(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[27],{"16hp":function(e,t,o){var r,n=t,i=o("oAGj"),a=o("SpAV"),l=o("CaSj"),s=o("UGKO"),c=o("FNB+"),u=o("cmoc"),g=o("eiag"),h=o("xe42"),f=o("OYRJ"),d=o("9Lk3"),p=o("fdtz"),m=o("lmwz"),v=o("3DEm"),C=o("K0Rh"),S=o("enh0"),y=o("sIWg"),F=o("1NAc");n.FormaPlacementSuggester=(r=function(e,t){l.DesignSuggester.call(this,e,t),this.maxSuggestions=3},i.defineClass({name:"FormaPlacementSuggester",ctor:r,superName:"DesignSuggester",statics:{KIND:{get:function(){return"FormaPlacementSuggester"}},createPlacementInputs:function(e,t){var o=[],r=[],n=[],l=[],s=[],h=[];return t.visitAll(c.FormaTraversal.PreOrder,(function(t){if(!(i.eq(c._equality_Forma_Forma,e,t)||t instanceof S.TextForma||null==t.controller)){var g=t.finalFrame;null!=g?((t.isBackgroundImage()||d.GridController.isBackgroundColoredCell(t))&&h.push(t),t instanceof u.FrameForma&&(r.push(g),s.push(t),e.originalID!=t.originalID&&l.push(g)),t.isTypeLockup()&&(o.push(g),e.originalID!=t.originalID&&l.push(g)),null!=t.controller&&t.controller.floating&&t.kind!=p.ImageForma.KIND&&e.originalID!=t.originalID&&(n.push(g),l.push(g))):a.CoreAssert.fail("something is wrong with this document. a forma has a nil frame","FormaPlacementSuggester.createPlacementInputs","FormaPlacementSuggester.swift",195)}})),new g.FormaPlacementInput(e,i.clone(l),i.clone(n),i.clone(o),i.clone(r),i.clone(s),i.clone(h))},createPlacementSuggestion:function(e,t,o,r,n){for(var a=0,l=0,s=0,c=i.iter(i.range(0,r.imageRects.length,!1));!c.done;c.next()){var u=c.value,g=r.imageRects[u];if(null!=(w=t.intersectionWith(g))&&w.area==t.area&&g.area>t.area){var d=r.images[u];a=v.MathUtils.maxDouble(a,d.controller.getAverageEdge(t)),l=v.MathUtils.maxDouble(l,d.controller.getFaceIntersections(t))}else null!=w&&(s+=w.area)}for(var p=o,m=0,C=i.iter(r.backgroundRegions);!C.done;C.next()){var S=C.value;(w=t.intersectionWith(S.finalFrame))&&(Math.abs(w.area-t.area)>100?m+=1:p=S.finalFrame)}n.setFeature(h.FormaPlacementScore.Features.REGION_BOUNDARY_OVERLAP,i.toDouble(m)),n.setFeature(h.FormaPlacementScore.Features.DISTANCE_TO_CENTER,t.center.distanceTo(o.center)/Math.max(o.width,o.height)),n.setFeature(h.FormaPlacementScore.Features.FACE,l),n.setFeature(h.FormaPlacementScore.Features.EDGE,a),n.setFeature(h.FormaPlacementScore.Features.IMAGE_EDGE_OVERLAP,s/o.area),n.setFeature(h.FormaPlacementScore.Features.SIZE,t.area/o.area);var y=1-Math.abs(t.width/o.width-2*t.height/o.height);n.setFeature(h.FormaPlacementScore.Features.ASPECT_RATIO,y);var F=t.minX-p.minX,P=p.maxX-t.maxX,I=1-Math.abs(F-P)/p.width;I<.98&&(I=0),n.setFeature(h.FormaPlacementScore.Features.XSYMM,I);var M=t.minY-p.minY,_=p.maxY-t.maxY,b=1-Math.abs(M-_)/p.height;b<.98&&(b=0),n.setFeature(h.FormaPlacementScore.Features.YSYMM,b);for(var k=0,T=i.iter(r.textRects);!T.done;T.next()){var x=T.value;Math.abs(x.center.x-t.center.x)<3&&(k+=1),Math.abs(x.minY-t.minY)<3?k+=.25:Math.abs(x.center.y-t.center.y)<3&&(k+=.1)}n.setFeature(h.FormaPlacementScore.Features.ALIGNMENT,k);for(var D=0,R=i.iter(r.textRects);!R.done;R.next()){var A=R.value;null!=(w=t.intersectionWith(A))&&(D+=w.area)}n.setFeature(h.FormaPlacementScore.Features.TEXT_OVERLAP,D/o.area);for(var L=0,E=i.iter(r.floatingRects);!E.done;E.next()){var w,N=E.value;(w=t.intersectionWith(N))&&(L+=w.area)}return n.setFeature(h.FormaPlacementScore.Features.FLOATING_ELEMENT_OVERLAP,L/o.area),new f.FormaPlacementSuggestion(e,t,n)}},props:{createSuggestions:function(){return this.createPlacementSuggestions(!0)},createPlacementSuggestions:function(e,t){if(void 0===t&&(t=null),null==this.group.frame)return[];var o=this.group.frame;this.group.kind==C.RootForma.KIND&&(o=y.TheoRect.fromSize(this.group.page.pageSize));var n,a=t;null==a&&this.forma.isImage()&&(n=m.ImageFacade.getImageFormaForForma(this.forma))&&(a=i.opt(n.bounds,(function(e){return e.aspectRatio})));var l=r.createPlacementInputs(this.forma,this.group),c=i.clone(this.getSearchLocations(this.forma,o,l,e,a));0==c.length&&c.push(o);for(var u,g=-1/0,f=new h.FormaPlacementScore(l),d=[],p=i.iter(c);!p.done;p.next()){var S=p.value,F=r.createPlacementSuggestion(this.forma,S,o,l,f);F.weightedScore.reject()||(d.push(F),f=new h.FormaPlacementScore(l)),F.score>g&&(g=F.score,u=F,f=new h.FormaPlacementScore(l))}if(e)return r.createPlacementSuggestion(this.forma,u.location,o,l,f),[i.as(u,s.IDesignSuggestion)];var P=[];P.push(u),i.sortInPlace(d,(function(e,t){return e.score>t.score}));for(var I=d.length,M=0,_=i.iter(i.range(0,this.maxSuggestions,!1));!_.done;_.next()){var b=null;for(M+=1;M<I;){for(var k=9999,T=i.iter(i.range(0,P.length,!1));!T.done;T.next()){var x=T.value;k=v.MathUtils.minDouble(k,d[M].distanceTo(P[x]))}if(k>.1){b=d[M];break}M+=1}if(null==b)break;P.push(b)}return P=i.clone(P.slice(1,P.length)),i.sortInPlace(P,(function(e,t){return e.location.center.x<t.location.center.x})),i.info("finished suggester"),[i.as(u,s.IDesignSuggestion)].concat(P)},fastPlacement:function(){var e=i.clone(this.createPlacementSuggestions(!0));return e.length>0?e[0]:null},getSearchLocations:function(e,t,o,r,n){void 0===n&&(n=null);var l=[],s=[],c=[],u=[],g=y.TheoRect.fromXXYY(v.MathUtils.minDouble(t.width/4,200),t.width-10,v.MathUtils.minDouble(t.height/4,100),t.height-10);r&&(g=y.TheoRect.fromXXYY(v.MathUtils.minDouble(t.width/4,200),t.width-10,v.MathUtils.minDouble(t.height/4,100),t.height-10));var h=t.area/10,f=t.area/5,d=g.minX,p=g.maxX,m=g.minY,C=g.maxY,S=t.width/20,P=t.height/20,I=r?5:8;null!=n&&(I*=I);var M=g.width/I,_=g.height/I;r&&(S=v.MathUtils.maxDouble(t.width/20,30),P=v.MathUtils.maxDouble(t.height/20,30)),s.push((t.minX+t.maxX)/2),c.push((t.minY+t.maxY)/2);for(var b=i.iter(o.otherRects.concat(o.backgroundRegions.map((function(e){return e.finalFrame}),this)));!b.done;b.next()){var k=b.value;s.push(k.center.x),c.push(k.center.y),c.push(k.minY)}for(var T=t.minX+5;T<t.maxX-5;)s.push(T),T+=S;for(var x=t.minY+5;x<t.maxY-5;)c.push(x),x+=P;var D=d;if(null==n)for(;D<p;){for(var R=m;R<C;)D*R>=h&&D*R<=f&&u.push(new F.TheoSize(D,R)),R+=_;D+=M}else{for(var A,L=0;D<p;){var E=D*(R=D/n);if(E>=h&&E<=f)u.push(new F.TheoSize(D,R));else if(0==u.length){var w=E<h?E/h:f/E;w>L&&(L=w,A=new F.TheoSize(D,R))}D+=M}0==u.length&&null!=A&&u.push(A)}for(var N=i.iter(s);!N.done;N.next())for(var O=N.value,B=i.iter(c);!B.done;B.next())for(var G=B.value,V=i.iter(u);!V.done;V.next()){var W=V.value;if(D=W.width,R=W.height,T=O-W.width/2,x=G-W.height/2,!(T+D>=t.maxX-5||x+R>=t.maxY-5||T<=t.minX+5||x<=t.minY+5||D/R<.5)){var U=y.TheoRect.fromXYWH(T,x,D,R);null!=n&&a.CoreAssert.isTrue(Math.abs(U.aspectRatio-n)<.001,void 0,"FormaPlacementSuggester.getSearchLocations","FormaPlacementSuggester.swift",513),l.push(U)}}return l}}}),r)},"4ZS9":function(e,t,o){var r,n=t,i=o("oAGj"),a=o("gXiO"),l=o("mGL3"),s=o("3UhB");n.FontSuggestionContext=(r=function(){this.currentDocumentFonts_=new l.OrderedFontSet,this.recentlyUsedFonts_=new l.OrderedFontSet,a.CoreObject.call(this)},i.defineClass({name:"FontSuggestionContext",ctor:r,superName:"CoreObject",props:{snapshotCurrentFonts:function(e){this.currentDocumentFonts_=s.TypeLockupUtils.fontsInDocument(e)},currentDocumentFonts:{get:function(){return this.currentDocumentFonts_}},addRecentlyUsedFont:function(e){var t=this,o=null;if(this.recentlyUsedFonts_.contains(e)){var r=e.displayFamilyName;o=i.clone(this.recentlyUsedFonts_.facesInFamily(r))}i.opt(o,(function(e){return e.forEach((function(e){return t.recentlyUsedFonts_.remove(e)}))})),i.opt(o,(function(e){return e.forEach((function(e){return t.recentlyUsedFonts_.append(e)}))})),this.recentlyUsedFonts_.append(e)},clearRecentFonts:function(){this.recentlyUsedFonts_=new l.OrderedFontSet},recentlyUsedFonts:{get:function(){return this.recentlyUsedFonts_}}}}),r)},"9BFu":function(e,t,o){var r,n,i=t,a=o("oAGj"),l=o("SpAV"),s=o("gXiO"),c=o("jC54");i.ScoreComponent=(r=function(e,t,o,r){this.std=1,this.mean=0,this.feature=e,this.weight=t,this.functionParam=o,this.featureName=r},a.defineClass({name:"ScoreComponent",ctor:r,props:{normalFeature:{get:function(){return(this.feature-this.mean)/this.std}}}}),r),i.applyFieldWidth=function(e,t){var o=e.length;return o>=t?e:a.toString(" ",t-o)+e},i.WeightedScore=(n=function(e){this.initScore=-1*a.toDouble(a.MAXFLOAT),this.components_=[],this.score_=0,this.recalculateScore_=!0,this.versionNumber=1;for(var t=a.iter(a.range(0,e,!1));!t.done;t.next())this.components_.push(new i.ScoreComponent(0,1,1e-5,"Feature"));s.CoreObject.call(this)},a.defineClass({name:"WeightedScore",ctor:n,superName:"CoreObject",props:{setFeature:function(e,t){this.recalculateScore_=!0,this.components_[e].feature=t},setStd:function(e,t){t>0&&(this.recalculateScore_=!0,this.components_[e].std=t)},setMean:function(e,t){this.recalculateScore_=!0,this.components_[e].mean=t},getFeatureValue:function(e){return this.components_[e].feature},setWeight:function(e,t){this.recalculateScore_=!0,this.components_[e].weight=t},getWeights:function(){for(var e=[],t=a.iter(this.components_);!t.done;t.next()){var o=t.value;e.push(o.weight)}return e},getNames:function(){for(var e=[],t=a.iter(this.components_);!t.done;t.next()){var o=t.value;e.push(o.featureName)}return e},getFeatures:function(){for(var e=[],t=a.iter(this.components_);!t.done;t.next()){var o=t.value;e.push(o.feature)}return e},setWeights:function(e){this.recalculateScore_=!0;for(var t=a.iter(a.range(0,e.length,!1));!t.done;t.next()){var o=t.value;this.components_[o].weight=e[o]}},setFunctionParam:function(e,t){this.recalculateScore_=!0,this.components_[e].functionParam=t},setFeatureName:function(e,t){this.components_[e].featureName=t},clearFeatures:function(){this.components_.forEach((function(e){e.feature=0}))},score:{get:function(){return this.recalculateScore_&&this.calculateScore(),isNaN(this.score_)&&l.CoreAssert.fail("nan score","WeightedScore","WeightedScore.swift",132),this.score_}},calculateScore:function(){var e=0;this.components_.forEach((function(t){return e+=Math.atan(t.normalFeature*t.functionParam)/Math.atan(t.functionParam)*t.weight})),this.recalculateScore_=!1,this.score_=e},asString:{get:function(){return this.getOutputString(!1,!1)}},nonZeroValues:{get:function(){return this.getOutputString(!0,!0)}},asSortedString:{get:function(){return this.getOutputString(!0,!1)}},getOutputString:function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var o="",r=this.score,n=0;if(this.components_.length>0){o+="Features:\n";var l=[];this.components_.forEach((function(e){if(!t||0!=e.normalFeature){var o=Math.atan(e.normalFeature*e.functionParam)/Math.atan(e.functionParam);n+=e.weight*o;var r=Math.round(1e3*e.feature)/1e3,a=Math.round(1e3*e.normalFeature)/1e3,s=Math.round(1e3*e.mean)/1e3,c=Math.round(1e3*e.std)/1e3,u=Math.round(1e3*e.weight)/1e3,g=Math.round(100*u*a)/100,h=" "+i.applyFieldWidth(e.featureName,10)+":\t ("+r+" - "+s+") / "+c+" * "+u+": "+g+" \n";l.push({value:u*a,out:h})}})),e&&a.sortInPlace(l,(function(e,t){return e.value<t.value}));for(var s=a.iter(l);!s.done;s.next())o+=s.value.out}return Math.abs(n-r)>.001&&(o+="ERROR. scores don't match: "+n+", "+r+" \n"),o+="Total: "+Math.round(1e3*r)/1e3+" \n"},reject:function(){return!1},getVersion:function(){return"v"+this.versionNumber},writeFeatureDict:function(e,t){var o=this,r=0;a.each(t,(function(t,n){var i=c.ModelWeightLibrary.getData(e,t);o.setFeatureName(r,t),o.setMean(r,i.mean),o.setStd(r,i.std),o.setWeight(r,i.weight),o.setFeature(r,n),r+=1}))}}}),n)},CaSj:function(e,t,o){var r,n=t,i=o("oAGj");n.DesignSuggester=(r=function(e,t){this.maxSuggestions_=100,this.forma_=e,this.group_=t},i.defineClass({name:"DesignSuggester",ctor:r,superName:"CoreObject",statics:{perms:function(e){return r.permute(i.clone(e),i.clone([]))},permute:function(e,t){if(0==e.length)return[t];for(var o=[],n=i.iter(i.range(0,e.length,!1));!n.done;n.next()){var a=n.value,l=i.clone(e),s=i.clone(t);s.push(l[a]),l.splice(a,1),i.append(o,r.permute(i.clone(l),i.clone(s)))}return o},getPermutations:function(e,t){void 0===t&&(t=50);var o=[];if(e<5){var n=i.toArray(i.range(0,e,!1));(o=i.clone(r.perms(i.clone(n)))).length>t&&(i.shuffleInPlace(o),o=i.clone(o.slice(0,t)))}else for(var a=i.iter(i.range(0,t,!1));!a.done;a.next())n=i.toArray(i.range(0,e,!1)),i.shuffleInPlace(n),o.push(i.clone(n));return o}},props:{maxSuggestions:{get:function(){return this.maxSuggestions_},set:function(e){this.maxSuggestions_=e}},forma:{get:function(){return this.forma_}},group:{get:function(){return this.group_}},createSuggestions:function(){return[]}}}),r)},Dq5S:function(e,t,o){var r,n,i=t,a=o("oAGj"),l=o("SpAV"),s=o("lmwz"),c=o("8t9B");i.ItemContentType=a.defineEnum("ItemContentType",{Image:0,Floating:1}),i.TextInfo=(r=function(){},a.defineClass({name:"TextInfo",ctor:r,props:{init_91e2:function(e,t,o){this.textLength=e,this.font=t,this.backingShape=o},init_implicit:function(e,t,o){this.textLength=e,this.font=t,this.backingShape=o},clone:function(){return r.init_implicit(this.textLength,this.font,this.backingShape)}}}),r),i.LayoutItem=(n=function(){this.aspectRatios_=null,this.importance_=null,this.focus_=null},a.defineClass({name:"LayoutItem",ctor:n,props:{init_b14a:function(e){this.id_=e.formaID,this.forma_=e;var t,o,r=this.forma_.controller.floating,n=s.ImageFacade.getImageFormaForForma(e);if(r||null==n){if(l.CoreAssert.isTrue(this.forma_.controller.floating,void 0,"LayoutItem.init","LayoutItem.swift",56),this.type_=i.ItemContentType.Floating,t=a.as(e.controller,c.TypeLockupController)){var u=t.text.length,g=a.opt(a.opt(t.lockupStyle,(function(e){return e.font})),(function(e){return e.fontData.postScriptName})),h=a.opt(t.lockupStyle,(function(e){return e.backingShapeID}));this.textInfo_=a.clone(i.TextInfo.init_91e2(u,g,h))}}else this.type_=i.ItemContentType.Image,(o=n.contentNode)&&(this.width_=a.toDouble(o.pixelWidth),this.height_=a.toDouble(o.pixelHeight),this.focus_=o.focusRegion)},init_e2cb:function(e,t,o,r,n,i,l){void 0===i&&(i=null),void 0===l&&(l=null),this.id_=e,this.type_=t,this.width_=o,this.height_=r,this.textInfo_=a.clone(n),this.aspectRatios_=a.clone(i),this.importance_=l,this.forma_=null},id:{get:function(){return this.id_}},forma:{get:function(){return this.forma_}},type:{get:function(){return this.type_}},width:{get:function(){return this.width_}},height:{get:function(){return this.height_}},textInfo:{get:function(){return this.textInfo_}},focusRegion:{get:function(){return this.focus_}},aspectRatios:{get:function(){return this.aspectRatios_},set:function(e){this.aspectRatios_=a.clone(e)}},importance:{get:function(){return this.importance_},set:function(e){this.importance_=e}}}}),n)},HG3C:function(e,t,o){var r,n,i=t,a=o("oAGj"),l=o("YSlt"),s=o("FNB+"),c=o("iCxV"),u=o("c+uM"),g=o("TkOd"),h=o("3DEm"),f=o("35Q0"),d=o("8t9B");i.ReadabilityInformation=(r=function(e,t){this.readabilityScore=e,this.readabilityString=t},a.defineClass({name:"ReadabilityInformation",ctor:r,props:{clone:function(){return new r(this.readabilityScore,this.readabilityString)}}}),r),i.LockupReadabilityEvaluator=(n=function(e,t){this.currentVersion="1.1",this.backgroundVariance=e,this.currentPosition=t.placement},a.defineClass({name:"LockupReadabilityEvaluator",ctor:n,statics:{calculateBackgroundVariance:function(e){var t,o=new l.ColorRankSuggester,r=[];if(t=a.as(e.controller,d.TypeLockupController))for(var n=a.iter(t.getBackgroundColorsFullList());!n.done;n.next()){var i=n.value;r.push(a.clone(l.ColorForComparison.init_c063(i,1)))}return o.getVarianceOfColors(a.clone(r))}},props:{getAllLockupVisualWeights:function(e){var t=this,o={};return e.root.page.root.visitAll(s.FormaTraversal.PreOrder,(function(e){var r=e.formaID;if(a.as(e.controller,d.TypeLockupController)){var n=a.clone(t.getLockupVisualWeight(e));o[r]=a.clone(n)}})),o},getLockupReadabilityInformation:function(e,t){var o;if(this.updateVarianceIfPositionHasChanged(e),null!=(o=this.getDensity(e,t))){var r=this.getBackgroundColorVariance(e,t);r<=.01&&(r=.01);var n=this.getLockupContrast(e,t),a=this.getPointSize(e),l=o/100*(n/r)/100*a/100,s="{score:"+h.MathUtils.roundDoubleToString(l,6)+",density:"+h.MathUtils.roundDoubleToString(o,6)+",variance:"+h.MathUtils.roundDoubleToString(r,6)+",backVar:"+h.MathUtils.roundDoubleToString(this.backgroundVariance,6)+",contrast:"+h.MathUtils.roundDoubleToString(n,6)+",size:"+h.MathUtils.roundDoubleToString(a,6)+",ver:"+this.currentVersion+"}";return new i.ReadabilityInformation(l,s)}return null},getLockupVisualWeight:function(e){var t,o=[1,1,1],r=this.getLockupSize(e),n=this.getLockupContrast(e,e.style);return null!=(t=this.getDensity(e,e.style))?{Contrast:n,Density:t,Size:r,VisualWeight:n*o[0]+t*o[1]+r*o[2]}:{Contrast:n,Density:-1,Size:r,VisualWeight:n*o[0]+r*o[2]}},getDensity:function(e,t){var o,r,n,i;return(o=a.opt(c.Host.fontProvider,(function(t){return t.getIncludedFonts(e.page.document)})))&&null!=(r=a.opt(t.font,(function(e){return e.fontData.postScriptName})))&&null!=(n=o.getIndexOfPostScriptName(r))&&null!=(i=o.fontAt(n).characterFeatures.area_perimeter_ratio)?i:null},getLockupSize:function(e){var t,o,r=0;return(t=a.as(e.controller,d.TypeLockupController))&&(o=t.size)&&(r=o.area),o=r/e.page.pageSize.area},getLockupContrast:function(e,t){var o,r=a.clone(g.InterestingPageData.init_a05b(e)),n=new l.ColorRankSuggester,i=a.clone(g.lockupStyleToLockupStyleAttributes(t,e.page.document)),s=(f.ShapeLibrary.shapeDictionary[i.backing]||f.ShapeLibrary.shapeDictionary.none).filled,c=u.LockupStyle.isKnockoutLook(t.textLook),h=i.primaryColor,d=[];c?(o=e.page.colorLibraryController.getSolidColorForKey(i.secondaryColor))&&d.push(o):(o=e.page.colorLibraryController.getSolidColorForKey(h))&&d.push(o);var p,m=[];if(0==s||c)for(var v=a.iter(r.colorsBehindSelectedLockup);!v.done;v.next()){var C=v.value;m.push(a.clone(l.ColorForComparison.init_c063(C,1)))}else(p=e.page.colorLibraryController.getSolidColorForKey(i.secondaryColor))&&m.push(a.clone(l.ColorForComparison.init_c063(p,1)));return a.clone(n.weightedColorContrastRanker(a.clone(m),a.clone(d)))[0]/a.toDouble(m.length)},getBackgroundColorVariance:function(e,t){var o=a.clone(g.lockupStyleToLockupStyleAttributes(t,e.page.document)),r=0;return 0==(f.ShapeLibrary.shapeDictionary[o.backing]||f.ShapeLibrary.shapeDictionary.none).filled&&(r=this.backgroundVariance),r},getPointSize:function(e){var t,o=0;return(t=a.as(e.controller,d.TypeLockupController))&&(o=t.getAverageFontSize()),o},updateVarianceIfPositionHasChanged:function(e){e.placement.equal(this.currentPosition)||(this.currentPosition=e.placement,this.backgroundVariance=n.calculateBackgroundVariance(e))}}}),n)},HWAX:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("SpAV"),l=o("yhkb"),s=o("C42b"),c=o("YSlt"),u=o("jcfx"),g=o("7Ta2");n.ColorSelectorUtils=(r=function(){},i.defineClass({name:"ColorSelectorUtils",ctor:r,statics:{getLightDarkColorToPreventIllegibility:function(e,t){for(var o=null,n=e.page.colorLibraryController.getProfilingColorKeys().concat(e.page.colorLibraryController.getThemeColorKeys()).concat(l.ColorLibraryController.BW_KEYS),a=[],s=i.iter(i.range(0,n.length,!1));!s.done;s.next()){var u,g=s.value;(u=e.page.colorLibraryController.getSolidColorForKey(n[g]))&&a.push(u)}var h,f=new c.ColorRankSuggester,d=i.clone(f.weightedColorContrastRanker(i.clone(t),i.clone(a)));return null!=(h=r.getIndexOfContrastingColorChoice(i.clone(d)))&&(o=n[h]),o},getIndexOfContrastingColorChoice:function(e){var t=null,o=i.clone(e);i.sortInPlace(o);for(var r=0,n=o.length>5?o.length-5:0,a=i.iter(i.range(n,o.length,!1).reversed());!a.done;a.next()){var l=a.value;o[l]>0&&(r=o[l])}for(var c=!1;!c&&r>0;){var u=s.CoreRandom.nextIntUniform(100)%e.length;e[u]>=r&&(t=u,c=!0)}return t},getComparisonColors:function(e,t,o){var r=[];if(null!=t)for(var n=i.iter(t);!n.done;n.next()){var a=n.value;r.push(i.clone(c.ColorForComparison.init_c063(a,1)))}return null!=o&&r.push(i.clone(o)),r},getSolidColorForChoices:function(e,t,o){for(var r=[],n=i.iter(i.range(0,o.length,!1));!n.done;n.next()){var a,l=n.value;(a=e.page.colorLibraryController.getSolidColorForKey(o[l]))&&r.push(a)}return r},mapInferredRoleToProfilingRole:function(e,t){void 0===t&&(t=null);var o=i.clone(t||(new g.RoleSuggester).getRole(e));return(new u.ProfilingColorMap).getProfilingCategoryForInferredRole(i.clone(o))},makeFinalDecisionOnColorChoice:function(e,t,o,n,l,s,u){if(void 0===l&&(l=!1),void 0===u&&(u=!1),0==o.length)return null;var g,h=new c.ColorRankSuggester,f=i.clone(h.weightedColorContrastRanker(i.clone(t),i.clone(n),l)),d=null,p=i.max(f);if(null!=p&&p>0?d=this.getContrastingChoice(u,i.clone(f),i.clone(o)):(d=r.getLightDarkColorToPreventIllegibility(e,i.clone(t)),a.CoreAssert.isTrue(null!=d,"Error: we couldn't find a legible color :(","ColorSelectorUtils.makeFinalDecisionOnColorChoice","ColorSelectorUtils.swift",136)),null!=(g=d)){var m,v=this.handlePaletteMappingOverride(g,e,s,i.clone(f),i.clone(o));(m=e.page.colorLibraryController.getSolidColorForKey(v))&&(0!=i.clone(h.weightedColorContrastRanker(i.clone(t),[m],l))[0]||s)&&(d=v)}return null==d&&(d=o[0]),d},getContrastingChoice:function(e,t,o){var r=null,n=i.max(t);if(e)r=o[i.indexOf(t,n)];else for(var a=i.iter(i.range(0,t.length,!1));!a.done;a.next()){var l=a.value;if(0!=t[l]){r=o[l];break}}return r},handlePaletteMappingOverride:function(e,t,o,r,n){var a="None";return a=o?t.formaID+u.ProfilingColorMap.backingColorKey:t.formaID,(new u.ProfilingColorMap).overridePaletteMappingDueToContrastAndForceDifference(e,a,i.clone(r),i.clone(n))},compareTwoColorStringsWithMargin:function(e,t){for(var o=!0,n=i.clone(r.convertColorStringToInt(e)),a=i.clone(r.convertColorStringToInt(t)),l=i.iter(i.range(0,n.length,!1));!l.done;l.next()){var s=l.value;n[s]!=a[s]&&n[s]!=a[s]-1&&n[s]!=a[s]+1&&(o=!1)}return o},convertColorStringToInt:function(e){for(var t=[],o=i.iter(i.range(0,i.toInt(e.length/3),!1));!o.done;o.next()){var r,n=o.value,a=e.substr(3*n,3);null!=(r=i.toInt(a))&&t.push(r)}return t}}}),r)},OYRJ:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("SpAV"),l=o("UGKO"),s=o("K0Rh");n.FormaPlacementSuggestion=(r=function(e,t,o){a.CoreAssert.isTrue(e.kind!=s.RootForma.KIND,void 0,"FormaPlacementSuggestion.init","FormaPlacementSuggestion.swift",17),this.forma_=e,this.score_=o,this.location_=t},i.defineClass({name:"FormaPlacementSuggestion",ctor:r,statics:{_implements:function(e){return"IDesignSuggestion"==e}},props:{location:{get:function(){return this.location_}},distanceTo:function(e){var t=e,o=0,r=this.forma_.page.pageSize.hypotenuse;return o+=l.distancePositionWeight*this.location_.center.distanceTo(t.location.center)/r,o+=l.distanceSizeWeight*Math.abs(this.location_.width-t.location.width)/r,o+=l.distanceSizeWeight*Math.abs(this.location_.height-t.location.height)/r},apply:function(){this.forma_.controller.fit(this.location_)},score:{get:function(){return this.score_.score}},weightedScore:{get:function(){return this.score_}},forma:{get:function(){return this.forma_}}}}),r)},Ohrj:function(e,t,o){var r,n,i,a=t,l=o("oAGj"),s=o("SpAV"),c=o("yhkb"),u=o("HWAX"),g=o("jcfx");a.ProfilingColorSelector=(r=function(e,t){var o;this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.currentIndividualIndex=0,this.numIndividualChoices=5,this.isBacking=!1,this.forma=e,this.isBacking=t,(o=l.opt(this.forma,(function(e){return e.controller})))?this.colorsBehindForma=l.clone(o.getBackgroundColors()):this.colorsBehindForma=[],this.values=e.page.colorLibraryController.getThemeColorKeys().concat(e.page.colorLibraryController.getProfilingColorKeys())},l.defineClass({name:"ProfilingColorSelector",ctor:r,props:{updateBackgroundColors:function(e){this.colorsBehindForma=l.clone(e||l.opt(l.opt(this.forma,(function(e){return e.controller})),(function(e){return e.getBackgroundColors()})))},selectColorForGlobalRecolor:function(e,t,o,r){void 0===e&&(e=!0),void 0===t&&(t=null),void 0===o&&(o=!1),void 0===r&&(r=null);var n=c.ColorLibraryController.BW_KEYS[0];if(null!=this.forma){var i=u.ColorSelectorUtils.mapInferredRoleToProfilingRole(this.forma,l.clone(r)),a=l.clone(u.ColorSelectorUtils.getComparisonColors(this.forma,l.clone(e?this.colorsBehindForma:null),l.clone(t))),s=l.clone(this.getListOfColorChoicesForRoleGlobal(i));if(s.length>0){var g,h=l.clone(u.ColorSelectorUtils.getSolidColorForChoices(this.forma,i,l.clone(s)));null!=(g=u.ColorSelectorUtils.makeFinalDecisionOnColorChoice(this.forma,l.clone(a),l.clone(s),l.clone(h),o,this.isBacking,!1))&&(n=g)}}return n},selectColorForIndividualRecolor:function(e,t,o,r){void 0===e&&(e=!0),void 0===t&&(t=null),void 0===r&&(r=null);var n=c.ColorLibraryController.THEME_DERIVED_BW_KEYS[0];if(null!=this.forma){var i=u.ColorSelectorUtils.mapInferredRoleToProfilingRole(this.forma,l.clone(r)),a=l.clone(u.ColorSelectorUtils.getComparisonColors(this.forma,l.clone(e?this.colorsBehindForma:null),l.clone(t))),s=l.clone(this.getListOfColorChoicesForRoleIndividual(i));if(s.length>0){var g=l.clone(u.ColorSelectorUtils.getSolidColorForChoices(this.forma,i,l.clone(s))),h=this.currentIndividualIndex%s.length,f=s.concat();f.splice(0,0,s[h]);var d,p=g.concat();p.splice(0,0,g[h]),null!=(d=u.ColorSelectorUtils.makeFinalDecisionOnColorChoice(this.forma,l.clone(a),l.clone(f),l.clone(p),o,this.isBacking))&&(n=d)}}return this.currentIndividualIndex=(this.currentIndividualIndex+1)%this.numIndividualChoices,n},getListOfColorChoicesForRoleGlobal:function(e){return s.CoreAssert.fail("base color selector not implemented. use primary or background","ProfilingColorSelector.getListOfColorChoicesForRoleGlobal","ColorSelector.swift",116),[]},getListOfColorChoicesForRoleIndividual:function(e){return s.CoreAssert.fail("base color selector not implemented. use primary or background","ProfilingColorSelector.getListOfColorChoicesForRoleIndividual","ColorSelector.swift",121),[]}}}),r),a.ProfilingPrimaryColorSelector=(n=function(e,t){a.ProfilingColorSelector.call(this,e,t)},l.defineClass({name:"ProfilingPrimaryColorSelector",ctor:n,superName:"ProfilingColorSelector",props:{getListOfColorChoicesForRoleGlobal:function(e){return(new g.ProfilingColorMap).getPrimaryColorsForRoleGlobal(e,this.forma.formaID,this.forma.page)},getListOfColorChoicesForRoleIndividual:function(e){return(new g.ProfilingColorMap).getPrimaryColorsForRoleIndividual(this.forma.page,e,this.numIndividualChoices)}}}),n),a.ProfilingBackgroundColorSelector=(i=function(e,t){a.ProfilingColorSelector.call(this,e,t)},l.defineClass({name:"ProfilingBackgroundColorSelector",ctor:i,superName:"ProfilingColorSelector",props:{getListOfColorChoicesForRoleGlobal:function(e){return(new g.ProfilingColorMap).getBackgroundColorsForRoleGlobal(e,this.forma.formaID,this.forma.page)},getListOfColorChoicesForRoleIndividual:function(e){return(new g.ProfilingColorMap).getBackgroundColorsForRoleIndividual(this.forma.page,e,this.numIndividualChoices)}}}),i)},P4KF:function(e,t,o){var r,n,i,a,l=t,s=o("oAGj"),c=o("7Ta2"),u=o("RkYL");l.Timing=(r=function(){},s.defineClass({name:"Timing",ctor:r,props:{init_c5c1:function(e,t,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===o&&(o=""),this.start=e,this.end=t,this.formaID=o},init_implicit:function(e,t,o){this.start=e,this.end=t,this.formaID=o},clone:function(){return r.init_implicit(this.start,this.end,this.formaID)}}}),r),l.LockupTiming=(n=function(e,t){this.startTime=e,this.endTime=t},s.defineClass({name:"LockupTiming",ctor:n,props:{clone:function(){return new n(this.startTime,this.endTime)}}}),n),l.RoleOrderIndexing=(i=function(){},s.defineClass({name:"RoleOrderIndexing",ctor:i,props:{init_27ef:function(e,t,o,r){void 0===e&&(e=""),void 0===t&&(t=""),void 0===o&&(o=0),void 0===r&&(r=0),this.roleString=e,this.formaID=t,this.posX=o,this.posY=r},init_implicit:function(e,t,o,r){this.roleString=e,this.formaID=t,this.posX=o,this.posY=r},clone:function(){return i.init_implicit(this.roleString,this.formaID,this.posX,this.posY)}}}),i),l.RoleBasedAnimationTiming=(a=function(){this.formaIndex=0,this.lockupRoleBasedTiming=[],this.lockupHierarchyBasedTiming=[],this.currentInterval=0,this.finalAnimDuration=15},s.defineClass({name:"RoleBasedAnimationTiming",ctor:a,props:{updateTiming:function(e,t){this.formaIndex=0,this.lockupRoleBasedTiming=[],this.setLockupRoleBasedTiming(s.clone(e)),this.setLockupHierarchyBasedTiming(s.clone(e))},getLockupRoleBasedTiming:function(e,t){this.currentInterval=e;for(var o=s.clone(l.Timing.init_c5c1()),r=s.iter(this.lockupRoleBasedTiming);!r.done;r.next()){var n=r.value;n.formaID==t&&(o=s.clone(n))}var i=new u.TheoTime(o.start*e,30),a=new u.TheoTime(o.end*e,30);return new l.LockupTiming(i,a)},getLockupHierarchyBasedTiming:function(e){this.currentInterval=e;var t=new u.TheoTime(this.lockupHierarchyBasedTiming[this.formaIndex].start*e,30),o=new u.TheoTime(this.lockupHierarchyBasedTiming[this.formaIndex].end*e,30);return this.formaIndex+=1,new l.LockupTiming(t,o)},getFinalAnimStartTime:function(){return new u.TheoTime(this.getFinalEndTime(),30)},getFinalAnimEndTime:function(){return new u.TheoTime(this.getFinalEndTime()+this.getFinalEndDuration(),30)},getFinalEndTime:function(){return this.lockupRoleBasedTiming.length*this.currentInterval},getFinalEndDuration:function(){return this.finalAnimDuration},setLockupRoleBasedTiming:function(e){for(var t=[],o=s.iter(e);!o.done;o.next()){var r=o.value;if(r.isTypeLockup()){var n=s.clone(r.totalPlacement.transformPoints(s.clone(r.bounds.points)));t.push(s.clone(l.RoleOrderIndexing.init_27ef((new c.RoleSuggester).getRole(r).role,r.formaID,n[0].x,n[0].y)))}}for(var i=[],a=s.iter(["Title","Quote","Subtitle","Call to Action","Body Text","Contact Info","Social Media Reference"]);!a.done;a.next())for(var u=a.value,g=s.iter(s.range(0,t.length,!1));!g.done;g.next())t[g.value].roleString==u&&i.push(u);for(var h=0,f=s.iter(i);!f.done;f.next()){var d=f.value,p=s.clone(this.getNextElementAndRemove(d,t));this.lockupRoleBasedTiming.push(s.clone(l.Timing.init_c5c1(h,h+1,p.formaID))),h+=1}},setLockupHierarchyBasedTiming:function(e){for(var t=0,o=s.iter(e);!o.done;o.next()){var r=o.value;if(r.isTypeLockup()){var n=t+1;this.lockupHierarchyBasedTiming.push(s.clone(l.Timing.init_c5c1(t,n,r.formaID))),t+=1}}},getNextElementAndRemove:function(e,t){for(var o=s.clone(l.RoleOrderIndexing.init_27ef()),r=s.iter(t);!r.done;r.next()){var n=r.value;if(n.roleString==e){o=s.clone(n),this.checkIfMultipleInstances(e,s.clone(t))&&(o=s.clone(this.findNextElementOfRole(e,s.clone(t)))),this.removeRoleOrderElement(o.formaID,t);break}}return o},removeRoleOrderElement:function(e,t){for(var o=0,r=s.iter(t);!r.done;r.next()){if(r.value.formaID==e){t.splice(o,1);break}o+=1}},checkIfMultipleInstances:function(e,t){for(var o=0,r=s.iter(t);!r.done;r.next())r.value.roleString==e&&(o+=1);return o>1},findNextElementOfRole:function(e,t){for(var o=[],r=s.iter(t);!r.done;r.next())(a=r.value).roleString==e&&o.push(s.clone(a));for(var n=s.clone(o[0]),i=s.iter(o);!i.done;i.next()){var a;(a=i.value).posY<=n.posY?n=s.clone(a):a.posX<=n.posX&&a.posY<=n.posY&&(n=s.clone(a))}return n}}}),a)},TP4q:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("pnSN"),l=o("cbNz"),s=o("9BFu");n.GridScore=(r=function(e,t,o,r,n,c,u,g){this.dataset="DefaultGridScore",this.rejectThreshold=-1e3,void 0===e&&(e=null),void 0===r&&(r=null),void 0===n&&(n=!1),void 0===c&&(c=null),void 0===u&&(u=null),void 0===g&&(g=null),this.currentGrid_=r,this.gridStyle_=e,this.gridFrame_=t,this.contentAware_=n,this.layoutItems_=i.clone(o);var h=i.clone(new l.GridStyleFeatureExtractor(i.as(r,a.GroupForma),i.clone(u),i.clone(g),e,t,i.clone(o)).features);s.WeightedScore.call(this,i.count(h)),this.writeFeatureDict(this.dataset,i.clone(h)),null!=c&&c.length==i.count(h)&&this.setWeights(i.clone(c))},i.defineClass({name:"GridScore",ctor:r,superName:"WeightedScore",props:{gridStyle:{get:function(){return this.gridStyle_}},reject:function(){return this.score<this.rejectThreshold}}}),r)},UGKO:function(e,t,o){var r,n,i=t,a=o("oAGj"),l=o("SpAV"),s=o("8t9B");i.distanceColorWeight=1,i.distanceSizeWeight=.25,i.distancePositionWeight=.5,i.IDesignSuggestion=a.defineProtocol("IDesignSuggestion",{apply:"() -> Void",distanceTo:"(IDesignSuggestion) -> Double",score:"Double",weightedScore:"WeightedScore",forma:"Forma"}),i.DesignTextSuggestion=(r=function(e,t){this.text_=t;var o=a.as(e.controller,s.TypeLockupController);l.CoreAssert.isTrue(null!=o,"must be type lockup controller","DesignTextSuggestion.init","DesignSuggestion.swift",31),this.forma_=e},a.defineClass({name:"DesignTextSuggestion",ctor:r,statics:{_implements:function(e){return"IDesignSuggestion"==e}},props:{apply:function(){var e=this,t=a.as(this.forma_.controller,s.TypeLockupController);a.opt(a.opt(t,(function(e){return e.contentNode})),(function(t){return t.text=e.text_})),a.opt(t,(function(e){return e.updateGroup()})),a.opt(a.opt(this.forma_.page.document,(function(e){return e.controller})),(function(e){return e.controllerSettingsState.settings=null}))},distanceTo:function(e){return l.CoreAssert.fail("no distance","DesignTextSuggestion.distanceTo","DesignSuggestion.swift",45),0},score:{get:function(){return null}},weightedScore:{get:function(){return null}},forma:{get:function(){return this.forma_}}}}),r),i.AddFormaSuggestion=(n=function(e,t){this.parent_=t,this.forma_=e},a.defineClass({name:"AddFormaSuggestion",ctor:n,statics:{_implements:function(e){return"IDesignSuggestion"==e}},props:{apply:function(){this.parent_.appendChild(this.forma_)},distanceTo:function(e){return l.CoreAssert.fail("no distance","AddFormaSuggestion.distanceTo","DesignSuggestion.swift",68),0},score:{get:function(){return null}},weightedScore:{get:function(){return null}},forma:{get:function(){return this.forma_}}}}),n)},UqVc:function(e,t,o){var r,n=t,i=o("oAGj");n.SuggestionUtils=(r=function(){},i.defineClass({name:"SuggestionUtils",ctor:r,props:{normalizedWeights:function(e){var t,o,r=[];if(null!=(t=i.min(e))&&null!=(o=i.max(e)))for(var n=o-t==0,a=i.iter(e);!a.done;a.next()){var l=a.value;if(n)r.push(1);else{var s=(l-t)/(o-t);r.push(s)}}return r},weightsEqualNaNOrEmpty:function(e){if(0==e.length==1)return!0;for(var t=i.iter(e);!t.done;t.next()){var o=t.value;if(1==isNaN(o))return!0}return!1}}}),r)},YSlt:function(e,t,o){var r,n,i=t,a=o("oAGj"),l=o("SpAV"),s=o("3DEm"),c=o("Zifs");i.ColorForComparison=(r=function(){this.role=""},a.defineClass({name:"ColorForComparison",ctor:r,props:{init_c063:function(e,t,o){void 0===o&&(o=""),this.color=e,this.weight=t,this.role=o},init_implicit:function(e,t,o){void 0===o&&(o=""),this.color=e,this.weight=t,this.role=o},clone:function(){return r.init_implicit(this.color,this.weight,this.role)}}}),r),i.ColorRankSuggester=(n=function(){},a.defineClass({name:"ColorRankSuggester",ctor:n,superName:"CoreObject",props:{weightedColorContrastRanker:function(e,t,o){var r;void 0===o&&(o=!1);var n=15*a.toDouble(e.length);o&&(n*=2);for(var i=a.repeat(0,t.length),l=a.iter(a.range(0,t.length,!1));!l.done;l.next()){for(var s=l.value,u=t[s],g=0,h=a.iter(a.range(0,e.length,!1));!h.done;h.next()){var f,d=h.value;if(f=e[d].color){var p=(r=e[d].weight)||null!=r?r:1;if(a.eq(c._equality_SolidColor_SolidColor,u,f))g+=1;else{var m=(1*f.perceptualDifference(u)+50*Math.pow(f.lightnessDifference(u)/50,2)*.7)/2;i[s]+=m*p}}}var v=a.toDouble(g)/a.toDouble(e.length);v>.4||g==e.length?i[s]=0:i[s]<n?i[s]=0:i[s]*=1-v}return i},getVarianceOfColors:function(e){if(e.length<1)return l.CoreAssert.info("ColorRankSuggester.getVarianceOfColors() has no colors in listOfCompared"),0;var t=[];t.push([]),t.push([]),t.push([]),t.push([]);for(var o=a.iter(e);!o.done;o.next()){var r;(r=(p=o.value).color)&&(t[0].push(r.red),t[1].push(r.green),t[2].push(r.blue),t[3].push(r.alpha))}for(var n=[],i=a.iter(t);!i.done;i.next()){var u,g=i.value;null!=(u=s.MathUtils.getMean(a.clone(g)))&&n.push(u)}if(4!=n.length)return l.CoreAssert.info("ColorRankSuggester.getVarianceOfColors(): Unable to get complete avgRGBA values. # Values = "+a.toString(n.length)),0;for(var h=new c.SolidColor(n[0],n[1],n[2],n[3]),f=[],d=a.iter(e);!d.done;d.next()){var p;(p=d.value.color)&&f.push(p.perceptualDifference(h))}return this.getVarianceFromDifferences(a.clone(f))},getVarianceFromDifferences:function(e){for(var t=0,o=a.iter(e);!o.done;o.next()){var r=o.value;t+=r*r}return t/a.toDouble(e.length)}}}),n)},ZLO9:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("gXiO");n.RetargetDocumentData=(r=function(e,t,o,r,n,l,s,c,u,g,h,f,d){this.docID=e,this.size=t,this.lockupStrings=i.clone(o),this.focus=r,this.numImages=n,this.edgeMap=i.clone(s),this.layoutID=c,this.numMoveable=l,this.numGridCells=u,this.textRoles=i.clone(g),this.shapeRoles=i.clone(h),this.salientCoverage=f,this.visualGroupInfo=i.clone(d),a.CoreObject.call(this)},i.defineClass({name:"RetargetDocumentData",ctor:r,superName:"CoreObject"}),r)},bSZx:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("P83h"),l=o("9Lk3");n.GridSuggestion=(r=function(e,t,o){void 0===e&&(e=null),this.gridStyle_=t,this.forma_=e,this.score_=o},i.defineClass({name:"GridSuggestion",ctor:r,superName:"CoreObject",props:{gridStyle:{get:function(){return this.gridStyle_}},score:{get:function(){return this.score_.score}},weightedScore:{get:function(){return this.score_}},apply:function(){if(i.info("Grid score:"),i.info(this.score_.asString),null!=this.forma_){var e,t=new a.FormaTransformChangedEvent(this.forma_);this.forma_.beginUpdate(t),(e=i.as(this.forma_.controller,l.GridController))&&(this.gridStyle_.forma=this.forma_,e.applyGridStyleWithMapping(this.gridStyle_,!0)),this.forma_.endUpdate(t)}}}}),r)},eiag:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("gXiO");n.FormaPlacementInput=(r=function(e,t,o,r,n,l,s){this.forma=e,this.otherRects=i.clone(t),this.floatingRects=i.clone(o),this.textRects=i.clone(r),this.imageRects=i.clone(n),this.images=i.clone(l),this.backgroundRegions=i.clone(s),a.CoreObject.call(this)},i.defineClass({name:"FormaPlacementInput",ctor:r,superName:"CoreObject"}),r)},h8Q5:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("hb8m");n.WheelSuggestionEvaluator=(r=function(e){this.lockupStyleEvaluator=new a.LockupStyleEvaluator(e)},i.defineClass({name:"WheelSuggestionEvaluator",ctor:r,superName:"CoreObject"}),r)},hb8m:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("wc1n"),l=o("xRbc"),s=o("HG3C"),c=o("c+uM");n.LockupStyleEvaluator=(r=function e(t){this.forma_=t,this.backgroundVariance=s.LockupReadabilityEvaluator.calculateBackgroundVariance(t),this.lockupVisualWeightEvaluator=new s.LockupReadabilityEvaluator(this.backgroundVariance,t),this.oldReadabilityInformation=i.clone(this.lockupVisualWeightEvaluator.getLockupReadabilityInformation(this.forma_,t.style)),this.featuresNeeded=[l.LockupRoleFeatures.SurroundingAlignment];var o=a.FeatureExtractorFactory.getFeatureExtractor(a.FeatureExtractorType.LockupStyle,this.forma_,i.clone(this.featuresNeeded));this.majorityAlignment=e.getSurroundingAlignment(o)},i.defineClass({name:"LockupStyleEvaluator",ctor:r,superName:"CoreObject",statics:{getCollisionPercentage:function(e){var t,o=0;return null!=(t=e.numericFeatureForKey(l.LockupRoleFeatures.CollisionPercentage))&&(o=t),o},getSurroundingAlignment:function(e){var t,o,r=c.LockupAlignment.UNSET;return null!=(t=e.featureForKey(l.LockupRoleFeatures.SurroundingAlignment))&&null!=(o=i.as(t,c.LockupAlignment))&&(r=o),r}},props:{styleEvaluatedWithReadability:function(e){var t=e;return this.newReadabilityInformation=i.clone(this.lockupVisualWeightEvaluator.getLockupReadabilityInformation(this.forma_,e)),e.backing==c.LockupBacking.Knockout&&(t=null),e.layout!=c.LockupLayout.FitJustified&&this.majorityAlignment!=c.LockupAlignment.UNSET&&e.alignment!=this.majorityAlignment&&(t=null),null!=this.newReadabilityInformation&&null!=this.oldReadabilityInformation&&this.newReadabilityInformation.readabilityScore<=this.oldReadabilityInformation.readabilityScore/2&&(t=null),t},initializeReadabilityInformation:function(e){this.newReadabilityInformation=i.clone(this.lockupVisualWeightEvaluator.getLockupReadabilityInformation(this.forma_,e))},getOldReadabilityInformation:function(){return this.oldReadabilityInformation},getNewReadabilityInformation:function(){return this.newReadabilityInformation}}}),r)},jcfx:function(e,t,o){var r,n,i,a=t,l=o("oAGj"),s=o("SpAV"),c=o("C42b"),u=o("HWAX"),g=o("FNB+"),h=o("9Lk3"),f=o("NkBu"),d=o("c+uM"),p=o("7Ta2"),m=o("JO5d"),v=o("8t9B");a.ProfilingCategories=l.defineEnum("ProfilingCategories",{Title:0,Subtitle:1,Body:2,Action:3,GraphicContent:4,Backing:5,Background:6,Separator:7,Decoration:8,NUM_CATEGORIES:9}),a.ColorProfiles=(r=function(){this.PrimaryProfileMedians={},this.BackgroundProfileMedians={},this.PrimaryProfileMedians[a.ProfilingCategories.Title]=[.12545,.09302,.94901],this.PrimaryProfileMedians[a.ProfilingCategories.Subtitle]=[.077319,.04819,.94901],this.PrimaryProfileMedians[a.ProfilingCategories.Body]=[.044715,.12156,.94901],this.PrimaryProfileMedians[a.ProfilingCategories.Action]=[.06959,.04819,.97647],this.BackgroundProfileMedians[a.ProfilingCategories.Title]=[.12581,.20392,.94901],this.BackgroundProfileMedians[a.ProfilingCategories.Subtitle]=[.079709,.44815,.94313],this.BackgroundProfileMedians[a.ProfilingCategories.Body]=[.07142,.20129,.96274],this.BackgroundProfileMedians[a.ProfilingCategories.Action]=[.5,.46886,.89803],this.PrimaryProfileMedians[a.ProfilingCategories.GraphicContent]=[.5,.6,1],this.PrimaryProfileMedians[a.ProfilingCategories.Backing]=[.5,.3,1],this.PrimaryProfileMedians[a.ProfilingCategories.Background]=[.5,.3,1],this.PrimaryProfileMedians[a.ProfilingCategories.Separator]=[.5,.3,1],this.PrimaryProfileMedians[a.ProfilingCategories.Decoration]=[.5,.6,1]},l.defineClass({name:"ColorProfiles",ctor:r}),r),a.ProfilingColorMap=(n=function e(){this.colorSet=[];for(var t=l.iter(this.profilingCatgoriesCases());!t.done;t.next()){var o=t.value;null==e.currentPrimaryIndices[o]&&(e.currentPrimaryIndices[o]=0),null==e.currentBackgroundIndices[o]&&(e.currentBackgroundIndices[o]=0)}},i={},l.defineClass({name:"ProfilingColorMap",ctor:n,statics:{PrimaryMap:{},BackgroundMap:{},currentPrimaryIndices:{},currentBackgroundIndices:{},paletteMappingDictionary:{},paletteMappingSelection:{},currentDocumentID:"",backingColorKey:"_Backing",lockupMSLPrimaryColorKey:"_MSLPrimary",lockupMSLBackingColorKey:"_MSLBacking",noKeyFound:"noKeyFound",textCategories:{get:function(){return void 0===i.textCategories&&(i.textCategories=[a.ProfilingCategories.Title,a.ProfilingCategories.Subtitle,a.ProfilingCategories.Body,a.ProfilingCategories.Action]),i.textCategories}},shapeCategories:{get:function(){return void 0===i.shapeCategories&&(i.shapeCategories=[a.ProfilingCategories.GraphicContent,a.ProfilingCategories.Backing,a.ProfilingCategories.Background,a.ProfilingCategories.Separator,a.ProfilingCategories.Decoration]),i.shapeCategories}}},props:{reset:function(){n.PrimaryMap={},n.BackgroundMap={},n.currentPrimaryIndices={},n.currentBackgroundIndices={},n.paletteMappingDictionary={},n.paletteMappingSelection={},n.currentDocumentID=""},updateRoleProfilingColorMap:function(e){var t;(t=e.document)&&(n.currentDocumentID=t.uuid),this.colorSet=e.colorLibraryController.getThemeColorKeys().concat(e.colorLibraryController.getProfilingColorKeys()),(new n).eraseCurrentPaletteMappingSelection(),n.PrimaryMap={},n.BackgroundMap={};for(var o=new a.ColorProfiles,r=l.iter(this.profilingCatgoriesCases());!r.done;r.next()){var i=r.value;if(null!=o.PrimaryProfileMedians[i]){var s=this.colorSet.length;n.PrimaryMap[i]=l.clone(this.selectRoleProfilingColors(e,i,!1,!0,s))}}for(var c=l.iter(this.profilingCatgoriesCases());!c.done;c.next())i=c.value,null!=o.BackgroundProfileMedians[i]&&(s=this.colorSet.length,n.BackgroundMap[i]=l.clone(this.selectRoleProfilingColors(e,i,!0,!0,s)))},updateIfCurrentDocumentHasChanged:function(e){var t;(t=e.document)&&n.currentDocumentID!=t.uuid&&this.updateRoleProfilingColorMap(e)},updateCurrentColorIndices:function(){for(var e=l.iter(this.profilingCatgoriesCases());!e.done;e.next()){var t=e.value;if(i=n.PrimaryMap[t]){var o=c.CoreRandom.nextIntUniform(i.length);n.currentPrimaryIndices[t]=o}}for(var r=l.iter(this.profilingCatgoriesCases());!r.done;r.next()){var i;if(t=r.value,(i=n.BackgroundMap[t])&&i.length>0){var a=null==n.currentBackgroundIndices[t]?-1:n.currentBackgroundIndices[t];n.currentBackgroundIndices[t]=(a+1)%i.length}}},checkIfMappingIsEmpty:function(){return null==n.PrimaryMap[a.ProfilingCategories.Title]},checkIfTwoFormaAreInSamePaletteMappingGroup:function(e,t){for(var o=!1,r=l.iter(l.keys(n.paletteMappingDictionary));!r.done;r.next()){var i=r.value;n.paletteMappingDictionary[i].includes(e)&&n.paletteMappingDictionary[i].includes(t)&&(o=!0)}return o},getMappingKeyForFormaID:function(e){for(var t=n.noKeyFound,o=l.iter(l.keys(n.paletteMappingDictionary));!o.done;o.next()){var r=o.value;n.paletteMappingDictionary[r].includes(e)&&(t=r)}return t},overridePaletteMappingDueToContrast:function(e,t){var o,r=this.getMappingKeyForFormaID(t),i=e;return r!=n.noKeyFound&&(null!=(o=n.paletteMappingSelection[r])?i=o:n.paletteMappingSelection[r]=e),i},overridePaletteMappingDueToContrastAndForceDifference:function(e,t,o,r){var i=this.getMappingKeyForFormaID(t),a=e;if(i!=n.noKeyFound)if(null!=(c=n.paletteMappingSelection[i]))a=c;else{if(this.checkIfColorAlreadyAssignedToPaletteMapping(a))for(var s=l.iter(l.range(0,o.length,!1));!s.done;s.next()){var c,g=s.value;if(null!=(c=u.ColorSelectorUtils.getContrastingChoice(!1,[o[g]],[r[g]]))&&!this.checkIfColorAlreadyAssignedToPaletteMapping(c)){a=c;break}}n.paletteMappingSelection[i]=a}return a},checkIfColorAlreadyAssignedToPaletteMapping:function(e){for(var t=!1,o=l.iter(l.keys(n.paletteMappingSelection));!o.done;o.next()){var r=o.value;n.paletteMappingSelection[r]==e&&(t=!0)}return t},eraseCurrentPaletteMappingSelection:function(){n.paletteMappingSelection={}},eraseCurrentPaletteMappingDictionary:function(){n.paletteMappingDictionary={}},setPaletteMappingForFormaWithSameRGBColor:function(e){var t,o=this;if(this.eraseCurrentPaletteMappingDictionary(),t=e.root.controller){var r=l.clone(t.getCurrentColors(e.root.style));r.length>0&&this.updateMappingDictionary(r[0].rgbString,e.root.formaID)}e.root.visitAll(g.FormaTraversal.PreOrder,(function(e){var t,r,i,a,s,c,u=e.formaID;if((a=l.as(e.controller,v.TypeLockupController))&&((s=e.style.colors.fieldPrimary)&&o.updateMappingDictionary(s.rgbString,u),(c=e.style.colors.fieldSecondary)&&null!=(t=l.opt(l.as(e.style,d.LockupStyle),(function(e){return e.backing})))&&t!=d.LockupBacking.None&&o.updateMappingDictionary(c.rgbString,u+n.backingColorKey),(r=a.getCurrentMSLPrimaryColor())&&o.updateMappingDictionary(r.rgbString,u+n.lockupMSLPrimaryColorKey),(i=a.getCurrentMSLBackingColor())&&o.updateMappingDictionary(i.rgbString,u+n.lockupMSLBackingColorKey)),l.as(e.controller,m.ShapeController)&&(s=e.style.colors.fieldPrimary)&&o.updateMappingDictionary(s.rgbString,u),a=l.as(e.controller,h.GridController))for(var g=l.clone(a.getCellIdsGroupedByColor()),p=l.iter(l.keys(g));!p.done;p.next())for(var C=p.value,S=l.iter(g[C]);!S.done;S.next())u=S.value,o.updateMappingDictionary(C,u);l.as(e.controller,f.ImageController)&&null!=e.style.filter&&((s=e.style.colors.fieldPrimary)&&o.updateMappingDictionary(s.rgbString,u),(c=e.style.colors.fieldSecondary)&&o.updateMappingDictionary(c.rgbString,u+n.backingColorKey))}))},getNumPaletteMappingGroups:function(){return l.keys(n.paletteMappingDictionary).length},getCurrentPaletteMapping:function(){return l.clone(n.paletteMappingDictionary)},updateMappingDictionary:function(e,t){for(var o=!1,r=l.iter(l.keys(n.paletteMappingDictionary));!r.done;r.next()){var i=r.value;u.ColorSelectorUtils.compareTwoColorStringsWithMargin(i,e)&&(n.paletteMappingDictionary[i].includes(t)||n.paletteMappingDictionary[i].push(t),o=!0)}o||(n.paletteMappingDictionary[e]=[t])},getPrimaryColorsForRoleGlobal:function(e,t,o){var r,i,a=[];if(this.updateIfCurrentDocumentHasChanged(o),(r=n.PrimaryMap[e])&&null!=(i=n.currentPrimaryIndices[e]))if(i<r.length){for(var s=l.iter(l.range(i,r.length,!1));!s.done;s.next()){var c=s.value;a.push(r[c])}for(var u=l.iter(l.range(0,i,!1));!u.done;u.next())c=u.value,a.push(r[c])}else a=l.clone(r);return a},getBackgroundColorsForRoleGlobal:function(e,t,o){var r,i,a=[];if(this.updateIfCurrentDocumentHasChanged(o),(r=n.BackgroundMap[e])&&null!=(i=n.currentBackgroundIndices[e]))if(i<r.length){for(var s=l.iter(l.range(i,r.length,!1));!s.done;s.next()){var c=s.value;a.push(r[c])}for(var u=l.iter(l.range(0,i,!1));!u.done;u.next())c=u.value,a.push(r[c])}else a=l.clone(r);return a},getPrimaryColorsForRoleIndividual:function(e,t,o){return this.colorSet=e.colorLibraryController.getThemeColorKeys().concat(e.colorLibraryController.getProfilingColorKeys()),this.selectRoleProfilingColors(e,t,!1,!1,o)},getBackgroundColorsForRoleIndividual:function(e,t,o){return this.colorSet=e.colorLibraryController.getThemeColorKeys().concat(e.colorLibraryController.getProfilingColorKeys()),this.selectRoleProfilingColors(e,t,!0,!1,o)},getProfilingCategoryForInferredRole:function(e){var t=a.ProfilingCategories.Body;return e.role==p.InferredRoleType.Title||e.role==p.InferredRoleType.Quote?t=a.ProfilingCategories.Title:e.role==p.InferredRoleType.SubTitle?t=a.ProfilingCategories.Subtitle:e.role==p.InferredRoleType.Social||e.role==p.InferredRoleType.Action?t=a.ProfilingCategories.Action:e.role==p.InferredRoleType.Body?t=a.ProfilingCategories.Body:e.role==p.InferredRoleType.Contact?t=a.ProfilingCategories.Body:e.role==p.InferredRoleType.GraphicContent||e.role==p.InferredRoleType.Logo?t=a.ProfilingCategories.GraphicContent:e.role==p.InferredRoleType.Seperator?t=a.ProfilingCategories.Separator:e.role==p.InferredRoleType.Backing?t=a.ProfilingCategories.Backing:e.role==p.InferredRoleType.Background?t=a.ProfilingCategories.Background:e.role==p.InferredRoleType.Decoration?t=a.ProfilingCategories.Decoration:s.CoreAssert.fail("role not supported","ProfilingColorMap.getProfilingCategoryForInferredRole","ProfilingColorMap.swift",471),t},countColorUsage:function(e,t){for(var o=0,r=[n.PrimaryMap,n.BackgroundMap],i=l.clone(this.profilingCatgoriesCases()),a=l.iter(r);!a.done;a.next())for(var s=a.value,c=l.iter(i);!c.done;c.next()){var u,g=c.value;if(this.anyCategoryOverlap(t,g)&&(u=s[g]))for(var h=l.iter(u);!h.done;h.next())h.value==e&&(o+=1)}return o},anyCategoryOverlap:function(e,t){return!(!n.textCategories.includes(e)||!n.textCategories.includes(t))||!(!n.shapeCategories.includes(e)||!n.shapeCategories.includes(t))},selectRoleProfilingColors:function(e,t,o,r,n){void 0===n&&(n=2);var i=[],c=new a.ColorProfiles,u=[];if(o&&null==c.BackgroundProfileMedians[t]||!o&&null==c.PrimaryProfileMedians[t])return s.CoreAssert.fail("category not supported in selectRoleProfilingColors","ProfilingColorMap.selectRoleProfilingColors","ProfilingColorMap.swift",524),[];for(var g=l.iter(this.colorSet);!g.done;g.next()){var h,f=g.value;if(h=e.colorLibraryController.getSolidColorForKey(f)){var d=0,p=0;o?d=this.getColorHSBDistance(h,l.clone(c.BackgroundProfileMedians[t])):(d=this.getColorHSBDistance(h,l.clone(c.PrimaryProfileMedians[t])),p=(r?1e3:0)*l.toDouble(this.countColorUsage(f,t))),i.push(d+p)}}for(var m=l.iter(l.range(0,n,!1));!m.done;m.next()){var v=l.min(i);if(null!=v){var C=l.indexOf(i,v);u.push(this.colorSet[C]),i[C]+=1e3}}return u},profilingCatgoriesCases:function(){for(var e=[],t=a.ProfilingCategories.NUM_CATEGORIES,o=l.iter(l.range(0,t,!1));!o.done;o.next()){var r=o.value;e.push(a.ProfilingCategories.toCaseValue(r))}return e},getColorHSBDistance:function(e,t){var o=[e.asHSB.h,e.asHSB.s,e.asHSB.b],r=Math.min(Math.abs(o[0]-t[0]),360-Math.abs(o[0]-t[0]));r/=180;var n=Math.abs(o[1]-t[1]),i=Math.abs(o[2]-t[2])/255;return Math.sqrt(r*r+n*n+i*i)}}}),n)},lq1z:function(e,t,o){var r,n,i,a,l=t,s=o("oAGj"),c=o("SpAV"),u=o("gXiO"),g=o("iCxV"),h=o("3lr5"),f=o("uj1m"),d=o("txj3"),p=o("K0Rh"),m=o("nrTo"),v=o("djAF"),C=o("ThKb");l.useNNModel=!0,l.linearLearningRate=.5,l.nnLearningRate=.005,s.gvar(l,"sharedSuggester_",(function(){return new l.FontSuggester})),l.concatSecondIntoFirst=function(e,t){for(var o=s.iter(t.descriptors);!o.done;o.next()){var r=o.value;e.append(r)}},l.FontSuggester=(r=function(){u.CoreObject.call(this)},n={},s.defineClass({name:"FontSuggester",ctor:r,superName:"CoreObject",statics:{sharedSuggester:{get:function(){return l.sharedSuggester_}},cache:{get:function(){return void 0===n.cache&&(n.cache=new m.PredictionCacheDouble),n.cache},set:function(e){n.cache=e}}},props:{getFontFeatures:function(e,t){var o,n,i=s.clone(e.selectedLockup.pts),a=i[0].x,c=i[0].y,u=i[3].x,g=i[3].y,h=(a+u)/2,f=(c+g)/2,d=e.width,m=e.height,C=e.selectedLockup.wordCount,S=e.selectedLockup.width,y=e.selectedLockup.height,F=e.numImages,P="root";if(n=s.opt(t.root,(function(e){return e.filterWithCallback((function(e){return(e.isBackgroundImage()||e.kind==v.ShapeForma.KIND||e.kind==p.RootForma.KIND)&&null!=e.controller&&!e.controller.moveable}))})))for(var I=s.iter(n);!I.done;I.next()){var M=I.value;M.isBackgroundImage()&&M.finalFrame.outsetXY(20,20).contains(t.finalFrame)?P="image":M.kind==v.ShapeForma.KIND&&(P="shape")}o=[d,m,d*m,Math.atan2(m,d),s.toDouble(e.lockups.length),s.toDouble(F),a/d,c/m,h/d,f/m,u/d,g/m,s.toDouble(C),S,y,S*y/s.toDouble(C),"root"==P?1:0,"image"==P?1:0,"shape"==P?1:0];var _=e.selectedLockup.styleAttributes.backing,b=e.selectedLockup.styleAttributes.layout;return r.cache.cleanup(t.page.document.uuid),new l.FontFeatures(s.clone(o),_,b)},suggestFonts:function(e,t){if(null!=g.Host.fontProvider){var o=g.Host.fontProvider.getIncludedFonts(h.ANY_DOCUMENT),r=e.currentDocumentFonts.clone();l.concatSecondIntoFirst(r,e.recentlyUsedFonts),l.concatSecondIntoFirst(r,o),t(r)}},onlineLearning:function(e,t){var o,r;if(l.useNNModel){if(o=f.MLPModel.loadNNModel("Font")){var n=t.regularFeatures.concat(),i=s.repeat(0,58),a=s.repeat(0,4);null!=(R=s.indexOf(o.shapes,t.shape))&&(i[R]=1),null!=(A=s.indexOf(o.layouts,t.layout))&&(a[A]=1),n=s.clone(n.concat(s.clone(i)).concat(s.clone(a))),c.CoreAssert.isTrue(81==n.length,void 0,"FontSuggester.onlineLearning","FontSuggester.swift",117);var u=s.clone(o.fonts),h=o.coefficients.length,p=s.repeat(0,o.coefficients[h-1].rows),m=new C.TheoMatrix([n]).subtract(o.featureScalingMean).divide(o.featureScalingStd);if(null!=(L=s.indexOf(u,e.postScriptName))&&L>=0&&L<p.length){p[L]=1;var v=new C.TheoMatrix([p]),S=new d.NNMLPClassifier(s.clone(o.coefficients),s.clone(o.intercepts)),y=s.clone(S.forwardPropagate(m.transpose())),F=y.AL,P=s.clone(y.caches),I=s.clone(S.backwardPropagate(F,v.transpose(),s.clone(P))),M=s.clone(I.dWs),_=s.clone(I.dbs);s.info("nn cost: "+S.computeCost(F,v.transpose())+")");for(var b=[],k=[],T=s.iter(s.range(0,h,!1));!T.done;T.next()){var x=T.value;b.push(o.coefficients[x].subtract(M[x].multiplyConstant(l.nnLearningRate))),k.push(o.intercepts[x].subtract(_[x].multiplyConstant(l.nnLearningRate)))}c.CoreAssert.isTrue(b.length==o.coefficients.length,void 0,"FontSuggester.onlineLearning","FontSuggester.swift",140),c.CoreAssert.isTrue(k.length==o.intercepts.length,void 0,"FontSuggester.onlineLearning","FontSuggester.swift",141);var D=new f.MLPModel(o.featureScalingMean,o.featureScalingStd,s.clone(b),s.clone(k),s.clone(o.shapes),s.clone(o.fonts),s.clone(o.layouts),s.clone(o.roles));s.opt(g.Host.learning,(function(e){return e.updateFontSuggestionNNModel(D)}))}}}else if(r=s.opt(g.Host.learning,(function(e){return e.loadFontSuggestionLinearModel()}))){var R,A,L;if(n=t.regularFeatures.concat(),i=s.repeat(0,58),a=s.repeat(0,4),null!=(R=s.indexOf(r.shapes,t.shape))&&(i[R]=1),null!=(A=s.indexOf(r.layouts,t.layout))&&(a[A]=1),n=s.clone(n.concat(s.clone(i)).concat(s.clone(a))),c.CoreAssert.isTrue(81==n.length,void 0,"FontSuggester.onlineLearning","FontSuggester.swift",162),m=new C.TheoMatrix([n]).subtract(r.featureScalingMean).divide(r.featureScalingStd),u=s.clone(r.fonts),p=s.repeat(0,u.length),null!=(L=s.indexOf(u,e.postScriptName))&&L>=0&&L<p.length){p[L]=1,v=new C.TheoMatrix([p]);var E=m.matrixMultiply(r.coefficient.transpose()).add(r.intercept).sigmoid().subtract(v),w=r.coefficient.subtract(E.transpose().matrixMultiply(m).multiplyConstant(l.linearLearningRate)),N=r.intercept.subtract(E.multiplyConstant(l.linearLearningRate));D=new l.FontLinearModel(r.featureScalingMean,r.featureScalingStd,w,N,s.clone(r.shapes),s.clone(r.fonts),s.clone(r.layouts)),s.opt(g.Host.learning,(function(e){return e.updateFontSuggestionLinearModel(D)}))}}},clearCache:function(){r.cache.clearCache()},getScores:function(e,t){var o=t.getUniqueKey();if(null==r.cache.getCacheValue(o)){var n,i,a=[];if(l.useNNModel){if(n=f.MLPModel.loadNNModel("Font")){var u=t.regularFeatures.concat(),h=s.repeat(0,58),p=s.repeat(0,4);null!=(b=s.indexOf(n.shapes,t.shape))&&(h[b]=1),null!=(k=s.indexOf(n.layouts,t.layout))&&(p[k]=1),u=s.clone(u.concat(s.clone(h)).concat(s.clone(p))),c.CoreAssert.isTrue(81==u.length,void 0,"FontSuggester.getScores","FontSuggester.swift",207);for(var m=new C.TheoMatrix([u]).subtract(n.featureScalingMean).divide(n.featureScalingStd),v=new d.NNMLPClassifier(s.clone(n.coefficients),s.clone(n.intercepts)).predict(m.transpose()),S=s.clone(v.transpose().asArray),y=s.clone(n.fonts),F={},P=s.iter(s.toSequence(S[0]));!P.done;P.next()){var I=P.value,M=I.offset,_=I.element;F[y[M]]=_}e.forEach((function(e){var t;null!=(t=F[e.postScriptName])?a.push(t):a.push(0)}))}}else if(i=s.opt(g.Host.learning,(function(e){return e.loadFontSuggestionLinearModel()}))){var b,k;u=t.regularFeatures.concat(),h=s.repeat(0,58),p=s.repeat(0,4),null!=(b=s.indexOf(i.shapes,t.shape))&&(h[b]=1),null!=(k=s.indexOf(i.layouts,t.layout))&&(p[k]=1),u=s.clone(u.concat(s.clone(h)).concat(s.clone(p))),c.CoreAssert.isTrue(81==u.length,void 0,"FontSuggester.getScores","FontSuggester.swift",241),v=(m=new C.TheoMatrix([u]).subtract(i.featureScalingMean).divide(i.featureScalingStd)).matrixMultiply(i.coefficient.transpose()).add(i.intercept),S=s.clone(v.sigmoid().asArray),y=s.clone(i.fonts),F={};for(var T=s.iter(s.toSequence(S[0]));!T.done;T.next()){var x=T.value;M=x.offset,_=x.element,F[y[M]]=_}e.forEach((function(e){var t;null!=(t=F[e.postScriptName])?a.push(t):a.push(0)}))}r.cache.setCacheValue(o,s.clone(a))}return r.cache.getCacheValue(o)}}}),r),l.FontFeatures=(i=function(e,t,o){this.regularFeatures=s.clone(e),this.shape=t,this.layout=o},s.defineClass({name:"FontFeatures",ctor:i,props:{getUniqueKey:function(){for(var e="",t=s.iter(this.regularFeatures);!t.done;t.next()){var o=t.value;e=e+s.toString("%.2f",o)+"-"}return e=(e=e+this.shape+"-")+this.layout+"-"}}}),i),l.FontLinearModel=(a=function(e,t,o,r,n,i,a){this.featureScalingMean=e,this.featureScalingStd=t,this.coefficient=o,this.intercept=r,this.shapes=s.clone(n),this.fonts=s.clone(i),this.layouts=s.clone(a),this.fontMap={}},s.defineClass({name:"FontLinearModel",ctor:a,props:{data:function(){return s.clone(s.as({model:{coef:this.coefficient.asArray,intercept:this.intercept.asFlatArray,shapes:this.shapes,fonts:this.fonts,layouts:this.layouts},featureScalingMean:this.featureScalingMean.asFlatArray,featureScalingStd:this.featureScalingStd.asFlatArray},["Dictionary","String","Any"]))}}}),a)},nrTo:function(e,t,o){var r,n,i,a=t,l=o("oAGj"),s=o("iCxV");a.RolePredictionCacheProtocol=l.defineProtocol("RolePredictionCacheProtocol",{getCacheValue:"(String) -> InferredRole",setCacheValue:"(String, InferredRole) -> Void",cleanup:"(String) -> Void"}),a.RolePredictionCache=(r=function(){},l.defineClass({name:"RolePredictionCache",ctor:r,statics:{_implements:function(e){return"RolePredictionCacheProtocol"==e}},props:{getCacheValue:function(e){return l.opt(s.Host.logging,(function(e){return e.error("This method must be overridden")})),null},setCacheValue:function(e,t){l.opt(s.Host.logging,(function(e){return e.error("This method must be overridden")}))},cleanup:function(e){l.opt(s.Host.logging,(function(e){return e.error("This method must be overridden")}))}}}),r),a.PredictionCacheDouble=(n=function(){},l.defineClass({name:"PredictionCacheDouble",ctor:n,statics:{cache:{},currentDocID:""},props:{getCacheValue:function(e){return n.cache[e]},setCacheValue:function(e,t){n.cache[e]=l.clone(t)},cleanup:function(e){e!=n.currentDocID&&(n.currentDocID=e,n.cache={})},clearCache:function(){n.cache={}}}}),n),a.PredictionCacheInferredRole=(i=function(){a.RolePredictionCache.call(this)},l.defineClass({name:"PredictionCacheInferredRole",ctor:i,superName:"RolePredictionCache",statics:{cache:{},currentDocID:"",_implements:function(e){return"RolePredictionCacheProtocol"==e}},props:{getCacheValue:function(e){return i.cache[e]},setCacheValue:function(e,t){i.cache[e]=l.clone(t)},cleanup:function(e){e!=i.currentDocID&&(i.currentDocID=e,i.cache={})}}}),i)},"v/sv":function(e,t,o){var r,n=t,i=o("oAGj"),a=o("CaSj"),l=o("FNB+"),s=o("tQF8"),c=o("/afT"),u=o("pnSN"),g=o("TP4q"),h=o("bSZx"),f=o("Dq5S"),d=o("oKlP");n.GridCellContent=i.defineEnum("GridCellContent",{None:0,Image:1,Text:2,Count:3}),n.GridSuggester=(r=function(e,t,o){this.gridForma_=null,void 0===o&&(o=null),this.gridStyle_=t,this.preserveMapping_=i.clone(o),this.gridForma_=e},i.defineClass({name:"GridSuggester",ctor:r,superName:"CoreObject",statics:{KIND:{get:function(){return"GridSuggester"}},defaultWeights:[-.4869963787443057,.10451788427313968,-10,.3841333333333332,.1438482857676463,.05953378239352733,-.7134725705040772,-.7,.2460712826952826,1.7685714285714302,1.7685714285714302,-1.42857142857143,-1.42857142857143,.2857180890092063,.2915071572811428,-.2857180890092063,-.2915071572811428,-.1822757614386357,-.1502170111498276,-.13002813087151563,-.16114682148449702,.28162418627853086,.2916486562661698,.3658656280531089,.31731319724602053,-.05177320346844536,-.04974606109777501,-.03389292805397268,-.021441808254260175,.14285700582863953,.961358333706472,-2.871390476190484,2.531390476190476,-.4,-.6],styleWeightMatrix:{checkerBoard:[-4,.3,-.6,.4,.3,.2,-.7,-.7,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,2,-100,100,-.4,-.6],imageOnTop:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,-5,5,5,-5,0,0,0,0,0,-100,0,100,1,-2,1,-2,0,0,0,0,0,.3,0,0,-.4,-.6],imageOnBottom:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,-5,5,5,-5,0,0,0,0,0,100,0,-100,1,-2,1,-2,0,0,0,0,0,.3,0,0,-.4,-.6],imageLeft:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,5,-5,-5,5,0,0,0,0,-100,0,100,0,-2,1,-2,1,0,0,0,0,0,.3,0,0,-.4,-.6],imageRight:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,5,-5,-5,5,0,0,0,0,100,0,-100,0,-2,1,-2,1,0,0,0,0,0,.3,0,0,-.4,-.6],textTowardCenter:[0,.3,-.7,.4,.3,.2,-.7,-.7,0,5,5,-5,-5,1,1,-1,-1,0,0,0,0,5,5,-1,-1,100,100,-100,-100,1,0,0,0,-.4,-.6],imageTowardCenter:[0,.3,-.7,.4,.3,.2,-.7,-.7,0,5,5,-5,-5,1,1,-1,-1,0,0,0,0,-1,-1,5,5,-100,-100,100,100,0,5,0,0,-.4,-.6]}},props:{sortCells:function(e,t){return e.bounds.minY<t.bounds.minY||!(e.bounds.minY>t.bounds.minY)&&e.bounds.minX<t.bounds.minX},createPreservedGroupMatches:function(e,t){var o=e.concat();i.sortInPlace(o,this.sortCells);for(var r=[],n=i.iter(t);!n.done;n.next()){var l=n.value;i.containsEq(r,l,s._equality_GridCell_GridCell)||r.push(l)}i.sortInPlace(r,this.sortCells);for(var c=[],u=i.iter(r);!u.done;u.next())c.push([]);for(var g=i.iter(t);!g.done;g.next()){var h=g.key;l=g.value,c[i.indexOfEq(r,l,s._equality_GridCell_GridCell)].push(h)}for(var f=Math.max(c.length,o.length),d=i.clone(a.DesignSuggester.getPermutations(f)),p=[],m=i.iter(d);!m.done;m.next()){for(var v=m.value,C=!0,S={},y=i.iter(i.range(0,f,!1));!y.done;y.next())for(var F=y.value,P=i.clone(c[F%c.length]),I=i.iter(P);!I.done;I.next()){h=I.value;var M,_=o[v[F]%o.length];if(M=i.opt(this.gridForma_,(function(e){return e.formaByID(h)}))){if(M.isBackgroundImage()&&1!=_.opacity){C=!1;break}S[h]=_}}for(var b=!1,k=i.iter(p);!k.done;k.next()){var T=k.value;this.mappingEqual(i.clone(S),i.clone(T))&&(b=!0)}!b&&C&&p.push(i.clone(S))}return p},createFormaMatches:function(e){if(null!=this.preserveMapping_&&i.count(this.preserveMapping_)>0)return this.createPreservedGroupMatches(i.clone(e),i.clone(this.preserveMapping_));for(var t=this.gridForma_,o=i.clone(t.filterWithCallback((function(e){return e.isBackgroundImage()}))),r=[],n=[],u=i.iter(i.range(0,e.length-1,!0));!u.done;u.next()){for(var g=e[q=u.value],h=!1,f=i.iter(i.range(0,q,!0));!f.done;f.next()){var p=e[f.value];!i.eq(s._equality_GridCell_GridCell,g,p)&&g.bounds.intersects(p.bounds)&&(h=!0,n.push(p))}h||r.push(g)}for(var m=Math.max(o.length,r.length),v=Math.max(250-20*o.length,100),C=i.clone(a.DesignSuggester.getPermutations(m,v)),S=[],y=i.iter(C);!y.done;y.next()){var F=y.value,P={};if(o.length>0)for(var I=i.iter(i.range(0,m,!1));!I.done;I.next())P[o[(q=I.value)%o.length].formaID]=e[F[q]%e.length];for(var M=!1,_=i.iter(S);!_.done;_.next()){var b=_.value;this.mappingEqual(i.clone(P),i.clone(b))&&(M=!0)}M||S.push(i.clone(P))}for(var k=[],T=i.iter(t.visitAsArray(l.FormaTraversal.JustChildren));!T.done;T.next()){var x=T.value;x.controller.floating&&k.push(x)}i.sortInPlace(k,(function(e,t){return e.finalFrame.center.distanceTo(d.TheoPoint.ZERO)<t.finalFrame.center.distanceTo(d.TheoPoint.ZERO)}));var D=e.length-o.length;if(this.gridStyle_.moveableShift&&k.length>0){var R=[];if(k.length<=D)for(var A=i.iter(k);!A.done;A.next()){var L=A.value;R.push([L])}else R=i.clone(c.GroupDetector.detectProximityGroups(i.clone(k)));D>R.length&&(R=i.clone(c.GroupDetector.splitFormaGroups(i.clone(R),D)));for(var E=[],w=i.iter(S);!w.done;w.next()){b=w.value;for(var N=i.clone(n),O=i.iter(b);!O.done;O.next()){var B=O.value;N.push(B)}for(var G=[],V=i.iter(e);!V.done;V.next()){g=V.value;for(var W=!1,U=i.iter(N);!U.done;U.next()){var j=U.value;i.eq(s._equality_GridCell_GridCell,j,g)&&(W=!0)}W&&0!=D||G.push(g)}i.shuffleInPlace(G);for(var K=i.iter([!1,!0]);!K.done;K.next()){var Y=K.value;if((1==D||1==R.length)&&Y)break;for(var X=i.clone(b),H=i.iter(i.range(0,R.length,!1));!H.done;H.next()){var q=H.value,z=i.clone(R[q]);Y&&(z=i.clone(R[R.length-q-1]));for(var Z=i.iter(i.range(0,z.length,!1));!Z.done;Z.next())X[z[Z.value].formaID]=G[Math.min(q,G.length-1)]}E.push(i.clone(X))}}S=i.clone(E)}return S},mappingEqual:function(e,t){for(var o=i.iter(e);!o.done;o.next()){var r=o.key,n=o.value;if(!i.eq(s._equality_GridCell_GridCell,t[r],n))return!1}return!0},createSuggestions:function(e){void 0===e&&(e=null);for(var t=[],o=i.iter(this.gridStyle_.gridCells);!o.done;o.next()){var n=o.value;t.push(n.clone())}var a=i.clone(this.createFormaMatches(i.clone(t)));if(0==a.length)return[];var l,s=[];if(l=this.gridForma_.root)for(var c=i.iter(a[0]);!c.done;c.next()){var d,p=c.key;n=c.value,(d=l.formaByID(p))&&(d.controller.floating||d.isBackgroundImage())&&s.push(f.LayoutItem.init_b14a(d))}var m=i.clone(null!=e?e:r.defaultWeights);t.length>5&&(m=i.clone(r.styleWeightMatrix.checkerBoard));for(var v=[],C=i.iter(a);!C.done;C.next()){var S=C.value,y=this.createGridStyle(i.clone(t),i.clone(S)),F=new g.GridScore(y,this.gridForma_.frame,i.clone(s),this.gridForma_,void 0,i.clone(m));v.push(new h.GridSuggestion(i.as(this.gridForma_,u.GroupForma),y,F))}return i.sort(v,(function(e,t){return e.score>t.score}))},createGridStyle:function(e,t){for(var o=this.gridStyle_.clone(),r=[],n=i.iter(e);!n.done;n.next()){var a=n.value;r.push(a.clone())}for(var l={},s=i.iter(t);!s.done;s.next())for(var c=s.key,u=(a=s.value,i.iter(r));!u.done;u.next()){var g=u.value;if(a.bounds==g.bounds){l[c]=g;break}}return o.setGridCells(r.concat()),o.setFormaMapping(i.clone(l)),o.forma=this.gridForma_,o}}}),r)},vYM0:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("SpAV"),l=o("yhkb"),s=o("C42b");n.ColorLibraryMap=(r=function(){},i.defineClass({name:"ColorLibraryMap",ctor:r,statics:{remapColors:function(e,t,o,n){var a=[];e.forEachColor((function(e,l,s){var c;if(c=null==l?s:i.opt(t.color(l),(function(e){return e.rgbColor}))){var u=i.opt(n,(function(e){return e[c.hex]}));null==u&&(u=r.findACloseColor(c,o),null!=n&&(n[c.hex]=u)),a.push({key:e,value:u})}})),e.setColorIDs(i.clone(a))},findACloseColor:function(e,t,o){void 0===o&&(o=20);var r=e.lightness,n=null,c=[];if(t.forEachColor((function(e,t){if(e.startsWith("theme")){var n=Math.abs(t.rgbColor.lightness-r);n<=o&&c.push({id:e,distance:n})}})),0==c.length)a.CoreAssert.info("Unable to find closest color in ColorLibraryMap.findACloseColor"),n=l.ColorLibraryController.BLACK_KEY;else{var u=i.sort(c,(function(e,t){return e.distance<t.distance}));n=u[s.CoreRandom.nextIntUniform(Math.min(u.length,3))].id}return n}}}),r)},xe42:function(e,t,o){var r,n,i=t,a=o("oAGj"),l=o("9BFu");i.FormaPlacementScore=(r=function e(t){this.rejectThreshold=-100,l.WeightedScore.call(this,e.Features.NUM_FEAT),this.setWeight(e.Features.XSYMM,10),this.setWeight(e.Features.YSYMM,10),this.setWeight(e.Features.CONTRAST,1),0==t.textRects.length?(this.setWeight(e.Features.EDGE,-200),this.setWeight(e.Features.FACE,-1e3)):(this.setWeight(e.Features.EDGE,-50),this.setWeight(e.Features.FACE,0)),this.setWeight(e.Features.SIZE,100),this.setWeight(e.Features.TEXT_OVERLAP,-5e3),this.setWeight(e.Features.FLOATING_ELEMENT_OVERLAP,-1e3),this.setWeight(e.Features.DISTANCE_TO_CENTER,-20),this.setWeight(e.Features.IMAGE_EDGE_OVERLAP,-500),this.setWeight(e.Features.REGION_BOUNDARY_OVERLAP,-40),this.setWeight(e.Features.ALIGNMENT,50),this.setWeight(e.Features.ASPECT_RATIO,t.forma.isImage()?0:20),this.setFeatureName(e.Features.XSYMM,"X- Symmetry"),this.setFeatureName(e.Features.YSYMM,"Y- Symmetry"),this.setFeatureName(e.Features.CONTRAST,"Contrast"),this.setFeatureName(e.Features.EDGE,"Edges"),this.setFeatureName(e.Features.FACE,"Faces"),this.setFeatureName(e.Features.SIZE,"Size"),this.setFeatureName(e.Features.TEXT_OVERLAP,"Text Overlap"),this.setFeatureName(e.Features.FLOATING_ELEMENT_OVERLAP,"Floating Element Overlap"),this.setFeatureName(e.Features.DISTANCE_TO_CENTER,"Distance To Center"),this.setFeatureName(e.Features.IMAGE_EDGE_OVERLAP,"Image Edge Overlap"),this.setFeatureName(e.Features.REGION_BOUNDARY_OVERLAP,"Region Boundary Overlap"),this.setFeatureName(e.Features.ALIGNMENT,"Alignment"),this.setFeatureName(e.Features.ASPECT_RATIO,"Aspect Ratio")},n={},a.defineClass({name:"FormaPlacementScore",ctor:r,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===n.Features&&(n.Features=a.defineEnum("Features",{XSYMM:1,YSYMM:2,CONTRAST:3,EDGE:4,FACE:5,SIZE:6,TEXT_OVERLAP:7,FLOATING_ELEMENT_OVERLAP:8,IMAGE_EDGE_OVERLAP:9,REGION_BOUNDARY_OVERLAP:10,DISTANCE_TO_CENTER:11,ALIGNMENT:12,ASPECT_RATIO:13,NUM_FEAT:14})),n.Features}}},props:{reject:function(){return this.score<this.rejectThreshold}}}),r)}}]);
//# sourceMappingURL=vendors_npm_spark_b84bf841-48bcb468.js.map