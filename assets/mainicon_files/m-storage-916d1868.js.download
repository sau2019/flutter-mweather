(window.webpackJsonp=window.webpackJsonp||[]).push([["m-storage"],{1296:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";o(988);var r,i=o(879);t.canUseFileSystem=!1,t._setFS=function(e){r=e,t.canUseFileSystem=!!e},t.ensureDirectoryExists=function(e,o){var n=function(e){e&&"EEXIST"===e.code?o():o(e)},s=function(s){if(s)o();else{var a=i.parentDirectory(e);a?t.ensureDirectoryExists(a,(function(t){t?o(t):r.mkdir(e,n)})):r.mkdir(e,n)}};e?r.exists(e,s):s(!0)},t.getTempFilePathAt=function(e,o){var n=function(){var r=e+i.generateUuid();t.exists(r,(function(e){e?n():o(r)}))};n()},t.exists=function(e,t){r.exists(e,t)},t.deleteFile=function(e,t){r.unlink(e,(function(e){e&&"ENOENT"!==e.code?t(e):t()}))},t.readFile=function(e,t,o){r.readFile(e,t,o)},t.writeFile=function(e,o,n,s){var a=i.parentDirectory(e);t.ensureDirectoryExists(a,(function(t){t?s(t):r.writeFile(e,o,n,s)}))},t.writeFileAtomically=function(e,o,n,s){var a=i.parentDirectory(e);t.ensureDirectoryExists(a,(function(i){i?s(i):t.getTempFilePathAt(a+"/",(function(t){r.writeFile(t,o,n,(function(o){o?s(o):r.rename(t,e,s)}))}))}))},t.createWriteStream=function(e,t){return r.createWriteStream(e,t)},t.createReadStream=function(e,t){return r.createReadStream(e,t)},t.move=function(e,o,n,s){var a=i.parentDirectory(o);t.ensureDirectoryExists(a,(function(t){if(t)s(t);else if(n){var i=(new Date).getTime()/1e3;r.utimes(e,i,i,(function(t){t?s(t):r.rename(e,o,s)}))}else r.rename(e,o,s)}))},t.info=function(e,t){r.stat(e,t)},t.directoryListing=function(e,t){var o,n,i=[],s=function(s){r.stat(e+"/"+s,(function(e,r){if(!e)try{i.push({name:s,info:r}),o--}catch(t){e=t}e?n||(n=e,t(e)):0===o&&t(void 0,i)}))};r.readdir(e,(function(e,n){if(!e)try{var r,i=n.length;for(o=i,r=0;r<i;r++)s(n[r])}catch(t){e=t}e?t(e):0===o&&t(void 0,[])}))},t.deleteDirectory=function(e,o){var n,i,s=function(){try{r.rmdir(e,o)}catch(e){o(e)}},a=function(e){e&&!n&&(n=e),--i<1&&(n?o(n):s())},c=function(o){var n=e+"/"+o;r.unlink(n,(function(e){try{e?t.deleteDirectory(n,(function(e){a(e)})):a()}catch(e){a(e)}}))};r.readdir(e,(function(e,t){if(!e)try{var n,r=t.length;if(r<1)s();else for(i=r,n=0;n<r;n++)c(t[n])}catch(t){e=t}e&&o(e)}))};return t.copyFile=function(e,o,n){var s=i.parentDirectory(o);t.ensureDirectoryExists(s,(function(t){t?n(t):function(e,t,o){try{var n=t+i.generateUuid(),s=r.createWriteStream(n),a=r.createReadStream(e);a.on("end",(function(){r.rename(n,t,o)})),a.pipe(s)}catch(e){o(e)}}(e,o,n)}))},t}.call(t,o,t,e))||(e.exports=n)},1788:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r=o(988),i=o(886),s=o(2048),a=o(2049),c=o(1296),h=o(879),l={PRIVATE:void 0,SHARED_BY_USER:"sharedByUser",SHARED_WITH_USER:"sharedWithUser"};function u(e,t,o,n,r,s){r=h.ensureRelativeHrefStartsWithSlash(r),this._options=s||{},o?this._setPath(o):r?(this._href=r,e&&(this._name=e),t&&(this._type=t),n&&(this._id=n)):t&&(this._current=new i,e&&(this._current._data.name=e),this._current._data.type=t,n&&(this._current.compositeId=n)),this._autoRemoveUnusedLocalFiles=!0,this._options.xhrBaseBranchSupport&&(this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0),this._collaborationType=l.PRIVATE}return u.newCompositeAsCopyOf=function(e,t,o,n,s,a,c){var l=e._core;if(l||e.current&&(l=e.current._core),!l)throw new r(r.INVALID_PARAMS,"compositeBranchOrElement must be a branch, an element or a composite with a current branch.");var d=new u(void 0,void 0,void 0,void 0,void 0,c);return n&&(d.path=n),d._current=i._newBranchAsCopyOfCore(l,this._localStorage),d.id=s||h.generateUuid(),t&&(d.name=t),o&&(d.type=o),a&&(d.href=a),d},u.COLLABORATION=l,Object.defineProperties(u.prototype,{id:{get:function(){return this._current?this._current.compositeId:this._id},set:function(e){if("string"!=typeof e)throw new r(r.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.compositeId=e),this._id=e}},name:{get:function(){return this._current?this._current.name:this._name},set:function(e){if("string"!=typeof e)throw new r(r.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.name=e),this._name=e}},type:{get:function(){return this._current?this._current.type:this._type},set:function(e){if("string"!=typeof e)throw new r(r.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.type=e),this._type=e}},href:{get:function(){return this._current?this._current.compositeHref:this._href},set:function(e){if("string"!=typeof e)throw new r(r.INVALID_PARAMS,"Expecting a string.");e=h.ensureRelativeHrefStartsWithSlash(e),this._current&&(this._current.compositeHref=e),this._href=e}},collaborationType:{get:function(){return this._current?this._current._collaborationType:this._collaborationType},set:function(e){if(e!==l.PRIVATE&&e!==l.SHARED_BY_USER&&e!==l.SHARED_WITH_USER)throw new r(r.INVALID_PARAMS,"Invalid value: ."+e);this._current&&(this._current._collaborationType=e),this._collaborationType=e}},clientDataString:{get:function(){return this._current?this._current._clientDataString:this._clientDataString},set:function(e){if("string"!=typeof e&&void 0!==e)throw new r(r.INVALID_PARAMS,"Invalid clientDataString: must be a string or undefined.");var t=this._options.maxClientDataLength||1024;if(e&&e.length>t)throw new r(r.INVALID_PARAMS,"Invalid clientDataString: cannot be greater than 1KB");this._current&&(this._current._clientDataString=e),this._clientDataString=e}},path:{get:function(){return this._path},set:function(e){if("string"!=typeof e)throw new r(r.INVALID_PARAMS,"Expecting a string.");this._setPath(e)}},isBound:{get:function(){return this._current&&this._current.isBound||!this._current&&this._href},set:function(){throw new r(r.READ_ONLY,"Cannot set the property isBound. Use resetIdentity or resetBinding instead.")}},hasLocalStorage:{get:function(){return this._localStorage},set:function(){throw new r(r.READ_ONLY,"Cannot set the property hasLocalStorage.")}},autoRemoveUnusedLocalFiles:{get:function(){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");return this._autoRemoveUnusedLocalFiles},set:function(e){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");this._autoRemoveUnusedLocalFiles=e}},clientDataStoragePath:{get:function(){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");return this._localStorage.clientDataPath()},set:function(e){throw new r(r.READ_ONLY,'Property "clientDataStoragePath" is read-only.')}},current:{get:function(){return this._current},set:function(e){throw new r(r.READ_ONLY,'Property "current" is read-only.')}}}),u.prototype.loadCurrentFromLocalStorage=function(e){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");var t=this;this._loadBranch(this._localStorage.currentManifestPath(),!1,(function(o,n){if(!o&&n)try{t._current=n,t._currentBranchCommittedAtDate=h.timeStamp(!0)}catch(e){o=e}e(o,o?void 0:n)}))},u.prototype.commitChanges=function(e){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");if(!this._current)return e(new r(r.INVALID_STATE,"Current branch is not in memory."));var t=this;c.writeFileAtomically(this._localStorage.currentManifestPath(),this._current.localData,"utf8",(function(o){if(!o)try{t._currentBranchCommittedAtDate=h.timeStamp(!0),t._current._isDirty=!1}catch(e){o=e}e(o)}))},u.prototype.tempAssetPath=function(){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");return this._localStorage.tempPathForComponent()},u.prototype.deleteTempFiles=function(e){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");this._localStorage.deleteTempFiles((function(t){e&&e(t)}))},u.prototype.removeUnusedLocalFiles=function(e){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");this._localStorage.removeUnusedLocalFiles(this._currentBranchCommittedAtDate,e)},u.prototype.removeLocalStorage=function(e){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");if(!this._path)return e(new r(r.INVALID_STATE,"No path set."));c.deleteDirectory(this._path,e)},u.prototype.loadBaseBranch=function(e){if(!this._localStorage&&!this._baseBranchData)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");if(this._localStorage)this._loadBranch(this._localStorage.currentBaseManifestPath(),!0,e);else{var t,o;try{o=new i(void 0,!0).parse(this._baseBranchData)}catch(e){t=e}e(t,o)}},u.prototype.loadPulledBranch=function(e){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");this._loadBranch(this._localStorage.pulledManifestPath(),!1,e)},u.prototype.loadPushedBranch=function(e){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");this._loadBranch(this._localStorage.pushedManifestPath(),!1,e)},u.prototype.resolvePullWithBranch=function(e,t){if(!e)throw new r(r.INVALID_PARAMS,"Need a branch.");if(e===this._current)throw new r(r.INVALID_PARAMS,"Cannot resolve current.");if(this._localStorage&&!t)throw new r(r.INVALID_PARAMS,"Need a callback function.");var o=this,n=function(){e.readOnly=!1,e._collaborationType=o.collaborationType,e._clientDataString=o.clientDataString,o._current=e};if(this._localStorage)o._localStorage.resolvePulledBranch(e,(function(e){if(!e)try{n(),o._autoRemoveUnusedLocalFiles&&o._localStorage.removeUnusedLocalFiles(o._currentBranchCommittedAtDate,(function(e){}))}catch(t){e=t}t(e,e?void 0:o._current)}));else{if(this._options.xhrBaseBranchSupport&&(this._baseBranchData=this._pulledBranchData,this._pulledBranchData=void 0),n(),!t)return this._current;t(void 0,this._current)}},u.prototype.acceptPush=function(e){if(this._localStorage&&!e)throw new r(r.INVALID_PARAMS,"Need a callback function.");var t,o,n=this,i=function(r){if(!r)if(t)try{n._localStorage?(t.applyToBranch(o),n._localStorage.acceptPushedBranch(o,(function(o){if(!o)try{t.applyToBranch(n._current,!0),n._autoRemoveUnusedLocalFiles&&n._localStorage.removeUnusedLocalFiles(n._currentBranchCommittedAtDate,(function(e){}))}catch(e){o=e}e(o)}))):(t.applyToBranch(n._current,!0),n._options.xhrBaseBranchSupport&&(n._baseBranchData=n._pushedBranchData,n._pushedBranchData=void 0),n._pushJournal=void 0,e&&e())}catch(e){r=e}else e&&e();if(r){if(!e)throw r;e(r)}};if(!this._localStorage)return t=this._pushJournal,i();var a,c=2;s.readJournal(n._localStorage.pushJournalPath(),n,!1,(function(e,o){c--,a?i():(e?"ENOENT"!==e.code&&(a=new r(r.INVALID_STATE,"Failed to load push journal.",e)):t=o,c||i())})),this._loadBranch(this._localStorage.currentManifestPath(),!1,(function(e,t){c--,a?i():(e?a=new r(r.INVALID_STATE,"Failed to load current manifest.",e):o=t,c||i())}))},u.prototype.discardPulledBranch=function(e){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");var t=this;this._localStorage.discardPulledBranch((function(o){if(!o){try{t._autoRemoveUnusedLocalFiles&&t._localStorage.removeUnusedLocalFiles(t._currentBranchCommittedAtDate,(function(e){}))}catch(e){o=e}e(o)}o&&e(o)}))},u.prototype.discardPushedBranch=function(e){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");var t=this;this._localStorage.discardPushedBranch((function(o){if(!o){try{t._autoRemoveUnusedLocalFiles&&t._localStorage.removeUnusedLocalFiles(t._currentBranchCommittedAtDate,(function(e){}))}catch(e){o=e}e(o)}o&&e(o)}))},u.prototype.resetBinding=function(e){delete this._href,this._current&&this._current._resetBinding(),this._localStorage?this._discardEveryBranchButCurrent(e):(this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0,e&&e())},u.prototype.resetIdentity=function(e){delete this._href,this._current?(this._current._resetIdentity(),this._id=this._current.compositeId):this._id=h.generateUuid(),this._localStorage?this._discardEveryBranchButCurrent(e):(this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0,e&&e())},u.prototype._loadBranch=function(e,t,o){if("function"!=typeof o)throw new r(r.INVALID_PARAMS,'Param "callback" must be a function.');var n=this;c.exists(e,(function(r){r?c.readFile(e,"utf8",(function(r,s){var a;if(!r)try{(a=new i(void 0,t,e).parse(s))._localStorage=n._localStorage}catch(e){r=e}o(r,a)})):o()}))},u.prototype._discardEveryBranchButCurrent=function(e){if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");var t,o=this,n=3,i=function(r){r&&!t&&(t=r),0===--n&&(!t&&o._autoRemoveUnusedLocalFiles&&o._localStorage.removeUnusedLocalFiles(o._currentBranchCommittedAtDate,(function(e){})),e(t))};this._localStorage.discardPushedBranch(i),this._localStorage.discardPulledBranch(i),this._localStorage.discardBaseBranch(i)},u.prototype._setPath=function(e){this._localStorage?this._localStorage.compositePath=e:c.canUseFileSystem&&(this._localStorage=new a(e,this._options.preserveFileExtensions),this._current&&(this._current._localStorage=this._localStorage)),this._path=e},u}.call(t,o,t,e))||(e.exports=n)},1797:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r=o(988),i=r.networkError,s=r.unexpectedResponse,a=o(879),c=a.merge,h=o(2050),l=a.appendPathElements;function u(e,t){this._service=e,this._server=t,t&&(this._endPoint=a.endPointOf(t)),this.SYNC_ASYNC_DEFAULT_DELAY=5,this.ASYNC_DEFAULT_DELAY=1,this.DEFAULT_POLL_DELAY=10,this._maxRedirects=5,this._authenticationWhitelist=[]}return u.FileContent=h.FileContent,u.StreamProvider=h.StreamProvider,Object.defineProperties(u.prototype,{maxRedirects:{get:function(){return this._maxRedirects},set:function(e){if("number"!=typeof e)throw new r(r.INVALID_PARAMS,"Expecting a number.");this._maxRedirects=Math.floor(e)}},authenticationWhitelist:{get:function(){return this._authenticationWhitelist},set:function(e){if(!Array.isArray(e))throw new r(r.INVALID_PARAMS,"Expecting an array.");this._authenticationWhitelist=e}}}),u.prototype.isValidHref=function(e){var t=a.endPointOf(e);return!t||t===this._endPoint},u.prototype.isDomainOnWhitelist=function(e){var t=a.parseURI(e).authority;if(!t||0===t.length)return!0;var o,n=t.length,r=this._authenticationWhitelist.length;for(o=0;o<r;o++){var i=this._authenticationWhitelist[o],s=i.length;if((n>s?t.slice(-s):t)===i)return!0}return!1},u.prototype.getAsset=function(e,t,o,n){if(!(e=this._resolveUrl(e)))return n(new r(r.WRONG_ENDPOINT,"Wrong endpoint: "+e));var h,l={};"string"==typeof t?l["If-None-Match"]=t:c(l,t);var u,d=this,p=0;function f(e,t){if(e)return n(i("Error downloading an asset",e,t));var o=t.statusCode;if(200===o)n(void 0,t);else if(304===o)n(void 0,t);else if(301===o||302===o||303===o||307===o)if(!d._service.handlesRedirects&&d.maxRedirects)if(p<d.maxRedirects){var r=t.headers.location;r?u(r):n(s("Missing location header in redirect response",e,t))}else n(s("Too many redirects",e,t));else n(s("Unexpected response getting an asset",e,t));else n(s("Unexpected response getting an asset",e,t))}return(h=(u=function(t){var n={responseType:o};return t&&(p++,n.reuseRequestDesc=h,d.isDomainOnWhitelist(t)||(l.Authorization=null)),d._service.invoke("GET",t||e,l,void 0,n,f)})()).progress=a.noOp,h},u.prototype.getAssetAsType=function(e,t,o,n){return this.getAsset(e,o,t,(function(e,t){if(e)return n(e);if(200===t.statusCode){var o=t.response||t.responseText;n(void 0,o,t.headers.etag,t)}else 304===t.statusCode?n(void 0,null,t.headers.etag,t):n(s("Unexpected response getting asset",e,t))}))},u.prototype._resolveUrl=function(e){var t=a.endPointOf(e);if(t){if(t!==this._endPoint)return;return e}return l(this._server,e)},u.prototype._makeRelativeUrl=function(e){var t=a.endPointOf(e);if(t){if(t!==this._endPoint)return;var o=a.parseURI(e);(o.scheme||o.authority)&&(e=o.path,o.query&&(e+="?"+o.query),o.fragment&&(e+="#"+o.fragment))}return e},u.prototype._parseAsyncResponse=function(e){var t=e.responseText||e.response;if(!t)throw new r(r.INVALID_DATA,"No body data.");var o={},n=t.indexOf("\n");if(-1===n)throw new r(r.INVALID_DATA,"Could not find status line.");var i=t.slice(0,13===t.charCodeAt(n-1)?n-1:n).split(" ");if(o.statusCode=parseInt(i[1],10),!o.statusCode)throw new r(r.INVALID_DATA,"Could not find status code.");i.length>2&&(o.statusText=i[2]);var s=t.search(/\r?\n\r?\n/);-1===s&&(s=t.length);var c=t.slice(n+1,s);o.headers=a.parseHeaders(c);var h="\r"===t.charAt(s)?s+4:s+2;return o.response=t.slice(h),o},u.prototype._pollForAsyncResponse=function(e,t,o,n){var r=this,c=Date.now()+1e3*t,h={responseType:"text",reuseRequestDesc:o,noSoonerThen:c};a.log("asynchronous request - polling"),o=this._service.invoke("GET",e,void 0,void 0,h,(function(t,c){if(t)return n(i("Error polling for an asynchronous reponse",t,c));var h=c.statusCode;if(202===h){a.log("asynchronous request - not yet ready");var l=c.headers["retry-after"];l&&(l=parseInt(l,10)),r._pollForAsyncResponse(e,l||r.DEFAULT_POLL_DELAY,o,n)}else if(200===h){a.log("asynchronous request - success");try{c=r._parseAsyncResponse(c)}catch(e){return n(s("Error parsing response body.",e,c))}200===(h=c.statusCode)||201===h||204===h?n(void 0,c):n(s("Unexpected response polling for an asynchronous response",t,c))}else a.log("asynchronous request - error"),n(s("Unexpected response polling for an asynchronous response",t,c))}))},u.prototype._handle202Response=function(e,t,o,n){var r,i=e.responseText||e.response;try{r=JSON.parse(i)}catch(t){return n(s("Error parsing 202 response body.",t,e))}var a=r.href;if(!a)return n(s("202 response missing an href.",void 0,e));var c=e.headers["retry-after"];c=c?parseInt(c,10):o,this._pollForAsyncResponse(this._resolveUrl(a),c,t,n)},u}.call(t,o,t,e))||(e.exports=n)},2019:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r=o(988),i=o(891),s=o(887),a=o(1296),c=o(879);function h(e,t,o){this._readOnly=o,this._owner=t,this._setData(e),this._localStorage=void 0}function l(e,t,o,n,i,s,a,h){var l=t._owner._core,u=e._owner._core,d=o&&e.id===t.id,p=u._getSourceHrefOfComponent(e),f=l.getComponentWithId(t.id),_=n&&(!f||!f.etag)&&"unmodified"===e.state,m=!d&&!p,g=m;if(i&&!f&&(p||m)&&e.id===t.id&&(t._data.id=c.generateUuid(),t.state="modified",t.etag=void 0,t.version=void 0,t.md5=void 0,t.length=void 0),s&&s._copyComponentMapping(e.id,h,t.id,a)&&(g=!1,d||(t.state="modified")),m){if(_){if(p=u._getHrefOfComponent(e),l._setSourceHrefOfComponent(p,t,a),!p&&g)throw new r(r.INVALID_STATE,"Failed to determine the source href of a component that does not have a local file.")}else if(g)throw new r(r.INVALID_STATE,"Could not use server-to-server copy for component "+e.id)}else l._setSourceHrefOfComponent(p,t,a);p&&(t.state="modified")}return Object.defineProperties(h.prototype,{rootNode:{get:function(){return this.getChildWithAbsolutePath(i.ROOT_PATH)},set:function(e){throw new r(r.READ_ONLY,'Property "rootNode" is read-only.')}},hasLocalStorage:{get:function(){return this._localStorage},set:function(){throw new r(r.READ_ONLY,"Cannot set the property hasLocalStorage.")}},isDirty:{get:function(){return this._isDirty},set:function(){throw new r(r.READ_ONLY,"Cannot set the property isDirty.")}},changeCount:{get:function(){return this._data.local&&this._data.local.change||0},set:function(){throw new r(r.READ_ONLY,"Cannot set the property changeCount.")}}}),h.prototype.getChildWithId=function(e){return this._allNodes[e]},h.prototype.getChildWithAbsolutePath=function(e){var t=this._absolutePaths[e.toLowerCase()];return t&&t instanceof i?t:void 0},h.prototype.getChildrenOf=function(e){if(!(e=e?this._allNodes[e.id]:this.rootNode))throw new r(r.INVALID_PARAMS,"Unknown node");var t,o=[],n=e._data.children;if(Array.isArray(n))for(t=0;t<n.length;t++){var i=n[t],s=this._allNodes[i.id];if(!s)throw new r(r.INVALID_DATA,"Node not in cache");o[o.length]=s}return o},h.prototype.addChild=function(e,t,o,n){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(t=t||c.generateUuid(),this._allNodes[t])throw new r(r.DUPLICATE_VALUE,"Node already exists in branch.");if(o&&("number"!=typeof o||o%1!=0))throw new r(r.INVALID_PARAMS,'Param "index" must be an integer.');var s=n?this._allNodes[n.id]:this.rootNode;if(!s)throw new r(r.INVALID_PARAMS,"Unknown parent node.");var a=new i;a.id=t,e&&(a.name=e),a._parentPath=s.absolutePath||s._parentPath;var h=s._data.children;return h?(o>=0&&o<=h.length||(o=h.length),o===h.length?h[o]=a._data:h.splice(o,0,a._data)):s._data.children=[a._data],this._allNodes[a.id]=a,a._owner=this._owner,this._setDirty(),a},h.prototype.removeChild=function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "node".');if(e.isRoot)throw new r(r.INVALID_PARAMS,"Cannot remove the root node.");var t=e.id;if(!t)throw new r(r.INVALID_PARAMS,'Param "node" must have an id.');var o=this._nodeDataOfParentOfNode(e);if(!o)throw new r(r.INVALID_PARAMS,"Node not found in this branch.");return o.parentNodeData.children.splice(o.index,1),0===o.parentNodeData.children.length&&delete o.parentNodeData.children,e=this._allNodes[t],this._removeNodeFromCachesRecursively(e._data),this._setDirty(),e},h.prototype.moveChild=function(e,t,o){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "node".');if(e.isRoot)throw new r(r.INVALID_PARAMS,"Cannot move the root node.");if(t&&("number"!=typeof t||t%1!=0))throw new r(r.INVALID_PARAMS,'Param "index" must be an integer.');var n=e.id;if(!n)throw new r(r.INVALID_PARAMS,'Param "node" must have an id.');var i=this._nodeDataOfParentOfNode(e);if(e=this._allNodes[n],!i)throw new r(r.INVALID_PARAMS,"Node not found in this branch.");var s=o?this._allNodes[o.id]:this.rootNode;if(!s)throw new r(r.INVALID_PARAMS,"Unknown parent node.");if(this._nodeIdIsDescendantOf(s.id,e._data))throw new r(r.INVALID_PARAMS,"Must not create a cycle.");var a=i.parentNodeData.children.splice(i.index,1)[0];try{var c=s._data.children;c?(t>=0&&t<=c.length||(t=c.length),t===c.length?c[t]=a:c.splice(t,0,a)):s._data.children=[a]}catch(e){throw i.parentNodeData.children.splice(i.index,0,a),e}return 0===i.parentNodeData.children.length&&delete i.parentNodeData.children,this._setDirty(),this._allNodes[n]},h.prototype.copyChild=function(e,t,o,n,r,i){return this._copyChild(e,t,o,n,r,!1,i)},h.prototype.replaceChild=function(e,t,o,n){return this._copyChild(e,void 0,void 0,t,o||e.id,!0,n)},h.prototype.allComponents=function(){var e,t=[];for(e in this._allComponents)this._allComponents.hasOwnProperty(e)&&t.push(this._allComponents[e]);return t},h.prototype.getComponentWithId=function(e){return this._allComponents[e]},h.prototype.getComponentWithAbsolutePath=function(e){var t=this._absolutePaths[e.toLowerCase()];return t&&t instanceof s?t:void 0},h.prototype.getComponentsOf=function(e){if(!(e=e?this._allNodes[e.id]:this.rootNode))throw new r(r.INVALID_PARAMS,"Unknown node");var t,o=[],n=e._data.components;if(Array.isArray(n))for(t=0;t<n.length;t++){var i=n[t],s=this._allComponents[i.id];if(!s)throw new r(r.INVALID_DATA,"Component not in cache");o[o.length]=s}return o},h.prototype.addComponent=function(e,t,o,n,i,a,h,l,u,d){var p=this._localStorage;if(!p)throw new r(r.NO_LOCAL_STORAGE,"No local storage. Use AdobeDCXCompositeXfer.uploadNewComponent() followed by addComponentWithUploadResults()");if("function"!=typeof d&&i)throw new r(r.INVALID_PARAMS,'Param "callback" must be a function.');if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(u&&"string"!=typeof u)throw new r(r.INVALID_PARAMS,'Param "id" must be of type string.');if(!i&&!h)throw new r(r.INVALID_PARAMS,"Must provide either source or sourceHref.");try{if(h){var f=this._getBranchOf(this).compositeHref;if(f){var _=c.endPointOf(f),m=c.endPointOf(h);if(_&&m&&_!==m)throw new r(r.WRONG_ENDPOINT,"Given source href has an invalid endpoint: "+m)}}var g=this._local();u=u||c.generateUuid();var y=new s;y.id=u,y.name=e,y.type=t,y.relationship=o,y.path=n,y.state="modified";var v=this,A=function(e){if(!e)try{if(u&&v._allComponents[u])throw new r(r.DUPLICATE_VALUE,'The "id" of a component must be unique.');var t=l?v._allNodes[l.id]:v.rootNode;if(!t)throw new r(r.INVALID_PARAMS,"Unknown parent node.");var o=v._normalizedAbsolutePathForItem(y,t);if(v._absolutePaths[o])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+o);if(!c.isValidAbsolutePath(o))throw new r(r.INVALID_PARAMS,"Invalid absolute path: "+o);y._parentPath=t.absolutePath||t._parentPath;var n=t._data.components;n?n.push(y._data):t._data.components=[y._data],y._owner=v._owner,h&&v._setSourceHrefOfComponent(h,y),v._allComponents[y.id]=y,v._absolutePaths[o]=y,v._setDirty()}catch(t){p.removeComponentAsset(y,g),h&&v._setSourceHrefOfComponent(void 0,y),y=void 0,e=t}if(d)return d(e,y);if(e)throw e;return y};if(!i)return A();p.ingestComponentAsset(y,i,a,g,A)}catch(e){if(d)return d(e);throw e}},h.prototype.addComponentWithUploadResults=function(e,t,o,n,i){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(i.compositeId!==this._owner.compositeId)throw new r(r.INVALID_PARAMS,"Param uploadResults does not appear valid to be for this composite.");var a=Object.keys(i.records);if(1!==a.length)throw new r(r.INVALID_PARAMS,"Param uploadResults must contain records of exactly one component upload.");if(this._localStorage)throw new r(r.INVALID_PARAMS,"This method is for in-browser use only. Use addComponent() instead.");var c=i.records[a[0]],h=c.id;if(this._allComponents[h])throw new r(r.DUPLICATE_VALUE,"Duplicate component id: "+h);var l=n?this._allNodes[n.id]:this.rootNode;if(!l)throw new r(r.INVALID_PARAMS,"Unknown parent node.");var u=new s;u.id=h,u.name=e,u.type=c.type,u.relationship=t,u.path=o,u.state="unmodified",u.etag=c.etag,u.length=c.length,u.version=c.version,u.md5=c.md5;var d=this._normalizedAbsolutePathForItem(u,l);if(this._absolutePaths[d])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+d);u._parentPath=l.absolutePath||l._parentPath;var p=l._data.components;return p?p.push(u._data):l._data.components=[u._data],u._owner=this._owner,this._allComponents[h]=u,this._absolutePaths[d]=u,this._setDirty(),u},h.prototype.updateComponent=function(e,t,o,n){var i=this._localStorage;if(!i)throw new r(r.NO_LOCAL_STORAGE,"No local storage. Use AdobeDCXCompositeXfer.uploadComponent() to upload a new component asset and then call updateComponentWithUploadResults()");if("function"!=typeof n)throw new r(r.INVALID_PARAMS,'Param "callback" must be a function.');if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!(e=this._allComponents[e.id]))throw new r(r.INVALID_PARAMS,"Unknown component.");try{var s=this;i.ingestComponentAsset(e,t,o,this._local(),(function(t){if(!t)try{"modified"!==e.state?e.state="modified":s._setDirty(),s._setSourceHrefOfComponent(void 0,e)}catch(o){t=o,e=void 0}n(t,e)}))}catch(e){n(e)}},h.prototype.updateComponentWithUploadResults=function(e,t){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!(e=this._allComponents[e.id]))throw new r(r.INVALID_PARAMS,"Unknown component.");if(this._localStorage)throw new r(r.INVALID_PARAMS,"This method is for in-browser use only. Use updateComponent() instead.");if(t.compositeId!==this._owner.compositeId)throw new r(r.INVALID_PARAMS,"Param uploadResults does not appear valid to be for this composite.");var o=t.records[e.id];if(!o)throw new r(r.INVALID_PARAMS,"Param uploadResults does not contain an upload record for the given component.");return e.etag=o.etag,e.version=o.version,e.md5=o.md5,e.length=o.length,e},h.prototype.removeComponent=function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "component".');var t=e.id;if(!t)throw new r(r.INVALID_PARAMS,'Param "component" must have an id.');var o=this._nodeDataOfParentOfComponent(e);if(!o)throw new r(r.INVALID_PARAMS,"Component not found in this branch.");return o.parentNodeData.components.splice(o.index,1),0===o.parentNodeData.components.length&&delete o.parentNodeData.components,e=this._allComponents[t],delete this._allComponents[t],delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],this._localStorage&&(this._localStorage.removeComponentAsset(e,this._local()),this._setSourceHrefOfComponent(void 0,e)),e._owner=void 0,e._parentPath="",this._setDirty(),e},h.prototype.moveComponent=function(e,t){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "component".');var o=e.id;if(!o)throw new r(r.INVALID_PARAMS,'Param "component" must have an id.');var n=this._nodeDataOfParentOfComponent(e);if(!n)throw new r(r.INVALID_PARAMS,"Component not found in this branch.");var i=t?this._allNodes[t.id]:this.rootNode;if(!i)throw new r(r.INVALID_PARAMS,"Unknown parent node.");var s=this._normalizedAbsolutePathForItem(e,i);if(this._absolutePaths[s])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+s);var a=n.parentNodeData.components.splice(n.index,1)[0],c=i._data.components;return c?c.push(a):i._data.components=[a],0===n.parentNodeData.components.length&&delete n.parentNodeData.components,e=this._allComponents[o],delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],e._parentPath=i.absolutePath||i._parentPath,this._absolutePaths[s]=e,this._setDirty(),e},h.prototype.copyComponent=function(e,t,o,n,r){return this._copyComponent(e,t,o,n,!1,r)},h.prototype.replaceComponent=function(e,t,o,n){return this._copyComponent(e,void 0,t,o||e.id,!0,n)},h.prototype.assetOfComponent=function(e,t){try{if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "component".');if(!e.id)throw new r(r.INVALID_PARAMS,'Param "component" must have an id.');var o=this._localStorage.componentAssetPath(e,this._local());if(!t)return o;a.exists(o,(function(e){t(void 0,e?o:null)}))}catch(e){if(!t)throw e;t(e)}},h.prototype._getHrefOfComponent=function(e){var t,o=this._getBranchOf(e).compositeHref;return o&&void 0!==e.version&&(t=c.appendPathElements(o,e.id),t+=";version="+e.version),t},h.prototype._setSourceHrefOfComponent=function(e,t,o){var n=t.id,r=this._componentSourceHrefLookup(!0,o);e?r[n]=e:r[n]&&delete r[n]},h.prototype._getSourceHrefOfComponent=function(e,t){var o=e.id,n=this._componentSourceHrefLookup(!1,t);if(n)return n[o]},h.prototype._copySourceHrefsFrom=function(e){var t=e._componentSourceHrefLookup(!1),o=this.allComponents(),n=o.length;if(n&&t){var r,i=this._componentSourceHrefLookup(!0);for(r=0;r<n;r++){var s=o[r].id;i[s]=t[s]}}},h.prototype._getBranchOf=function(e){return e._owner?this._getBranchOf(e._owner):e},h.prototype._isSameComposite=function(e){var t=this._getBranchOf(this),o=this._getBranchOf(e);return t._data.id===o._data.id&&(t.compositeHref===o.compositeHref&&this._localStorage===e._localStorage)},h.prototype._stringify=function(e,t){if(e){var o=this._data.local,n=null;try{delete this._data.local,n=JSON.stringify(this._data,void 0,t?2:void 0)}catch(e){throw e}finally{o&&(this._data.local=o)}return n}return JSON.stringify(this._data,void 0,t?2:void 0)},h.prototype._setData=function(e){var t=new i(e,this._readOnly,!0);t._owner=this._owner,t._parentPath="";var o={},n={},a={};n[t.id]=t,a[i.ROOT_PATH]=t;var h=this,l=function(e,t,o,n,a){var u,d,p,f=e.components;if(Array.isArray(f))for(u=0;u<f.length;u++){var _=f[u],m=new s(_,h._readOnly);if(t[m.id])throw new r(r.INVALID_DATA,"Duplicate component id: "+m.id);if(m._owner=h._owner,m._parentPath=a,n[p=h._normalizedAbsolutePathForItem(m)])throw new r(r.INVALID_DATA,"Duplicate absolute path: "+p);if(!c.isValidAbsolutePath(p))throw new r(r.INVALID_DATA,"Invalid absolute component path: "+p);t[m.id]=m,n[p]=m}var g=e.children;if(Array.isArray(g))for(u=0;u<g.length;u++){var y=g[u],v=new i(y,h._readOnly);if(o[v.id])throw new r(r.INVALID_DATA,"Duplicate node id: "+v.id);if(d=v.path,v._owner=h._owner,v._parentPath=a,d){if(n[p=h._normalizedAbsolutePathForItem(v)])throw new r(r.INVALID_DATA,"Duplicate absolute path: "+p);if(!c.isValidAbsolutePath(p))throw new r(r.INVALID_DATA,"Invalid node absolute path: "+p);n[p]=v}o[v.id]=v,l(y,t,o,n,v.path?c.appendPathElements(a,v.path):a)}};return l(e,o,n,a,i.ROOT_PATH),this._data=e,this._allComponents=o,this._allNodes=n,this._absolutePaths=a,this._isDirty=!1,this},h.prototype._removeNodeFromCachesRecursively=function(e){var t,o=e.components;if(Array.isArray(o))for(t=0;t<o.length;t++){var n=o[t].id,r=this._allComponents[n];delete this._allComponents[n],delete this._absolutePaths[this._normalizedAbsolutePathForItem(r)],r._owner=void 0,this._localStorage&&(this._localStorage.removeComponentAsset(r,this._local()),this._setSourceHrefOfComponent(void 0,r))}var i=e.children;if(Array.isArray(i))for(t=0;t<i.length;t++)this._removeNodeFromCachesRecursively(i[t]);var s=e.id,a=this._allNodes[s];delete this._allNodes[s],a.path&&delete this._absolutePaths[this._normalizedAbsolutePathForItem(a)],a._owner=void 0},h.prototype._local=function(){return this._data.local||(this._data.local={version:2}),this._data.local},h.prototype._componentSourceHrefLookup=function(e,t){if(e&&this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(t||(t=e?this._local():this._data.local)){var o=t["componentS2SCopy#srcHref"];return!o&&e&&(o=t["componentS2SCopy#srcHref"]={}),o}},h.prototype._recursiveReset=function(e,t){var o,n=e.components;if(n)for(o=n.length-1;o>=0;o--){var r=n[o];"committedDelete"===r.state?(delete n[o],delete this._allComponents[r.id],delete r._owner,this._localStorage&&this._localStorage.removeComponentAsset(r,this._local()),this._setSourceHrefOfComponent(void 0,r,this._local())):(delete r.etag,delete r.version,delete r.length,delete r.md5,r.state="modified",t&&t(r))}var i=e.children;if(i)for(o=0;o<i.length;o++)this._recursiveReset(i[o],t)},h.prototype._nodeIdIsDescendantOf=function(e,t){var o,n=t.children;if(n)for(o=0;o<n.length;o++){var r=n[o];if(r.id===e||this._nodeIdIsDescendantOf(e,r))return!0}return!1},h.prototype._recursivelyGetAllComponentsOfChild=function(e,t){t=t||[];var o,n,r=e._data||e,i=r.components;if(i)for(n=i.length,o=0;o<n;o++)t[t.length]=this._allComponents[i[o].id];var s=r.children;if(s)for(n=s.length,o=0;o<n;o++)t=this._recursivelyGetAllComponentsOfChild(s[o],t);return t},h.prototype._nodeDataOfParentOfNode=function(e,t){t=t||this._data;var o,n=e._data.id,r=t.children;if(r)for(o=0;o<r.length;o++){var i=r[o];i.path;if(i.id===n)return{parentNodeData:t,index:o};var s=this._nodeDataOfParentOfNode(e,i);if(s)return s}return null},h.prototype._nodeDataOfParentOfComponent=function(e,t){t=t||this._data;var o,n=e._data.id,r=t.components;if(r)for(o=0;o<r.length;o++){if(r[o].id===n)return{parentNodeData:t,index:o}}var i=t.children;if(i)for(o=0;o<i.length;o++){var s=i[o],a=this._nodeDataOfParentOfComponent(e,s);if(a)return a}return null},h.prototype._determineAbsolutePathChangesRecursively=function(e,t,o){var n,r=e.components;if(r)for(n=0;n<r.length;n++){var i=r[n],s=this._allComponents[i.id];o.push({item:s,parentPath:t,absPath:c.appendPathElements(t,i.path)})}var a=e.children;if(a)for(n=0;n<a.length;n++){var h=a[n],l=this._allNodes[h.id],u=h.path,d=u?c.appendPathElements(t,u):t;o.push({item:l,parentPath:t,absPath:u?d:void 0}),this._determineAbsolutePathChangesRecursively(h,d,o)}},h.prototype._setPathOfNode=function(e,t){var o=t?c.appendPathElements(e.parentPath,t):e.parentPath,n=[{item:e,absPath:t?o:void 0}];this._determineAbsolutePathChangesRecursively(e._data,o,n);var i,s,a=c.flatCopy(this._absolutePaths);for(i=0;i<n.length;i++){var h=n[i].item;h._data.path&&delete a[this._normalizedAbsolutePathForItem(h)]}for(i=0;i<n.length;i++)if((s=n[i]).absPath){var l=s.absPath.toLowerCase();if(a[l])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+l);if(!c.isValidAbsolutePath(l))throw new r(r.INVALID_PARAMS,"Invalid absolute path: "+l);a[l]=s.item}for(i=0;i<n.length;i++)(s=n[i]).parentPath&&(s.item._parentPath=s.parentPath);e._data.path=t,this._absolutePaths=a},h.prototype._setPathOfComponent=function(e,t){if(!this._allComponents[e.id])throw new r(r.INVALID_PARAMS,"Unknown component.");var o=c.appendPathElements(e.parentPath,t).toLowerCase();if(this._absolutePaths[o])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path for component: "+o);if(!c.isValidAbsolutePath(o))throw new r(r.INVALID_PARAMS,"Invalid absolute path: "+o);delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],this._absolutePaths[o]=e,e._data.path=t},h.prototype._setDirty=function(e){if(!e){if("pending"===this._local().archivalState||"archived"===this._local().archivalState)throw new r(r.INVALID_STATE,"Cannot modify an archived composite.");"pendingDelete"!==this._data.state&&"committedDelete"!==this._data.state||console.log("Modifying deleted composite")}this._isDirty=!0,this._local().change=this.changeCount+1,e||"unmodified"!==this._data.state&&this._data.state||(this._data.state="modified")},h.prototype._normalizedAbsolutePathForItem=function(e,t){return(t?c.appendPathElements(t.absolutePath||t._parentPath,e.path):e.absolutePath).toLowerCase()},h.prototype._hasSameEndpoint=function(e){var t=this._getBranchOf(this).compositeHref,o=this._getBranchOf(e).compositeHref;if(t&&o){var n=c.endPointOf(t),r=c.endPointOf(o);if(n&&r&&n!==r)return!1}return!0},h.prototype._copyComponent=function(e,t,o,n,i,s){if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "component".');if(s&&"function"!=typeof s)throw new r(r.INVALID_PARAMS,"Param callback must be a function.");var a=this,c=e._owner._core,h=this._isSameComposite(c),u=h||this._hasSameEndpoint(e),d=c._local(),p=this._localStorage,f=c._localStorage,_=p&&f;if(_&&!s&&!h)throw new r(r.INVALID_PARAMS,"Must pass a callback when copying between two different composites.");if(!_&&!u)throw new r(r.NO_LOCAL_STORAGE,"Cannot copy between two different endpoints without local storage.");var m=function(e,t,o){l(e,t,h,u,!n,_?p:void 0,o,d)},g=_?f.componentAssetPath(e,d):void 0;if(!s)return this._copyComponentModel(e,t,i,o,n,m);if(h||!g)try{s(void 0,this._copyComponentModel(e,t,i,o,n,m))}catch(e){s(e)}else{var y={};p.ingestComponentAsset(e,g,!0,y,(function(r){if(r)s(r);else try{d=y,s(void 0,a._copyComponentModel(e,t,i,o,n,m))}catch(e){s(e)}}))}},h.prototype._copyComponentModel=function(e,t,o,n,i,a){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "component".');var h=e._owner,l=new s(JSON.parse(JSON.stringify(e._data)));n?(l.path=n,l.id=i||c.generateUuid()):i&&(l.id=i),l._owner=this._owner,e.id===l.id&&this._isSameComposite(h._core)||(l.state="modified",l.etag=void 0,l.version=void 0,l.md5=void 0,l.length=void 0);var u,d,p=this._allComponents[l.id];if(p&&!o)throw new r(r.DUPLICATE_VALUE,"Component already exists.");if(o&&!p)throw new r(r.INVALID_PARAMS,"Could not find existing component.");if(o){var f=this._nodeDataOfParentOfComponent(p);if(!f)throw new r(r.INVALID_PARAMS,"Parent node of existing component not found in this branch.");var _=f.parentNodeData.id;if(!(d=this._allNodes[_]))throw new r(r.INVALID_STATE,"Unknown parent node.");u=f.index}else if(!(d=t?this._allNodes[t.id]:this.rootNode))throw new r(r.INVALID_PARAMS,"Unknown parent node.");l._parentPath=d.absolutePath||d._parentPath;var m=this._normalizedAbsolutePathForItem(l),g=this._absolutePaths[m];if(g&&g!==p)throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+m);if(!c.isValidAbsolutePath(m))throw new r(r.INVALID_PARAMS,"Component path must be a valid path for a component.");var y=this._local();a&&a(e,l,y=c.deepCopy(y));var v=d._data.components;return o?v[u]=l._data:v?v.push(l._data):d._data.components=[l._data],this._data.local=y,this._allComponents[l.id]=l,this._absolutePaths[m]=l,this._setDirty(),l},h.prototype._copyChild=function(e,t,o,n,i,s,a){if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "node".');var c=this,h=e._owner._core,u=this._isSameComposite(h),d=u||this._hasSameEndpoint(e),p=h._local(),f=this._localStorage,_=h._localStorage,m=f&&_,g=h._recursivelyGetAllComponentsOfChild(e);if(g.length>0){if(m&&!a&&!u)throw new r(r.INVALID_PARAMS,"Must pass a callback when copying between two different composites.");if(!m&&!d)throw new r(r.NO_LOCAL_STORAGE,"Cannot copy components between two different endpoints without local storage.")}var y=function(e,t,o){l(e,t,u,d,!0,m?f:void 0,o,p)};if(!a)return this._copyChildModel(e,t,o,s,n,i,y);var v=function(){a(void 0,c._copyChildModel(e,t,o,s,n,i,y))};if(0===g.length||u||!m)try{v()}catch(e){a(e)}else{var A,w,C={},S=g.length,E=0,D=function(e){if(e&&!w&&(w=e),0===--E)if(w)a(w);else try{p=C,v()}catch(e){a(e)}};for(A=0;A<S;A++){var I=g[A],N=_.componentAssetPath(I,p);N&&(E++,f.ingestComponentAsset(I,N,!0,C,D))}if(0===E)try{v()}catch(e){a(e)}}},h.prototype._copyChildModel=function(e,t,o,n,a,h,l){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");var u=e._owner,d=new i(JSON.parse(JSON.stringify(e._data)));a?(d.path=a,d.id=h||c.generateUuid()):h&&(d.id=h),d._owner=this._owner,e.isRoot&&(delete d._data.local,delete d._data["manifest-format-version"]);var p,f=this._allNodes[d.id];if(f&&!n)throw new r(r.DUPLICATE_VALUE,"Child node already exists.");if(n&&!f)throw new r(r.INVALID_PARAMS,"Could not find existing node to replace.");if(n){var _=this._nodeDataOfParentOfNode(f);if(!_)throw new r(r.INVALID_PARAMS,"Parent of existing node not found in this branch.");var m=_.parentNodeData.id;if(!(p=this._allNodes[m]))throw new r(r.INVALID_STATE,"Unknown parent node.");o=_.index}else if(!(p=t?this._allNodes[t.id]:this.rootNode))throw new r(r.INVALID_PARAMS,"Unknown parent node.");if(d._parentPath=p.absolutePath||p._parentPath,d.path){var g=this._normalizedAbsolutePathForItem(d),y=this._absolutePaths[g];if(y&&y!==f)throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+g);if(!c.isValidAbsolutePath(g))throw new r(r.INVALID_PARAMS,"Node path must be a valid path for a node.")}var v=c.flatCopy(this._allNodes),A=c.flatCopy(this._allComponents),w=c.flatCopy(this._absolutePaths),C=c.deepCopy(this._local()),S=function(e,t,o,n,r,i){var s,a;delete o[e.id],e.path&&delete r[t._normalizedAbsolutePathForItem(e)];var c=e._data.children;if(c)for(a=c.length,s=0;s<a;s++)S(o[c[s].id],t,o,n,r,i);var h=e._data.components;if(h)for(a=h.length,s=0;s<a;s++){var l=n[h[s].id];delete n[l.id],delete r[t._normalizedAbsolutePathForItem(l)],t._localStorage&&(t._localStorage.removeComponentAsset(l,i),t._setSourceHrefOfComponent(void 0,l,i))}};f&&S(f,this,v,A,w,C);var E=function(e,t,o,n,a,h,u,d){if(n[e.id])throw new r(r.DUPLICATE_VALUE,"Duplicate node id: "+e.id);var p;if(n[e.id]=e,e.path){if(h[p=t._core._normalizedAbsolutePathForItem(e)])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+p);h[p]=e}var f,_,m=e._data.children;if(m)for(_=m.length,f=0;f<_;f++){var g=new i(m[f]);n[g.id]&&(g.id=c.generateUuid()),g._owner=t,g._parentPath=e.absolutePath||e._parentPath,E(g,t,o,n,a,h,u,d)}var y=e._data.components;if(y)for(_=y.length,f=0;f<_;f++){var v=new s(y[f]),A=v.id;if(a[A]&&(v.id=c.generateUuid(),v.state="modified",v.etag=void 0,v.version=void 0,v.md5=void 0,v.length=void 0),v._owner=t,v._parentPath=e.absolutePath||e._parentPath,l&&l(o.getComponentWithId(A),v,u),a[v.id])throw new r(r.DUPLICATE_VALUE,"Duplicate component id: "+v.id);if(a[v.id]=v,h[p=t._core._normalizedAbsolutePathForItem(v)])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+p);h[p]=v}};if(E(d,this._owner,u,v,A,w,C,u._local()),n)p._data.children[o]=d._data;else{var D=p._data.children;D?(o>=0&&o<=D.length||(o=D.length),o===D.length?D[o]=d._data:D.splice(o,0,d._data)):p._data.children=[d._data]}return this._allNodes=v,this._allComponents=A,this._absolutePaths=w,this._data.local=C,this._setDirty(),d},h.prototype._verifyIntegrity=function(e,t,o){var n,s=this,a=[],h=!1,l=function(e){return a.push(new r(r.INVALID_STATE,e)),t&&(h||(t("Branch for composite "+s.rootNode.id+" has the following errors:"),h=!0),t("   "+e)),!1},u=function(e,t){return!!e||l(t)},d=[],p=function(e){(d.indexOf(e)<0||l("Item "+e.id+" encountered more than once"))&&d.push(e)},f=c.flatCopy(this._allComponents),_=c.flatCopy(this._allNodes),m=c.flatCopy(this._absolutePaths),g=Object.keys(m),y=g.length;for(n=0;n<y;n++){var v=g[n];u("/"===v.charAt(0),"Absolute path "+v+" does not start with a slash.")}var A=function(e,t){var o,n,r=e.children;if(r)for(o=0;o<r.length;o++){var i=r[o],a=_[i.id];(a||l("Node "+i.id+" is not in cache."))&&(p(a),u(a._data===i,"Node "+a.id+" _data property incorrect."),delete _[a.id],a.path&&a._owner&&(n=s._normalizedAbsolutePathForItem(a),(m[n]||l("Absolute path of node "+a.id+" ("+n+") is not in cache."))&&delete m[n]),u(a._parentPath===t,"Parent path of node "+a.id+" should be "+t+" but is "+a._parentPath),u(a._owner===s._owner,"Node "+a.id+" _owner property is not correct.")),A(i,i.path?c.appendPathElements(t,i.path):t)}var h=e.components;if(h)for(o=0;o<h.length;o++){var d=h[o],g=f[d.id];(g||l("Component "+d.id+" is not in cache."))&&(p(g),u(g._data===d,"Component "+g.id+" _data property incorrect."),delete f[g.id],g._owner&&(n=s._normalizedAbsolutePathForItem(g),(m[n]||l("Absolute path "+n+" is not in cache."))&&delete m[n]),u(g._parentPath===t,"Parent path of component "+g.id+" should be "+t+" but is "+g._parentPath),u(g._owner===s._owner,"Component "+g.id+" _owner property is not correct."))}},w=m[i.ROOT_PATH];u(w,"Cannot find root node via path")&&(u(w.id===this._data.id,"Root node has correct id"),u(w.path===i.ROOT_PATH,"Root node has correct path"),u(""===w._parentPath,"Root node has correct parent path"),u(w._owner===this._owner,"Root node has correct owner"),u(w._data===this._data,"Root node has correct data"),u(_[w.id]===w,"Cannot find root node via id")&&delete _[w.id],delete m[i.ROOT_PATH]),A(this._data,i.ROOT_PATH);var C=Object.keys(f);for(n=0;n<C.length;n++)l("Component "+C[n]+" is in cache but could not be found.");for(C=Object.keys(_),n=0;n<C.length;n++)l("Node "+C[n]+" is in cache but could not be found.");for(C=Object.keys(m),n=0;n<C.length;n++)l("Absolute path "+C[n]+" is in cache but could not be found.");if(this._localStorage){var S=this._localStorage.componentIds(this._local());for(n=0;n<S.length;n++)u(this._allComponents[S[n]],"Component "+S[n]+" is in local storage mapping but could not be found in the manifest.");if(e)for(S=Object.keys(this._allComponents),n=0;n<S.length;n++){var E=S[n],D=this._allComponents[E],I=this._localStorage.componentAssetPath(D,this._local());u(I,"Component "+E+" does not have an entry in local storage mapping.")&&o&&u(o.existsSync(I),"Asset "+I+" does not exist.")}var N=this._componentSourceHrefLookup();if(N)for(y=(S=Object.keys(N)).length,n=0;n<y;n++){var O=this._allComponents[S[n]];O?u("modified"===O.state,"Component "+S[n]+" is in local source href mapping but has a state of "+O.state):u(!1,"Component "+S[n]+" is in local source href mapping but could not be found in the manifest.")}}return a.length?a:null},h}.call(t,o,t,e))||(e.exports=n)},2048:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r=o(988),i=o(1296),s=(o(879),3);function a(e,t,o){o?this._setData(o,e.href):this._data={"push-journal-format-version":s,"composite-href":e.href,"uploaded-components":{}},this._filePath=t,this._waitingCallbacks=[],this._commitInProgress=!1,this._needAnotherCommit=!1}return a.readJournal=function(e,t,o,n){i.readFile(e,"utf8",(function(r,i){var s;if(r&&r.code&&o&&(r=void 0),!r)try{i=JSON.parse(i),s=new a(t,e,i)}catch(n){o?s=new a(t,e):r=n}n(r,r?void 0:s)}))},Object.defineProperties(a.prototype,{compositeHref:{get:function(){return this._data["composite-href"]},set:function(e){throw new r(r.READ_ONLY,"This property is read-only.")}},manifestEtag:{get:function(){return this._data.etag},set:function(e){e?this._data.etag=e:delete this._data.etag}},currentBranchEtag:{get:function(){return this._data["current-branch-etag"]},set:function(e){e?this._data["current-branch-etag"]=e:delete this._data["current-branch-etag"]}},changeCount:{get:function(){return this._data.change},set:function(e){e?this._data.change=e:delete this._data.change}},compositeHasBeenCreated:{get:function(){return!!this._data["composite-created"]},set:function(e){e?this._data["composite-created"]=!0:delete this._data["composite-created"]}},compositeHasBeenDeleted:{get:function(){return!!this._data["composite-deleted"]},set:function(e){e?this._data["composite-deleted"]=!0:delete this._data["composite-deleted"]}},compositeHasBeenArchived:{get:function(){return!!this._data["composite-archived"]},set:function(e){e?this._data["composite-archived"]=!0:delete this._data["composite-archived"]}},isEmpty:{get:function(){return 0===Object.keys(this._data["uploaded-components"]).length&&!this.compositeHasBeenDeleted&&!this.manifestEtag},set:function(e){throw new r(r.READ_ONLY,"This property is read-only.")}},isComplete:{get:function(){return!!(this._data.etag&&this._data.change||this._data["composite-deleted"]||this._data["composite-archived"])},set:function(e){throw new r(r.READ_ONLY,"This property is read-only.")}}}),a.prototype.recordUploadedComponent=function(e,t,o,n,r,i,s){var a={etag:t,length:r,version:o,md5:n};i&&(a["storage-name"]=i),s&&(a["source-href"]=s),this._data["uploaded-components"][e]=a},a.prototype.idsOfAllUploadedComponents=function(){return Object.keys(this._data["uploaded-components"])},a.prototype.getRecordForUploadedComponent=function(e){return this._data["uploaded-components"][e]},a.prototype.removeRecordForUploadedComponent=function(e){delete this._data["uploaded-components"][e]},a.prototype.applyToBranch=function(e,t){if(!this.isComplete)throw new r(r.INVALID_STATE,"Journal is not complete.");var o=e.isDirty;if(this.compositeHasBeenDeleted)e._data.state="committedDelete",e.manifestEtag=this.manifestEtag;else{this.compositeHasBeenArchived&&(e.compositeArchivalState="archived");var n,i="unmodified"!==e.compositeState&&this.changeCount!==e.changeCount,s=this.idsOfAllUploadedComponents(),a=s.length;for(n=0;n<a;n++){var c=s[n],h=e.getComponentWithId(c);if(h){var l=this.getRecordForUploadedComponent(h.id);h._data.etag=l.etag,h._data.length=l.length,h._data.version=l.version,h._data.md5=l.md5,l["source-href"]?e._core._getSourceHrefOfComponent(h)===l["source-href"]&&(h._data.state="unmodified",e._core._setSourceHrefOfComponent(void 0,h)):e.hasLocalStorage&&e._localStorage.componentAssetName(h,e._local())===l["storage-name"]?(h._data.state="unmodified",e._core._setSourceHrefOfComponent(void 0,h)):e.hasLocalStorage||(h._data.state="unmodified")}}e.manifestEtag=this.manifestEtag,i||(e._data.state="unmodified")}t&&(e._isDirty=o)},a.prototype.commitChanges=function(e){if(this._filePath){var t=this,o=function(e){t._needAnotherCommit=!1,t._commitInProgress=!0,t._waitingCallbacks=[],i.writeFileAtomically(t._filePath,JSON.stringify(t._data),"utf8",(function(n){var r,i=e.length;for(r=0;r<i;r++)try{e[r](n)}catch(e){}t._needAnotherCommit?o(t._waitingCallbacks):t._commitInProgress=!1}))};t._commitInProgress?(this._needAnotherCommit=!0,e&&this._waitingCallbacks.push(e)):o(e?[e]:[])}else e&&e()},a.prototype._setData=function(e,t){if(e["push-journal-format-version"]<=2){var o=e["uploaded-components"];if(o){var n,r=Object.keys(o),i=r.length;for(n=0;n<i;n++){var a=o[r[n]];"number"==typeof a.version&&(a.version=String(a.version))}}e["push-journal-format-version"]=s}var c=this._verify(e,t);if(null===c)return this._data=e,this;throw c},a.prototype._verify=function(e,t){return e["push-journal-format-version"]!==s?new r(r.INVALID_DATA,"Wrong push journal format version."):e["composite-href"]!==t?new r(r.INVALID_DATA,"Composite and journal hrefs mismatch."):e["uploaded-components"]?null:new r(r.INVALID_DATA,"Missing component list.")},a}.call(t,o,t,e))||(e.exports=n)},2049:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r=o(988),i=o(879),s=o(1296);function a(e,t){if("string"!=typeof e||""===e)throw new r(r.INVALID_PARAMS,'Param "compositePath" must be a non-empty string.');this._compositePath=e,this._preserveFileExtensions=t,this._inMemoryBranchesAndElements=[],this._inflightComponents=[]}Object.defineProperties(a.prototype,{compositePath:{get:function(){return this._compositePath},set:function(e){if("string"!=typeof e||""===e)throw new r(r.INVALID_PARAMS,'Param "compositePath" must be a non-empty string.');this._compositePath=e}}}),a.prototype.currentManifestPath=function(){return this._compositePath+"/manifest"},a.prototype.currentBaseManifestPath=function(){return this._compositePath+"/manifest.base"},a.prototype.pulledManifestPath=function(){return this._compositePath+"/pull.manifest"},a.prototype.pushedManifestPath=function(){return this._compositePath+"/push.manifest"},a.prototype.resolvePulledBranch=function(e,t){var o=this;s.writeFileAtomically(this.currentManifestPath(),e.localData,"utf8",(function(e){e?(e.code!==r.OUT_OF_SPACE&&(e=new r(r.INVALID_STATE,"Could not write current manifest.",e)),t(e)):s.move(o.pulledManifestPath(),o.currentBaseManifestPath(),!1,(function(e){e?t(new r(r.INVALID_STATE,"Could not move pull manifest.",e)):t()}))}))},a.prototype.acceptPushedBranch=function(e,t){var o=this;s.writeFileAtomically(this.currentManifestPath(),e.localData,"utf8",(function(e){e?(e.code!==r.OUT_OF_SPACE&&(e=new r(r.INVALID_STATE,"Could not write current manifest.",e)),t(new r(r.INVALID_STATE,"Could not write current manifest.",e))):s.move(o.pushedManifestPath(),o.currentBaseManifestPath(),!1,(function(e){e?t(new r(r.INVALID_STATE,"Could not move push manifest.",e)):o._deleteJournal(t)}))}))},a.prototype.discardPulledBranch=function(e){s.deleteFile(this.pulledManifestPath(),e)},a.prototype.discardPushedBranch=function(e){var t=this;s.deleteFile(this.pushedManifestPath(),(function(o){o?e(o):t._deleteJournal(e)}))},a.prototype.discardBaseBranch=function(e){s.deleteFile(this.currentBaseManifestPath(),e)},a.prototype.registerInMemoryBranchOrElement=function(e){if(this._inMemoryBranchesAndElements.indexOf(e)>=0)throw new r(r.INVALID_STATE,"Branch or element is already registered.");this._inMemoryBranchesAndElements.push(e)},a.prototype.unregisterInMemoryBranchOrElement=function(e){var t=this._inMemoryBranchesAndElements.indexOf(e);if(t<0)throw new r(r.INVALID_STATE,"Unknown branch or element.");this._inMemoryBranchesAndElements.splice(t,1)},a.prototype._deleteJournal=function(e){s.deleteFile(this.pushJournalPath(),e)};var c=/(\/)|(\.$)/;return a.prototype.componentAssetName=function(e,t){var o=t["copyOnWrite#storageIds"],n=o?o[e.id]:null;return n&&c.test(n)&&(n=null),n},a.prototype.componentAssetPath=function(e,t){var o=this.componentAssetName(e,t);return o?this._componentPathFromName(o):null},a.prototype.ingestComponentAsset=function(e,t,o,n,i){var a=this,c=this._newFileNameForComponent(e),h=this._componentPathFromName(c);this._inflightComponents.push(c);var l=function(t){if(!t)try{a._setComponentName(e,n,c)}catch(e){t=e}var o=a._inflightComponents.indexOf(c);o<0&&!t&&(t=new r(r.INVALID_STATE,"Could not find inflight component.")),a._inflightComponents.splice(o,1),i(t)};o?s.copyFile(t,h,l):s.move(t,h,!0,l)},a.prototype.removeComponentAsset=function(e,t){var o=t["copyOnWrite#storageIds"];o&&delete o[e.id]},a.prototype.componentIds=function(e){var t=e["copyOnWrite#storageIds"];return t?Object.keys(t):[]},a.prototype.copyLocalStorageData=function(e,t,o,n){var r,i=o.allComponents(),s=i.length,a=t["copyOnWrite#storageIds"];if(a){var c=n["copyOnWrite#storageIds"];for(c||(c=n["copyOnWrite#storageIds"]={}),r=0;r<s;r++){var h=i[r],l=h.id,u=e.getComponentWithId(l);if(u&&u.etag===h.etag){var d=a[l];d&&(c[l]=d)}}}},a.prototype.removeUnusedLocalFiles=function(e,t){var o,n,i,a,c,h=this,l=function(e){h._deleteComponentAsset(e,(function(e){e&&!o&&(o=e),0===--c&&t(o)}))},u=function(){try{var e,o=a.length,r=[];for(e=0;e<o;e++){var s=a[e].name,u=a[e].info;!n[s]&&u.mtime.getTime()<i&&h._inflightComponents.indexOf(s)<0&&r.push(s)}if((c=o=r.length)>0)for(e=0;e<o;e++)l(r[e])}catch(e){return void t(e)}0===c&&t()};this._gatherComponentAssetNames([this.currentManifestPath(),this.currentBaseManifestPath(),this.pulledManifestPath(),this.pushedManifestPath()],e,(function(e,s,c,h){if(o)t(o);else{if(!e)try{if(s<1||!h)throw new r(r.INVALID_STATE,s<1?"No manifest found.":"Invalid time stamp");n=c,i=h}catch(t){e=t}e&&(o=e),a&&(o?t(o):u())}})),s.directoryListing(this._compositePath+"/components",(function(e,r){if(o)t(o);else{if(!e)try{a=r}catch(t){e=t}e&&(o=e),n&&(o?t(o):u())}}))},a.prototype.tempPathForComponent=function(){return this._compositePath+"/tmp/"+i.generateUuid()},a.prototype.deleteTempFiles=function(e){s.deleteDirectory(this._compositePath+"/tmp",e)},a.prototype.clientDataPath=function(){return this._compositePath+"/clientdata"},a.prototype.pushJournalPath=function(){return this._compositePath+"/push.journal"},a.prototype._copyComponentMapping=function(e,t,o,n){var r=t["copyOnWrite#storageIds"];if(r){var i=n["copyOnWrite#storageIds"];i||(i=n["copyOnWrite#storageIds"]={});var s=r[e];return s&&(i[o]=s),s}},a.prototype._componentPathFromName=function(e){return this._compositePath+"/components/"+e},a.prototype._newFileNameForComponent=function(e){var t=i.generateUuid();if(this._preserveFileExtensions){var o=e.path?i.filePathComponents(e.path).extension:null;o&&(t=t+"."+o)}return t},a.prototype._setComponentName=function(e,t,o){var n=t["copyOnWrite#storageIds"];n||(n=t["copyOnWrite#storageIds"]={}),n[e.id]=o},a.prototype._gatherComponentAssetNames=function(e,t,o){try{var n,r,a={},c=t||i.timeStamp(!0),h=e.length,l=h,u=0,d=function(e){if(e){e=e["copyOnWrite#storageIds"];var t,o=Object.keys(e);for(t=0;t<o.length;t++){var n=e[o[t]];a[n]=!0}}},p=function(e){s.exists(e,(function(t){t?(u++,s.info(e,(function(t,n){if(!t)try{var i=n.mtime.getTime();i<c&&(c=i),s.readFile(e,"utf8",(function(e,t){if(l--,!e)try{t=JSON.parse(t),d(t.local)}catch(t){e=t}e&&!r&&(r=e),0===l&&o(r,u,a,c)}))}catch(e){t=e}t&&(l--,r||(r=t),0===l&&o(r))}))):0===--l&&o(r,u,a,c)}))};for(n=0;n<h;n++)p(e[n]);for(h=this._inMemoryBranchesAndElements.length,n=0;n<h;n++)d(this._inMemoryBranchesAndElements[n]._local())}catch(e){o(e)}},a.prototype._deleteComponentAsset=function(e,t){s.deleteFile(this._componentPathFromName(e),t)},a}.call(t,o,t,e))||(e.exports=n)},2050:function(e,t,o){(function(n){var r;void 0===(r=function(e,t,r){"use strict";var i,s,a=o(879),c=o(988),h=o(1296);i=window.XMLHttpRequest;var l=a.merge;function u(e){this.filename=e}function d(){}function p(e){this._requestQueue=[],this._requestsOutstanding=[],this._rejectedAuths=[],this._authCallback=e,this._isActive=!0,this._waitingForAuthentication=!1,this._currentAuthId=a.generateUuid(),this._https=s,this._XMLHttpRequest=i,this._handlesRedirects=void 0!==i,this._maxOutstanding=5}return Object.defineProperties(p.prototype,{isActive:{get:function(){return this._isActive},set:function(e){this._isActive!==e&&(this._isActive=e,e||(this._authValue=void 0,this._checkQueue()))}},crossOriginCredentials:{get:function(){return this._withCredentials},set:function(e){this._withCredentials=e}},maxOutstanding:{get:function(){return this._maxOutstanding},set:function(e){this._maxOutstanding=e,this._checkQueue()}},handlesRedirects:{get:function(){return this._handlesRedirects}}}),p.prototype._forceXhr=function(e,t){this._https=void 0,this._XMLHttpRequest=e||i||nodeRequire("xhr2"),this._handlesRedirects=!t},p.FileContent=u,p.StreamProvider=d,p.prototype.setAdditionalHeaders=function(e){this._additionalHeaders=e||{}},p.prototype.setAdditionalNodeOptions=function(e){this._additionalNodeOptions=e},p.prototype.setApiKey=function(e){this._apiKey=e},p.prototype.setTimeout=function(e){this._timeout=e},p.prototype.setAuthToken=function(e){e?(this._authValue="Bearer "+e,this.resume()):(this._authValue=void 0,this._currentAuthId=a.generateUuid())},p.prototype.resume=function(){this._currentAuthId=a.generateUuid(),this._waitingForAuthentication=!1,this._checkQueue()},p.prototype.setRequestHooks=function(e,t){this._beforeHook=e,this._afterHook=t},p.prototype.invoke=function(e,t,o,r,i,s){var d=(i=i||{}).responseType;if(d instanceof u){if(!h.canUseFileSystem)throw new c(c.INVALID_PARAMS,"No filesystem access")}else if("buffer"===d){if("function"!=typeof n)throw new c(c.INVALID_PARAMS,"No Buffer class")}else if("blob"===d){if("function"!=typeof Blob)throw new c(c.INVALID_PARAMS,"No Blob class")}else if(d&&"text"!==d&&"json"!==d&&"arraybuffer"!==d)throw new c(c.INVALID_PARAMS,"Unsupported response type");o=l({},o,this._additionalHeaders),this._apiKey&&(o["x-api-key"]=this._apiKey);var p={method:e,href:t,headers:o,callback:s,body:r,options:i},f=i.reuseRequestDesc;if(f){if(this._requestQueue.indexOf(f)>=0||this._requestsOutstanding.indexOf(f)>=0)throw new c(c.INVALID_PARAMS,"Request descriptor still in use.");p=a.merge(f,p)}return this._doRequest(p),p},p.prototype._doRequest=function(e){var t,o,r,i=this,s=0,p=[],f=e.body,_=e.options.responseType;function m(t,n){t&&a.log("["+e.id+"] error: "+t),o&&o.end();var r=i._requestsOutstanding.indexOf(e);r>=0&&i._requestsOutstanding.splice(r,1);var s=e.callback;s&&(e.callback=void 0,t&&(t.clientRequest=e.clientRequest,t.xhr=e.xhr),t&&t.code!==c.SERVICE_IS_INACTIVE&&!i._isActive?t=new c(c.SERVICE_IS_INACTIVE,"Service is now inactive",t):e.timedOut&&(t=new c(c.TIMED_OUT,"timed out request",t)),s(t,n)),i._isActive&&i._checkQueue()}if(!this._isActive)return m(new c(c.SERVICE_IS_INACTIVE,"Network request in inactive state"));function g(t){t.pipe(r),t.on("error",(function(t){return i.abort(e),m(new c(c.TERMINATED_INPUTSTREAM,"Input stream terminated abnormally",t))}))}if(this._waitingForAuthentication||this._requestsOutstanding.length>=this._maxOutstanding||e.options.noSoonerThen)this._requestQueue.push(e),this._waitingForAuthentication||this._checkQueue();else{var y=e.headers;if(null===y.Authorization)delete y.Authorization;else{if(!this._allowAuthTokenToBeSentInsecurely_DONT_USE_THIS_IN_PRODUCTION&&0!==e.href.indexOf("https:"))return m(new c(c.INVALID_PARAMS,"Must not send auth token over unsecured connection"));this._authValue&&(y.Authorization=this._authValue)}if(this._currentAuthId&&(e.authId=this._currentAuthId),this._beforeHook&&this._beforeHook(e),e.id=a.generateUuid(),e.startTime=(new Date).valueOf(),y["X-Request-Id"]=e.id,this._https){this._requestsOutstanding.push(e);var v=(void 0).parse(e.href),A=l({},this._additionalNodeOptions,v);A.method=e.method||"GET",A.headers=y,a.log("["+e.id+"] "+A.method+" "+e.href),r=this._https.request(A,(function(t){var r=!1,s=!1,l=!1;function d(){if(!s)return s=!0,o=void 0,m(void 0,t)}var f=i._requestsOutstanding.indexOf(e);if(f<0)i._checkQueue();else{e.response=t;var g=(new Date).valueOf()-e.startTime;if(a.log("["+e.id+"] "+t.statusCode+" ("+g+"ms)"),401===t.statusCode&&i._authCallback)i._requestsOutstanding.splice(f,1),i._requestQueue.unshift(e),i._authFail(e),a.consumeStream(t);else{var y=e.progress;200===t.statusCode||201===t.statusCode||202===t.statusCode?(t.on("data",(function(e){e.length&&y&&y(e.length),!o&&e&&p.push(e)})),i._https&&_ instanceof u&&(o=h.createWriteStream(_.filename),t.pipe(o),r=!0)):a.consumeStream(t),t.once("end",(function(){l=!0;var o=i._requestsOutstanding.indexOf(e);if(!(o<0||(i._requestsOutstanding.splice(o,1),i._checkQueue(),r||s)))return s=!0,t.response=n.concat(p),"arraybuffer"===_?t.response=new ArrayBuffer(t.response):"text"===_&&(t.response=t.response.toString()),m(void 0,t)})),t.once("close",(function(){if(!l&&!s)return s=!0,m(new c(c.NETWORK_ERROR,"incomplete response"))})),r&&(o.once("finish",d),o.once("close",d))}}})),e.clientRequest=r,r.once("error",m),i._timeout&&r.setTimeout(i._timeout,(function(){e.timedOut=!0,r.abort()})),e.bytesSent=0,e.bytesReported=0,r.once("end",(function(){if(e.progress){var t=e.bytesSent-e.bytesReported;t>0&&(e.progress(t),e.bytesReported+=t)}}));var w=r.write;if(r.write=function(t){var o=t&&t.length;return o&&(e.bytesSent+=o),w.call(r,t,(function(){e.progress&&t&&(e.progress(o),e.bytesReported+=o)}))},f instanceof u)g(h.createReadStream(f.filename));else if(f instanceof d){if(f.getStream)g(f.getStream());else f.getStreamAsync&&f.getStreamAsync((function(t,o){if(t)return i.abort(e),m(new c(c.TERMINATED_INPUTSTREAM,"Error creating input stream",t));g(o)}))}else if(f instanceof n)r.write(f),r.end();else if(f instanceof ArrayBuffer)r.write(new n(new Int8Array(f))),r.end();else if("string"==typeof f)r.write(new n(f,"utf8")),r.end();else{if(f)return m(new c(c.INVALID_PARAMS,"Invalid data type"));r.end()}this._afterHook&&this._afterHook(e,r)}else{if(f instanceof u)return h.canUseFileSystem?void h.readFile(f.filename,{},(function(t,o){if(t)return m(t);e.body=o,i._doRequest(e)})):m(new c(c.INVALID_PARAMS,"Can't use FileContent without filesystem support"));var C;for(C in"function"==typeof n&&f instanceof n&&(e.body=f=new Int8Array(f)),this._requestsOutstanding.push(e),a.log("["+e.id+"] "+e.method+" "+e.href),(t=new this._XMLHttpRequest).open(e.method,e.href,!0),this._withCredentials&&(t.withCredentials=!0),_&&(t.responseType=_ instanceof u?"buffer":_),t.onreadystatechange=function(){var o=e.progress;if(o&&t.response){var n=t.response.length;o(n-s),s=n}if(4===t.readyState){if(0===t.status)return m(new c(c.UNEXPECTED,"XHR failure"));var r=i._requestsOutstanding.indexOf(e);if(r<0)i._checkQueue();else{var l=(new Date).valueOf()-e.startTime;if(a.log("["+e.id+"] "+t.status+" ("+l+"ms)"),i._requestsOutstanding.splice(r,1),401!==t.status||!i._authCallback){if(e.xhr=t,e.response=t,t.statusCode=t.status,t.headers=a.parseHeaders(t.getAllResponseHeaders()),_ instanceof u){var d=t.response.response;return void h.writeFileAtomically(_.filename,d,void 0,(function(e){return e?m(new c(c.UNEXPECTED,"Can't create file",e,t)):m(void 0,t)}))}return o&&f&&o(f.length||f.size),m(void 0,t)}i._requestQueue.unshift(e),i._authFail(e),i._checkQueue()}}},y)y.hasOwnProperty(C)&&t.setRequestHeader(C,y[C]);e.xhr=t,i._timeout&&(t.timeout=i._timeout,t.ontimeout=function(){e.timedOut=!0,t.abort()}),f?t.send(f):t.send(),this._afterHook&&this._afterHook(e,t)}}},p.prototype._authFail=function(e){if(this._authCallback){var t=e.authId;if(-1!==this._rejectedAuths.indexOf(t))return;this._authValue=null,this._waitingForAuthentication=!0,this._rejectedAuths.unshift(t)>this._maxOutstanding&&(this._rejectedAuths.length=this._maxOutstanding),this._authCallback(this)}},p.prototype._checkQueue=function(){if(!this._isActive){var e=this._requestsOutstanding;this._requestsOutstanding=[],e.forEach((function(e){e.xhr&&e.xhr.abort(),e.clientRequest&&e.clientRequest.abort();var t=e.callback;t&&(e.callback=void 0,t(new c(c.SERVICE_IS_INACTIVE,"Network request in inactive state")))}));var t=this._requestQueue;return this._requestQueue=[],t.forEach((function(e){var t=new c(c.SERVICE_IS_INACTIVE,"Network request in inactive state"),o=e.callback;o&&(e.callback=void 0,o(t))})),void(this._checkQueueTimerId&&(clearTimeout(this._checkQueueTimerId),this._checkQueueTimerId=void 0,this._checkQueueTimerWhen=void 0))}for(var o,n=Date.now(),r=n+3e5,i=0;!(this._waitingForAuthentication||this._requestsOutstanding.length>=this._maxOutstanding||i>=this._requestQueue.length);){var s=this._requestQueue[i];(o=s.options.noSoonerThen||n)&&o>r&&(o=s.options.noSoonerThen=r),o<=n?(this._requestQueue.splice(i,1),s.options.noSoonerThen=void 0,this._doRequest(s)):i++}if(!this._waitingForAuthentication&&this._requestsOutstanding.length<this._maxOutstanding&&this._requestQueue.length>0){var a,h,l=this._requestQueue.length;for(h=0;h<l;h++)(o=this._requestQueue[h].options.noSoonerThen)&&o>r&&(o=this._requestQueue[h].options.noSoonerThen=r),o&&(a=a&&a<o?a:o);if(a&&(!this._checkQueueTimerWhen||this._checkQueueTimerWhen>a)){this._checkQueueTimerId&&clearTimeout(this._checkQueueTimerId),this._checkQueueTimerWhen=a;var u=this;this._checkQueueTimerId=setTimeout((function(){u._checkQueueTimerWhen=void 0,u._checkQueueTimerId=void 0,u._checkQueue()}),a-n)}}},p.prototype.abort=function(e){var t=this._requestQueue.indexOf(e);t>=0?this._requestQueue.splice(t,1):(t=this._requestsOutstanding.indexOf(e))>=0&&(this._requestsOutstanding.splice(t,1),e.xhr&&e.xhr.abort(),e.clientRequest&&e.clientRequest.abort(),this._checkQueue())},p.prototype.abortAllWithToken=function(e){if(e){var t;for(t=0;t<this._requestQueue.length;++t)this._requestQueue[t].token===e&&(this._requestQueue.splice(t,1),--t);for(t=0;t<this._requestsOutstanding.length;++t)if(this._requestsOutstanding[t].token===e){var o=this._requestsOutstanding[t];this._requestsOutstanding.splice(t,1),--t,o.xhr&&o.xhr.abort(),o.clientRequest&&o.clientRequest.abort()}this._checkQueue()}},p}.call(t,o,t,e))||(e.exports=r)}).call(this,o(16).Buffer)},2779:function(e,t){},2780:function(e,t){},2825:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r=o(2019),i=o(988),s=o(879);function a(e,t,o){(this._owner=t,e)?e=this._setData(e,o):(e={id:s.generateUuid()},this._core=new r(e,this,o),this._data=e)}return Object.defineProperties(a.prototype,{rootNode:{get:function(){return this._core.rootNode},set:function(e){this._core.rootNode=e}},name:{get:function(){return this._core.rootNode.name},set:function(e){var t=this._core;if(t._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new i(i.INVALID_PARAMS,"Expecting a string or undefined.");t.rootNode.name=e}},type:{get:function(){return this._core.rootNode.type},set:function(e){var t=this._core;if(t._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new i(i.INVALID_PARAMS,"Expecting a non-empty string.");t.rootNode.type=e}},compositeHref:{get:function(){return this._owner.compositeHref},set:function(e){throw new i(i.READ_ONLY,'Property "compositeHref" is read-only.')}},_localStorage:{get:function(){return this._core._localStorage},set:function(e){this._core._localStorage=e}},hasLocalStorage:{get:function(){return this._core.hasLocalStorage},set:function(e){this._core.hasLocalStorage=e}},_isDirty:{get:function(){return this._core._isDirty},set:function(e){this._core._isDirty=e}},isDirty:{get:function(){return this._isDirty},set:function(e){this._core.isDirty=e}},changeCount:{get:function(){return this._core.changeCount},set:function(e){this._core.changeCount=e}}}),a.prototype.getChildWithId=function(e){return this._core.getChildWithId(e)},a.prototype.getChildWithAbsolutePath=function(e){return this._core.getChildWithAbsolutePath(e)},a.prototype.getChildrenOf=function(e){return this._core.getChildrenOf(e)},a.prototype.addChild=function(e,t,o,n){return this._core.addChild(e,t,o,n)},a.prototype.removeChild=function(e){return this._core.removeChild(e)},a.prototype.moveChild=function(e,t,o){return this._core.moveChild(e,t,o)},a.prototype.copyChild=function(e,t,o,n,r,i){return this._core.copyChild(e,t,o,n,r,i)},a.prototype.allComponents=function(){return this._core.allComponents()},a.prototype.getComponentWithId=function(e){return this._core.getComponentWithId(e)},a.prototype.getComponentWithAbsolutePath=function(e){return this._core.getComponentWithAbsolutePath(e)},a.prototype.getComponentsOf=function(e){return this._core.getComponentsOf(e)},a.prototype.addComponent=function(e,t,o,n,r,i,s,a,c,h){return this._core.addComponent(e,t,o,n,r,i,s,a,c,h)},a.prototype.addComponentWithUploadResults=function(e,t,o,n,r){return this._core.addComponentWithUploadResults(e,t,o,n,r)},a.prototype.updateComponent=function(e,t,o,n){return this._core.updateComponent(e,t,o,n)},a.prototype.updateComponentWithUploadResults=function(e,t){return this._core.updateComponentWithUploadResults(e,t)},a.prototype.removeComponent=function(e){return this._core.removeComponent(e)},a.prototype.moveComponent=function(e,t){return this._core.moveComponent(e,t)},a.prototype.copyComponent=function(e,t,o,n,r){return this._core.copyComponent(e,t,o,n,r)},a.prototype.assetOfComponent=function(e,t){return this._core.assetOfComponent(e,t)},a.prototype.parse=function(e){if("string"!=typeof e)throw new i(i.INVALID_PARAMS,'Param "data" must be a string');var t=null;try{t=JSON.parse(e)}catch(e){throw new i(i.INVALID_JSON,"Manifest could not be parsed. Underlying error: "+e.message)}return this._setData(t,this._core._readOnly)},a.prototype.copy=function(){return new a(JSON.parse(JSON.stringify(this._data)),this._owner)},a.prototype._updateLocalDataFromBranch=function(e){if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if(!this._localStorage)throw new i(i.NO_LOCAL_STORAGE,"No local storage.");if(!e._localStorage)throw new i(i.NO_LOCAL_STORAGE,"No local storage for source.");if(this._localStorage.compositePath!==e._localStorage.compositePath)throw new i(i.INVALID_PARAMS,"Branches must have same storage path.");this._core._localStorage.copyLocalStorageData(e,e._core._local(),this,this._core._local()),this._core._copySourceHrefsFrom(e._core)},a.prototype._verify=function(e){return"string"!=typeof e.id?new i(i.INVALID_DATA,"Element is missing an id of type string"):"string"!=typeof e.name?new i(i.INVALID_DATA,"Element is missing a name of type string"):"string"!=typeof e.type?new i(i.INVALID_DATA,"Element is missing a type of type string"):null},a.prototype._setData=function(e,t){var o=this._verify(e);if(null===o)return this._core=new r(e,this,t),this._data=e,this;throw o},a.prototype._local=function(){return this._core._local()},a.prototype._setDirty=function(e){this._core._setDirty(e)},a.prototype._setPathOfNode=function(e,t){this._core._setPathOfNode(e,t)},a.prototype._verifyIntegrity=function(e,t,o){return this._core._verifyIntegrity(e,t,o)},a}.call(t,o,t,e))||(e.exports=n)},2826:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r=o(1797),i=o(988),s=i.networkError,a=i.unexpectedResponse,c=o(1788),h=o(879),l=h.appendPathElements,u="If-Match";function d(e,t){if(r.call(this,e,t),!this._endPoint)throw new i(i.INVALID_PARAMS,"Could not determine endpoint from: "+t);this.authenticationWhitelist=["adobe.com","adobe.io","fotolia.net"]}return d.prototype=Object.create(r.prototype),d.prototype.name="AdobeStorageSession",d.FileContent=r.FileContent,d.StreamProvider=r.StreamProvider,d.prototype.getCollection=function(e,t,o){if(!(e=this._resolveUrl(e)))return o(new i(i.WRONG_ENDPOINT,"Wrong endpoint: "+e));var n;e+="?order=asc&orderby=name";var r={};t&&(r["If-None-Match"]=t);var c=this;return this._service.invoke("GET",e,r,void 0,{responseType:"text"},(function t(h,l){if(h)return o(s("Error retrieving a collection",h,l));if(200===l.statusCode){var u,d=l.responseText||l.response;try{u=JSON.parse(d)}catch(e){return(h=new i(i.INVALID_DATA,"Invalid JSON returned by server",e)).response=l,o(h)}n?n.children=n.children.concat(u.children):n=u;var p=l.headers["x-children-next-start"];if(p){var f=e+"&start="+p;c._service.invoke("GET",f,r,void 0,{responseType:"text"},t)}else o(void 0,n,l.headers.etag,l.headers)}else 304===l.statusCode?o(void 0,null,l.headers.etag,l.headers):o(a("Unexpected status code while getting a collection",void 0,l))}))},d.prototype.pagedGetCollection=function(e,t,o,n,r,c,h,l){if(!(e=this._resolveUrl(e)))return l(new i(i.WRONG_ENDPOINT,"Wrong endpoint: "+e));e+=function(e,t,o,n){var r=[],i="";return t&&r.push("order="+t),e&&r.push("orderBy="+e),o&&r.push("start="+o),n&&r.push("limit="+n),r.length>0&&(i="?"+r.join("&")),i}(o,n,r,c);var u={};t&&(u["If-None-Match"]=t);return this._service.invoke("GET",e,u,void 0,{responseType:"text"},(function(e,t){if(e)return l(s("Error retrieving a collection",e,t));if(200===t.statusCode){var o,n=t.responseText||t.response;try{o=JSON.parse(n)}catch(o){return(e=new i(i.INVALID_DATA,"Invalid JSON returned by server",o)).response=t,l(e)}h?h.children=h.children.concat(o.children):h=o,l(void 0,h,t.headers.etag,t.headers)}else 304===t.statusCode?l(void 0,null,t.headers.etag,t.headers):l(a("Unexpected status code while getting a collection",void 0,t))}))},d.prototype.getComponent=function(e,t,o){var n=this.getComponentHref(e,e.version);return this.getAsset(n,void 0,t,o)},d.prototype.getSyncGroups=function(e,t){var o=l(this._server,"assets");return this.getCollection(o,e,t)},d.prototype.getSyncGroup=function(e,t,o){var n=l(this._server,"assets",e);return this.getCollection(n,t,o)},d.prototype.getCompositeManifest=function(e,t,o){var n=e.href;return n&&(n=this._resolveUrl(n)),n?(n=l(n,"manifest"),this.getAssetAsType(n,"text",t,o)):o(new i(i.WRONG_ENDPOINT,"Wrong endpoint: "+n))},d.prototype.headRequest=function(e,t){return this._service.invoke("HEAD",e,{},void 0,void 0,(function(e,o){if(e)return t(e);t(e,o)}))},d.prototype.remixComposite=function(e,t,o,n,r,i){var s={compositeId:n};r&&(s.creatorTool=r);var a={href:e};return t&&(a.authorization=t),this._invokeOperation("remix",a,{href:o},s,(function(e,t,o){i(e)}))},d.prototype.createCompositeDirectory=function(e,t,o){var n=this,r=this._resolveUrl(e.href);if(!r)return o(new i(i.WRONG_ENDPOINT,"Wrong endpoint: "+r));function c(e,t,o){var a={"Content-Type":"application/vnd.adobe.directory+json","X-Update":"content"};t&&(a[u]="*"),n._service.invoke("PUT",r,a,void 0,void 0,(function(e,t){return e?o(s("Error Creating composite directory",e,t)):409===t.statusCode?((e=new i(i.ALREADY_EXISTS,e)).response=t,o(e)):void o(void 0,t)}))}c(0,t,(function(e,i){if(e)return o(e);var l=i.statusCode;if(200===l||201===l)o(void 0,i);else if(404===l){var u=h.parentDirectory(r);n._service.invoke("PUT",u,{},void 0,void 0,(function(e,n){if(e)return o(s("Error creating composite directory",e,n));var r=n.statusCode;200===r||201===r||409===r?c(0,t,(function(e,t){if(e)return o(e);var n=t.statusCode;200===n||201===n?o(void 0,t):o(s("Error creating composite directory",e,t))})):o(a("Unexpected response creating composite directory",e,n))}))}else o(a("Unexpected response creating composite directory",e,i))}))},d.prototype.deleteCompositeDirectory=function(e,t){var o=this,n=this._resolveUrl(e.href);if(!n)return t(new i(i.WRONG_ENDPOINT,"Wrong endpoint: "+n));n+="?recursive=true&invocation_mode=sync,async";var r=this._service.invoke("DELETE",n,{"If-Match":"*"},void 0,void 0,(function(e,n){if(e)return t(s("Error deleting composite directory",e,n));var i=n.statusCode;return 200===i||204===i||404===i?t(void 0,n):202===i?o._handle202Response(n,r,o.SYNC_ASYNC_DEFAULT_DELAY,t):void t(a("Unexpected response deleting composite directory",e,n))}))},d.prototype.archiveCompositeDirectory=function(e,t){var o=this;if(!this._resolveUrl(e.href))return t(new i(i.WRONG_ENDPOINT,"Wrong endpoint: "+e.href));var n={"Content-Type":"application/vnd.adobe.directory+json",Link:"<"+e.href+">;rel=self"},r=this._resolveUrl("/archive/"+e.id)+"?invocation_mode=sync,async",c=this._service.invoke("PUT",r,n,void 0,void 0,(function(e,n){if(e)return t(s("Error archiving composite directory",e,n));var r=n.statusCode;return 200===r||204===r||404===r?t(void 0,n):202===r?o._handle202Response(n,c,o.SYNC_ASYNC_DEFAULT_DELAY,t):void t(a("Unexpected response archiving composite directory",e,n))}))},d.prototype.leaveSharedComposite=function(e,t){if(e.collaborationType!==c.COLLABORATION.SHARED_WITH_USER)throw new i(i.INVALID_STATE,"Composite's collaboration type must be sharedWithUser.");return this.deleteCompositeDirectory(e,t)},d.prototype.uploadComponent=function(e,t,o,n,r,s){if(!e._owner||!e._owner.compositeHref)throw new i(i.INVALID_STATE,"Component must be part of a branch of a bound composite.");return this.uploadAssetForComponentId(e.id,e.type,e._owner.compositeHref,t,o,n,r,s)},d.prototype.uploadAssetForComponentId=function(e,t,o,n,r,c,h,l){var d=this,p=this._constructComponentHref(o,e);r&&(p+="?intermediates=false");var f={};function _(e,t){e?delete f[u]:f[u]="*";var o=d._service.invoke("PUT",p,f,h,void 0,(function(e,o){if(e)return t(s("Error uploading component",e,o));var n=o.statusCode;if(200===n||201===n||204===n){var r;try{r=JSON.parse(o.responseText||o.response)}catch(n){return(e=new i(i.INVALID_DATA,"Invalid JSON returned by server",n)).response=o,t(e,o,r)}t(void 0,o,r)}else 507===n?((e=new i(i.EXCEEDS_QUOTA,"Exceeds quota",e)).response=o,t(e)):((e=a("Unexpected response uploading component",e)).response=o,t(e))}));return o.token=c,o}return t&&(f["Content-Type"]=t),_(n,(function(e,t,o){if(e){if(!(t=e.response))return l(e);var r=t.statusCode;404===r||409===r||412===r?_(!n,l):l(e)}else l(void 0,t,o)}))},d.prototype.copyAssetToComponentId=function(e,t,o,n,r,c,h,l){var d=this._makeRelativeUrl(h);if(!d)return l(new i(i.WRONG_ENDPOINT,"Cannot copy asset: "+h));var p=this,f=this._constructComponentHref(o,e);f+="?invocation_mode=sync,async",r&&(f+="&intermediates=false");var _={};function m(e,t,o){e?delete _[u]:_[u]="*";var n=p._service.invoke("PUT",f,_,void 0,{responseType:"text"},(function(e,r){if(e)return o(s("Error uploading component",e,r));var i=r.statusCode;200===i||201===i||204===i?o(void 0,r,t):202===i?p._handle202Response(r,n,p.SYNC_ASYNC_DEFAULT_DELAY,(function(e,n){o(e,n,t)})):o(a("Unexpected response copying a component asset",e,r),r,t)}));return n.token=c,n}t&&(_["Content-Type"]=t),_.Link="<"+d+">;rel=source";var g=function(e,t,o){var r;if(e){if(!(t=e.response))return l(e);var s=t.statusCode;o||404!==s&&409!==s&&412!==s?507===s?((e=new i(i.EXCEEDS_QUOTA,"Exceeds quota",e)).response=t,l(e)):l(e):m(!n,!0,g)}else{try{r=JSON.parse(t.responseText||t.response)}catch(o){return(e=new i(i.INVALID_DATA,"Invalid JSON returned by server",o)).response=t,l(e)}l(void 0,t,r)}};return m(n,!0,g)},d.prototype.updateManifest=function(e,t,o,n){var r=this.getBranchManifestHref(e),c={"Content-Type":"application/vnd.adobe.dcx-manifest+json"},h=e.manifestEtag;return o?c["If-Match"]="*":h&&(c["If-Match"]=h),this._service.invoke("PUT",r,c,t,void 0,(function(e,t){if(e)return n(s("Error updating manifest",e,t));var o=t.statusCode;!t.headers.etag||200!==o&&201!==o&&204!==o?412===o?((e=new i(i.UPDATE_CONFLICT,"Manifest has been changed")).response=t,n(e)):n(a("Unexpected response updating manifest",e,t)):n(void 0,t)}))},d.prototype.getHrefForComposite=function(e,t){if(!e.type)throw new i(i.INVALID_STATE,"Composite needs a type");if(!e.id)throw new i(i.INVALID_STATE,"Composite needs an id");return e.href?e.href:this._resolveUrl(l("assets",t,e.id))},d.prototype.getHrefForCompositeWithId=function(e,t){return this._resolveUrl(l("assets",t,e))},d.prototype.getCompositeManifestHref=function(e){var t=this._resolveUrl(e.href);if(!t)throw new i(i.WRONG_ENDPOINT,"Wrong endpoint: "+t);return l(t,"manifest")},d.prototype.getBranchManifestHref=function(e){var t=this._resolveUrl(e.compositeHref);if(!t)throw new i(i.WRONG_ENDPOINT,"Wrong endpoint: "+t);return l(t,"manifest")},d.prototype.getComponentHref=function(e,t){var o,n=e._owner;if(!n||!n.compositeHref)throw new i(i.INVALID_STATE,"Component must be part of a branch of a bound composite.");return n._core&&(o=n._core._getSourceHrefOfComponent(e)),o||this._constructComponentHref(n.compositeHref,e.id,t)},d.prototype._constructComponentHref=function(e,t,o){var n=l(this._resolveUrl(e),t);return n&&void 0!==o&&(n+=";version="+o),n},d.prototype._invokeOperation=function(e,t,o,n,r){var c=this,l=this._resolveUrl("/ops");l+="?invocation_mode=sync,async";var u={op:e,id:h.generateUuid(),target:o,source:t};n&&(u.value=n),h.log("[invoke operation]: "+JSON.stringify(u,void 0,2));var d=function(e,t){var o;if(e)return(t=e.response)?void(507===t.statusCode?((e=new i(i.EXCEEDS_QUOTA,"Exceeds quota",e)).response=t,r(e)):r(e)):r(e);try{o=JSON.parse(t.responseText||t.response)}catch(o){return(e=new i(i.INVALID_DATA,"Invalid JSON returned by server",o)).response=t,r(e)}if(o.error)return(e=new i(i.UNEXPECTED_RESPONSE,"Error in operation result: "+JSON.stringify(o.error,void 0,2))).response=t,r(e);r(void 0,t,o)},p=c._service.invoke("POST",l,{"Content-Type":"application/vnd.adobe.asset-operation+json"},JSON.stringify(u),{responseType:"text"},(function(t,o){if(t)return d(s("Error invoking operation "+e,t,o));var n=o.statusCode;200===n||201===n||204===n?d(void 0,o):202===n?c._handle202Response(o,p,c.SYNC_ASYNC_DEFAULT_DELAY,(function(e,t){d(e,t)})):d(a("Unexpected response for operation "+e,t,o),o)}));return p},d}.call(t,o,t,e))||(e.exports=n)},2827:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r=o(1797),i=o(988),s=o(879),a=s.appendPathElements;function c(e,t){if(r.call(this,e,t),!this._endPoint)throw new i(i.INVALID_PARAMS,"Could not determine endpoint from: "+t);this.authenticationWhitelist=["adobe.com","adobe.io","fotolia.net"]}c.prototype=Object.create(r.prototype),c.prototype.name="AdobeCommunitySession",c.FileContent=r.FileContent,c.StreamProvider=r.StreamProvider,c.prototype.getCompositeManifestHref=function(e){var t=this._resolveUrl(e.href);if(!t)throw new i(i.WRONG_ENDPOINT,"Wrong endpoint: "+t);return a(t,"manifest")},c.prototype.getComponent=function(e,t,o){var n=this.getComponentHref(e,e.version);return this.getAsset(n,void 0,t,o)},c.prototype.getRenditionOfComponent=function(e,t,o,n,r,i){var s=this.getComponentRenditionHref(e,e.version,t,o,n);return this.getAsset(s,{accept:t},r,i)},c.prototype.getCompositeManifest=function(e,t,o){var n=e.href;return n&&(n=this._resolveUrl(n)),n?(n=a(n,"manifest"),this.getAssetAsType(n,"text",t,o)):o(new i(i.WRONG_ENDPOINT,"Wrong endpoint: "+n))},c.prototype.headRequest=function(e,t){return this._service.invoke("HEAD",e,{},void 0,void 0,(function(e,o){if(e)return t(e);t(e,o)}))},c.prototype.getComponentHref=function(e,t){var o,n=e._owner;if(!n||!n.compositeHref)throw new i(i.INVALID_STATE,"Component must be part of a branch of a bound composite.");return n._core&&(o=n._core._getSourceHrefOfComponent(e)),o||this._constructComponentHref(n.compositeHref,e,t)},c.prototype.getComponentRenditionHref=function(e,t,o,n,r){var s=e._owner;if(!s||!s.compositeHref)throw new i(i.INVALID_STATE,"Component must be part of a branch of a bound composite.");if(s._core&&s._core._getSourceHrefOfComponent(e))throw new i(i.INVALID_STATE,"Getting a rendition of a source href not implemented.");return this._constructComponentRenditionHref(s.compositeHref,e,t,o,n,r)},c.prototype._constructComponentHref=function(e,t,o){var n=t.absolutePath.slice(1),r=a(this._resolveUrl(e),n);return r&&void 0!==o&&(this._hrefUsesContentApis(e)?r+="/version/"+o:r+="?version="+o),r};var h=/^\/?content\/2\/[^\/]+\/[^\/]+/,l=/^\/?api\/v2\/[^\/]+\/assets\/[^\/]+/,u={"image/jpeg":"jpg","image/png":"png"};return c.prototype._constructComponentRenditionHref=function(e,t,o,n,r,a){var c,d,p=t.absolutePath.slice(1),f=s.parseURI(e).path;if("/content/2/"===f.slice(0,"/content/2/".length)){var _=u[n];if(!_)throw new i(i.INVALID_PARAMS,"Unsupported rendition media type: "+n);if(!((c=h.exec(f))&&c.length>0))throw new i(i.INVALID_PARAMS,"Failed to parse composite href: "+e);d=this._resolveUrl(s.appendPathElements(c[0],"rendition",p,"version",o,"format",_,"dimension",r,"size",String(a)))}else{if(!((c=l.exec(f))&&c.length>0))throw new i(i.INVALID_PARAMS,"Failed to parse composite href: "+e);d=this._resolveUrl(s.appendPathElements(c[0],"rendition",r,String(a),p)+"?version="+o)}return d},c.prototype._hrefUsesContentApis=function(e){return"/content/2/"===s.parseURI(e).path.slice(0,"/content/2/".length)},c}.call(t,o,t,e))||(e.exports=n)},2828:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r,i,s=o(1788),a=o(887),c=o(886),h=o(988),l=o(2048),u=o(1797),d=o(879),p=o(1296),f=u.FileContent,_=a.STATES;function m(e,t,o){return h.wrapError(h.UNEXPECTED_RESPONSE,e,t,o)}function g(e,t,o){this._session=e,this._callback=t,this._cleanup=o,this._componentsPending=0,this.bytesTransfered=0,this.bytesTotal=0,this.onProgress=d.noOp;var n=this;this._reportProgress=function(e){if(e>0){n.bytesTransfered+=e;var t=n.onProgress;t&&t(n.bytesTransfered,n.bytesTotal)}}}return g.prototype._callCallback=function(e,t){var o=this._callback;o&&(this._callback=void 0,o(e,t))},g.prototype._xferComplete=function(e,t){var o=this._cleanup;o?(this._cleanup=void 0,o(e,t)):this._callCallback(e,t)},g.prototype.abort=function(e){this._aborted||(this._aborted=!0,this._session._service.abortAllWithToken(this)),e||(this._callback=void 0,e=new Error("Aborted")),this._xferComplete(e)},t.pullComposite=function(e,t,o){if(!e.hasLocalStorage)throw new h(h.INVALID_PARAMS,"No local storage. Use AdobeDCXCompositeXfer.pullCompositeManifestOnly() to pull down the composite without local storage.");return this._pullComposite(e,t,"all",o)},t.pullMinimumComposite=function(e,t,o){if(!e.hasLocalStorage)throw new h(h.INVALID_PARAMS,"No local storage. Use AdobeDCXCompositeXfer.pullCompositeManifestOnly() to pull down the composite without local storage.");return this._pullComposite(e,t,"min",o)},t.pullCompositeManifestOnly=function(e,t,o){return this._pullComposite(e,t,"none",o)},t.downloadComponents=function(e,o,n,r){var i=function e(t){return t._owner?e(t._owner):t}(o),s=new g(n,r);return s._referenceBranch=i,t._pullComponents(s,i,e||o.allComponents()),s},t.pushComposite=function(e,o,n,r){var i,s=e._localStorage;(i=new g(n,r,(function(t,o){if(i._owner&&e.hasLocalStorage&&s.unregisterInMemoryBranchOrElement(i._owner),!e.hasLocalStorage){var n=i._journal;e._pushJournal=n.isEmpty?void 0:n}i._callCallback(t,o)})))._composite=e,i._overwriteExisting=o;var a=!e.isBound;if(i._compositeIsNew=a,e.hasLocalStorage)e._loadBranch(s.currentManifestPath(),!1,(function(o,n){if(o)return i._xferComplete(o);i._owner=n,e._localStorage.registerInMemoryBranchOrElement(n),l.readJournal(s.pushJournalPath(),e,!0,(function(o,n){if(o)return i._xferComplete(o);i._journal=n,t._pushComposite(e,i)}))}));else{if(!e.href)return i._xferComplete(new h(h.INVALID_STATE,"New composite has no href"));i._owner=e.current.copy(),i._journal=e._pushJournal||new l(e),t._pushComposite(e,i)}return i},t.remixComposite=function(e,t,o,n,r,i,s){var a=d.parseURI(o).path;if(!a||!n||a.split("/").pop()!==n)throw new h(h.INVALID_PARAMS,"Invalid combination of params targetHref ("+o+") and compositeId ("+n+")");var c=new g(i,s);return i.remixComposite(e,t,o,n,r,(function(e){c._xferComplete(e,e?void 0:o)})).token=c,c},t.uploadNewComponent=function(e,t,o,n,i,a){if(o._localStorage)throw new h(h.INVALID_PARAMS,"For in-browser use only. Use composite.current.addComponent() to add a new component asset");return r(n||d.generateUuid(),t,!0,o.collaborationType===s.COLLABORATION.SHARED_WITH_USER,e,o.id,o.href,i,a)},t.uploadComponent=function(e,t,o,n,i){if(o._localStorage)throw new h(h.INVALID_PARAMS,"For in-browser use only. Use composite.current.updateComponent() to update a component asset");return r(e.id,e.type,!1,o.collaborationType===s.COLLABORATION.SHARED_WITH_USER,t,o.id,o.href,n,i)},t.copyAssetForNewComponent=function(e,t,o,n,r,a){if(o._localStorage)throw new h(h.INVALID_PARAMS,"For in-browser use only. Use composite.current.addComponent() to add a new component asset");return i(n||d.generateUuid(),t,!0,o.collaborationType===s.COLLABORATION.SHARED_WITH_USER,e,o.id,o.href,r,a)},t.getURLForComponent=function(e,t){if(e._owner._localStorage)throw new h(h.INVALID_PARAMS,"For in-browser use only.");return t.getComponentHref(e,e.version)},t._pullComposite=function(e,o,n,r){if("string"!=typeof e.href)throw new h(h.INVALID_STATE,"Composite must have an href");var i;var s=function(r,s){if(r)return i._xferComplete(r);var a;s?(a=s.manifestEtag,i._referenceBranch=s):e.current&&(a=e.current.manifestEtag,i._referenceBranch=e.current);var l=o.getCompositeManifest(e,a,(function(o,r,a){if(o)return o.response&&404===o.response.statusCode?i._xferComplete(new h(h.NO_COMPOSITE,"Composite missing or deleted",o.underlyingError||o)):i._xferComplete(o);if(null===r&&!s)return i._xferComplete(void 0,null);var l;if(null!==r)try{if((l=(new c).parse(r))._localStorage=e._localStorage,l.compositeHref=e.href,l._collaborationType=e.collaborationType,l._clientDataString=e.clientDataString,l.manifestEtag=a,l.compositeState===_.committedDelete||l.compositeState===_.pendingDelete)return void i._session.deleteCompositeDirectory(e,(function(e){return e?i._xferComplete(new h(h.DELETED_COMPOSITE,"Error deleting composite directory",e)):i._xferComplete(new h(h.DELETED_COMPOSITE,"Composite is deleted"))}));i._referenceBranch&&l.hasLocalStorage&&l._updateLocalDataFromBranch(i._referenceBranch)}catch(e){return i._xferComplete(new h(h.INVALID_JSON,"Corrupted manifest",e))}else l=s;var u,d,p=l.allComponents();for(u=0;u<p.length;++u)(d=p[u]).state===_.pendingDelete||d.state===_.committedDelete?l.removeComponent(d):d.state=_.unmodified;p=void 0,"all"===n?p=l.allComponents():"min"===n&&(d=l.getComponentWithAbsolutePath("/META-INF/metadata.xml"))&&(p=[d]),p?t._pullComponents(i,l,p):i._xferComplete(void 0,l)}));l&&(l.token=i,l.progress=i._reportProgress)};return(i=new g(o,r,(function(t,o){if(t){var n=t.pulledBranch;n?(n.compositeState=_.unmodified,n.hasLocalStorage?p.writeFileAtomically(e._localStorage.pulledManifestPath(),t.pulledBranch.localData,"utf8",(function(e){i._callCallback(t)})):i._callCallback(t)):i._callCallback(t)}else{if(null===o)return i._callCallback(void 0,null);if(o.compositeState=_.unmodified,o.readOnly=!0,o.hasLocalStorage){var r=e._localStorage.pulledManifestPath();p.writeFileAtomically(r,o.localData,"utf8",(function(e){if(e)return i._callCallback(e);o.manifestPath=r,o._isDirty=!1,i._callCallback(void 0,o)}))}else e._options.xhrBaseBranchSupport&&(e._pulledBranchData=o.localData),i._callCallback(void 0,o)}})))._composite=e,e.hasLocalStorage?e.loadPulledBranch(s):s(),i},t._pullComponents=function(e,o,n){if(!o.hasLocalStorage)throw new h(h.INVALID_PARAMS,"No local storage.");var r,i=e._session;function s(t,r){if(e._componentsPending-=1,t&&(e.failedComponents=e.failedComponents||[],e.failedComponents.push({component:r,error:t})),0===e._componentsPending&&!e._aborted){var i=e.failedComponents;if(i){t=new h(h.COMPONENT_DOWNLOAD_ERROR,"Failed to download all components");var s,a=i.length;for(s=0;s<a;s++){var c=i[s].error;if(c.code===h.OUT_OF_SPACE){t=new h(c.code,c.message);break}}t.pulledBranch=o,t.failedComponents=i}o.readOnly&&o.manifestPath&&(!i||n.length>i.length)?p.writeFileAtomically(o.manifestPath,o.localData,"utf8",(function(t){e._xferComplete(t,t?void 0:o)})):e._xferComplete(t,t?void 0:o)}}function a(o){if(!e._aborted){e.bytesTotal+=o.length||0;var n=o._owner._localStorage.tempPathForComponent(o),r=d.parentDirectory(n);p.ensureDirectoryExists(r,(function(r){if(r)return e.abort(r);var a=t._pullComponent(o,n,i,s);a.progress=e._reportProgress,a.token=e}))}}function c(e){o.assetOfComponent(e,(function(t,o){"string"!=typeof o?a(e):s(void 0,e)}))}for(e._componentsPending=n.length,r=0;r<n.length;++r){var l,u=n[r];if(e._referenceBranch){var f=e._referenceBranch.getComponentWithId(u.id);f&&(l=f.etag)}u.etag!==l?a(u):c(u)}0===e._componentsPending&&e._xferComplete(void 0,o)},t._pullComponent=function(e,t,o,n){var r=e._owner;if(!e._owner.hasLocalStorage)throw new h(h.INVALID_PARAMS,"No local storage. Use AdobeDCXCompositeXfer.pullCompositeManifestOnly() to pull down the composite without local storage.");return o.getComponent(e,new f(t),(function(o,i){if(o)n(o,e);else if(200===i.statusCode){var s=Number(i.headers["content-length"]);void 0===e.length||null===e.length||isNaN(s)||s===e.length?r._localStorage.ingestComponentAsset(e,t,!1,r._local(),(function(t){n(t,e,i.headers.etag)})):n(new h(h.UNEXPECTED_RESPONSE,"Incorrect content length",o,i))}else 304===i.statusCode?n(void 0,e,i.headers.etag):n(m("Unexpected response getting a component",o,i),e)}))},t._pushComposite=function(e,o){if(!e.href)return o._xferComplete(new h(h.INVALID_STATE,"New composite has no href"));var n=o._owner,r=o._journal,i=o._compositeIsNew,a=o._overwriteExisting,c=o._session,l=n.changeCount,u=n.remoteData.length+50;if(o.bytesTotal=u,n.compositeState===_.committedDelete)return o._xferComplete(new h(h.DELETED_COMPOSITE,"Attempt to push a deleted composite"));if("archived"===n.compositeArchivalState)return o._xferComplete(new h(h.DELETED_COMPOSITE,"Attempt to push an archived composite"));var d="pending"===n.compositeArchivalState;if(d&&e.collaborationType===s.COLLABORATION.SHARED_WITH_USER)return o._xferComplete(new h(h.INVALID_STATE,"Attempt to archive composite that is shared with this user."));if(!i&&!d&&n.compositeState===_.unmodified)return o._xferComplete();if(n.compositeState===_.pendingDelete)return i&&!a?o._xferComplete(new h(h.DELETED_COMPOSITE,"Attempt to delete unbound composite")):e.collaborationType===s.COLLABORATION.SHARED_WITH_USER?o._xferComplete(new h(h.INVALID_STATE,"Attempt to delete composite that is shared with this user.")):t._deleteComposite(o,a,(function(e,t){o._xferComplete(e,t)}));function f(t,n){d?c.archiveCompositeDirectory(e,(function(r,i){if(r)return n(r);t.compositeArchivalState="archived",o._journal.compositeHasBeenArchived=!0,o._journal.commitChanges((function(o){if(o)return n(o);e.hasLocalStorage?p.writeFileAtomically(e._localStorage.pushedManifestPath(),t.localData,"utf8",(function(e){if(e)return n(e);n(void 0,t)})):n(void 0,t)}))})):n(void 0,t)}function g(t){if(i)return o._xferComplete(t);var n=c.getCompositeManifestHref(e);c.headRequest(n,(function(e,n){return e?o._xferComplete(e):404===n.statusCode?(t=new h(h.NO_COMPOSITE,"Composite does not exist; may have been deleted"),o._xferComplete(t)):o._xferComplete(t)}))}!function(e,t,o,n,r){function i(e){e||(t.compositeHasBeenCreated=!0);var o,n=t._compositeCreationCallbacks,r=n.length;for(o=0;o<r;o++)try{n[o](e)}catch(e){}t._compositeCreationCallbacks=void 0}e.isBound||t.compositeHasBeenCreated?r():t._compositeCreationCallbacks?t._compositeCreationCallbacks.push(r):(t._compositeCreationCallbacks=[r],n.createCompositeDirectory(e,o,(function(t,r){if(t){if(t.code!==h.ALREADY_EXISTS)return i(m("Unexpected response creating a composite directory",t,r));if(o)i();else{var s=n.getCompositeManifestHref(e);n.headRequest(s,(function(e,t){return e?i(e):404!==t.statusCode?i(e=new h(h.INVALID_STATE,"Composite already exists and overwriteExisting not specified")):void i()}))}}else i()})))}(e,r,a,c,(function(i){if(i)return o._xferComplete(i);t._pushComponents(o,n,(function(){var t=o.failedComponents;if(t){i=new h(h.COMPONENT_UPLOAD_ERROR,"One or more components failed to upload.");var s,d=t.length;for(s=0;s<d;s++){var m=t[s].error;if(m.code===h.EXCEEDS_QUOTA){i=new h(m.code,m.message);break}}return i.failedComponents=t,g(i)}if(n.compositeState===_.modified){n.compositeState=_.unmodified,r.manifestEtag&&r.currentBranchEtag===n.manifestEtag&&(n.manifestEtag=r.manifestEtag);var y=n.remoteData;o.bytesTotal+=y.length,o.bytesTotal-=u;var v=c.updateManifest(n,y,a,(function(t,i){if(t)return g(t);var s=i.headers.etag;r.manifestEtag=s,r.currentBranchEtag=n.manifestEtag,r.changeCount=l,r.commitChanges((function(t){if(t)return o._xferComplete(t);r.applyToBranch(n),n.compositeState=_.unmodified,e.hasLocalStorage?p.writeFileAtomically(e._localStorage.pushedManifestPath(),n.localData,"utf8",(function(e){if(e)return o._xferComplete(e);n._isDirty=!1,f(n,(function(e,t){o._xferComplete(e,t)}))})):(e._options.xhrBaseBranchSupport&&(e._pushedBranchData=n.localData),f(n,(function(e,t){o._xferComplete(e,t)})))}))}));v&&(v.progress=o._reportProgress,v.token=o)}else f(n,(function(e,t){o._xferComplete(e,t)}))}))}))},t._deleteComposite=function(e,t,o){var n=e._composite,r=e._owner,i=e._session;r.compositeState=_.committedDelete;var s=r.remoteData;e.bytesTotal=s.length,e._journal.manifestEtag&&e._journal.currentBranchEtag===r.manifestEtag&&(r.manifestEtag=e._journal.manifestEtag),i.updateManifest(r,s,t,(function(t,s){if(t)return o(t);i.deleteCompositeDirectory(n,(function(t,i){if(t)return o(t);e._journal.compositeHasBeenDeleted=!0,e._journal.commitChanges((function(e){if(e)return o(e);n.hasLocalStorage?p.writeFileAtomically(n._localStorage.pushedManifestPath(),r.localData,"utf8",(function(e){if(e)return o(e);o(void 0,r)})):o(void 0,r)}))}))}))},t._pushComponents=function(e,t,o){var n,r=t.allComponents(),i=e._composite,a=i._localStorage,c={},l=e._journal;function u(t,n,r){n?c[t.id]=n:delete c[t.id],r&&(e.failedComponents=e.failedComponents||[],e.failedComponents.push({component:t,error:r})),0===Object.keys(c).length&&l.commitChanges(o)}function m(t,o,n){u(t,"uploading"),p.info(o,(function(r,a){if(r)return r=new h(h.INVALID_STATE,"Component asset missing",r),void u(t,null,r);var c=a.size,p=d.filePathComponents(o).fileName,m=l.getRecordForUploadedComponent(t.id);if(m&&m.length===c&&m["storage-name"]===p)return t.etag=m.etag,t.version=m.version,t.md5=m.md5,t.length=m.length,t.state=_.unmodified,void u(t,null);e.bytesTotal+=c;var g=e._session.uploadComponent(t,n,i.collaborationType===s.COLLABORATION.SHARED_WITH_USER,e,new f(o),(function(e,o,n){if(!e){var r=o.headers.etag,i=o.headers["x-latest-version"],s=n.md5;r||(e=new h(h.UNEXPECTED_RESPONSE,"No etag")),i||(e=new h(h.UNEXPECTED_RESPONSE,"No version")),s||(e=new h(h.UNEXPECTED_RESPONSE,"No md5")),e||(t.etag=r,t.version=i,t.md5=s,t.length=c,t.state=_.unmodified,l.recordUploadedComponent(t.id,r,i,s,c,p),l.commitChanges())}u(t,null,e)}));g&&(g.progress=e._reportProgress,g.token=e)}))}function g(o,n,r){var c=l.getRecordForUploadedComponent(o.id);if(c&&c["source-href"]===n)return o.etag=c.etag,o.version=c.version,o.md5=c.md5,o.length=c.length,void(o.state=_.unmodified);u(o,"copying");var d=e._session.copyAssetToComponentId(o.id,o.type,e._composite.href,r,i.collaborationType===s.COLLABORATION.SHARED_WITH_USER,e,n,(function(e,i,s){if(e){if(a){var c=a.componentAssetPath(o,t._local());if(c)return m(o,c,r)}}else{var d=i.headers.etag,p=i.headers["x-latest-version"],f=s.md5,g=s.size;d||(e=new h(h.UNEXPECTED_RESPONSE,"No etag")),p||(e=new h(h.UNEXPECTED_RESPONSE,"No version")),f||(e=new h(h.UNEXPECTED_RESPONSE,"No md5")),g||(e=new h(h.UNEXPECTED_RESPONSE,"No length")),e||(o.etag=d,o.version=p,o.md5=f,o.length=g,o.state=_.unmodified,l.recordUploadedComponent(o.id,d,p,f,g,void 0,n),l.commitChanges())}u(o,null,e)}));d&&(d.progress=e._reportProgress,d.token=e)}for(n=0;n<r.length;++n){var y=r[n],v=y.state,A=!y.etag;if(v||(v=_.unmodified),A||v===_.modified){var w=t._core._getSourceHrefOfComponent(y);if(t.hasLocalStorage||w){var C=A||e._compositeIsNew;w?g(y,w,C):m(y,a.componentAssetPath(y,t._local()),C)}else{var S=new h(h.INVALID_STATE,"Component should not be modified or new without local storage");e.failedComponents=e.failedComponents||[],e.failedComponents.push({component:y,error:S})}}else v===_.unmodified?l.removeRecordForUploadedComponent(y.id):v!==_.committedDelete&&v!==_.pendingDelete||t.removeComponent(y)}0===Object.keys(c).length&&o()},r=function(e,t,o,n,r,i,s,c,l){if("function"!=typeof l)throw new h(h.INVALID_PARAMS,'Param "callback" must be a function.');var u=r.length||r.byteLength||r.size,d=new g(c,l);d.bytesTotal=u;var p=c.uploadAssetForComponentId(e,t,s,o,n,d,r,(function(o,n,r){var s;if(!o)try{s=new a._UploadResults(i),u=u||p.bytesSent,s.records[e]=function(e,t,o,n,r){if("number"!=typeof t)throw new h(h.UNEXPECTED_RESPONSE,"No length");var i=n.headers.etag,s=n.headers["x-latest-version"],c=r.md5;if(!i)throw new h(h.UNEXPECTED_RESPONSE,"No etag");if(!s)throw new h(h.UNEXPECTED_RESPONSE,"No version");if(!c)throw new h(h.UNEXPECTED_RESPONSE,"No md5");return new a._UploadRecord(e,i,s,c,t,o)}(e,u,t,n,r)}catch(e){o=e,s=void 0}d._xferComplete(o,s)}));return p&&(p.progress=d._reportProgress,p.token=d),d},i=function(e,t,o,n,r,i,s,c,l){if("function"!=typeof l)throw new h(h.INVALID_PARAMS,'Param "callback" must be a function.');var u=new g(c,l),d=c.copyAssetToComponentId(e,t,s,o,n,u,r,(function(o,n,r){if(!u._aborted){var s;if(!o)try{(s=new a._UploadResults(i)).records[e]=function(e,t,o,n){var r=n.headers.etag,i=n.headers["x-latest-version"],s=t.md5,c=t.size;if("number"!=typeof c)throw new h(h.UNEXPECTED_RESPONSE,"No length");if(!r)throw new h(h.UNEXPECTED_RESPONSE,"No etag");if(!i)throw new h(h.UNEXPECTED_RESPONSE,"No version");if(!s)throw new h(h.UNEXPECTED_RESPONSE,"No md5");return new a._UploadRecord(e,r,i,s,c,o)}(e,r,t,n)}catch(e){o=e,s=void 0}l(o,s)}}));return d&&(d.progress=u._reportProgress,d.token=u),u},t}.call(t,o,t,e))||(e.exports=n)},2829:function(e,t,o){var n,r;n=[o(0),o(2),o(3),o(13),o(7),o(26),o(301)],void 0===(r=function(e,t,o,n,r,i,s){"use strict";n.logger;return t.Model.extend({IS_REF:!0,isPublished:function(){return!1},getMyApp:function(){return i.getAppBySyncGroupName(this.get("syncGroupName"))},getMyPrimaryApp:function(){var t=this.getMyApp(),o=t.getSetting("syncGroup");return e.endsWith(o,"-template")&&(t=i.getAppBySyncGroupName(t.getConfig().templateSyncGroup)),t},isTemplate:function(){var t=this.getMyApp().getSetting("syncGroup");return e.endsWith(t,"-template")},getCollaboration:function(){return this._collaboration},getEtag:function(){return""},getResolvedDoc:function(){return this._modelDoc},resolveModel:function(e){this._modelDoc=e,this._modelPromise=o.resolve(e)},resolve:function(){return this._modelPromise||(this._modelPromise=this.syncGroup.getComposite(this.get("id"),this.get("modified")).then(function(e){return this._modelDoc=e,this.set("modified",this._modelDoc.getContentModifiedDate()),this._modelDoc.setCollaboration(this.get("collaboration")),e}.bind(this))),this._modelPromise},setAsBadRefFromCompositeLoadError:function(e){return!("NO_COMPOSITE"!==e.code||!e.underlyingError||!e.underlyingError.response||404!==e.underlyingError.response.status)&&(this.IS_BAD_REF=!0,this.delete=function(){return n.deleteCompositeDoc(this)},this.getDCXRoot=function(){return{getValue:function(e){return""},setValue:function(e,t){this[e]=t}}},this.getResolvedDoc=function(){return this},this.isPublished=function(){return!0},this.getProjectName=function(){return this.get("id")},this.getContentModifiedDate=function(){var e=this.get("modified");return e?e.indexOf("Z")>-1?this._unZpadDate(e):new Date(e):new Date},this._unZpadDate=function(e){var t=Date.parse(e);if(isNaN(t)){var o,n=e.split("T"),r=1*n[1].substring(0,2);return r>23?(e=n[0]+"T23"+n[1].substring(2),(o=new Date(e)).setUTCHours(o.getUTCHours()+(r-23)),o):new Date}return new Date(t)},!0)}})}.apply(t,n))||(e.exports=r)},554:function(e,t){},555:function(e,t){},879:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r,i;r=o(2750),t._setLogCallback=function(e){i=e},t.merge=function(e){var t,o;for(t=1;t<arguments.length;++t){var n=arguments[t];if("object"==typeof n)for(o in n)n.hasOwnProperty(o)&&(e[o]=n[o])}return e},t.parentDirectory=function(e){var t=e.split("/");return t.pop(),t.join("/")},t.filePathComponents=function(e){var t=e.split("/"),o=t.pop(),n=o.split("."),r=n.length>1?n.pop():null;return{directory:t.join("/"),fileName:o,baseName:n.join("."),extension:r}},t.appendPathElements=function(){var e,t=[],o=arguments.length;for(e=0;e<o;e++){var n=arguments[e];"string"==typeof n&&""!==n&&(0===e&&1!==n.length||"/"===n.charAt(0)&&(n=n.slice(1)),e!==o-1&&"/"===n.charAt(n.length-1)&&(n=n.slice(0,n.length-1)),t.push(n))}return t.join("/")};var s=/^[^\u0000-\u001F\u0022\u002A\u003A\u003C\u003E\u003F\u005C\u007F]*[^\u0000-\u001F\u0022\u002A\u002E\u003A\u003C\u003E\u003F\u005C\u007F]{1}$/;t.isValidPath=function(e,t){try{if(e.length>65535)return!1;var o=(t?e.slice(1):e).split("/");if(!o||0===o.length)return!1;var n,r=o.length;for(n=0;n<r;n++){if(o[n].length>255||!s.test(o[n]))return!1}if(t&&o.length>0){var i=o[0];if("manifest"===i||"mimetype"===i)return!1}return!0}catch(e){return!1}},t.isValidAbsolutePath=function(e){return t.isValidPath(e,!0)};var a=t.noOp=function(){};t.consumeStream=function(e,t,o){e.on("data",o||a),e.on("end",t||a)},t.flatCopy=function(e){var t,o={},n=Object.keys(e),r=n.length;for(t=0;t<r;t++){var i=n[t];o[i]=e[i]}return o},t.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},t.objectsEqual=function(e,o,n){var r,i,s={},a=Object.keys(e),c=a.length;for(i=0;i<c;i++){if(r=a[i],!n||!n[r]){var h=e[r],l=o[r],u=typeof h;if(u!==typeof l)return!1;if("object"===u){if(!t.objectsEqual(h,l,n))return!1}else if(h!==l)return!1}s[r]=!0}for(c=(a=Object.keys(o)).length,i=0;i<c;i++)if(!s[r=a[i]])return!1;return!0};var c=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?");t.parseURI=function(e){var t=e.match(c);return{scheme:t[2],authority:t[4],path:t[5],query:t[7],fragment:t[9]}},t.endPointOf=function(e){var o,n=t.parseURI(e),r=n.scheme,i=n.authority,s="https"===r?443:"http"===r?80:-1;return r&&i&&(o=(r+"://"+i).toLowerCase(),s>=0&&i.indexOf(":")<0&&(o=o+":"+s)),o},t.ensureRelativeHrefStartsWithSlash=function(e){if(e){var o=t.parseURI(e),n=o.scheme,r=o.authority;n||r||"/"!==e.charAt(0)&&(e="/"+e)}return e};var h=/^([^:]+):(.*)$/,l=/^\s+|\s+$/g;return t.parseHeaders=function(e){var t,o,n,r={},i=e.split(/\r?\n/);for(t=0;t<i.length;++t){var s=i[t];if(s.length>0){var a=s.charCodeAt(0);if(!o||9!==a&&32!==a){var c=h.exec(s);c&&c.length>1&&(o=c[1].toLowerCase(),n=(n=c[2]||"").replace(l,""),r[o]?r[o]=r[o]+","+n:r[o]=n)}else r[o]=r[o]+" "+s.replace(l,"")}}return r},t.timeStamp=function(e){var t=(new Date).getTime();return e&&(t-=t%1e3),t},t.generateUuid=r,t.log=function(e){if("function"==typeof i)try{i(e)}catch(e){}},t}.call(t,o,t,e))||(e.exports=n)},886:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r=o(2019),i=o(2825),s=o(988),a=o(879),c=6;function h(e,t,o){if(e)e=this._setData(e,t);else{var n=a.generateUuid();e={"manifest-format-version":c,id:n},this.originalManifestFormatVersion=c,this._core=new r(e,this,t),this._data=e}this._pendingElements=[],this.manifestPath=o}function l(e){var t=e["manifest-format-version"];if(t<c){if(t<4)throw new s(s.INVALID_DATA,"Encountered manifest format version "+e["manifest-format-version"]+". Format version conversion not yet implemented for that version.");t<5&&function e(t){var o,n,r=t.components;if(r)for(n=r.length,o=0;o<n;o++){delete r[o].localStorageAssetId}var i=t.children;if(i)for(n=i.length,o=0;o<n;o++)e(i[o])}(e),t<6&&function e(t,o){o&&t.path&&delete t.path;var n,r=t.components;if("object"==typeof r)for(n=0;n<r.length;n++){var i=r[n];"number"==typeof i.version&&(i.version=i.version.toString())}var s=t.children;if("object"==typeof s)for(n=0;n<s.length;n++){e(s[n])}}(e,!0)}}return h._newBranchAsCopyOfCore=function(e,t){var o=new h(JSON.parse(JSON.stringify(e._data))),n=o._core;return o._localStorage=t,o._resetIdentity((function(o){var r=e.getComponentWithId(o.id);if(!r)throw new s(s.INVALID_STATE,"Could not find original component.");if("modified"===r.state||!r.etag)throw new s(s.INVALID_STATE,"Cannot create a new composite from a branch that contains modified or unbound components.");var i=e._getHrefOfComponent(r);if(!i)throw new s(s.INVALID_STATE,"Cannot determine the href of component id "+r.id);n._setSourceHrefOfComponent(i,o),t&&t.removeComponentAsset(o,n._local())})),o},Object.defineProperties(h.prototype,{compositeId:{get:function(){return this._core.rootNode.id},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new s(s.INVALID_PARAMS,"Expecting a non-empty string.");if(t._allNodes[e])throw new s(s.DUPLICATE_VALUE,"There is already a node with the same id.");delete t._allNodes[this._data.id],this._data.id=e,t._allNodes[e]=this._core.rootNode,t._setDirty()}},rootNode:{get:function(){return this._core.rootNode},set:function(e){this._core.rootNode=e}},name:{get:function(){return this._core.rootNode.name},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new s(s.INVALID_PARAMS,"Expecting a string or undefined.");t.rootNode.name=e}},type:{get:function(){return this._core.rootNode.type},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new s(s.INVALID_PARAMS,"Expecting a non-empty string.");t.rootNode.type=e}},compositeHref:{get:function(){return this._data.local?this._data.local.compositeHref:void 0},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new s(s.INVALID_PARAMS,"Expecting a string or undefined.");t._local().compositeHref=a.ensureRelativeHrefStartsWithSlash(e),t._setDirty(!0)}},_collaborationType:{get:function(){return this._data.local?this._data.local.collaborationType:void 0},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");e?t._local().collaborationType=e:delete t._local().collaborationType,t._setDirty(!0)}},_clientDataString:{get:function(){return this._data.local?this._data.local.clientDataString:void 0},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");e?t._local().clientDataString=e:delete t._local().clientDataString,t._setDirty(!0)}},manifestEtag:{get:function(){return this._data.local?this._data.local.manifestEtag:void 0},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new s(s.INVALID_PARAMS,"Expecting a string or undefined.");t._local().manifestEtag=e,t._setDirty(!0)}},compositeState:{get:function(){return this._data.state||"unmodified"},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new s(s.INVALID_PARAMS,"Expecting a string.");if("unmodified"!==e&&"modified"!==e&&"pendingDelete"!==e&&"committedDelete"!==e)throw new s(s.INVALID_PARAMS,'State must be "modified", "unmodified", "pendingDelete", or "committedDelete".');if("pendingDelete"===e&&"committedDelete"===e&&("pending"===this.compositeArchivalState||"archived"===this.compositeArchivalState))throw new s(s.INVALID_STATE,"Cannot delete an archived composite.");this._data.state=e,t._setDirty(!0)}},compositeArchivalState:{get:function(){return this._core._local().archivalState||"active"},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new s(s.INVALID_PARAMS,"Expecting a string.");if("pending"!==e&&"archived"!==e&&"active"!==e)throw new s(s.INVALID_PARAMS,'State must be "pending", "archived", or undefined.');if("archived"===this.compositeArchivalState)throw new s(s.INVALID_STATE,"Composite has already been archived.");if("active"!==e&&("pendingDelete"===this.compositeState||"committedDelete"===this.compositeState))throw new s(s.INVALID_STATE,"Cannot archive a deleted composite.");"active"===e?delete this._core._local().archivalState:this._core._local().archivalState=e,t._setDirty(!0)}},isBound:{get:function(){return this.manifestEtag&&this.compositeHref},set:function(){throw new s(s.READ_ONLY,"Cannot set the property isBound. Use resetIdentity instead.")}},_localStorage:{get:function(){return this._core._localStorage},set:function(e){this._core._localStorage=e}},hasLocalStorage:{get:function(){return this._core.hasLocalStorage},set:function(e){this._core.hasLocalStorage=e}},_isDirty:{get:function(){return this._core._isDirty},set:function(e){this._core._isDirty=e}},isDirty:{get:function(){return this._core.isDirty},set:function(e){this._core.isDirty=e}},localData:{get:function(){return this._core._stringify(!1,!0)},set:function(){throw new s(s.READ_ONLY,"Cannot set the property localData.")}},remoteData:{get:function(){return this._core._stringify(!0)},set:function(){throw new s(s.READ_ONLY,"Cannot set the property remoteData.")}},pendingElements:{get:function(){return this._pendingElements},set:function(e){throw new s(s.READ_ONLY,"Cannot set the property pendingElements.")}},changeCount:{get:function(){return this._core.changeCount},set:function(e){this._core.changeCount=e}},readOnly:{get:function(){return this._core._readOnly},set:function(e){this._core._readOnly=e}}}),h.prototype.parse=function(e){if("string"!=typeof e)throw new s(s.INVALID_PARAMS,'Param "data" must be a string');var t=null;try{t=JSON.parse(e)}catch(e){throw new s(s.INVALID_JSON,"Manifest could not be parsed. Underlying error: "+e.message)}return this._setData(t,this._core._readOnly)},h.prototype.getElementWithId=function(e){return this._createElement(this._core.getChildWithId(e))},h.prototype.getElementWithAbsolutePath=function(e){return this._createElement(this._core.getChildWithAbsolutePath(e))},h.prototype.addElement=function(e,t,o,n,r,i){if("string"!=typeof e)throw new s(s.INVALID_PARAMS,"Element must have a name of type string");if("string"!=typeof t)throw new s(s.INVALID_PARAMS,"Element must have a type of type string");if("string"!=typeof o)throw new s(s.INVALID_PARAMS,"Element must have a path of type string");var a=this._core.addChild(e,n,r,i);try{a.path=o}catch(e){throw this._core.removeChild(a),e}return a._data.type=t,this._createElement(a)},h.prototype.updateElement=function(e){var t=this.getChildWithId(e.rootNode.id);if(!t)throw new s(s.INVALID_PARAMS,"Element does not exist in branch.");var o=this._core.replaceChild(e.rootNode,t.path);return this._deleteElement(e),o},h.prototype.abandonElement=function(e){this._deleteElement(e)},h.prototype.getChildWithId=function(e){return this._core.getChildWithId(e)},h.prototype.getChildWithAbsolutePath=function(e){return this._core.getChildWithAbsolutePath(e)},h.prototype.getChildrenOf=function(e){return this._core.getChildrenOf(e)},h.prototype.addChild=function(e,t,o,n){return this._core.addChild(e,t,o,n)},h.prototype.removeChild=function(e){return this._core.removeChild(e)},h.prototype.moveChild=function(e,t,o){return this._core.moveChild(e,t,o)},h.prototype.copyChild=function(e,t,o,n,r,i){return this._core.copyChild(e,t,o,n,r,i)},h.prototype.replaceChild=function(e,t,o,n){return this._core.replaceChild(e,t,o,n)},h.prototype.allComponents=function(){return this._core.allComponents()},h.prototype.getComponentWithId=function(e){return this._core.getComponentWithId(e)},h.prototype.getComponentWithAbsolutePath=function(e){return this._core.getComponentWithAbsolutePath(e)},h.prototype.getComponentsOf=function(e){return this._core.getComponentsOf(e)},h.prototype.addComponent=function(e,t,o,n,r,i,s,a,c,h){return this._core.addComponent(e,t,o,n,r,i,s,a,c,h)},h.prototype.addComponentWithUploadResults=function(e,t,o,n,r){return this._core.addComponentWithUploadResults(e,t,o,n,r)},h.prototype.updateComponent=function(e,t,o,n){return this._core.updateComponent(e,t,o,n)},h.prototype.updateComponentWithUploadResults=function(e,t){return this._core.updateComponentWithUploadResults(e,t)},h.prototype.removeComponent=function(e){return this._core.removeComponent(e)},h.prototype.moveComponent=function(e,t){return this._core.moveComponent(e,t)},h.prototype.copyComponent=function(e,t,o,n,r){return this._core.copyComponent(e,t,o,n,r)},h.prototype.replaceComponent=function(e,t,o,n){return this._core.replaceComponent(e,t,o,n)},h.prototype.assetOfComponent=function(e,t){return this._core.assetOfComponent(e,t)},h.prototype.copy=function(){return new h(JSON.parse(JSON.stringify(this._data)))},h.prototype._createElement=function(e){var t;if(e){var o=JSON.parse(JSON.stringify(e._data));o["manifest-format-version"]=this._data["manifest-format-version"],delete o.path,(t=new i(o,this,this._core._readOnly))&&this._localStorage&&(t._localStorage=this._localStorage,t._updateLocalDataFromBranch(this),this._localStorage.registerInMemoryBranchOrElement(t))}return t&&this._pendingElements.push(t),t},h.prototype._deleteElement=function(e){var t=this._pendingElements.indexOf(e);if(t<0)throw new s(s.INVALID_PARAMS,"Unknown element.");this._pendingElements.splice(t,1),this._localStorage&&this._localStorage.unregisterInMemoryBranchOrElement(e)},h.prototype._updateLocalDataFromBranch=function(e){if(this._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if(!this._localStorage)throw new s(s.NO_LOCAL_STORAGE,"No local storage.");if(!e._localStorage)throw new s(s.NO_LOCAL_STORAGE,"No local storage for source.");if(this._localStorage.compositePath!==e._localStorage.compositePath)throw new s(s.INVALID_PARAMS,"Branches must have same storage path.");this._core._localStorage.copyLocalStorageData(e,e._core._local(),this,this._core._local()),this._core._copySourceHrefsFrom(e._core)},h.prototype._verify=function(e){return"string"!=typeof e.id?new s(s.INVALID_DATA,"Manifest is missing an id of type string"):"string"!=typeof e.name?new s(s.INVALID_DATA,"Manifest is missing a name of type string"):"string"!=typeof e.type?new s(s.INVALID_DATA,"Manifest is missing a type of type string"):"number"!=typeof e["manifest-format-version"]?new s(s.INVALID_DATA,"Manifest is missing a manifest-format-version of type number"):null},h.prototype._setData=function(e,t){this.originalManifestFormatVersion=e["manifest-format-version"],l(e),e.local&&(e.local.version=2);var o=this._verify(e);if(null===o)return e["manifest-format-version"]=c,this._core=new r(e,this,t),this._data=e,this;throw o},h.prototype._reset=function(e,t){if(this._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");this._data.local&&(delete this._data.local.manifestEtag,delete this._data.local.compositeHref),e||(this._data.id=a.generateUuid()),this._data.state="modified",this._core._recursiveReset(this._data,t),this._core._setDirty()},h.prototype._resetBinding=function(e){this._reset(!0,e)},h.prototype._resetIdentity=function(e){this._reset(!1,e)},h.prototype._local=function(){return this._core._local()},h.prototype._setDirty=function(e){this._core._setDirty(e)},h.prototype._setPathOfNode=function(e,t){this._core._setPathOfNode(e,t)},h.prototype._verifyIntegrity=function(e,t,o){return this._core._verifyIntegrity(e,t,o)},h}.call(t,o,t,e))||(e.exports=n)},887:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r=o(988),i=o(879);function s(e,t){e?this._setData(e):this._data={},this._readOnly=t}var a={unmodified:"unmodified",modified:"modified",pendingDelete:"pendingDelete",committedDelete:"committedDelete"};s.STATES=a,s._UploadResults=function(e){this.compositeId=e,this.records={}},s._UploadRecord=function(e,t,o,n,r,i){this.id=e,this.etag=t,this.version=o,this.md5=n,this.length=r,this.type=i},Object.defineProperties(s.prototype,{id:{get:function(){return this._data.id},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(this._owner)throw new r(r.READ_ONLY,"Cannot change the id of a component that is part of a branch or element.");if("string"!=typeof e||""===e)throw new r(r.INVALID_PARAMS,"Expecting a non-empty string.");this._data.id=e,this._setDirty()}},name:{get:function(){return this._data.name},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new r(r.INVALID_PARAMS,"Expecting a string or undefined.");this._data.name=e,this._setDirty()}},type:{get:function(){return this._data.type},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new r(r.INVALID_PARAMS,"Expecting a non-empty string.");this._data.type=e,this._setDirty()}},path:{get:function(){return this._data.path},set:function(e){if(this._data.path!==e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!i.isValidPath(e))throw new r(r.INVALID_PARAMS,"Expecting a valid path.");this._owner?this._owner._core._setPathOfComponent(this,e):(this._data.path=e,this._parentPath=""),this._setDirty()}}},parentPath:{get:function(){return this._parentPath},set:function(e){throw new r(r.READ_ONLY,"parentPath is read-only.")}},absolutePath:{get:function(){return this._data.path&&this._owner?i.appendPathElements(this._parentPath,this._data.path):void 0},set:function(e){throw new r(r.READ_ONLY,"absolutePath is read-only.")}},relationship:{get:function(){return this._data.rel},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new r(r.INVALID_PARAMS,"Expecting a string or undefined.");this._data.rel=e,this._setDirty()}},state:{get:function(){return this._data.state},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new r(r.INVALID_PARAMS,"Expecting a string.");if(!a.hasOwnProperty(e))throw new r(r.INVALID_PARAMS,'State must be "modified", "unmodified", "pendingDelete", or "committedDelete".');this._data.state=e,this._setDirty()}},etag:{get:function(){return this._data.etag},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new r(r.INVALID_PARAMS,"Expecting a string or undefined.");this._data.etag=e,this._setDirty()}},md5:{get:function(){return this._data.md5},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new r(r.INVALID_PARAMS,"Expecting a string or undefined.");this._data.md5=e,this._setDirty()}},version:{get:function(){return this._data.version},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(void 0!==e&&"string"!=typeof e)throw new r(r.INVALID_PARAMS,"Expecting a string or undefined.");this._data.version=e,this._setDirty()}},length:{get:function(){return this._data.length},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&void 0!==e)throw new r(r.INVALID_PARAMS,"Expecting a number or undefined.");this._data.length=e,this._setDirty()}},width:{get:function(){return this._data.width},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&void 0!==e)throw new r(r.INVALID_PARAMS,"Expecting a number or undefined.");this._data.width=e,this._setDirty()}},height:{get:function(){return this._data.height},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&void 0!==e)throw new r(r.INVALID_PARAMS,"Expecting a number or undefined.");this._data.height=e,this._setDirty()}}});var c={name:!0,id:!0,state:!0,path:!0,rel:!0,type:!0,etag:!0,length:!0,version:!0,md5:!0,width:!0,height:!0};return s.prototype.getCustomKeys=function(){var e,t=[],o=Object.keys(this._data),n=o.length;for(e=0;e<n;e++){var r=o[e];c[r]||t.push(r)}return t},s.prototype.getValue=function(e){if("string"!=typeof e)throw new r(r.INVALID_PARAMS,'Param "key" must be a string');return this._data[e]},s.prototype.setValue=function(e,t){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new r(r.INVALID_PARAMS,'Param "key" must be a string');this._data[e]=t,this._setDirty()},s.prototype.removeValue=function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new r(r.INVALID_PARAMS,'Param "key" must be a string');delete this._data[e],this._setDirty()},s.prototype.getLink=function(e){if("string"!=typeof e)throw new r(r.INVALID_PARAMS,'Param "relationship" must be a string');return this._data._links?this._data._links[e]:void 0},s.prototype.setLink=function(e,t){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("object"!=typeof e)throw new r(r.INVALID_PARAMS,'Param "link" must be an object.');if("string"!=typeof t)throw new r(r.INVALID_PARAMS,'Param "relationship" must be a string');var o=this._data._links;o||(o=this._data._links={}),o[t]=e,this._setDirty()},s.prototype.removeLink=function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new r(r.INVALID_PARAMS,'Param "relationship" must be a string');var t=this._data._links;t&&(delete t[e],Object.keys(t).length<1&&delete this._data._links,this._setDirty())},s.prototype.isEqualTo=function(e,t){return i.objectsEqual(this._data,e._data,t)},s.prototype._setData=function(e){var t=this._verify(e);if(null===t)return this._data=e,this;throw t},s.prototype._setDirty=function(){this._owner&&this._owner._setDirty()},s.prototype._verify=function(e){return"string"!=typeof e.id?new r(r.INVALID_DATA,"Component is missing an id of type string"):null},s}.call(t,o,t,e))||(e.exports=n)},891:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r=o(988),i=o(879);function s(e,t,o){e?this._setData(e):this._data={},this._readOnly=t,this._isRoot=o}s.ROOT_PATH="/",Object.defineProperties(s.prototype,{id:{get:function(){return this._data.id},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(this._owner)throw new r(r.READ_ONLY,"Cannot change the id of a node that is part of a branch or element.");if("string"!=typeof e||""===e)throw new r(r.INVALID_PARAMS,"Expecting a non-empty string.");this._data.id=e,this._setDirty()}},name:{get:function(){return this._data.name},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new r(r.INVALID_PARAMS,"Expecting a string or undefined.");this._data.name=e,this._setDirty()}},type:{get:function(){return this._data.type},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new r(r.INVALID_PARAMS,"Expecting a string or undefined.");this._data.type=e,this._setDirty()}},relationship:{get:function(){return this._data.rel},set:function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&void 0!==e)throw new r(r.INVALID_PARAMS,"Expecting a string or undefined.");this._data.rel=e,this._setDirty()}},path:{get:function(){return this._isRoot?"/":this._data.path},set:function(e){if(e!==this.path){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(this._isRoot)throw new r(r.READ_ONLY,"Cannot change the path of the root node.");if(e&&!i.isValidPath(e))throw new r(r.INVALID_PARAMS,"Expecting a valid path or undefined.");this._owner?this._owner._setPathOfNode(this,e||void 0):(this._data.path=e||void 0,this._parentPath=""),this._setDirty()}}},parentPath:{get:function(){return this._parentPath},set:function(e){throw new r(r.READ_ONLY,"parentPath is read-only.")}},absolutePath:{get:function(){var e=this.path;return this._isRoot?e:e&&this._owner?i.appendPathElements(this._parentPath,e):void 0},set:function(e){throw new r(r.READ_ONLY,"absolutePath is read-only.")}},isRoot:{get:function(){return this._isRoot},set:function(e){throw new r(r.READ_ONLY,"isRoot is read-only.")}}}),s.prototype.getLink=function(e){if("string"!=typeof e)throw new r(r.INVALID_PARAMS,'Param "relationship" must be a string');return this._data._links?this._data._links[e]:void 0},s.prototype.setLink=function(e,t){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("object"!=typeof e)throw new r(r.INVALID_PARAMS,'Param "link" must be an object.');if("string"!=typeof t)throw new r(r.INVALID_PARAMS,'Param "relationship" must be a string');var o=this._data._links;o||(o=this._data._links={}),o[t]=e,this._setDirty()},s.prototype.removeLink=function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new r(r.INVALID_PARAMS,'Param "relationship" must be a string');var t=this._data._links;t&&(delete t[e],Object.keys(t).length<1&&delete this._data._links,this._setDirty())};var a={components:!0,children:!0,"manifest-format-version":!0,id:!0,name:!0,type:!0,state:!0,local:!0},c={components:!0,children:!0,rel:!0,path:!0,id:!0,name:!0,type:!0};return s.prototype.getCustomKeys=function(){var e,t=[],o=Object.keys(this._data),n=o.length;for(e=0;e<n;e++){var r=o[e];(this._isRoot?a[r]:c[r])||t.push(r)}return t},s.prototype.getValue=function(e){if("string"!=typeof e)throw new r(r.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new r(r.INVALID_PARAMS,"Illegal key");return this._data[e]},s.prototype.setValue=function(e,t){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new r(r.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new r(r.INVALID_PARAMS,"Illegal key");this._data[e]=t,this._setDirty()},s.prototype.removeValue=function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new r(r.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new r(r.INVALID_PARAMS,"Illegal key");delete this._data[e],this._setDirty()},s.prototype.copy=function(){var e=null,t=this._data.children,o=this._data.components;try{t&&delete this._data.children,o&&delete this._data.components,e=new s(JSON.parse(JSON.stringify(this._data)))}finally{t&&(this._data.children=t),o&&(this._data.components=o)}return e},s.prototype.isEqualTo=function(e,t,o){return this._isEqual(this._data,e._data,i.merge({children:!0,components:!0},t),o)},s.prototype._isEqual=function(e,t,o,n){var r,s,a,c,h,l,u;if(!i.objectsEqual(e,t,o))return!1;if(s=e.components,a=t.components,(c=s?s.length:0)!==(a?a.length:0))return!1;if(c)for(r=0;r<c;r++){for(h=s[r],l=null,u=0;u<c;u++)if(h.id===a[u].id){l=a[u];break}if(!l)return!1;if(!i.objectsEqual(h,l,n))return!1}if(s=e.children,a=t.children,(c=s?s.length:0)!==(a?a.length:0))return!1;if(c)for(r=0;r<c;r++)if(!this._isEqual(s[r],a[r],o,n))return!1;return!0},s.prototype._setData=function(e){var t=this._verify(e);if(null===t)return this._data=e,this;throw t},s.prototype._verify=function(e){return"string"!=typeof e.id?new r(r.INVALID_DATA,"Node is missing an id of type string"):null},s.prototype._setDirty=function(){this._owner&&this._owner._setDirty()},s}.call(t,o,t,e))||(e.exports=n)},892:function(e,t,o){var n;void 0===(n=function(e,t,n){"use strict";var r=o(1788),i=(o(2049),o(2050)),s=o(2826),a=o(2827),c=o(2828),h=o(879),l=o(988),u=o(1296);function d(e,t){e&&u._setFS(e),this._compositeOptions=h.merge({},t),t&&t.logCallback&&h._setLogCallback(t.logCallback)}return d.COLLABORATION={PRIVATE:r.COLLABORATION.PRIVATE,SHARED_BY_USER:r.COLLABORATION.SHARED_BY_USER,SHARED_WITH_USER:r.COLLABORATION.SHARED_WITH_USER},d.AdobeDCXError=l,d.FileContent=i.FileContent,d.StreamProvider=i.StreamProvider,d.prototype.newEmptyComposite=function(e,t,o,n){var i=new r(e,t,null,n,null,this._compositeOptions);return o&&(i.path=o),i},d.prototype.newCompositeFromLocalStorage=function(e,t){try{if("string"!=typeof e)throw new l(l.INVALID_PARAMS,"");var o=new r(null,null,e,null,null,this._compositeOptions);o.loadCurrentFromLocalStorage((function(e,n){t(e,e?void 0:o)})),o.deleteTempFiles()}catch(e){t(e)}},d.prototype.newCompositeWithHref=function(e,t,o,n,i){var s=new r(o,i,null,n,e,this._compositeOptions);return t&&(s.path=t),s},d.prototype.newCompositeAsCopyOf=function(e,t,o,n,i,s){return r.newCompositeAsCopyOf(e,t,o,n,i,s,this._compositeOptions)},d.prototype.createHTTPService=function(e){return new i(e)},d.prototype.createStorageSession=function(e,t){return new s(e,t)},d.prototype.createCommunitySession=function(e,t){return new a(e,t)},d.prototype.compositeXfer=c,d}.call(t,o,t,e))||(e.exports=n)},893:function(e,t,o){var n,r;n=[o(0),o(2),o(3),o(13),o(5),o(879),o(301),o(2829)],void 0===(r=function(e,t,o,n,r,i,s,a){"use strict";var c=n.logger;return t.Model.extend({_compositeCache:{},constructor:function(e,o){t.Model.apply(this,arguments),o&&(this.factory=o)},initialize:function(e){this._composites=e.children},newComposite:function(e,t){var o=n.dcx.newEmptyComposite(e,t);return this._addComposite(o)},_doPullComposite:function(e,t,o,r,i){n.pullComposite(e).then(function(n){this._addComposite(e,t),i.resolve(this._compositeCache[o])}.bind(this)).fail(function(e){var t=this.get("name");if(t){if("NO_COMPOSITE"===e.code){var o=e.underlyingError&&e.underlyingError.response||{},n={syncGroupName:t,assetId:r,responseStatusCode:o.statusCode,responseStatusText:o.statusText};c.info("AUDIT SyncGroup encountered deadend composite reference",n)}}else c.error("Initializing blank sync-group, should never happen");i.reject(e)}.bind(this)).done()},getComposite:function(e,t,r){var s,a=o.defer(),c=i.appendPathElements(n.dcxSession._server,"assets",this.get("name"),e),h=this._compositeCache[c];if(h)t&&h.set("modified",t),r?(s=h.getDCXComposite(),n.pullComposite(s).then((function(e){h.set("name",e.name),a.resolve(h)}),(function(e){a.reject(e)}))):a.resolve(h);else if(s=n.dcx.newCompositeWithHref(c),window._sgPreload&&window._sgPreload.composites&&window._sgPreload.composites[e])try{var l,u,d,p=window._sgPreload.composites[e];window._sgPreload.compositeMeta&&(l=window._sgPreload.compositeMeta[e],d=l.collaboration,u=l.etag);var f=(new n.AdobeDCXBranch).parse(p);f._localStorage=s._localStorage,f.compositeHref=s.href,f._collaborationType=s.collaborationType,f._clientDataString=s.clientDataString,f.manifestEtag=u,s._pulledBranchData=f.localData,s.resolvePullWithBranch(f,function(){s=this._addComposite(s,t),this._compositeCache[c].set("collaboration",d),a.resolve(this._compositeCache[c])}.bind(this))}catch(o){console.warn("FAILED TO MAKE COMPOSITE ["+e+"] from preload cache",o,window._sgPreload.composites[e]),this._doPullComposite(s,t,c,e,a)}else this._doPullComposite(s,t,c,e,a);return a.promise},factory:function(e){return new s(e)},_addComposite:function(e,t){return e.href||(e.href=n.dcxSession.getHrefForComposite(e,this.get("name"))),this._compositeCache[e.href]=this.factory({name:e.current.name,id:e.id,modified:t,syncGroupName:this.get("name"),compositeObj:e}),this._compositeCache[e.href]},addNewCompositeDoc:function(e){this._compositeCache[e.getDCXComposite().href]=e,this.trigger("sync-add",[e])},removeCompositeDoc:function(e){e.IS_REF||(delete this._compositeCache[e.getDCXComposite().href],this.trigger("sync-remove",[e.get("id")]))},updateComposites:function(t){var r=this._composites,s=e.filter(t,(function(t){return!e.find(r,e.pick(t,"name"))})),a=e.filter(r,(function(o){return!e.find(t,e.pick(o,"name"))})),h=e.filter(t,(function(t){return!e.find(r,t)})),l=[];h=e.filter(h,(function(t){return!e.find(s,t)})),s.length&&c.debug("updateComposites:NEW",s),a.length&&c.debug("updateComposites:REMOVE",a),h.length&&c.debug("updateComposites:MODIFIED",h),this._composites=t,this.getComposites(s).then(function(e){this.trigger("sync-add",e)}.bind(this)),e.each(a,function(e){var t=this.get("name"),o=i.appendPathElements(n.dcxSession._server,"assets",t,e.name);delete this._compositeCache[o],l.push(e.name)}.bind(this)),this.trigger("sync-remove",l);var u=[];return e.each(h,function(e){var t=i.appendPathElements(n.dcxSession._server,"assets",this.get("name"),e.name),r=this._compositeCache[t],s=o.defer();r?(u.push(s.promise),n.pullComposite(r.getDCXComposite()).then((function(t){r.set("modified",e.modified),r.set("name",t.name),s.resolve()})).fail((function(e){console.warn("pull composite error: "+e),s.reject(e)}))):console.warn("Error, modified composite not found ["+t+"]")}.bind(this)),o.allSettled(u).then(function(){return h&&this.trigger("sync-refreshed",h),!0}.bind(this))},createCompositeModelRef:function(e,t,o){var n=new a;return n.set("id",e),n.set("modified",t),n.set("syncGroupName",this.get("name")),n.set("collaboration",o.collaboration||"NONE"),n.syncGroup=this,n},getCompositeRefs:function(){var t=[];return e.each(this._composites,function(e){var o=this.createCompositeModelRef(e.name,e.modified,e);t.push(o)}.bind(this)),t},getComposites:function(t){var n=o.defer(),r=[],i=[];return t=t||this._composites,e.each(t,function(e){var t=this.getComposite(e.name,e.modified);r.push(t.then((function(t){return t&&(t.set("collaboration",e.collaboration||"NONE"),i.push(t)),!0}),(function(e){return e})))}.bind(this)),o.allSettled(r).then((function(t){n.resolve(i),e.each(t,(function(e){"rejected"===e.state&&c.warn("syncGroup encountered broken composite with "+e.value)}))})).catch((function(e){c.error("failed to get composites",e),n.reject(e)})),n.promise}})}.apply(t,n))||(e.exports=r)},894:function(e,t,o){var n,r;n=[o(1),o(0),o(3),o(255),o(6)],void 0===(r=function(e,t,o,n,r){"use strict";return{initializeStorage:function(){var e;return this.dcx=new this.AdobeDCX(void 0,{xhrBaseBranchSupport:!0}),this.dcxService=this.dcx.createHTTPService((function(t){r.getAccessToken().then((function(o){o===e?(this.logger.error("Storage rejected our token, but IMS says it's valid, giving up!"),t.setAuthToken()):(e=o,t.setAuthToken(o))}))})),r.getAccessToken().then(function(e){return this.dcxService.setAuthToken(e),this.dcxService.setApiKey(r.apiKey),this.dcxSession=this.dcx.createStorageSession(this.dcxService,"https://"+this.storageServer),this.storageEnabled=!0,this.enabledDefer.resolve(),marvel.events.trigger("storage-enabled",!0),!0}.bind(this))},waitForQuiet:function(e,t){var r=o.defer(),i=0,s=(new Date,function(){(t?t(e):e.isMidCommit()||e._commitQueue.length>0||n.inProgress())||2!=++i?window.setTimeout(s,50):r.resolve(e)});return s(),r.promise}}}.apply(t,n))||(e.exports=r)},895:function(e,t,o){var n,r;n=[o(1),o(0),o(3),o(255),o(6),o(92),o(7),o(101)],void 0===(r=function(e,t,o,n,r,i,s,a){"use strict";return{loadBaseBranch:function(e){var t=o.defer();try{e.loadBaseBranch((function(e,o){e?t.reject(e):t.resolve(o)}))}catch(e){window.marvel.logger.error("dcx-storage-utils unexpected error in loadBaseBranch",e),t.reject(e)}return t.promise},deleteCompositeDoc:function(e){var t=e.get("syncGroupName"),o=e.get("id"),n=this.syncGroups[t];return n&&n.removeCompositeDoc(e),this._deleteComposite(t,o)},_deleteComposite:function(e,t){var n=this.AdobeDCXUtil.appendPathElements(this.dcxSession._server,"assets",e,t)+"?recursive=true&invocation_mode=sync",r=o.defer();return this.logger.info("Invoke DCX DELETE",n),this.dcxSession._service.invoke("DELETE",n,{"If-match":"*"},void 0,void 0,function(e,t){e?(this.logger.error("Delete failed with "+e,e),r.reject(e)):(r.resolve(),this.syncNow())}.bind(this)),r.promise},pullComposite:function(e){return this._pullCompositeWithRetry(e)},_pullCompositeWithRetry:function(e,t){var n="pullComposite";t&&(n="pullCompositeManifestOnly");var r=0;return a(this._pullComposite.bind(this,e,t),{maxAttempts:6,shouldRetry:this._isRetryableError,counter_cb:function(){r++},loggerFn:window.marvel.logger.info.bind(window.marvel.logger),logMessagePrefix:"[Core:ClientStorage] RETRY: "})().then(function(e){return r>0&&window.marvel.logger.info("[Core:ClientStorage] "+n+" succeeded after retry ("+r+")"),e}.bind(this)).catch(function(t){return this._isRetryableError(t)?window.marvel.logger.warn("[Core:ClientStorage] "+n+" gave up after retry",{projectId:e.id,href:e._href,error:t}):t&&"NO_COMPOSITE"===t.code?window.marvel.logger.info("[Core:ClientStorage] "+n+" encountered NO_COMPOSITE error",{projectId:e.id,href:e._href,error:t}):window.marvel.logger.error("[Core:ClientStorage] "+n+" error",{projectId:e.id,href:e._href,error:t}),o.reject(t)}.bind(this))},_isRetryableError:function(e){var t=e&&e.underlyingError||{},o=e.statusCode||t.response&&t.response.statusCode;return e&&(this.DCXRetryCodes().includes(e.code)||500==o||503==o||504==o)},_pullComposite:function(e,t){var n=o.defer();try{this.dcx.compositeXfer.pullCompositeManifestOnly(e,this.dcxSession,function(o,r){var i;o?n.reject(o):t?n.resolve(r):(i=r?e.resolvePullWithBranch(r):e.current,n.resolve(i))}.bind(this))}catch(e){n.reject(e)}return n.promise},pullCompositeManifestOnly:function(e){return this._pullCompositeWithRetry(e,!0)},pushComposite:function(e,t,n){var r=0,i=!1;return a(function(){return this._pushComposite(e,t,i||n)}.bind(this),{maxAttempts:6,shouldRetry:function(t){var o=this._isRetryableError(t);return!o&&t&&"INVALID_STATE"===t.code&&(o=!0,i=!0,this.logger.info("[Core:ClientStorage] pushComposite encountered INVALID_STATE, forcing push",{projectId:e.id,href:e._href,error:t})),o}.bind(this),counter_cb:function(){r++}})().then(function(e){return r>0&&this.logger.info("[Core:ClientStorage] pushComposite succeeded after retry ("+r+")"),e}.bind(this)).catch(function(t){return this._isRetryableError(t)?this.logger.warn("[Core:ClientStorage] pushComposite failed gave up after retry",{projectId:e.id,href:e._href,error:t}):!t||"UPDATE_CONFLICT"!==t.code&&"EXCEEDS_QUOTA"!==t.code?this.logger.error("[Core:ClientStorage] pushComposite failed not retryable",{projectId:e.id,href:e._href,error:t}):"EXCEEDS_QUOTA"===t.code?this.logger.warn("[Core:ClientStorage] pushComposite failed not retryable EXCEEDS_QUOTA",{projectId:e.id,href:e._href,error:t}):this.logger.info("[Core:ClientStorage] pushComposite encountered "+t.code,{projectId:e.id,href:e._href,error:t}),s.trackEvent("core:dcxClientSaveFailure",{},"core:storage"),o.reject(t)}.bind(this))},_pushComposite:function(e,t,n){var r=o.defer();e.href||(e.href=this.dcxSession.getHrefForComposite(e,t));this.dcx.compositeXfer.pushComposite(e,!!n,this.dcxSession,function(t,o){if(t)r.reject(t);else{var n=e.acceptPush();r.resolve(n)}}.bind(this));return r.promise},_convertCanvas:function(e){var t=o.defer();return e.canvas.toBlob(function(e){var o=URL.createObjectURL(e),n=document.createElement("img");n.onload=function(){t.resolve({blob:e,url:o,img:this})},n.onerror=function(){URL.revokeObjectURL(o),t.reject(new Error("StorageDCXUtilsMixin::_convertCanvas::newImage::onerror"))},n.src=o}.bind(this)),t.promise},pushCanvasComponent:function(e,t,o,n){return this._convertCanvas(e.copyFrom).then(function(r){return delete e.copyFrom,e.file=r.blob,this.pushComponent(e,t,o,n)}.bind(this))},_dataURLtoBlob:function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):window.unescape(e.split(",")[1]);for(var o=e.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return new Blob([n],{type:o})},pushDataUrlComponent:function(e,t,o,n){return e.file=this._dataURLtoBlob(e.copyFrom.url),delete e.copyFrom,this.pushComponent(e,t,o,n)},pushComponentWithoutRetry:function(e,t,o,n){return this._pushComponent(e,t,o,n)},pushComponent:function(e,t,n,r){var i=0;return a(this._pushComponent.bind(this,e,t,n,r),{maxAttempts:6,shouldRetry:this._isRetryableError,counter_cb:function(){i++}})().then(function(e){return i>0&&this.logger.info("[Core:ClientStorage] pushComponent succeeded after retry ("+i+")"),e}.bind(this)).catch(function(e){return this._isRetryableError(e)?this.logger.warn("[Core:ClientStorage] pushComponent failed gave up after retry",{projectId:t.id,href:t._href,error:e}):e&&"EXCEEDS_QUOTA"===e.code?this.logger.warn("[Core:ClientStorage] pushComponent failed not retryable EXCEEDS_QUOTA",{projectId:t.id,href:t._href,error:e}):e&&0===e.readyState?this.logger.info("[Core:ClientStorage] pushComponent failed readyState zero",{projectId:t.id,href:t._href,error:e,statusText:e.statusText}):e&&!0===e.isDownloadErr?this.logger.info("[Core:ClientStorage] pushComponent failed due to download failure",{projectId:t.id,href:t._href,error:e}):this.logger.error("[Core:ClientStorage] pushComponent failed not retryable",{projectId:t.id,href:t._href,error:e}),s.trackEvent("core:dcxClientSaveFailure",{},"core:storage"),o.reject(e)}.bind(this))},_pushComponent:function(e,t,n,r){var i,s,a,c,h=o.defer();try{if(i=e.copyFrom){if("canvas"===i.source)return this.pushCanvasComponent(e,t,n,r);if("dataUrl"===i.source)return this.pushDataUrlComponent(e,t,n,r)}if(s=e.cover,c=function(o,n){if(o)return o.isDownloadErr?415===o.status||404===o.status||410===o.status?this.logger.warn("Upload warning in download with"+o.message,o):this.logger.error("Upload failed in download with "+o.message,o):this.logger.error("Upload failed with "+o,o),h.reject(o);try{var i=t.current;if(r){var s=e.absolutePath||"/"+e.path;a=i.getComponentWithAbsolutePath(s),a=i.updateComponentWithUploadResults(a,n),h.resolve(a)}else a=i.addComponentWithUploadResults(e.name,e.relationship,e.path,e.parent||i.rootNode,n),h.resolve(a)}catch(t){this.logger.error("[Core:ClientStorage] uploadComplete error in _pushComponent:"+e.path+" "+e,{err:t}),t.uploadResults=n,h.reject(t)}}.bind(this),r){var l=e.absolutePath||"/"+e.path;if(a=t.current.getComponentWithAbsolutePath(l))i?this.transload(t,a,i,c):s?this.uploadCover(t,a,s,c):this.dcx.compositeXfer.uploadComponent(a,e.file,t,this.dcxSession,c);else{var u="null component in pushComponent:"+e.path+" "+e;this.logger.error(u),h.reject(new Error(u))}}else i?this.transload(t,e.id,i,c):s?this.uploadCover(t,e.id,s,c):this.dcx.compositeXfer.uploadNewComponent(e.file,e.type,t,e.id,this.dcxSession,c)}catch(e){this.logger.error("unexpected error caught in pushComponent",{err:e}),h.reject(e)}return h.promise},transload:function(o,n,i,s){var a,c,h,l=i.source;"string"==typeof n?h=n:n?(c=n,h=n.id):h=this.AdobeDCXUtil.generateUuid();switch(l){case"dooplo":a=i.assetId.replace(/^https?\:\/\/[^\.]*\.adobe\.io\/api\/v1\/assets\/([^\/]*)\/.*$/,"$1");break;case"dropbox":a=i.assetId.replace(/^https?\:\/\/[^\/]*\/db_files\/(.*)$/,"$1");break;case"lightroom":a=i.assetId.replace(/^https?\:\/\/[^\/]*\/lr_files\/(.*)$/,"$1");break;case"cc":a=i.assetId.replace(/^https?\:\/\/[^\/]*\/files\/(.*)$/,"$1");break;case"google drive":a=i.assetId,l="googleDrive";break;case"google photos":a=i.assetId,l="google";break;case"facebook":a=i.assetId,l="facebook";break;case"cp":a=i.assetId;break;default:if(!l){var u=new Error("falsy imageSource in transload: "+l);return this.logger.error(u.message,{err:u,composite:o,copyFrom:i}),s(u)}a=i.assetId}var d={asset_id:a,path:o.href.replace(/^https?\:\/\/[^\.]*\.adobe\.io\/([^\#\?]*)([^\#]*)(.*)$/,"$1")+"/"+h,allowedTypes:["image/png","image/jpeg"]},p=this.AdobeDCXUtil.generateUuid(),f={method:"PUT",url:"/transload/"+l,dataType:"json",data:d,beforeSend:function(e){e.setRequestHeader("X-Request-Id",p)},success:function(e,t,n){if(200!=n.status)return s(new Error("Transload came back with "+n.status+" "+n.responseText));var r=new this.AdobeDCXComponent._UploadResults(o.id);r.records[h]=new this.AdobeDCXComponent._UploadRecord(h,n.getResponseHeader("etag"),n.getResponseHeader("x-latest-version"),e.md5,e.size,e.type),s(null,r)}.bind(this),error:function(e){try{var o=JSON.parse(e.responseText||e.response);e.isDownloadErr=o.isDownloadErr,e.message=o.error,e.imageService=l}catch(o){t.extend(e,{data:d,url:"/transload/"+l,requestId:p}),this.logger.error("Bad error response in transload",e)}return r.checkIsOffline(),s(e)}.bind(this)};c&&(f.headers={"If-Match":c.etag}),e.ajax(f)},upload:function(t,o,n,i){var s;s=n?n.id:this.AdobeDCXUtil.generateUuid();var a=new FormData;a.append("path",o.href.replace(/^https?\:\/\/[^\.]*\.adobe\.io\/([^\#\?]*)([^\#]*)(.*)$/,"$1")+"/"+s),a.append("file",t);var c={method:"PUT",url:"/transload/font",dataType:"json",data:a,processData:!1,contentType:!1,success:function(e,t,n){if(200!=n.status&&201!=n.status)return i(new Error("Upload came back with "+n.status+" "+n.responseText));var r=new this.AdobeDCXComponent._UploadResults(o.id);r.records[s]=new this.AdobeDCXComponent._UploadRecord(s,n.getResponseHeader("etag"),n.getResponseHeader("x-latest-version"),e.md5,e.size,e.type),i(null,r)}.bind(this),error:function(e){return r.checkIsOffline(),i(e)}.bind(this)};n&&(c.headers={"If-Match":n.etag}),e.ajax(c)},uploadCover:function(t,o,n,r){var i,s;s="string"==typeof o?o:o?(i=o).id:n.target.split("/")[1];var a={method:"POST",url:"/cover",dataType:"json",data:{source_path:n.source,target_path:n.target,x:n.x,y:n.y,type:n.type},success:function(e,o,n){if(200!=n.status)return r(new Error("Cover came back with "+n.status+" "+n.responseText));var i=new this.AdobeDCXComponent._UploadResults(t.id);i.records[s]=new this.AdobeDCXComponent._UploadRecord(s,n.getResponseHeader("etag"),n.getResponseHeader("x-latest-version"),e.md5,e.size,e.type),r(null,i)}.bind(this),error:function(e){return r(e)}};i&&(a.headers={"If-Match":i.etag}),e.ajax(a)},_stripEtag:function(e){return e&&0===e.indexOf('"')&&(e=e.substring(1)),e&&e.indexOf('"')===e.length-1&&(e=e.substring(0,e.length-1)),e},_privateGetComponentHref:function(e,t){return o.resolve(this._dep_getComponentHref(t,e,!1,{}))},getComponentRenditionHref:function(e,t,n,r){return o.resolve(this._dep_getComponentHref(t,e,!0,{size:n,mime:r}))},_dep_getComponentHref:function(e,t,o,n){var r,i;e instanceof String||"string"==typeof e?(i=e,r=t.current.getComponentWithAbsolutePath(i)):i="/"+(r=e).path;var s=this.dcxSession.getComponentHref(r);if(o){s=(s=(s=s.replace(this.storageServer,window.location.host)).replace(/\/assets/,"/image_assets")).replace(/^(https?\:\/\/[^\/]+\/image_assets\/[^\/]+\/[^\/]+)\/.*$/,"$1"+i+"?asset_id="+r.id+"&img_etag="+this._stripEtag(r.etag));for(var a in n)if(n.hasOwnProperty(a)&&void 0!==n[a]){var c=n[a];s+="&"+encodeURIComponent(a)+"="+encodeURIComponent(c)}}return s},getComponent:function(e,t){var n,i,s=o.defer();return e instanceof this.AdobeDCXComponent?i="/"+(n=e).path:(i=e,n=t.current.getComponentWithAbsolutePath(i)),n?this.dcxSession.getComponent(n,"text",function(e,t){return e?(r.checkIsOffline(),s.reject(e)):200!=t.statusCode?s.reject(new Error("Response for component "+i+" was "+t.statusCode)):void s.resolve(t.responseText)}.bind(this)):s.resolve(),s.promise}}}.apply(t,n))||(e.exports=r)},896:function(e,t,o){var n,r;n=[o(1),o(0),o(3),o(255),o(6),o(5)],void 0===(r=function(e,t,o,n,r,i){"use strict";return{ensureSyncGroup:function(e,t){return e?this.storageReady().then(function(){var n=o.defer();return this.onceEnabled(function(){this._ensureSyncGroup(e,n,t),this._watchSyncGroups()}.bind(this)),n.promise}.bind(this)):(this.logger.error("ensureSyncGroup called with empty syncGroupName",{}),void window.marvel.events.trigger("service-borked"))},_watchSyncGroups:function(){this._watching||(this._watching=!0,this._onWatchTimer=this._onWatchTimer.bind(this),this._startSyncWatch())},_clearSyncWatch:function(){return!!this.watchTimeout&&(clearTimeout(this.watchTimeout),this.watchTimeout=null,!0)},_startSyncWatch:function(){this._syncAgain?(!0!==this._syncAgain&&(this._targetSyncGroup=this._syncAgain),this._syncAgain=!1,t.defer(this._onWatchTimer)):this.watchTimeout=setTimeout(this._onWatchTimer,this.WATCH_INTERVAL)},_onWatchTimer:function(){if(this._clearSyncWatch(),this.syncMode!==this.MODE_EDITOR||this._nextSyncDefer){this.syncEnter();var e=[];t.each(this.syncGroups,function(t){var n=o.defer(),i=t.get("etag");this._targetSyncGroup&&this._targetSyncGroup!==t.get("name")||(e.push(n.promise),this._getSyncGroup(t.get("name"),i,(function(e,o,s,a){e&&r.checkIsOffline(),i!==s?(t.set("etag",s),o?t.updateComposites(o.children).then((function(){n.resolve()})):n.resolve()):n.resolve()})))}.bind(this)),o.allSettled(e).then(function(){if(this.syncLeave(),this._targetSyncGroup=null,this._nextSyncDefer){var e=this._nextSyncDefer;this._nextSyncDefer=null,e.resolve()}this._startSyncWatch()}.bind(this)).done()}else this._startSyncWatch()},_queueCreateSyncGroup:function(e,t,o){this._sgCreateQueue=this._sgCreateQueue||[],this._sgCreateQueue.push({name:e,defer:t,factory:o}),this._createSyncGroups()},_getJSONResultFromResponse:function(e){var t=e.responseText||e.response;return JSON.parse(t)},_createSyncGroups:function(){var e,o,n;this._sgCreating||(this._sgCreating=!0,(n=this._sgCreateQueue.pop())?(o=this.AdobeDCXUtil.appendPathElements(this.dcxSession._server,"assets",n.name),this.dcxSession._service.invoke("PUT",o,{},void 0,void 0,function(o,i){if(o){!navigator.onLine?this.logger.warn("Failed to ensure Sync Group: "+n.name+" because we were offline",{error:o,msgIn:o.message}):i?this.logger.error("Failed to ensure Sync Group: "+n.name+" with response",{error:o,msgIn:o.message,statusCode:i.statusCode}):this.logger.error("Failed to ensure Sync Group: "+n.name+" likely CORS or service failure",{error:o,msgIn:o.message}),n.defer.reject(o),r.checkIsOffline()}else{var s=this._getJSONResultFromResponse(i);e=new this.SyncGroupModel(s,n.factory),this._addSyncGroup(n.name,e)}this.syncLeave(),n.defer.resolve(e),this._sgCreating=!1,t.defer(this._createSyncGroups)}.bind(this))):this._sgCreating=!1)},_addSyncGroup:function(e,t){this.syncGroups[e]=t},_getSyncGroup:function(e,t,o){this.dcxSession.getSyncGroup(e,t,o)},_sgConstructor:function(e,t,o){if(window._sgPreload&&window._sgPreload[e]){var n=new this.SyncGroupModel(JSON.parse(window._sgPreload[e]),o);this._addSyncGroup(e,n),t.resolve(n)}else this.syncEnter(),this._getSyncGroup(e,void 0,function(n,i,s,a){var c;if(n&&r.checkIsOffline(),!i)return this._queueCreateSyncGroup(e,t,o);c=new this.SyncGroupModel(i,o),this._addSyncGroup(e,c),this.syncLeave(),t.resolve(c)}.bind(this))},_ensureSyncGroup:function(t,o,n){if(this.syncGroups[t])o.resolve(this.syncGroups[t]);else if(i.hasFeature("enable-spark-storage-server")||i.hasFeature("enable-odb")||window._sgPreloadUnauth&&(window._sgPreloadUnauth=!1,r.requiresAuth().then((function(){e("head").append('<script src="/sp-storage/organizer?u='+Math.round(1e3*Math.random())+'"><\/script>')})).catch((function(e){window.marvel.logger.error("[Client:Storage] unexpected error awaiting auth before reloading preloader",e)})).done()),window._sgPreload)this._sgConstructor(t,o,n);else{var s=!1,a=function(){s=!0,window.marvel.logger.warn("[Client:Storage] organizer preloader timed out after 90s"),this._sgConstructor(t,o,n)}.bind(this),c=window.setTimeout(a,9e4);window.marvel.events.on("sg-preload-ready",function(){s||(window._sgPreloadUnauth&&!window._sgPreloaderUnauthRetry?(window.clearTimeout(c),c=window.setTimeout(a,9e4),i.hasFeature("enable-spark-storage-server")||i.hasFeature("enable-odb")||(window._sgPreloaderUnauthRetry=!0,window._sgPreloadUnauth=!1,r.requiresAuth().then((function(){e("head").append('<script src="/sp-storage/organizer?u='+Math.round(1e3*Math.random())+"><\/script>")})).catch((function(e){window.marvel.logger.error("[Client:Storage] unexpected error awaiting auth before re-reloading preloader",e)})).done())):(window.clearTimeout(c),this._sgConstructor(t,o,n)))}.bind(this))}}}}.apply(t,n))||(e.exports=r)},897:function(e,t,o){var n,r;n=[o(2830)],void 0===(r=function(e){return{DCXRetryCodes:function(){return[e.NETWORK_ERROR,e.RETRYABLE_SERVER_ERROR,e.TIMED_OUT,e.UNEXPECTED_RESPONSE,e.COMPONENT_DOWNLOAD_ERROR,e.COMPONENT_UPLOAD_ERROR,e.UNEXPECTED,e.NO_COMPOSITE]}}}.apply(t,n))||(e.exports=r)},988:function(e,t,o){var n;void 0===(n=function(e,t,o){"use strict";function n(e,t,o){Error.call(this),this.code=e,this.message="["+e+"] "+t,this.underlyingError=o}n.prototype=new Error,n.prototype.name="AdobeDCXError",delete n.prototype.stack,n.INVALID_JSON="INVALID_JSON",n.READ_ONLY="READ_ONLY",n.INVALID_PARAMS="",n.INVALID_DATA="INVALID_DATA",n.DUPLICATE_VALUE="DUPLICATE_VALUE",n.NO_LOCAL_STORAGE="NO_LOCAL_STORAGE",n.INVALID_STATE="INVALID_STATE",n.DELETED_COMPOSITE="DELETED_COMPOSITE",n.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",n.NETWORK_ERROR="NETWORK_ERROR",n.COMPONENT_DOWNLOAD_ERROR="COMPONENT_DOWNLOAD_ERROR",n.COMPONENT_UPLOAD_ERROR="COMPONENT_UPLOAD_ERROR",n.UPDATE_CONFLICT="UPDATE_CONFLICT",n.NO_COMPOSITE="NO_COMPOSITE",n.ALREADY_EXISTS="ALREADY_EXISTS",n.SERVICE_IS_INACTIVE="SERVICE_IS_INACTIVE",n.EXCEEDS_QUOTA="EXCEEDS_QUOTA",n.NOT_IMPLEMENTED="NOT_IMPLEMENTED",n.RETRYABLE_SERVER_ERROR="RETRYABLE_SERVER_ERROR",n.TIMED_OUT="TIMED_OUT",n.UNEXPECTED="UNEXPECTED",n.TERMINATED_INPUTSTREAM="TERMINATED_INPUTSTREAM",n.WRONG_ENDPOINT="WRONG_ENDPOINT",n.OUT_OF_SPACE="ENOSPC";var r={};return r[n.SERVICE_IS_INACTIVE]=1,r[n.NOT_IMPLEMENTED]=1,r[n.EXCEEDS_QUOTA]=1,r[n.RETRYABLE_SERVER_ERROR]=1,r[n.TIMED_OUT]=1,r[n.TERMINATED_INPUTSTREAM]=1,r[n.WRONG_ENDPOINT]=1,r[n.OUT_OF_SPACE]=1,n.wrapError=function(e,t,o,i){if(!o||!r[o.code]){if(i){var s=i.statusCode;s>=500&&s<600&&(501===s?(e=n.NOT_IMPLEMENTED,t="Unimplemented request"):507===s?(e=n.EXCEEDS_QUOTA,t="Quota exceeded"):(e=n.RETRYABLE_SERVER_ERROR,t="Server error"))}o=new n(e,t,o)}return i&&(o.response=i),o},n.networkError=function(e,t,o){return n.wrapError(n.NETWORK_ERROR,e,t,o)},n.unexpectedResponse=function(e,t,o){return n.wrapError(n.UNEXPECTED_RESPONSE,e,t,o)},n}.call(t,o,t,e))||(e.exports=n)}}]);
//# sourceMappingURL=m-storage-916d1868.js.map