(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[10],{"5YbD":function(e,t,n){n("oAGj")},"7siz":function(e,t,n){var r,o,i=t,a=n("oAGj"),l=n("McK+"),s=n("90dd"),u=n("ZoS2");i.IEditorModel=a.defineProtocol("IEditorModel",{attributes:"IAttributesModel",handles:"IHandlesModel",activeSwap:"IActiveSwapModel",snapLines:"ISnapLinesModel",featureSets:"IFeatureSetsModel"}),i.IMutableEditorModel=a.defineProtocol("IMutableEditorModel",{attributes:"AttributesState",handles:"HandlesState",activeSwap:"ActiveSwapState",snapLines:"SnapLinesState",featureSets:"FeatureSetsState"}),i.EditorModel=(r=function(){this.updateDepth_=0,this.state_=new l.EditorModelState,this.startingState_=new l.EditorModelState,u.TheoPublishingObject.call(this)},a.defineClass({name:"EditorModel",ctor:r,superName:"TheoPublishingObject",statics:{_implements:function(e){return"IEditorModel"==e||"TheoMessagePublisher"==e}},props:{attributes:{get:function(){return this.state_.attributes}},handles:{get:function(){return this.state_.handles}},activeSwap:{get:function(){return this.state_.activeSwap}},snapLines:{get:function(){return this.state_.snapLines}},featureSets:{get:function(){return this.state_.featureSets}},mutable:{get:function(){return this.state_}},beginUpdates:function(){this.updateDepth_+=1,1==this.updateDepth_&&(this.startingState_=this.state_.clone()),this.state_.mutable=!0},updatesComplete:function(){if(this.updateDepth_-=1,0==this.updateDepth_){this.state_.mutable=!1;var e=a.clone(this.state_.calculateChanges(this.startingState_));e.length>0&&this.publish(new i.EditorModelChangedMessage(this,a.clone(e)))}}}}),r),i.EditorModelChangedMessage=(o=function e(t,n){this.changes=a.clone(n),s.TheoMessage.call(this,e.TYPE,t)},a.defineClass({name:"EditorModelChangedMessage",ctor:o,superName:"TheoMessage",statics:{CHG_ATTRIBUTE_PREFIX:"attribute:",CHG_HANDLES:"handles",CHG_SWAP_STATE:"swapState",CHG_SNAPLINES:"snaplines",CHG_FEATURE_SET_PREFIX:"feature-set:",TYPE:"EditorModelChangedMessage"}}),o)},Cl7N:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("7siz");o.ISnapLinesModel=i.defineProtocol("ISnapLinesModel",{getAll:"() -> Array<AlignmentLine>"}),o.SnapLinesState=(r=function(e){void 0===e&&(e=null),this.snaplines=i.clone(e||[])},i.defineClass({name:"SnapLinesState",ctor:r,superName:"EditorStateMember",statics:{_implements:function(e){return"ISnapLinesModel"==e}},props:{clone:function(){return new r(i.clone(this.snaplines))},getAll:function(){return this.snaplines},clear:function(){this.setAll([])},setAll:function(e){this.beforeChange(),this.snaplines=i.clone(e),this.afterChange()},diff:function(e){if(e.snaplines.length!=this.snaplines.length)return[a.EditorModelChangedMessage.CHG_SNAPLINES];for(var t=i.iter(i.range(0,this.snaplines.length,!1));!t.done;t.next()){var n=t.value;if(!e.snaplines.includes(this.snaplines[n]))return[a.EditorModelChangedMessage.CHG_SNAPLINES]}return[]}}}),r)},DjTP:function(e,t,n){var r,o,i=t,a=n("oAGj"),l=n("cZuM"),s=n("SpAV"),u=n("gXiO"),c=n("FNB+"),h=n("iCxV"),f=n("fdtz"),m=n("c+uM"),p=n("tGKA"),d=n("8t9B"),g=n("ThKb"),v=n("oKlP"),C=n("sIWg"),S=n("1NAc"),y=n("zjY7");i.SpringConstraint=(r=function(e,t,n,r,o,i,a){this.nodeA=e,this.nodeB=t,this.pinA=n,this.pinB=r,this.vertical=o,this.length=i,this.stiffness=a,this.oldLengthDebug=0,this.oldStiffnessDebug=0,this.proportional=!1},a.defineClass({name:"SpringConstraint",ctor:r}),r),i.SpringLayoutController=(o=function(e){this.parentNode_=null,this.springConstraints_={},this.debugPrint_=!1,this.STRONG_STIFF=9e4,this.STRUT_STIFF=9e7,this.ITERATION_STEP_SIZE=50,this.SPACER_UPDATE_THRESHOLD=50,this.LOGISTIC_L_SCALE=1e3,this.LOGISTIC_K_SCALE=.01,this.LOGISTIC_X_SCALE=100,this.LOGISTIC_B_SCALE=1,this.SPACER_LOGISTIC_L=.5,this.SPACER_LOGISTIC_K=1,this.SPACER_LOGISTIC_X=0,this.SPACER_LOGISTIC_B=10,this.NODE_LOGISTIC_L=1,this.NODE_LOGISTIC_K=.5,this.NODE_LOGISTIC_X=0,this.NODE_LOGISTIC_B=1,this.group_=e,u.CoreObject.call(this)},a.defineClass({name:"SpringLayoutController",ctor:o,superName:"CoreObject",statics:{_implements:function(e){return"ResizeLayoutController"==e}},props:{beginUpdateGroup:function(){if(this.oldBounds_=this.group_.bounds,null!=this.oldBounds_){var e=a.clone(this.group_.filterWithCallback((function(e){return null!=e.controller&&!e.isGridCell()&&e.kind!=f.ImageForma.KIND&&e.frame.area>1}),c.FormaTraversal.JustChildren));this.parentNode_=new y.VisualStructureDetector(a.clone(e),this.group_).inferVisualStructure();for(var t=a.iter(this.group_.filterWithCallback((function(e){return e.isTypeLockup()})));!t.done;t.next()){var n,r=t.value;(n=a.as(r.controller,d.TypeLockupController))&&n.addLineBreakConstraints()}}},endUpdateGroup:function(){for(var e=a.iter(this.group_.filterWithCallback((function(e){return e.isTypeLockup()})));!e.done;e.next()){var t,n=e.value;(t=a.as(n.controller,d.TypeLockupController))&&t.removeLineBreakConstraints()}},updateGroup:function(){var e,t,n;(e=this.oldBounds_)&&(t=this.group_.bounds)&&(n=this.solveSpringSystem(e,t))&&this.updateFormaFromStructure(n)},solveSpringSystem:function(e,t){if(null==this.parentNode_)return null;var n={};n[this.parentNode_.id]=this.parentNode_;for(var r=a.iter(this.parentNode_.descendents);!r.done;r.next()){var o=r.value;n[o.id]=o}var i=this.parentNode_.clone();this.createSpringConstraints(i),this.updateAllConstraints(i,!1);var l=[i];a.append(l,i.descendents);for(var u=a.clone(this.getForegroundLeafs(i)),c=i.frame.scaleXY(t.width/e.width,t.height/e.height,v.TheoPoint.ZERO),h=a.toInt(Math.ceil(Math.max(Math.abs(c.height-i.frame.height),Math.abs(c.width-i.frame.width))/this.ITERATION_STEP_SIZE)+1),f=a.iter(a.range(0,h,!1));!f.done;f.next()){var m=f.value;this.debugPrint_&&(a.info("\n-----------------\niteration: "+m+"\n"),this.printNodes(i),a.info("\n")),i.frame=c;for(var p=m>=h-1,d=a.iter(l);!d.done;d.next()){var g,S,b,_=d.value;if((g=_.frame)&&(S=a.as(_,y.VisualNodeGroup))&&(b=this.springConstraints_[S.id])){s.CoreAssert.isTrue(null!=n[_.origNode.id],void 0,"SpringLayoutController.solveSpringSystem","SpringLayoutController.swift",180),this.debugPrint_&&a.info("node:"+_.description+" oldFrame: "+n[_.origNode.id].frame.asIntString);for(var A=a.iter(b);!A.done;A.next()){var F=A.value,T=F[0].vertical,D=T?g.height:g.width,P=T?S.frame.minY:S.frame.minX,x=this.adjustSpringSet(a.clone(F),D,P,p,i);S.frame=T?new C.TheoRect(g.minX,g.minY,g.maxX,g.minY+x):new C.TheoRect(g.minX,g.minY,g.minX+x,g.maxY),this.setSpringStiffnesses(S,a.clone(F),a.clone(u),this.debugPrint_),this.adjustSpringsToMatchOldSize(a.clone(F),a.clone(n))&&this.setSpringStiffnesses(S,a.clone(F),a.clone(u))}}}}return this.debugPrint_&&(a.info("\n -----------------------------\n  after resize: "),this.printNodes(i)),i},adjustSpringSet:function(e,t,n,r,o){if(e.length<1)return 0;for(var i=e[0].vertical,l=0,s=0,u=a.iter(e);!u.done;u.next())l+=(S=u.value).length,s+=1/((S.proportional?1:S.stiffness)*(t/S.length));var c=t-l,f=1/s,m=c;Math.abs(c)>this.ITERATION_STEP_SIZE&&!r&&(m=c<0?-1*this.ITERATION_STEP_SIZE:this.ITERATION_STEP_SIZE);var d=f*m;this.debugPrint_&&a.info("  constraint set: "+(i?"vert":"horiz")+"  desiredL "+Math.round(t)+" currL "+Math.round(l)+" totalD "+Math.round(c)+"  currD "+Math.round(m));for(var g=0,v=a.iter(a.range(0,e.length,!1));!v.done;v.next()){var S,y=v.value;(S=e[y]).oldLengthDebug=S.length,S.oldStiffnessDebug=S.stiffness;var b=d/((S.proportional?1:S.stiffness)*(t/S.length));isNaN(b)&&(a.opt(h.Host.logging,(function(e){return e.error("nan update")})),b=0);var _=Math.max(0,S.length+b);if(S.nodeA==S.nodeB){var A=S.nodeA,F=A.frame.aspectRatio,T=n+g;if(A.frame=i?new C.TheoRect(A.frame.minX,T,A.frame.maxX,T+_):new C.TheoRect(T,A.frame.minY,T+_,A.frame.maxY),A.maintainAspectRatio&&!S.proportional&&A.parent!=o){var D=C.TheoRect.fromSize(A.frame.fitAspectRatioWithin(F));if(D.height>15){var P=this.getParentChildPin(A.frame,A.parent.frame),x=p.Matrix2D.translation(A.frame.eval(P).subtract(D.eval(P)));D=D.transform(x);var w=i?A.frame.height-D.height:A.frame.width-D.width;A.frame=D;var I=S.vertical?P.y:P.x;.5==I?(e[y-1].length+=w/2,e[y+1].length+=w/2):0==I?e[y+1].length+=w:1==I&&(e[y-1].length+=w),_=i?D.height:D.width}}}S.length=_,g+=_}return g},adjustSpringsToMatchOldSize:function(e,t){for(var n=!1,r=a.iter(a.range(1,e.length-1,!1));!r.done;r.next()){var o=r.value,i=e[o];if(i.nodeA==i.nodeB&&!i.proportional){var l=i.nodeA,s=t[l.origNode.id].frame,u=l.frame;if(s.area-u.area>0){var c=e[o-1],h=e[o+1],f=.2*Math.max(c.length,h.length);if(f<10)continue;var m=i.vertical?u.height:u.width,p=s.area/(i.vertical?u.width:u.height)-m;Math.abs(p)>f&&(p=p<0?-1*f:f);var d=1/(1/c.stiffness+1/i.stiffness+1/h.stiffness)*p,g=d/c.stiffness,v=c.length;c.length-g>this.SPACER_UPDATE_THRESHOLD&&(c.length=Math.max(1e-4,c.length-g));var C=d/h.stiffness,S=h.length;h.length-C>this.SPACER_UPDATE_THRESHOLD&&(h.length=Math.max(1e-4,h.length-C));var y=i.length;i.length=i.length+(v-c.length)+(S-h.length),n=n||Math.abs(y-i.length)>0}}}return n},createSpringConstraints:function(e){this.springConstraints_={};for(var t=a.clone(this.getForegroundLeafs(e)),n=[e];n.length>0;){var r,o=n[0];n.splice(0,1),(r=a.as(o,y.VisualNodeGroup))&&(this.springConstraints_[r.id]=this.createSpringConstraintsForGroup(r,!1,a.clone(t)).concat(this.createSpringConstraintsForGroup(r,!0,a.clone(t))),n=r.children.concat(n))}},updateAllConstraints:function(e,t){void 0===e&&(e=null),void 0===t&&(t=!1);for(var n=null!=e?e:this.parentNode_,r=[n],o=a.clone(this.getForegroundLeafs(n));r.length>0;){var i,l,s=r[0];if(r.splice(0,1),(i=a.as(s,y.VisualNodeGroup))&&(l=this.springConstraints_[i.id])){for(var u=a.iter(l);!u.done;u.next()){var c=u.value;this.setSpringStiffnesses(i,a.clone(c),a.clone(o),t)}r=i.children.concat(r)}}},printNodes:function(e){for(var t=[e],n=[];t.length>0;){var r,o=t[0];if(t.splice(0,1),(C=a.as(o,y.VisualNodeGroup))&&(r=this.springConstraints_[C.id])){for(var i=a.iter(r);!i.done;i.next())for(var l=i.value,s=a.iter(l);!s.done;s.next()){var u=s.value;if(u.nodeA==u.nodeB){var c=this.getNodeStiffness(u.nodeA,u.vertical);n.push({node:u.nodeA,vertical:u.vertical,stiffness:c})}}t=C.children.concat(t)}}for(var h=[],f={},m=a.iter(n);!m.done;m.next())if(c=m.value,!h.includes(c.node)){for(var p="",d=(o=c.node).parent;null!=d;)d=a.opt(d,(function(e){return e.parent})),p+="\t";p+="node: "+o.description;for(var g=a.iter(n);!g.done;g.next()){var v=g.value;v.node==o&&(p+=(v.vertical?" v: ":" h: ")+a.toString(Math.round(v.stiffness)))}f[o.shortID]=p,h.push(o)}for(t=[e];t.length>0;){var C,S;o=t[0],t.splice(0,1),(C=a.as(o,y.VisualNodeGroup))&&(t=C.children.concat(t)),this.debugPrint_&&null!=(S=f[o.shortID])&&a.info(S)}},setConstraintsOnNode:function(e,t,n,r,o){var i,l=o?e.frame.minY:e.frame.minX,s=(o?e.frame.maxY:e.frame.maxX)-l,u=o?t.frame.minY:t.frame.minX,c=(o?t.frame.maxY:t.frame.maxX)-u,h=!1,f=!1,m=!1;n<.1*s&&(h=!0),r<.1*s&&(f=!0),(i=a.as(t,y.VisualNodeLeaf))&&(i.forma.isTypeLockup()?c>.66*s&&(h=!0,f=!0):Math.abs(n-r)<=1&&n<.25*s&&(h=!0,f=!0)),h&&f||(m=!0),o?(t.constraintBottom=h,t.constraintTop=f,t.constraintHeight=m):(t.constraintLeft=h,t.constraintRight=f,t.constraintWidth=m)},getContextualSpacerLength:function(e,t,n){var r,o=e.vertical,i=e.nodeA==t?e.nodeB:e.nodeA,l=e.length,u=!1,c=[];null!=(m=a.as(i,y.VisualNodeLeaf))&&(u=m.hasForegroundRole,c=[m]),(r=a.as(i,y.VisualNodeGroup))&&(u=(c=a.clone(this.getForegroundLeafs(r))).length>0);for(var h=n.concat(),f=a.iter(c);!f.done;f.next()){var m=f.value;h.includes(m)&&a.remove(h,m)}if(u){var p=C.TheoRect.Zero;if(o){var d=e.nodeA.frame.horizontalLine(e.pinA).p1.y,g=e.nodeB.frame.horizontalLine(e.pinB).p1.y;p=new C.TheoRect(i.frame.minX,d,i.frame.maxX,g)}else{var v=e.nodeA.frame.verticalLine(e.pinA).p1.x,S=e.nodeB.frame.verticalLine(e.pinB).p1.x;p=new C.TheoRect(v,i.frame.minY,S,i.frame.maxY)}for(var b=a.iter(h);!b.done;b.next()){m=b.value,s.CoreAssert.isTrue(i!=m,void 0,"SpringLayoutController.getContextualSpacerLength","SpringLayoutController.swift",682);for(var _,A=!1,F=a.iter(c);!F.done;F.next()){var T=F.value;(m.forma.finalFrame.xDistance(T.forma.finalFrame)<=0&&!o||m.forma.finalFrame.yDistance(T.forma.finalFrame)<=0&&o)&&(A=!0)}A||(_=a.opt(m.frame,(function(e){return e.intersectionWith(p)})))&&(l=Math.min(l,_.L1Distance(i.frame)))}}return l},setSpringStiffnesses:function(e,t,n,r){if(void 0===r&&(r=!1),0!=t.length){var o=t[0].vertical,i=o?e.frame.minY:e.frame.minX,l=(o?e.frame.maxY:e.frame.maxX)-i;if(3==t.length){s.CoreAssert.isTrue(t[1].nodeA==t[1].nodeB,void 0,"SpringLayoutController.setSpringStiffnesses","SpringLayoutController.swift",720);var u=t[1].nodeA,c=this.getContextualSpacerLength(t[0],e,a.clone(n)),f=this.getContextualSpacerLength(t[2],e,a.clone(n));u.resetConstraints(o),u instanceof y.VisualNodeLeaf&&this.setConstraintsOnNode(e,u,c,f,o);var m=o?u.constraintBottom:u.constraintLeft,p=o?u.constraintHeight:u.constraintWidth,d=o?u.constraintTop:u.constraintRight;t[0].stiffness=m?this.STRONG_STIFF:this.getSpacerStiffness(c,l,o),t[1].stiffness=p?this.STRONG_STIFF:this.getNodeStiffness(u,o),t[2].stiffness=d?this.STRONG_STIFF:this.getSpacerStiffness(f,l,o),(0==t[0].stiffness||isNaN(t[0].stiffness)||0==t[1].stiffness||isNaN(t[1].stiffness)||0==t[2].stiffness||isNaN(t[2].stiffness))&&a.opt(h.Host.logging,(function(e){return e.error("error in spring stiffness")}))}else for(var g=a.iter(t);!g.done;g.next())(b=g.value).nodeA==b.nodeB?b.stiffness=this.getNodeStiffness(b.nodeA,b.vertical):b.stiffness=this.getSpacerStiffness(b.length,l,b.vertical),(0==b.stiffness||isNaN(b.stiffness))&&a.opt(h.Host.logging,(function(e){return e.error("error in spring stiffness")}));for(var v=a.iter(t);!v.done;v.next())(b=v.value).length<1&&(b.stiffness=this.STRUT_STIFF);for(var C=!1,S=a.iter(t);!S.done;S.next()){var b=S.value;Math.abs(b.oldLengthDebug-b.length)>1&&(C=r)}if(C)for(var _=a.iter(t);!_.done;_.next()){var A=_.value,F=A.vertical?"vert":"horiz";a.info("\t A:"+A.nodeA.shortID+" B:"+A.nodeB.shortID+" "+F+" oldK:"+Math.round(A.oldStiffnessDebug)+"  newK:"+Math.round(A.stiffness)+" oldL:"+Math.round(A.oldLengthDebug)+"  newL:"+Math.round(A.length)+"  ")}}},createFlowSpringConstraints:function(e,t){s.CoreAssert.isTrue(e.children.length>1,void 0,"SpringLayoutController.createFlowSpringConstraints","SpringLayoutController.swift",806);var n=t?e.frame.minY:e.frame.minX,r=t?e.frame.maxY:e.frame.maxX,o=r-n,l=a.sort(e.children,(function(e,n){return t?e.frame.minY<n.frame.minY:e.frame.minX<n.frame.minX})),u=[],c=t?l[0].frame.minY:l[0].frame.minX,h=(b=t?l[l.length-1].frame.maxY:l[l.length-1].frame.maxX)-c,f=Math.max(c-n,0),m=Math.max(r-b,0),p=Math.max(n-c,0)/h,d=Math.max(b-r,0)/h;u.push(new i.SpringConstraint(e,l[0],0,p,t,f,this.getSpacerStiffness(f,o,t)));for(var g=!1,v=a.iter(a.range(0,l.length,!1));!v.done;v.next()){var C=v.value;g=g||l[C].bgConstraint;var S=t?l[C].frame.minY:l[C].frame.minX,y=t?l[C].frame.maxY:l[C].frame.maxX;if(u.push(new i.SpringConstraint(l[C],l[C],0,1,t,y-S,this.getNodeStiffness(l[C],t))),C<l.length-1){var b=t?l[C].frame.maxY:l[C].frame.maxX,_=t?l[C+1].frame.minY:l[C+1].frame.minX,A=Math.abs(b-_);u.push(new i.SpringConstraint(l[C],l[C+1],1,0,t,A,this.getSpacerStiffness(A,o,t)))}}u.push(new i.SpringConstraint(l[l.length-1],e,d,1,t,m,this.getSpacerStiffness(m,o,t)));for(var F=a.iter(u);!F.done;F.next())F.value.proportional=g;for(var T=0,D=a.iter(u);!D.done;D.next())T+=D.value.length;return Math.abs(o-T)>1&&s.CoreAssert.fail("constraint length failure","SpringLayoutController.createFlowSpringConstraints","SpringLayoutController.swift",874),u},createParentSpringConstraints:function(e,t,n,r){var o=n?e.frame.minY:e.frame.minX,l=n?e.frame.maxY:e.frame.maxX,s=n?t.frame.minY:t.frame.minX,u=n?t.frame.maxY:t.frame.maxX,c=[],h=Math.max(s-o,0),f=Math.max(l-u,0),m=Math.abs(h-f)/(l-o);if(m<.05&&m>0){var p=(h+f)/2;h=p,f=p}c.push(new i.SpringConstraint(e,t,0,0,n,h,1)),c.push(new i.SpringConstraint(t,t,0,1,n,u-s,1)),c.push(new i.SpringConstraint(t,e,1,1,n,f,1));for(var d=a.iter(c);!d.done;d.next())d.value.proportional=t.bgConstraint;return this.setSpringStiffnesses(e,a.clone(c),a.clone(r)),c},createSpringConstraintsForGroup:function(e,t,n){if(e.layoutStrategy==y.GroupLayoutStrategy.VerticalFlow&&t||e.layoutStrategy==y.GroupLayoutStrategy.HorizontalFlow&&!t)return[this.createFlowSpringConstraints(e,t)];for(var r=[],o=a.iter(e.children);!o.done;o.next()){var i=o.value;r.push(a.clone(this.createParentSpringConstraints(e,i,t,a.clone(n))))}return r},getNodeStiffness:function(e,t){if((t?e.frame.height:e.frame.width)<10)return 1e6;var n,r,o=1;if(n=a.as(e,y.VisualNodeLeaf)){var i,l,s=e.frame;if((i=a.as(n.forma.controller,d.TypeLockupController))&&(l=n.forma.finalFrame)){var u=i.getAverageFontSize(),c=a.toDouble(i.numLines())/a.toDouble(i.text.split("\n").length),h=l.height/c,f=l.width*c,m=new S.TheoSize(f,h).aspectRatio,p=l.aspectRatio,g=s.fitAspectRatioWithin(m).area,v=s.fitAspectRatioWithin(p).area,C=Math.max(g,v)/l.area;o=this.getFormaStiffness(u*C)}else o=this.getFormaStiffness(s.height)}else if(r=a.as(e,y.VisualNodeGroup)){var b;if(b=this.springConstraints_[r.id]){for(var _=0,A=a.iter(b);!A.done;A.next()){var F=A.value;if(F[0].vertical==t){for(var T=1,D=1,P=a.iter(F);!P.done;P.next()){var x=P.value,w=x.nodeA==x.nodeB?this.getNodeStiffness(x.nodeA,t):x.stiffness;w<this.STRONG_STIFF&&(T+=x.length*w,D+=x.length)}_=Math.max(_,T/a.toDouble(D))}}o=0==_?1:_}}return o},getParentChildPin:function(e,t){var n=.5,r=.5;return Math.abs(e.minX-t.minX)/t.width<.1&&(n=0),Math.abs(e.maxX-t.maxX)/t.width<.1&&(n=1),Math.abs(e.center.x-t.center.x)/t.width<.1&&(n=.5),Math.abs(e.minY-t.minY)/t.height<.1&&(r=0),Math.abs(e.maxY-t.maxY)/t.height<.1&&(r=1),Math.abs(e.center.y-t.center.y)/t.height<.1&&(r=.5),new v.TheoPoint(n,r)},updateFormaFromStructure:function(e){for(var t=[],n=a.clone(e.leafDescendents),r=a.iter(n);!r.done;r.next()){var o=r.value;t.push(o.forma)}for(var i={},s=a.iter(n);!s.done;s.next()){(o=s.value).inferenceData=y.VisualNodeData.init_ff0a(o,a.clone(t));for(var u=a.iter(n);!u.done;u.next()){var c,h=u.value;o!=h&&(ne=o.forma.finalFrame)&&(c=h.forma.finalFrame)&&(i[o.forma.formaID+h.forma.formaID]=ne.intersects(c),i[h.forma.formaID+o.forma.formaID]=ne.intersects(c))}}for(var f=a.iter(e.descendents);!f.done;f.next()){var g,C,S,b=f.value;if((o=a.as(b,y.VisualNodeLeaf))&&(Y=o.frame)&&(g=o.forma.frame)&&(C=o.initFrame)&&(S=o.parent)){var _=o.forma,A=Y,F=!1;(M=a.as(o.forma.controller,d.TypeLockupController))&&1==M.numLines()&&m.LockupStyle.layoutSupportsAlignments(M.lockupStyle.layout)&&(F=!0);var T=_.placement.transformValues,D=Math.abs(T.rotCosine)/(Math.abs(T.rotCosine)+Math.abs(T.rotSine)),P=Math.abs(T.rotSine)/(Math.abs(T.rotCosine)+Math.abs(T.rotSine)),x=new v.TheoPoint(A.width/C.width,A.height/C.height),w=new v.TheoPoint(x.x*D+x.y*P,x.x*P+x.y*D);if(null!=_.controller&&_.controller.maintainAspectRatio){var I=Math.min(w.x,w.y);_.bounds=a.opt(_.bounds,(function(e){return e.scaleXY(I,I,new v.TheoPoint(0,0))}))}else _.bounds=a.opt(_.bounds,(function(e){return e.scaleXY(w.x,w.y,new v.TheoPoint(0,0))}));(M=a.as(o.forma.controller,d.TypeLockupController))&&M.snapSizeToBounds();var M,G=.5,L=.5,E=A.center.x,k=A.center.y,N=S.layoutStrategy==y.GroupLayoutStrategy.VerticalFlow&&1==S.alignments.length&&S.alignments.includes(l.AlignmentType.Left),R=S.layoutStrategy==y.GroupLayoutStrategy.VerticalFlow&&1==S.alignments.length&&S.alignments.includes(l.AlignmentType.Right);if(!(Math.abs(C.center.x-g.center.x)/C.width<.01)){var B=C.minX-g.minX,O=g.maxX-C.maxX;N=N||B>0&&O<=0,R=R||O>0&&B<=0}N?(G=(C.minX-g.minX)/g.width,E=A.minX):R&&(G=1-(g.maxX-C.maxX)/g.width,E=A.maxX),F&&(M=a.as(o.forma.controller,d.TypeLockupController))&&(M.beginBlockedUpdate(),a.opt(M.lockupStyle,(function(e){return e.layout=m.LockupLayout.Standard})),M.lockupStyle.alignment=N?m.LockupAlignment.Left:R?m.LockupAlignment.Right:m.LockupAlignment.Center,M.endBlockedUpdate(),M.styleChanged()),C.minY-g.minY>0&&(L=(C.minY-g.minY)/g.height,k=A.minY),g.maxY-C.maxY>0&&(L=1-(g.maxY-C.maxY)/g.height,k=A.maxY),_.movePinToPoint(new v.TheoPoint(G,L),new v.TheoPoint(E,k))}}for(var X=a.iter(e.descendents);!X.done;X.next()){var Y;if(b=X.value,(o=a.as(b,y.VisualNodeLeaf))&&(Y=o.forma.frame)){var z,H=null,U=1/0,K=null,V=null,j=1/0,W=null;if(z=a.opt(o.inferenceData,(function(e){return e.alignments})))for(var Z=a.iter(n);!Z.done;Z.next()){var q;if(q=z[(se=Z.value).forma.formaID])for(var J=se.forma.frame,Q=a.iter(q);!Q.done;Q.next()){var $=Q.value,ee=null;$.line.type==l.AlignmentType.Right&&(ee=Math.abs(J.maxX-Y.maxX)+.1*J.L1Distance(Y)),$.line.type==l.AlignmentType.Left&&(ee=Math.abs(J.minX-Y.minX)+.1*J.L1Distance(Y)),$.line.type==l.AlignmentType.CenterX&&(ee=Math.abs(J.center.x-Y.center.x)+.1*J.L1Distance(Y)),null!=ee&&ee<U&&$.line.line.length<600&&(U=ee,K=$.line.type,H=J);var te=null;$.line.type==l.AlignmentType.Top&&(te=Math.abs(J.minY-Y.minY)+.1*J.L1Distance(Y)),$.line.type==l.AlignmentType.Bottom&&(te=Math.abs(J.maxY-Y.maxY)+.1*J.L1Distance(Y)),$.line.type==l.AlignmentType.CenterY&&(te=Math.abs(J.center.y-Y.center.y)+.1*J.L1Distance(Y)),null!=te&&te<j&&$.line.line.length<600&&(j=te,W=$.line.type,V=J)}}var ne,re,oe=0,ie=0;if(null!=K&&K==l.AlignmentType.CenterX&&(oe=H.center.x-o.forma.frame.center.x),null!=K&&K==l.AlignmentType.Left&&(oe=H.minX-o.forma.frame.minX),null!=K&&K==l.AlignmentType.Right&&(oe=H.maxX-o.forma.frame.maxX),null!=W&&W==l.AlignmentType.CenterY&&(ie=V.center.y-o.forma.frame.center.y),null!=W&&W==l.AlignmentType.Bottom&&(ie=V.maxY-o.forma.frame.maxY),null!=W&&W==l.AlignmentType.Top&&(ie=V.minY-o.forma.frame.minY),oe=Math.min(oe,0),ie=Math.min(ie,0),(oe<0||ie<0)&&(null!=K&&o.forma.controller.setAlignmentType(K),o.forma.move(p.Matrix2D.translationXY(oe,ie)),(ne=o.forma.finalFrame)&&(re=a.opt(o.forma.parent,(function(e){return e.finalFrame}))))){for(var ae=!1,le=a.iter(n);!le.done;le.next()){var se;(se=le.value)!=o&&se.forma.finalFrame.intersects(ne)&&!i[o.forma.formaID+se.forma.formaID]&&(ae=!0)}re.contains(ne)&&!ae||o.forma.move(p.Matrix2D.translationXY(-oe,-ie))}}}this.debugPrint_&&a.info("after update: \n "+this.group_.print())},getSpacerStiffness:function(e,t,n){if(e<1)return this.STRUT_STIFF;var r=this.SPACER_LOGISTIC_L*this.LOGISTIC_L_SCALE,o=this.SPACER_LOGISTIC_K*this.LOGISTIC_K_SCALE,i=this.SPACER_LOGISTIC_X*this.LOGISTIC_X_SCALE,a=this.SPACER_LOGISTIC_B*this.LOGISTIC_B_SCALE;return r/(1+Math.pow(g.TheoMatrix.E_DOUBLE,o*(e-i)))+a},getFormaStiffness:function(e){var t=this.NODE_LOGISTIC_L*this.LOGISTIC_L_SCALE,n=this.NODE_LOGISTIC_K*this.LOGISTIC_K_SCALE,r=this.NODE_LOGISTIC_X*this.LOGISTIC_X_SCALE,o=this.NODE_LOGISTIC_B*this.LOGISTIC_B_SCALE;return t/(1+Math.pow(g.TheoMatrix.E_DOUBLE,n*(e-r)))+o},getForegroundLeafs:function(e){for(var t=[],n=a.iter(e.leafDescendents);!n.done;n.next()){var r=n.value;r.hasForegroundRole&&t.push(r)}return t}}}),o)},H9Ol:function(e,t,n){var r,o,i,a,l=t,s=n("oAGj"),u=n("0wFF"),c=n("cZuM"),h=n("XmBt"),f=n("SpAV"),m=n("yhkb"),p=n("yGNn"),d=n("ascj"),g=n("fVJ2"),v=n("dJuF"),C=n("quOg"),S=n("wNKJ"),y=n("FNB+"),b=n("6ZWm"),_=n("waL6"),A=n("yHU1"),F=n("Pil/"),T=n("cmoc"),D=n("OdB2"),P=n("P83h"),x=n("9Lk3"),w=n("ZK0l"),I=n("/afT"),M=n("pnSN"),G=n("iCxV"),L=n("fdtz"),E=n("lmwz"),k=n("c+uM"),N=n("tGKA"),R=n("3DEm"),B=n("jcfx"),O=n("KIfs"),X=n("K0Rh"),Y=n("JO5d"),z=n("Zifs"),H=n("djAF"),U=n("35Q0"),K=n("umUn"),V=n("fAXt"),j=n("8t9B"),W=n("mL0c"),Z=n("oKlP"),q=n("sIWg"),J=n("1NAc");l.ControllerMetadata=(r=function(){},o={},s.defineClass({name:"ControllerMetadata",ctor:r,superName:"DBObject",statics:{SCHEMA_CLASS_NAME:"ControllerMetadata",codec:{get:function(){return void 0===o.codec&&(o.codec=v.DBPropertyCodec.registerCodec(r.SCHEMA_CLASS_NAME,v.DBPropertyCodec.directObjectCodec(r.SCHEMA_CLASS_NAME))),o.codec}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},_implements:function(e){return"IDBObject"==e}},props:{init_866e:function(e,t){s.super_init(this,g.DBObject,g.DBObject.prototype.init_866e,e,t)},init_dd5d:function(e,t){s.super_init(this,g.DBObject,g.DBObject.prototype.init_dd5d,s.clone(e),s.clone(t))},init_d41d:function(){s.super_init(this,g.DBObject,g.DBObject.prototype.init_dd5d,{},{})},className:{get:function(){return r.SCHEMA_CLASS_NAME}}}}),r),l.FormaController=(i=function(e,t,n){this.blockedUpdate_=0,this.controllerMetadata_=null,this.kind=e,this.forma_=t,this.owner_=n},s.defineClass({name:"FormaController",ctor:i,superName:"CoreObject",props:{owner:{get:function(){return this.owner_}},forma:{get:function(){return this.forma_}},parentController:function(){for(var e=s.opt(this.forma,(function(e){return e.parent}));null!=e&&null!=e.controller;)e=e.parent;return null==e?null:e.controller},moveable:{get:function(){return null==this.forma.allowUserMove||this.forma.allowUserMove}},floating:{get:function(){return this.moveableInDirection(new Z.TheoPoint(1,0))&&this.moveableInDirection(new Z.TheoPoint(0,1))}},moveableInDirection:function(e){var t;return(t=s.as(s.opt(s.opt(this.forma,(function(e){return e.parent})),(function(e){return e.controller})),w.GroupController))?t.childMoveableInDirection(this.forma,e)&&this.moveable:this.moveable},selectable:{get:function(){return!1}},rotateable:{get:function(){return this.moveable}},replaceable:{get:function(){return!0}},deleteable:{get:function(){return!0}},duplicatable:{get:function(){return!1}},copyTo:function(e){return void 0===e&&(e=null),p.CorePromise.resolve(null)},duplicate:function(){return this.copyTo()},flippable:{get:function(){return!1}},nudgeable:{get:function(){return!1}},scalable:{get:function(){var e=this;return!s.opt(this.forma,(function(t){return null==t.parent||null!=e.forma&&x.GridController.isBackgroundColoredCell(e.forma)}))}},opacityChangeable:{get:function(){return this.moveable}},maintainAspectRatio:{get:function(){return!1}},selectionHandlePositions:{get:function(){return f.CoreAssert.isTrue(this.selectable,"this forma isn't selectable. why get the handle positions?","FormaController","FormaController.swift",154),[new Z.TheoPoint(0,0),new Z.TheoPoint(0,1),new Z.TheoPoint(1,0),new Z.TheoPoint(1,1)]}},showHandle:function(e){var t,n=this;return null!=(t=s.opt(s.opt(s.opt(this.forma,(function(e){return e.parent})),(function(e){return e.controller})),(function(t){return t.showChildHandle(n.forma,e)})))?t:this.selectionHandlePositions.includes(e)},visibleSelectionHandlePositions:{get:function(){for(var e=[],t=s.iter(this.selectionHandlePositions);!t.done;t.next()){var n=t.value;this.showHandle(n)&&e.push(n)}return e}},showChildHandle:function(e,t){var n=e.finalFrame.eval(t);return!(n.x<5||n.y<5||n.x>e.root.finalFrame.maxX-5||n.y>e.root.finalFrame.maxY-5)},alignmentDetector:{get:function(){return null==this.alignmentDetector_&&(this.alignmentDetector_=c.AlignmentDetector.init_a05b(this.forma_)),this.alignmentDetector_},set:function(e){this.alignmentDetector_=e}},getAlignments:function(e){var t;if(void 0===e&&(e=!1),t=this.forma_.bounds){f.CoreAssert.isFalse(isNaN(t.origin.x)||isNaN(t.origin.y),"forma "+this.forma_.kind+" "+(null!=this.forma_.controller?this.forma_.controller.kind:"")+" has Nan origin pt","FormaController.getAlignments","FormaController.swift",202),f.CoreAssert.isFalse(isNaN(t.size.width),"forma "+this.forma_.kind+" "+(null!=this.forma_.controller?this.forma_.controller.kind:"")+" has Nan width","FormaController.getAlignments","FormaController.swift",203),f.CoreAssert.isFalse(isNaN(t.size.height),"forma "+this.forma_.kind+" "+(null!=this.forma_.controller?this.forma_.controller.kind:"")+" has Nan height","FormaController.getAlignments","FormaController.swift",204);var n=this.forma_.kind==X.RootForma.KIND||this.forma_.isGridCell()?c.AlignmentDetector.ALIGNMENT_ROOT:c.AlignmentDetector.ALIGNMENT_FORMA,r=this.forma_.kind==X.RootForma.KIND||this.forma_.isGridCell()?c.AlignmentLocation.Root:c.AlignmentLocation.Forma,o=this.forma_.visit(y.FormaTraversal.FurthestAncestor,(function(e,t,n){return!0}));return[new c.AlignmentLine(c.AlignmentType.Left,r,n,t.verticalLine(0).transform(this.forma_.totalPlacement),!1,o),new c.AlignmentLine(c.AlignmentType.CenterX,r,n,t.verticalLine(.5).transform(this.forma_.totalPlacement),!1,o),new c.AlignmentLine(c.AlignmentType.Right,r,n,t.verticalLine(1).transform(this.forma_.totalPlacement),!1,o),new c.AlignmentLine(c.AlignmentType.Top,r,n,t.horizontalLine(0).transform(this.forma_.totalPlacement),!1,o),new c.AlignmentLine(c.AlignmentType.CenterY,r,n,t.horizontalLine(.5).transform(this.forma_.totalPlacement),!1,o),new c.AlignmentLine(c.AlignmentType.Bottom,r,n,t.horizontalLine(1).transform(this.forma_.totalPlacement),!1,o)]}return[]},addForma:function(e,t,n){var r;return(r=s.as(e.root,X.RootForma))?(t.controller.fit(r.frame.insetRel(.25,.25,.25,.25)),r.appendChild(t),p.CorePromise.resolve(null)):p.CorePromise.reject("page has no root?")},getUserPerceivedFrame:function(){for(var e,t,n,r,o=s.clone(this.getAlignments()),i=s.iter(o);!i.done;i.next()){var a=i.value;if(a.location==c.AlignmentLocation.Forma)switch(a.type){case 0:e=a.line;break;case 2:t=a.line;break;case 3:n=a.line;break;case 5:r=a.line}}var l=s.opt(this.forma,(function(e){return e.finalFrame}));if(null!=l&&(null==e&&(e=l.verticalLine(0)),null==t&&(t=l.verticalLine(1)),null==n&&(n=l.horizontalLine(0)),null==r&&(r=l.horizontalLine(1))),null!=e&&null!=t&&null!=n&&null!=r){var u=e.intersection(n),h=n.intersection(t),f=r.intersection(t),m=r.intersection(e);if(null!=u&&null!=h&&null!=f&&null!=m)return q.TheoRect.boundsOfPoints([u,h,f,m])}return s.opt(this.forma,(function(e){return e.finalFrame}))},canMultiSelect:{get:function(){return this.selectable&&this.floating}},move:function(e){var t;(t=this.forma_)&&(t.placement=t.placement.concat(e),this.updateParentGroup())},place:function(e){var t;(t=this.forma_)&&(t.placement=e,this.updateParentGroup())},flip:function(e){var t;void 0===e&&(e=!1),(t=this.forma_)&&(V.TransformFacade.flipForma(t,e),this.updateParentGroup())},rotate:function(e){var t;void 0===e&&(e=Math.PI/180),(t=this.forma_)&&(V.TransformFacade.rotateForma(t,e),this.updateParentGroup())},rotation:function(){var e;return(e=this.forma_)?e.rotation():0},nudge:function(e){var t;(t=this.forma_)&&(V.TransformFacade.translateForma(t,e),this.updateParentGroup())},fit:function(e){var t,n;(t=this.forma)&&(t.placement=N.Matrix2D.Identity,t.bounds=q.TheoRect.fromSize(e.size),(n=t.frame)&&(t.move(N.Matrix2D.uniformScaling(n.aspectRatio>=1?e.width/n.width:e.height/n.height)),t.moveCenterToPoint(e.center)),this.updateParentGroup())},fitInArea:function(e){var t,n,r;if(r=this.forma){var o=e.area,i=s.opt(r.bounds,(function(e){return e.aspectRatio})),a=Math.sqrt(i*o),l=Math.sqrt(o/i),u=s.opt(r.root,(function(e){return e.bounds})),c=s.opt(u,(function(t){return t.locatePoint(e.center)}));c=new Z.TheoPoint(R.MathUtils.nearestMultiple((t=s.opt(c,(function(e){return e.x})))||null!=t?t:.5,.5),R.MathUtils.nearestMultiple((n=s.opt(c,(function(e){return e.y})))||null!=n?n:.5,.5));var h=new q.TheoRect(0,0,a,l),f=e.evalXY(c.x,c.y);h=h.moveToPoint(f,c),r.controller.fit(h)}},clone:function(e){return new _.FormaControllerFactory(this.owner).createController(this.kind,e)},match:function(e){var t,n,r,o;if((t=this.forma)&&(n=t.bounds)&&(r=e.forma)&&(o=r.bounds)&&!n.equal(o))if(this.maintainAspectRatio&&!E.ImageFacade.isPotentialBackgroundImage(t)){var i=o.fitAspectRatioWithin(n.aspectRatio);t.bounds=q.TheoRect.fromSize(i),t.moveCenterToPoint(r.frame.center)}else t.bounds=r.bounds},postMatch:function(e){},beginBlockedUpdate:function(){this.blockedUpdate_+=1},endBlockedUpdate:function(){this.blockedUpdate_-=1},blockUpdate:{get:function(){return this.blockedUpdate_>0}},styleChanged:function(){},formaWillChangeState:function(e,t){},formaDidChangeState:function(e,t){},formaWillCommitState:function(e){},formaDidCommitState:function(e){},contentID:{get:function(){return null}},settings:{get:function(){return null}},attach:function(){},detach:function(){},controllerMetadata:{get:function(){return this.controllerMetadata_},set:function(e){this.controllerMetadata_=e,s.count(e.state.allProperties)>0&&this.decodeMetadata()}},decodeMetadata:function(){},postDecode:function(){},onEvent:function(e){this.preProcessEvent(e)||this.processEvent(e)||this.postProcessEvent(e)},preProcessEvent:function(e){return!1},processEvent:function(e){return null!=this.owner&&((t=s.as(e,F.BeginPointerTrackingEvent))?t.trackingResponse=A.BeginPointerTrackingResponseEnum.TrackWithinGroup:e instanceof F.BeginFormaDragEvent?this.processBeginFormaDrag(e):e instanceof F.EndFormaDragEvent?this.processEndFormaDrag(e):e instanceof F.FormaDragEvent?this.processFormaDrag(e):e instanceof F.FormaClickEvent?this.processFormaClick(e):e instanceof F.FormaDoubleClickEvent?this.processFormaDoubleClick(e):e instanceof F.BeginFormaResizeEvent?this.processBeginFormaResize(e):e instanceof F.FormaResizeEvent?this.processFormaResize(e):e instanceof F.EndFormaResizeEvent&&this.processEndFormaResize(e),!1);var t},processFormaDoubleClick:function(e){},processBeginFormaResize:function(e){var t,n;this.alignmentDetector_=c.AlignmentDetector.init_a05b(this.forma_),(t=s.as(s.opt(this.forma.parent,(function(e){return e.controller})),w.GroupController))&&t.beginChildResizeEvent(e),(n=s.opt(s.opt(this.owner,(function(e){return e.document})),(function(e){return e.firstPage})))&&n.publish(new D.BeginFormaResizeMessage(n))},processFormaResize:function(e){var t;if(this.clearAlignmentLines(),t=this.forma.bounds){var n=this.forma.placement.transformPoint(this.forma.bounds.eval(e.pin)),r=e.newSize.width>=0?e.newSize.width:this.forma.bounds.width,o=e.newSize.height>=0?e.newSize.height:this.forma.bounds.height,i=null!=e.pin&&(.5==e.pin.x||.5==e.pin.y),a=new J.TheoSize(r,o);i||!this.maintainAspectRatio&&e.forma.kind!=T.FrameForma.KIND||(a=this.owner.selection.inCropMode?t.size.myAspectRatioFitWithin(a):t.size.myAspectRatioClosestCorner(a));var l=this.forma.placement.extractedScale;this.forma.placement=l.matrix,this.forma.bounds=q.TheoRect.fromSize(a);var s=this.forma.placement.transformPoint(this.forma.bounds.eval(e.pin));this.forma.move(N.Matrix2D.translation(Z._minus_TheoPoint_TheoPoint(n,s))),this.updateParentGroup()}},processEndFormaResize:function(e){var t;(t=s.opt(s.opt(this.owner,(function(e){return e.document})),(function(e){return e.firstPage})))&&t.publish(new D.EndFormaResizeMessage(t));var n,r=new P.FormaAlignmentChangedEvent(this.forma_,[],null);this.forma_.beginUpdate(r),this.forma_.endUpdate(r),(n=s.as(s.opt(this.forma.parent,(function(e){return e.controller})),w.GroupController))&&n.endChildResizeEvent(e)},processBeginFormaDrag:function(e){this.clearAlignmentLines();var t=s.clone(e.dragDelegate.draggedFormae);this.alignmentDetector_=c.AlignmentDetector.init_f94b(s.clone(t));var n=this.owner.document.firstPage;n.publish(new D.BeginFormaDragMessage(n))},afterProcessBeginFormaDrag:function(e){},processEndFormaDrag:function(e){var t=s.first(e.dragDelegate.draggedFormae),n=e.drag.viewportScale,r=26/n;S.DragFacade.rescueFormaToPageBounds(t,r,24/n);var o=new P.FormaAlignmentChangedEvent(t,[],null);t.beginUpdate(o),t.endUpdate(o);var i,a,l=this.owner.document.firstPage;if(l.publish(new D.EndFormaDragMessage(l)),i=s.opt(t.root,(function(e){return e.filterWithCallback((function(e){return e instanceof M.GroupForma&&null!=e.controller}))})))for(var u=s.iter(i);!u.done;u.next()){var c,h=u.value;(c=s.as(h.controller,w.GroupController))&&c.canClaimForma(t)&&c.claimForma(t)}else G.Host.logging.error("Error: forma has not root "+t.print());(a=s.as(t.controller,j.TypeLockupController))&&a.invalidateStyleScores()},afterProcessEndFormaDrag:function(e){},containsForma:function(e){var t,n=s.clone(e.totalPlacement.transformPoints(s.clone(e.bounds.points))),r=s.clone(this.forma.totalPlacement.inverse.transformPoints(s.clone(n))),o=r.map((function(e){return e.x}),this),i=r.map((function(e){return e.y}),this),a=q.TheoRect.fromXYXY(s.min(o),s.min(i),s.max(o),s.max(i));return!!(t=s.opt(this.forma.bounds,(function(e){return e.intersectionWith(a)})))&&t.area>.8*a.area},clearAlignmentLines:function(){var e=new P.FormaAlignmentChangedEvent(this.forma,[],[]);this.forma.beginUpdate(e),this.forma.endUpdate(e)},beforeProcessFormaDrag:function(e){},afterProcessFormaDrag:function(e){},processFormaDrag:function(e){var t=this,n=e.drag,r=1==e.dragDelegate.draggedFormae.length;e.dragDelegate.forEachDraggedForma((function(e,o){return t.processOneFormaDrag(n,e,o,r)}))},processOneFormaDrag:function(e,t,n,r){if(null!=this.owner){var o=this.owner;if(f.CoreAssert.isTrue(null!=t.controller,"processFormaDrag dragged forma with nil controller, forma kind "+t.kind+" and controller kind: "+this.kind,"FormaController.processOneFormaDrag","FormaController.swift",730),null!=t.controller){var i=t.controller;if(!(!i.moveable||o.interactionMode==C.InteractionMode.SelectionFocused&&o.selection.selectedCount>0&&!o.selection.isSelected(t)))if(F=e.newDragPlacement)i.place(F);else{var a=new P.FormaTransformChangedEvent(t);t.beginUpdate(a);var l,u=s.opt(t.parent,(function(e){return e.totalPlacement.inverse}))||N.Matrix2D.Identity,c=e.freeMovement(u),h=c.movement,m=c.rise,p=c.run,d=p>0&&Math.abs(m/p),g=new Z.TheoPoint(.5,.5);switch(l=t.parent instanceof T.FrameForma?t.parent.bounds.center:N._asterisk_TheoPoint_Matrix2D(t.bounds.center,n),g=t.bounds.locatePoint(t.placement.inverse.transformPoint(l)),e.dragMode){case 1:h=e.noScale(u,l);break;case 2:h=e.noRotation(u,l)}d=e.dragMode==O.DragMode.NoScaleNoSkew,f.CoreAssert.isFalse(0==h.determinant,void 0,"FormaController.processOneFormaDrag","FormaController.swift",783),N._asterisk_Matrix2D_Matrix2D(N._asterisk_Matrix2D_Matrix2D(N.Matrix2D.translation(l),h),N.Matrix2D.translation(Z._negate_TheoPoint(l))),e.uncommitedMovement=h;var v=e.activePace()==O.DragPace.MediumPace||e.currentlySnapped;r||(v=!1),e.dragMode==O.DragMode.UniformScaleNoRotationNoSkew&&(v=!1);var S,b=s.clone(t.filterByControllerKind(x.GridController.KIND,y.FormaTraversal.NearestAncestor));(S=s.as(s.opt(s.first(b),(function(e){return e.controller})),x.GridController))&&S.isChildSwappable(t)&&(v=!1);var _,A=e.currentlySnapped;if(_=t.controller){var F=N._asterisk_Matrix2D_Matrix2D(n,h);if(_.place(F),e.currentlySnapped=!1,v)null!=_.setSnappedPlacement(d?g:null,8/e.viewportScale,!1).movement&&(e.currentlySnapped=!0),!A&&e.currentlySnapped&&e.commitDrag();else{var w=new P.FormaAlignmentChangedEvent(t,[],null);this.forma_.beginUpdate(w),this.forma_.endUpdate(w)}}e.currentlySnapped,t.endUpdate(a);var I=o.document.firstPage;I.publish(new D.FormaDragMessage(I))}}}},processFormaClick:function(e){var t,n=this;this.alignmentDetector_=c.AlignmentDetector.init_a05b(this.forma_);var r,o=e.forma,i=1==e.modifierKeys.shift||1==e.modifierKeys.command||1==e.modifierKeys.control;r=G.Host.platform.isWeb?"Web":G.Host.platform.isIOS?"iOS":G.Host.platform.isAndroid?"Android":"Unknown",i?this.owner.selection.isSelected(o)?(this.owner.selection.deselectForma(o),s.opt(G.Host.logging,(function(e){return e.logToAnalytics(u.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+s.toString(n.owner.selection.selectedCount),contextualData3:"Did deselect: yes",contextualData4:"Platform: "+r})}))):(this.owner.selection.selectForma(o),s.opt(G.Host.logging,(function(e){return e.logToAnalytics(u.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+s.toString(n.owner.selection.selectedCount),contextualData3:"Did deselect: no",contextualData4:"Platform: "+r})}))):this.owner.selection.isSelected(o)?((t=s.opt(G.Host.platform,(function(e){return e.isWeb})))||null!=t)&&t||this.owner.selection.deselectForma(o):(o.controller.selectable&&this.owner.selection.replaceSelection(o),this.owner.controllerSettingsState.settings=null)},setSnappedPlacement:function(e,t,n){var r,o=this.alignmentDetector.snapped_Placement(e,t,n),i=o[0],a=o[1];(r=i)&&this.move(r);for(var u=[],c=s.iter(this.alignmentDetector.possibleAlignmentLines);!c.done;c.next())for(var h=c.value,f=s.iter(h.lines);!f.done;f.next()){var m=f.value;u.push(m)}var p=new P.FormaAlignmentChangedEvent(this.forma_,s.clone(a),null);return this.forma_.beginUpdate(p),this.forma_.endUpdate(p),new l.SnappedPlacement(i,s.clone(a.length>0?a:null))},updateParentGroup:function(){var e,t=s.opt(this.forma,(function(e){return e.parent}));(e=s.as(s.opt(t,(function(e){return e.controller})),w.GroupController))&&e.childUpdate(this.forma_)},postProcessEvent:function(e){return!1},containsPoint:function(e,t){void 0===t&&(t=0);var n=this.forma.bounds;return null!=n&&(0!=t&&(n=n.outsetXY(t,t)),n.containsPoint(e))},applyStyle:function(e,t){void 0===t&&(t=0),s.opt(this.forma,(function(t){return t.applyStyle(e)}))},shuffleColorAssignment:function(){if(s.opt(this.forma,(function(e){return null!=e.style}))){var e,t=this.getCurrentColors(this.forma.style).length,n=[];if(e=this.getBackgroundColor()){var r=this.forma.page.colorLibraryController,o=s.clone(r.getThemeColorKeys());if(o.length>t){var i=r.getKeyOfColorInTheme(r.getTheoColorForSolidColor(e));null!=i&&s.remove(o,i)}for(var a=[],l=s.iter(o);!l.done;l.next()){var u=l.value,c=r.getSolidColorForKey(u);null!=c&&c.contrasts(e,!1)&&a.push(u)}a.length>=t&&(o=s.clone(a)),s.shuffleInPlace(o);for(var h=0;h<t;)n.push(r.getTheoColorForKey(o[h])),h+=1}for(var f=s.iter(s.range(0,n.length,!1));!f.done;f.next()){var m,p=f.value;if(null!=(m=this.forma.page.colorLibraryController.getKeyOfColorInTheme(n[p]))){var d,g=(new B.ProfilingColorMap).overridePaletteMappingDueToContrast(m,this.forma.formaID);(d=this.forma.page.colorLibraryController.getTheoColorForKey(g))&&(n[p]=d)}}this.applyColors(s.clone(n))}},getSuggestableColors:function(){for(var e=this.forma.page.colorLibraryController,t=s.clone(e.getColorThemeAsArrayOfTheoColors()),n=[],r=s.iter(t);!r.done;r.next()){var o=r.value;o.isBrandkitColor()||n.push([o])}return n},getCurrentColors:function(e){var t,n,r=[];return this.primaryColorVisible()&&(t=e.colors.color(d.ColorRole.FieldPrimary))&&r.push(t),this.secondaryColorVisible()&&(n=e.colors.color(d.ColorRole.FieldSecondary))&&r.push(n),r},applyColors:function(e,t){var n;if(void 0===t&&(t=d.ColorRole.FieldPrimary),n=this.forma){var r=s.clone(n.page.colorLibraryController.addColorsToTheme(s.clone(e),n));r.length>0&&n.style.colors.setColorId(d.ColorRole.FieldPrimary,r[0]),r.length>1&&n.style.colors.setColorId(d.ColorRole.FieldSecondary,r[1])}this.updateParentGroup()},primaryColorVisible:function(){return!0},secondaryColorVisible:function(){return!1},applyOpacity:function(e){s.opt(s.opt(s.opt(this.forma,(function(e){return e.root})),(function(e){return e.animation})),(function(e){return e.invalidate()})),s.opt(this.forma,(function(t){return t.style.opacity=e})),this.updateParentGroup()},currentOpacity:{get:function(){var e;return(e=s.opt(this.forma,(function(e){return e.style.opacity})))||null!=e?e:1}},preferredXAlignment:{get:function(){return null}},setAlignmentType:function(e){},currentHeightScale:{get:function(){var e,t;if((e=s.opt(this.forma,(function(e){return e.bounds})))&&(t=s.opt(this.forma,(function(e){return e.totalPlacement})))){var n=s.clone(e.evalPts([Z.TheoPoint.ZERO,new Z.TheoPoint(0,1)])),r=s.clone(t.transformPoints(s.clone(n)));return r[0].distanceTo(r[1])}return null}},getSizeHeightScales:function(){var e;return(e=s.opt(this.forma,(function(e){return e.bounds})))?[{size:e.size,scale:e.height}]:[]},setHeightScale:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=t||this.getPin();null!=r&&(r.targetHeight=e,this.matchPreviousPin(r,n))},getParentForPin:function(){var e;return(e=this.forma)?s.opt(s.opt(e.parent,(function(e){return e.controller})),(function(e){return e.kind==w.GroupController.KIND}))||s.opt(s.opt(e.parent,(function(e){return e.controller})),(function(e){return e.kind==h.AlignmentGroupController.KIND}))?e.parent:I.GroupDetector.getVisualParent(e):null},determinePinPosition:function(e,t,n,r,o,i,a,l){var s=i-o,u=t-e,c=Math.max(-1*(o-e)/s,0),h=Math.min(1-(i-e-u)/s,1),f=Math.max(Math.max(o,0)-e,0)/s,m=Math.max(t-i,0)/s,p=Math.max(Math.max(o,0)-n,0)/s,d=Math.max(Math.min(r,t)-i,0)/s;return this.isFrameCentered(p,d)||this.isFrameCentered(f,m)?(c+h)/2:R.MathUtils.absDouble(a-e)<25?0:R.MathUtils.absDouble(l-t)<25?1:p>d?h:c},isFrameCentered:function(e,t){var n=.1+Math.min(e,t);return R.MathUtils.absDouble(e-t)<n&&(e>=0&&t>=0||e+t<.05)},visualParent:{get:function(){return I.GroupDetector.getVisualParent(this.forma)}},visualParentExpansionFrame:{get:function(){var e=I.GroupDetector.getVisualParent(this.forma),t=this.getExpansionBounds(e);return e.totalPlacement.transformRect(t)}},getExpansionBounds:function(e){var t,n,r;if((t=this.forma)&&t.bounds&&(n=e.bounds)&&(r=this.getFrameInOtherFormaCoord(e))){for(var o=n.minX,i=n.maxX,a=n.minY,l=n.maxY,u=s.clone(t.parent.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),c=s.iter(u);!c.done;c.next()){var h=c.value;if(!s.eq(y._equality_Forma_Forma,h,t)){var f=h.controller.getFrameInOtherFormaCoord(e);if(!h.isTypeLockup()&&f.intersects(r))continue;var m=Math.max(r.minX,f.minX),p=Math.min(r.maxX,f.maxX),d=Math.max(r.minY,f.minY),g=Math.min(r.maxY,f.maxY),v=R.MathUtils.absDouble(1-(p-m)/Math.min(r.width,f.width))<.2,C=R.MathUtils.absDouble(1-(g-d)/Math.min(r.height,f.height))<.2;p>m&&!C&&(f.center.y>r.center.y?l=Math.min(l,(f.minY+r.maxY)/2):a=Math.max(a,(f.maxY+r.minY)/2)),g>d&&!v&&(f.center.x>r.center.x?i=Math.min(i,(f.minX+r.maxX)/2):o=Math.max(o,(f.maxX+r.minX)/2))}}return new q.TheoRect(o,a,i,l)}return null},boundaryAlignment:function(e,t){return R.MathUtils.absDouble(e.minX-t.minX)<25||R.MathUtils.absDouble(e.maxX-t.maxX)<25||R.MathUtils.absDouble(e.minY-t.minY)<25||R.MathUtils.absDouble(e.maxY-t.maxY)<25},getPinBounds:function(e){return s.opt(this.forma,(function(e){return e.bounds}))},getPin:function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0);var n,r,o,i=this;if(!this.floating)return null;if((n=this.forma)&&(r=n.finalFrame)&&(o=s.opt(n.root,(function(e){return e.finalFrame})))){var a=this.currentHeightScale;null==a||!n.isShape()&&0!=a||(a=null);var l,u=this.getParentForPin(),h=u.finalFrame,f=h,m=W.PinBoundsType.Bounds,p=r,d=!1;s.as(this,w.GroupController)&&(l=n.childrenFinalFrame)&&(p=l,(d=this.boundaryAlignment(l,o))&&(m=W.PinBoundsType.ChildrenBounds));var g,v=this.getExpansionBounds(u),C=u.totalPlacement.transformRect(v),S=this.determinePinPosition(f.minX,f.maxX,C.minX,C.maxX,r.minX,r.maxX,p.minX,p.maxX),y=this.determinePinPosition(f.minY,f.maxY,C.minY,C.maxY,r.minY,r.maxY,p.minY,p.maxY),b=r.eval(new Z.TheoPoint(S,y)),_=this.forma.totalPlacement.inverse.transformPoint(b),A=new Z.TheoPoint(_.x/this.forma.bounds.width,_.y/this.forma.bounds.height),F=u.totalPlacement.inverse.transformPoint(b),T=u.bounds,D=new Z.TheoPoint(F.x/T.width,F.y/T.height),P=W.PinBoundsType.Bounds,x=new W.TheoPin(n,m,A,u,P,D,a,0,0),I=1;(g=s.opt(n.page.view,(function(e){return e.getViewportTransform()})))&&(I=Math.sqrt(Math.abs(g.determinant)));var M=c.AlignmentDetector.DISTANCE_THRESHOLD/I,G=Math.abs(h.center.x-r.center.x)<5;if(e&&!d&&!G){var L=s.clone(this.alignmentDetector.detectFormaAlignments(2*M,!0,!1));s.sortInPlace(L,(function(e,t){return 10*Math.abs(e.offset.length())+e.line.line.length+.1*s.toDouble(e.line.type)<10*Math.abs(t.offset.length())+t.line.line.length+.1*s.toDouble(t.line.type)}));for(var E=s.iter(L);!E.done;E.next()){var k,N,R=E.value;if((k=s.opt(this.getPinBounds(m),(function(e){return e.transform(i.forma.totalPlacement)})))&&(N=s.opt(R.forma.controller.getPinBounds(W.PinBoundsType.Bounds),(function(e){return e.transform(R.forma.totalPlacement)})))){var B=Math.max(0,-1*Math.min(k.maxY-N.minY,N.maxY-k.minY));if(R.forma.parent!=n.parent||N.area<=p.area||N.intersects(k)||!R.forma.controller.floating||B>200)continue;var O=null;if(R.line.type==c.AlignmentType.CenterX?O=.5:R.line.type==c.AlignmentType.Left?O=0:R.line.type==c.AlignmentType.Right&&(O=1),null!=O){S=O;var X=R.forma,Y=(P=W.PinBoundsType.Bounds,this.forma.controller.getPinBounds(m)),z=X.controller.getPinBounds(P),H=X.totalPlacement.transformPoint(z.eval(new Z.TheoPoint(.5,.5))),U=this.forma.totalPlacement.inverse.transformPoint(H);y=.5,U.y>Y.maxY?y=1:U.y<Y.minY&&(y=0);var K=new Z.TheoPoint(S,y),V=new Z.TheoPoint(S,1-y),j=(D=X.totalPlacement.transformPoint(z.eval(V)),this.forma.totalPlacement.transformPoint(Y.eval(K))),q=Math.abs(j.y-D.y),J=q/X.controller.currentHeightScale;return new W.TheoPin(n,m,K,X,P,V,a,q,J,!0)}}}}return x}return null},matchPreviousPin:function(e,t){void 0===t&&(t=!1);var n,r,o=this.forma.placement.transformValues;if((n=this.getParentForPin())&&(r=n.bounds)){for(var i,a,l,u,c,h,f=this.forma.isTypeLockup()&&!this.maintainAspectRatio?2:1,m=this.getExpansionBounds(n),p=s.iter(s.range(0,f,!1));!p.done;p.next()){var d=p.value,g=this.getFrameInOtherFormaCoord(n);g=g.scale(1.1,new Z.TheoPoint(.5,.5));var v=Math.max(g.minX-m.minX,0),C=Math.max(Math.min(m.maxX,r.maxX)-g.maxX,0),S=Math.max(g.minY-m.minY,0),y=Math.max(Math.min(m.maxY,r.maxY)-g.maxY,0);v=0==e.pinPoint.x?0:v,C=1==e.pinPoint.x?0:C,S=0==e.pinPoint.y?0:S,y=1==e.pinPoint.y?0:y,.5==e.pinPoint.x&&(v=Math.min(v,C),C=Math.min(v,C)),.5==e.pinPoint.y&&(S=Math.min(S,y),y=Math.min(S,y));var b=1+(v+C)/g.width,_=1+(S+y)/g.height,A=this.currentHeightScale,F=null!=e.targetHeight&&null!=A?e.targetHeight/A:1;if(Math.abs(F-1)<.01)break;var T=b>F,D=_>F;if(!(d>0&&Math.abs(F-1)<.05))if(this.maintainAspectRatio){var P=T&&D?F:Math.min(b,_);this.forma.bounds=s.opt(this.forma.bounds,(function(e){return e.scaleXY(P,P,new Z.TheoPoint(0,0))}))}else this.forma.bounds=T&&D?s.opt(this.forma.bounds,(function(e){return e.scaleXY(F,F,new Z.TheoPoint(0,0))})):T?s.opt(this.forma.bounds,(function(e){return e.scaleXY(F,_,new Z.TheoPoint(0,0))})):D?s.opt(this.forma.bounds,(function(e){return e.scaleXY(b,F,new Z.TheoPoint(0,0))})):s.opt(this.forma.bounds,(function(e){return e.scaleXY(b,_,new Z.TheoPoint(0,0))}))}null!=(i=e.targetHeight)&&null!=(a=this.currentHeightScale)&&(l=s.opt(this.forma,(function(e){return e.finalFrame})))&&(u=s.opt(this.forma,(function(e){return e.bounds})))&&(c=s.opt(s.opt(this.forma,(function(e){return e.root})),(function(e){return e.finalFrame})))&&(F=i/a,Math.abs(F-1)>.001&&(m=this.getExpansionBounds(n),(t||u.width*F<m.width&&u.height*F<m.height&&l.width*F<c.width&&l.height*F<c.height)&&(this.forma.placement=this.forma.placement.scaleTo(o.xscale*F,o.yscale*F)))),(h=s.as(this.forma.controller,j.TypeLockupController))&&h.snapSizeToBounds(),this.forma.move(e.offsetMatrix()),m=this.getExpansionBounds(n),this.preventOutofBounds(n,m)}},getFrameInOtherFormaCoord:function(e){var t,n;return(t=this.forma.bounds)&&(n=e.totalPlacement.inverse)?e==s.opt(this.forma,(function(e){return e.parent}))?s.opt(this.forma,(function(e){return e.frame})):this.forma.totalPlacement.concat(n).transformRect(t):null},preventOutofBounds:function(e,t,n){void 0===n&&(n=0);var r,o,i=!1;if((r=null!=t?t:e.bounds)&&(o=this.getFrameInOtherFormaCoord(e))&&!r.contains(o)){var a=r.insetXY(n,n),l=o.minX-a.minX,s=o.maxX-a.maxX,u=o.minY-a.minY,c=o.maxY-a.maxY;l<0&&(this.forma.move(N.Matrix2D.translationXY(-l,0)),i=!0),s>0&&(this.forma.move(N.Matrix2D.translationXY(-s,0)),i=!0),u<0&&(this.forma.move(N.Matrix2D.translationXY(0,-u)),i=!0),c>0&&(this.forma.move(N.Matrix2D.translationXY(0,-c)),i=!0)}return i},linkedForma:function(e){var t,n;return(t=this.forma.parent)&&(n=t.controller)?n.linkedFormaForChild(this.forma,e):[]},linkedFormaForChild:function(e,t){return[]},getZOrder:function(){var e,t=-1;return null==this.forma||null==this.forma.parent?(f.CoreAssert.isTrue(!1,void 0,"FormaController.getZOrder","FormaController.swift",1806),t):t=(e=this.forma.parent.indexOfChild(this.forma))||null!=e?e:-1},setZOrder:function(e){null!=this.forma&&null!=this.forma.parent?this.forma.parent.insertChildAt(this.forma,e):f.CoreAssert.isTrue(!1,void 0,"FormaController.setZOrder","FormaController.swift",1818)},getMinLayerIndex:function(){var e=0;if(null==this.forma||null==this.forma.parent)return f.CoreAssert.isTrue(!1,void 0,"FormaController.getMinLayerIndex","FormaController.swift",1828),e;var t=this.forma.parent;return null!=t&&(e=s.clone(t.filterWithCallback((function(e){return(e.isBackgroundImage()||e.isShape()&&!e.hasIntent(y.Forma.INTENT_TEMP_IMAGE_CROP))&&null!=e.controller&&!e.controller.floating}),y.FormaTraversal.JustChildren)).length),e},getReorderableLayerCount:function(){var e=0;if(null==this.forma)return f.CoreAssert.isTrue(!1,void 0,"FormaController.getReorderableLayerCount","FormaController.swift",1848),e;if(s.opt(this.forma,(function(e){return e.isGridCell()})))return e;var t=this.forma.parent;return null!=t&&(e=s.clone(t.filterWithCallback((function(e){return!e.isBackgroundImage()&&!e.hasIntent(y.Forma.INTENT_TEMP_IMAGE_CROP)&&!x.GridController.isBackgroundColoredCell(e)}),y.FormaTraversal.JustChildren)).length),e},contrastCheck:function(e){var t,n,r;if(void 0===e&&(e=!0),(t=this.forma.style.colors.fieldPrimary)&&null!=(n=this.forma.style.colors.colorID(d.ColorRole.FieldPrimary))&&(r=this.getBackgroundColor())&&!t.contrasts(r,e)){var o=t.contrastWithColor(r),i=m.ColorLibraryController.getBackgroundContrastKey(n);this.forma.page.colorLibraryController.setTheoColorToLibrary(K.TheoColor.init_5344(o,null,null),i),this.forma.style.colors.setColorId(d.ColorRole.FieldPrimary,i)}},getBackingContrastRole:function(){return d.ColorRole.FieldPrimary},getBackgroundColor:function(e){void 0===e&&(e=null);var t=this;if(null==this.forma.finalFrame)return null;var n,r=null!=e?e:this.forma.finalFrame;if(n=s.as(this.forma.root,X.RootForma)){var o,i=n.style.colors.fieldPrimary,a=s.opt(n.finalFrame,(function(e){return e.intersectionWith(r)}));if(null==a)return null;r=a,(o=s.as(this,j.TypeLockupController))&&o.styleController.targetedLockupStyle!==o.lockupStyle&&o.textBacked&&!k.LockupStyle.isShadowLook(o.lockupStyle.textLook)&&(i=o.lockupStyle.colors.fieldPrimary),null==i&&(s.opt(G.Host.logging,(function(e){return e.warning("Possible error. background color is nil.")})),i=z.SolidColor.WHITE);for(var l=s.iter(n.visitAsArray(y.FormaTraversal.PreOrder));!l.done;l.next()){var u,c=l.value,h=c.finalFrame,f=c.controller;if(!(null==f||s.eq(y._equality_Forma_Forma,c,this.forma)||null==h||(u=f)&&u.kind!=Y.ShapeController.KIND&&u.kind!=b.FrameController.KIND)){for(var m=c.parent,p=!1;null!=m&&m.kind!=X.RootForma.KIND&&m!=c;){if(m==this.forma){p=!0;break}m=m.parent}if(!p){var d=r.intersectionWith(h);if(null!=d&&d.area/r.area>.5){var g,v;if(c.parent==s.opt(this.forma,(function(e){return e.parent}))&&null!=c.parent&&null!=(g=s.opt(c.parent,(function(e){return e.indexOfChild(t.forma)})))&&null!=(v=c.parent.indexOfChild(c))&&g<v)continue;if(c instanceof T.FrameForma){var C=c.controller.getAverageColor(r);null!=C?i=i.blend(C,C.alpha):(G.Host.logging.warning("Error: Couldn't find the background color"),i=new z.SolidColor(.5,.5,.5,1))}else if(c instanceof H.ShapeForma){if(!(new B.ProfilingColorMap).checkIfTwoFormaAreInSamePaletteMappingGroup(c.formaID,this.forma.formaID)&&!(new B.ProfilingColorMap).checkIfTwoFormaAreInSamePaletteMappingGroup(c.formaID,this.forma.formaID+B.ProfilingColorMap.backingColorKey)){var S=s.opt(s.opt(s.as(c,H.ShapeForma),(function(e){return e.contentNode})),(function(e){return e.getTag(U.TAG_SHAPE_ID)}));if(null==S||U.ShapeLibrary.FilledBackingShapes.includes(S)){var _=c.style.colors.fieldPrimary,A=s.as(c,H.ShapeForma).getAverageAlpha(r);null!=_&&null!=i&&(i=i.blend(_,c.style.opacity*A))}}}else M.GroupForma}}}}return i}return null},getBackgroundColors:function(){var e,t,n=[];if((e=this.forma.finalFrame)&&(t=this.forma.root)){var r=s.clone(t.filterWithCallback((function(t){return t.isGraphic()&&t.kind!=L.ImageForma.KIND&&t.kind!=X.RootForma.KIND&&null!=t.finalFrame&&t.finalFrame.intersects(e)})));if(1==r.length&&r[0].isGridCell()&&r[0].isShape()){var o,i=r[0].style.colors.fieldPrimary;if((o=r[0].finalFrame)&&o.contains(e)&&null!=i)return[i]}for(var a=3;e.width/s.toDouble(a)<50&&1!=a;)a-=1;for(var l=3;e.height/s.toDouble(l)<50&&1!=l;)l-=1;for(var u=new J.TheoSize(e.width/s.toDouble(a),e.height/s.toDouble(l)),c=s.iter(s.range(0,a,!1));!c.done;c.next())for(var h=c.value,f=s.iter(s.range(0,l,!1));!f.done;f.next()){var m=f.value,p=q.TheoRect.fromXYWH(s.toDouble(h)*u.width+e.origin.x,s.toDouble(m)*u.height+e.origin.y,u.width,u.height);null==(i=this.getBackgroundColor(p))||s.containsEq(n,i,z._equality_SolidColor_SolidColor)||n.push(i)}}return n},getBackgroundColorsFullList:function(){var e,t,n=[];if((e=this.forma.finalFrame)&&(t=this.forma.root)){var r=s.clone(t.filterWithCallback((function(t){return t.isGraphic()&&t.kind!=L.ImageForma.KIND&&t.kind!=X.RootForma.KIND&&null!=t.finalFrame&&t.finalFrame.intersects(e)})));if(1==r.length&&r[0].isGridCell()&&r[0].isShape()){var o,i=r[0].style.colors.fieldPrimary;if((o=r[0].finalFrame)&&o.contains(e)&&null!=i)return[i]}for(var a=new J.TheoSize(e.width/s.toDouble(16),e.height/s.toDouble(16)),l=s.iter(s.range(0,16,!1));!l.done;l.next())for(var u=l.value,c=s.iter(s.range(0,16,!1));!c.done;c.next()){var h=c.value,f=q.TheoRect.fromXYWH(s.toDouble(u)*a.width+e.origin.x,s.toDouble(h)*a.height+e.origin.y,a.width,a.height);null!=(i=this.getBackgroundColor(f))&&n.push(i)}}return n},getAverageColor:function(e){return this.forma.style.colors.fieldPrimary}}}),i),l.SnappedPlacement=(a=function(e,t){this.movement=e,this.snapLines=s.clone(t)},s.defineClass({name:"SnappedPlacement",ctor:a,superName:"CoreObject"}),a)},JFv5:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),l=n("FNB+"),s=n("9Lk3"),u=n("ZK0l"),c=n("/afT"),h=n("fdtz"),f=n("K0Rh"),m=n("T6jX"),p=n("8t9B"),d=n("oKlP"),g=n("zjod");o.ResizeLayoutController=i.defineProtocol("ResizeLayoutController",{beginUpdateGroup:"() -> Void",updateGroup:"() -> Void",endUpdateGroup:"() -> Void"}),o.ResizeLayoutType=i.defineEnum("ResizeLayoutType",{Proportional:"Proportional",Pin:"Pin",Spring:"Spring"}),o.PinLayoutController=(r=function(e){this.formaToUpdate_=[],this.inferredGroups_=null,this.group_=e,a.CoreObject.call(this)},i.defineClass({name:"PinLayoutController",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"ResizeLayoutController"==e}},props:{beginUpdateGroup:function(){if(this.oldBounds_=this.group_.bounds,i.as(this.group_.root,f.RootForma)&&!this.group_.hasIntent(l.Forma.INTENT_INFERRED_TEMP_GROUP)&&i.opt(this.group_.root,(function(e){return null!=e.page.root_}))&&!m.TheoDocumentUtils.enableFastHeuristicsForComplexPage(this.group_.root.page)){var e=i.clone(c.GroupDetector.createOverlapGroups(this.group_));if(e.length>0){this.inferredGroups_=[];for(var t=i.iter(e);!t.done;t.next()){var n=t.value;this.inferredGroups_.push(n)}i.opt(i.as(this.group_.controller,s.GridController),(function(e){return e.inferGridCellAssignment()}))}}this.formaToUpdate_=[];for(var r=i.iter(this.group_.visitAsArray(l.FormaTraversal.JustChildren));!r.done;r.next()){var o=r.value;if(o.kind!=h.ImageForma.KIND&&o.kind!=g.VideoForma.KIND){var a;(a=i.as(o.controller,u.GroupController))&&a.beginUpdateGroup();var p=i.opt(o.controller,(function(e){return e.getPin(!0)}));null==p||p.isRelativePin?this.formaToUpdate_.push({forma:o,pin:p}):this.formaToUpdate_.splice(0,0,{forma:o,pin:p})}}},updateGroup:function(){if(null!=this.oldBounds_){for(var e=this.oldBounds_.size,t=this.group_.bounds.size,n=new d.TheoPoint(t.width/e.width,t.height/e.height),r=i.iter(this.formaToUpdate_);!r.done;r.next()){var o;if((o=(v=r.value).forma.frame)&&o.area>0){var a=v.forma,l=a.placement.transformValues,s=Math.abs(l.rotCosine)/(Math.abs(l.rotCosine)+Math.abs(l.rotSine)),u=Math.abs(l.rotSine)/(Math.abs(l.rotCosine)+Math.abs(l.rotSine)),c=new d.TheoPoint(n.x*s+n.y*u,n.x*u+n.y*s);if((g=i.as(a.controller,p.TypeLockupController))&&g.addLineBreakConstraints(),null!=a.controller&&a.controller.maintainAspectRatio){var h=Math.min(c.x,c.y);a.bounds=i.opt(a.bounds,(function(e){return e.scaleXY(h,h,new d.TheoPoint(0,0))}))}else a.bounds=i.opt(a.bounds,(function(e){return e.scaleXY(c.x,c.y,new d.TheoPoint(0,0))}));a.moveCenterToPoint(new d.TheoPoint(o.center.x*n.x,o.center.y*n.y))}}for(var f=i.iter(this.formaToUpdate_);!f.done;f.next()){var m,g,v=f.value;(m=v.pin)&&(i.opt(v.forma.controller,(function(e){return e.matchPreviousPin(m)})),(g=i.as(v.forma.controller,p.TypeLockupController))&&g.removeLineBreakConstraints())}}},endUpdateGroup:function(){for(var e=i.iter(this.group_.visitAsArray(l.FormaTraversal.JustChildren));!e.done;e.next()){var t=e.value;if(t.hasIntent(l.Forma.INTENT_INFERRED_TEMP_GROUP)&&null!=this.inferredGroups_&&this.inferredGroups_.includes(t)){for(var n=i.iter(t.visitAsArray(l.FormaTraversal.JustChildren));!n.done;n.next()){var r=n.value;this.group_.appendChild(r,!0)}t.removeFromParent(),i.opt(i.as(this.group_.controller,s.GridController),(function(e){return e.inferGridCellAssignment()})),i.remove(this.inferredGroups_,t)}}}}}),r)},"McK+":function(e,t,n){var r,o,i=t,a=n("oAGj"),l=n("bccX"),s=n("mD2h"),u=n("SpAV"),c=n("gXiO"),h=n("QLmq"),f=n("d820"),m=n("Cl7N");i.EditorModelState=(r=function(e,t,n,r,o){this.mutable_=!1,void 0===e&&(e=new l.AttributesState),void 0===t&&(t=new h.FeatureSetsState),void 0===n&&(n=new f.HandlesState),void 0===r&&(r=new s.ActiveSwapState),void 0===o&&(o=new m.SnapLinesState),this.attributes=e,this.featureSets=t,this.handles=n,this.activeSwap=r,this.snapLines=o},a.defineClass({name:"EditorModelState",ctor:r,statics:{_implements:function(e){return"IMutableEditorModel"==e}},props:{clone:function(){return new r(this.attributes.clone(),this.featureSets.clone(),this.handles.clone(),this.activeSwap.clone(),this.snapLines.clone())},calculateChanges:function(e){var t=[];return a.append(t,this.attributes.diff(e.attributes)),a.append(t,this.featureSets.diff(e.featureSets)),a.append(t,this.handles.diff(e.handles)),a.append(t,this.activeSwap.diff(e.activeSwap)),a.append(t,this.snapLines.diff(e.snapLines)),t},mutable:{get:function(){return this.mutable_},set:function(e){e!=this.mutable_&&(this.mutable_=e,this.attributes.mutable=e,this.featureSets.mutable=e,this.handles.mutable=e,this.activeSwap.mutable=e,this.snapLines.mutable=e)}}}}),r),i.EditorStateMember=(o=function(){this.mutable=!1,c.CoreObject.call(this)},a.defineClass({name:"EditorStateMember",ctor:o,superName:"CoreObject",props:{beforeChange:function(){u.CoreAssert.isTrue(this.mutable,"editor state is read-only","EditorStateMember.beforeChange","EditorModelState.swift",93)},afterChange:function(){}}}),o)},QLmq:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("7siz");o.IFeatureSetsModel=i.defineProtocol("IFeatureSetsModel",{find:"(String) -> IFeatureSet"}),o.FeatureSetsState=(r=function(e){void 0===e&&(e=null),this.featureSets=i.clone(e||{})},i.defineClass({name:"FeatureSetsState",ctor:r,superName:"EditorStateMember",statics:{_implements:function(e){return"IFeatureSetsModel"==e}},props:{clone:function(){return new r(i.clone(this.featureSets))},find:function(e){return this.featureSets[e]},clear:function(){this.beforeChange(),i.removeAll(this.featureSets),this.afterChange()},add:function(e){this.beforeChange(),this.featureSets[e.key]=e,this.afterChange()},remove:function(e){this.beforeChange(),i.removeKey(this.featureSets,e),this.afterChange()},diff:function(e){for(var t=[],n=i.iter(this.featureSets);!n.done;n.next()){var r,o=n.key,l=n.value;(r=e.featureSets[o])&&l.isEqualTo(r)||t.push(a.EditorModelChangedMessage.CHG_FEATURE_SET_PREFIX+o)}for(var s=i.iter(e.featureSets);!s.done;s.next())o=s.key,null==this.featureSets[o]&&t.push(a.EditorModelChangedMessage.CHG_FEATURE_SET_PREFIX+o);return t}}}),r)},XmBt:function(e,t,n){var r,o,i,a=t,l=n("oAGj"),s=n("cZuM"),u=n("ftr0"),c=n("SpAV"),h=n("ascj"),f=n("FNB+"),m=n("waL6"),p=n("ZK0l"),d=n("pnSN"),g=n("iCxV"),v=n("tGKA"),C=n("3DEm"),S=n("djAF"),y=n("hpGl"),b=n("35Q0"),_=n("JKVa"),A=n("8t9B"),F=n("oKlP"),T=n("sIWg"),D=n("1NAc");a.AlignmentGroupItemType=l.defineEnum("AlignmentGroupItemType",{DefaultContent:0,SeperatorShape:1,BackingShape:2,BulletShape:3}),a.AlignmentLayoutItem=(r=function(e,t,n,r,o,i,a,l){this.forma=e,this.type=t,this.formaPin=n,this.parentPosition=r,this.size=o,this.scale=i,this.artworkID=a,this.primaryColor=l},l.defineClass({name:"AlignmentLayoutItem",ctor:r,props:{clone:function(){return new r(this.forma,this.type,this.formaPin,this.parentPosition,this.size,this.scale,this.artworkID,this.primaryColor)}}}),r),a.AlignmentColumnLayout=(o=function(e,t,n,r,o,i,a,s,u){this.columns=l.clone(e),this.contentColumn=l.clone(t),this.contentSizes=l.clone(n),this.contentScales=l.clone(r),this.contentSpacing=l.clone(o),this.seperatorHeights=l.clone(i),this.seperatorPositions=l.clone(a),this.marginLeft=l.clone(s),this.marginRight=l.clone(u)},l.defineClass({name:"AlignmentColumnLayout",ctor:o,props:{clone:function(){return new o(this.columns,this.contentColumn,this.contentSizes,this.contentScales,this.contentSpacing,this.seperatorHeights,this.seperatorPositions,this.marginLeft,this.marginRight)}}}),o),a.AlignmentGroupController=(i=function(e,t,n){this.blockChildUpdates_=!1,this.blockAlignmentLayout_=!1,this.childrenAligned_=!1,this.iconHack_=!1,this.childScales_={},p.GroupController.call(this,e,t,n)},l.defineClass({name:"AlignmentGroupController",ctor:i,superName:"GroupController",statics:{KIND:{get:function(){return"alignment-group"}},MIN_SPACING:{get:function(){return 5}},DEFAULT_MARGINS:{get:function(){return 20}},DEFAULT_SEPERATOR_HEIGHT:{get:function(){return 5}},PROPERTY_BACKING_SHAPE_ID:"backing-shape-id"},props:{backingShapeID_:{get:function(){return l.as(this.controllerMetadata.get(y.ShapeGroupController.PROPERTY_BACKING_SHAPE_ID),"String")},set:function(e){this.controllerMetadata.set(y.ShapeGroupController.PROPERTY_BACKING_SHAPE_ID,e)}},selectable:{get:function(){return!0}},moveable:{get:function(){return!0}},rotateable:{get:function(){return!0}},deleteable:{get:function(){var e,t;return(e=l.opt(this.forma,(function(e){return e.finalFrame})))&&(t=l.opt(this.forma,(function(e){return e.root.finalFrame})))?!e.equal(t):p.GroupController._getters.deleteable.call(this)}},replaceable:{get:function(){return!this.moveable}},maintainAspectRatio:{get:function(){return!1}},contentID:{get:function(){var e=[];if(l.opt(this.forma,(function(t){return t.visit(f.FormaTraversal.JustChildren,(function(t,n,r){var o;return null!=(o=t.contentID)&&e.push(o),!1}))})),0==e.length)return null;l.sortInPlace(e);for(var t="",n=l.iter(e);!n.done;n.next())t+=n.value;return t}},horizontalAlignment:{get:function(){return this.alignmentGroupStyle.horizontalAlignment},set:function(e){this.alignmentGroupStyle.horizontalAlignment=e,this.updateGroup()}},alignmentGroupStyle:{get:function(){var e;return(e=l.as(l.opt(this.forma,(function(e){return e.style})),u.AlignmentGroupStyle))?e:(l.opt(this.forma,(function(e){return e.applyStyle(u.AlignmentGroupStyle.createDefault())})),l.as(l.opt(this.forma,(function(e){return e.style})),u.AlignmentGroupStyle))}},inferredSpacing:{get:function(){var e;if(null!=(e=l.opt(this.alignmentGroupStyle,(function(e){return e.spacing}))))return e;var t=l.clone(this.getSortedChildren()),n=[];if(t.length>0){for(var r=l.iter(l.range(0,t.length-1,!1));!r.done;r.next()){var o,i=r.value;null!=(o=l.opt(this.alignmentGroupStyle,(function(e){return e.topDistances[t[i].formaID]})))&&n.push(o)}return n.reduce((function(e,t){return e+t}),0)/l.toDouble(n.length)}return null}},setHorizontalAlignment:function(e,t){void 0===t&&(t=null),this.horizontalAlignment=e},applyOpacity:function(e){l.opt(this.backingShape_,(function(t){return t.style.opacity=e})),this.alignmentGroupStyle.opacity=e},setNextSpacingOption:function(){var e,t,n;(e=this.alignmentGroupStyle)&&(t=l.opt(this.forma,(function(e){return e.finalFrame})))&&(null!=(n=e.spacing)?n>t.height/5?e.spacing=0:e.spacing=n+20:e.spacing=25,this.updateGroup())},setNextPaddingOption:function(){var e,t;(e=this.alignmentGroupStyle)&&(null!=(t=e.padding)?e.padding=t>.4?-.3:t+.15:e.padding=.15,this.updateBackingShape())},setBackingShape:function(e){l.opt(this.alignmentGroupStyle,(function(t){return t.backingArtworkID=e})),this.updateBackingShape()},styleChanged:function(){this.updateBackingShape()},moveableFormae:function(){for(var e=[],t=l.iter(this.forma.visitAsArray(f.FormaTraversal.JustChildren));!t.done;t.next()){var n=t.value;null!=n.controller&&n.controller.moveable&&e.push(n)}return l.sortInPlace(e,(function(e,t){return e.finalFrame.center.distanceTo(F.TheoPoint.ZERO)<t.finalFrame.center.distanceTo(F.TheoPoint.ZERO)})),e},showLinkingButtons:{get:function(){if(this.moveableFormae().length>0)return!0;if(this.iconHack_)return!0;for(var e=l.iter(this.forma.siblingForma());!e.done;e.next()){var t=e.value;if(this.containsForma(t))return!0}return!1}},isLinked:{get:function(){var e;return!(e=this.alignmentGroupStyle)||e.layoutMode!=u.GroupLayoutMode.None}},toggleLinkChildren:function(){var e;if(e=this.alignmentGroupStyle)if(e.layoutMode==u.GroupLayoutMode.None)e.layoutMode=u.GroupLayoutMode.Flow,this.claimSiblingForma();else{e.layoutMode=u.GroupLayoutMode.None;for(var t=l.iter(this.moveableFormae());!t.done;t.next()){var n,r=t.value;(n=l.opt(this.forma,(function(e){return e.parent})))&&(this.iconHack_=!0,n.appendChild(r,!0),this.iconHack_=!1)}}},setAlignmentSortOrder:function(){var e,t;if((e=l.as(this.forma,d.GroupForma))&&(t=this.alignmentGroupStyle)){var n=l.clone(e.filterWithCallback((function(e){return null!=e.controller}),f.FormaTraversal.JustChildren)),r=[];l.sortInPlace(n,(function(t,n){return t.frame.center.distanceTo(e.bounds.origin)>n.frame.center.distanceTo(e.bounds.origin)}));for(var o=l.iter(n);!o.done;o.next()){var i=o.value;r.push(i.formaID)}t.setOrder(l.clone(r))}},getSortedChildren:function(){var e,t,n,r;if((n=l.as(this.forma,d.GroupForma))&&(r=this.alignmentGroupStyle)){var o=l.clone(n.filterWithCallback((function(e){return null!=e.controller}),f.FormaTraversal.JustChildren));return r.order.length!=o.length&&this.setAlignmentSortOrder(),l.sortInPlace(o,(function(n,o){return((e=l.indexOf(r.order,n.formaID))||null!=e?e:1e3)>((t=l.indexOf(r.order,o.formaID))||null!=t?t:1e3)})),o}return[]},getDesiredScales:function(e,t){for(var n=[],r=l.iter(e);!r.done;r.next()){var o,i=r.value;(o=i.frame)&&(null==(d=l.opt(this.alignmentGroupStyle,(function(e){return e.scales[i.formaID]})))&&(d=l.opt(i.controller,(function(e){return e.currentHeightScale}))),null!=d&&n.push({forma:i,size:o.size,scale:d}))}for(var a=1,s=!1;!s&&a>.05;){s=!0;for(var u=l.iter(n);!u.done;u.next()){var c=u.value;c.forma.isTypeLockup()&&0==l.clone(this.getSizesForScale(c.forma,c.scale*a,t)).length&&(s=!1,a*=.9)}}for(var h=l.iter(l.range(0,n.length,!1));!h.done;h.next()){var f=h.value;(d=n[f]).forma.isTypeLockup()&&(n[f]={forma:d.forma,size:d.size,scale:d.scale*a})}for(var m={},p=l.iter(n);!p.done;p.next()){var d;m[(d=p.value).forma.formaID]={size:d.size,scale:d.scale}}return m},createChildScales:function(e){var t,n=l.clone(e.controller.getSizeHeightScales());if(this.childScales_[e.formaID]=l.clone(n),t=this.childScales_[e.formaID])if(t.length!=n.length)c.CoreAssert.fail("Error. scales don't match","AlignmentGroupController.createChildScales","AlignmentGroupController.swift",494);else for(var r=l.iter(l.range(0,t.length,!1));!r.done;r.next()){var o=r.value,i=t[o].size.height/n[o].size.height;Math.abs(t[o].scale-n[o].scale*i)>1&&c.CoreAssert.fail("scale error","AlignmentGroupController.createChildScales","AlignmentGroupController.swift",501)}return n},getSizesForScale:function(e,t,n){var r=[],o=l.clone(this.childScales_[e.formaID]);null==o&&(o=l.clone(this.createChildScales(e)));for(var i=l.iter(o);!i.done;i.next()){var a=i.value,s=a.size.multiply(t/a.scale);(null==n||s.width<=n.width&&s.height<=n.height)&&r.push(s)}var u=this.forma.bounds.scaleXY(2,1).size,h=e.bounds.size;if(l.sortInPlace(r,(function(e,t){return 1*e.similarity(h)+e.similarity(u)<1*t.similarity(h)+t.similarity(u)})),null!=n)for(var f=l.iter(r);!f.done;f.next()){var m=f.value;c.CoreAssert.isTrue(m.width<=n.width+.001,void 0,"AlignmentGroupController.getSizesForScale","AlignmentGroupController.swift",548),c.CoreAssert.isTrue(m.height<=n.height+.001,void 0,"AlignmentGroupController.getSizesForScale","AlignmentGroupController.swift",549)}return r},getSeperatorPositions:function(e,t,n){var r;if(e.length>0&&(r=this.alignmentGroupStyle)){if(r.seperatorStyle==u.SeperatorStyle.None)return[];if(r.seperatorStyle==u.SeperatorStyle.FirstInner&&0==t)return[0];if(r.seperatorStyle==u.SeperatorStyle.Inner)return l.toArray(l.stride(0,e.length-1,1));if(r.seperatorStyle==u.SeperatorStyle.Outer&&0==t)return[-1,e.length-1];if(r.seperatorStyle==u.SeperatorStyle.BottomAll)return l.toArray(l.stride(0,e.length,1))}return[]},getColumnLayout:function(e,t){var n;if(n=this.alignmentGroupStyle){for(var r=l.clone(this.splitChildren(l.clone(e),t)),o=r.length,u=null!=n.marginTop?n.marginTop:i.DEFAULT_MARGINS,h=null!=n.marginBottom?n.marginBottom:i.DEFAULT_MARGINS,m=null!=n.marginLeft&&o<2?n.marginLeft:i.DEFAULT_MARGINS,p=null!=n.marginRight&&o<2?n.marginRight:i.DEFAULT_MARGINS,d=new T.TheoRect(t.minX+m,t.minY,t.maxX-p,t.maxY),v=l.clone(d.split(r.length,!0)),S=v[0],y=[],b=l.iter(e);!b.done;b.next())for(var _=b.value,A=l.iter(l.range(0,o,!1));!A.done;A.next()){var F=A.value;if(l.containsEq(r[F],_,f._equality_Forma_Forma)){y.push(F);break}}if(y.length!=e.length)return c.CoreAssert.fail("incorrect number of children in assignment","AlignmentGroupController.getColumnLayout","AlignmentGroupController.swift",624),null;for(var P=l.iter(e);!P.done;P.next())if(_=P.value,null==n.bottomDistances[_.formaID]||null==n.topDistances[_.formaID])return null;for(var x=l.repeat([],o),w=l.repeat([],o),I=l.repeat([],o),M=l.repeat(0,o),G=l.repeat(0,o),L=m/(2*l.toDouble(o)),E=p/(2*l.toDouble(o)),k=new D.TheoSize(S.width-L-E,S.height-u-h),N=l.repeat([],o),R=l.repeat([],o),B=l.clone(this.getDesiredScales(l.clone(e),k)),O=l.repeat([],o),X=l.iter(l.range(0,r.length,!1));!X.done;X.next()){for(var Y=X.value,z=l.clone(r[Y]),H=l.iter(l.range(1,z.length,!1));!H.done;H.next()){var U;F=H.value,null!=n.spacing?x[Y].push(n.spacing):null!=(U=n.bottomDistances[z[F].formaID])?x[Y].push(U):x[Y].push(0)}I[Y]=l.clone(this.getSeperatorPositions(l.clone(z),Y,o));for(var K=l.iter(I[Y]);!K.done;K.next())w[Y].push(null!=n.seperatorHeight?n.seperatorHeight:i.DEFAULT_SEPERATOR_HEIGHT);var V=null!=n.marginTop?n.marginTop:n.bottomDistances[z[0].formaID],j=null!=n.marginBottom?n.marginBottom:n.topDistances[e[z.length-1].formaID];n.verticalAlignment==s.AlignmentType.CenterY&&(j=V=Math.max(V,j)),M[Y]=V,G[Y]=j;for(var W=l.iter(z);!W.done;W.next()){var Z;if(null!=(Z=B[(_=W.value).formaID])){0==(_e=l.clone(this.getSizesForScale(_,Z.scale,k))).length&&(_e=l.clone(this.getSizesForScale(_,Z.scale,null))),R[Y].push(_e[0]),O[Y].push(Z.scale);for(var q=_e[0],J=l.iter(_e);!J.done;J.next()){var Q=J.value;Q.height<q.height&&(q=Q)}N[Y].push(q)}}}for(var $=l.toDouble(e.length-1),ee=!0,te=0;ee&&(100==te&&l.opt(g.Host.logging,(function(e){return e.warning("error")})),!(te>10));){te+=1,ee=!1;for(var ne=0,re=l.iter(l.range(0,o,!1));!re.done;re.next()){var oe=x[Y=re.value].reduce((function(e,t){return e+t}),0),ie=w[Y].reduce((function(e,t){return e+t}),0);if((ne=(De=(Te=N[Y].reduce((function(e,t){return e+t.height}),0))+(j=G[Y])+(V=M[Y])+oe+ie)-S.height)>0){var ae=null==n.spacing?oe-i.MIN_SPACING*$:0,le=null==n.marginTop&&n.verticalAlignment!=s.AlignmentType.Top?V-i.DEFAULT_MARGINS:0,se=null==n.marginBottom&&n.verticalAlignment!=s.AlignmentType.Bottom?j-i.DEFAULT_MARGINS:0;if(ae+le+se>1){for(var ue=ae+le+se,ce=Math.min(ne,ue),he=ce*(ae/ue),fe=ce*(le/ue),me=ce*(se/ue),pe=l.iter(l.range(0,x[Y].length,!1));!pe.done;pe.next())F=pe.value,x[Y][F]-=he*(x[Y][F]/(oe+1e-4));M[Y]-=fe,G[Y]-=me,ee=!0}else{fe=ne*(V/(De+1e-4)),me=ne*(j/(De+1e-4)),he=ne*(oe/(De+1e-4));for(var de=1-ne*(Te/(De+1e-4))/Te,ge=l.iter(l.range(0,o,!1));!ge.done;ge.next()){for(var ve=ge.value,Ce=l.iter(l.range(0,N[ve].length,!1));!Ce.done;Ce.next())F=Ce.value,N[ve][F]=N[ve][F].multiply(de),O[ve][F]=O[ve][F]*de;for(var Se=l.iter(l.range(0,x[ve].length,!1));!Se.done;Se.next())F=Se.value,x[ve][F]-=he*(x[ve][F]/(oe+1e-4)),x[ve][F]=Math.max(x[ve][F],i.MIN_SPACING);M[ve]=Math.max(M[ve]-fe,i.DEFAULT_MARGINS),G[ve]=Math.max(G[ve]-me,i.DEFAULT_MARGINS)}ee=!0}}}}for(var ye=l.iter(l.range(0,o,!1));!ye.done;ye.next()){Y=ye.value;for(var be=l.iter(l.range(0,N[Y].length,!1));!be.done;be.next()){F=be.value;var _e,Ae=r[Y][F],Fe=O[Y][F];(_e=l.clone(this.getSizesForScale(Ae,Fe,k))).length>0&&N[Y][F].height-_e[0].height>0&&(N[Y][F]=_e[0])}oe=x[Y].reduce((function(e,t){return e+t}),0),ie=w[Y].reduce((function(e,t){return e+t}),0);var Te,De=(Te=N[Y].reduce((function(e,t){return e+t.height}),0))+(j=G[Y])+(V=M[Y])+oe+ie,Pe=S.height-De;if(!(Pe<=0)){var xe=n.verticalAlignment!=s.AlignmentType.Top?Pe:0,we=n.verticalAlignment!=s.AlignmentType.Bottom?Pe:0,Ie=xe+we;if(Ie>0){var Me=C.MathUtils.minDouble(Pe,Ie);M[Y]+=Me*(xe/(Ie+1e-4)),G[Y]+=Me*(we/(Ie+1e-4)),Pe-=Me}for(var Ge=null==n.spacing?Pe:0,Le=l.iter(l.range(0,x[Y].length,!1));!Le.done;Le.next())F=Le.value,x[Y][F]+=Ge*(x[Y][F]/(oe+1e-4));Pe-=Ge}}for(var Ee=[],ke=l.iter(l.range(0,o,!1));!ke.done;ke.next()){for(var Ne=[M[Y=ke.value]].concat(x[Y]).concat([G[Y]]),Re=l.iter(Ne);!Re.done;Re.next()){var Be=Re.value;c.CoreAssert.isFalse(isNaN(Be),"not expecting NaN","AlignmentGroupController.getColumnLayout","AlignmentGroupController.swift",929)}Ee.push(l.clone(Ne))}var Oe=l.repeat(L,o),Xe=l.repeat(E,o);return new a.AlignmentColumnLayout(l.clone(v),l.clone(y),l.clone(N),l.clone(O),l.clone(Ee),l.clone(w),l.clone(I),l.clone(Oe),l.clone(Xe))}return null},splitChildren:function(e,t){var n,r=1;if(null!=(n=l.opt(this.alignmentGroupStyle,(function(e){return e.numColumns})))?r=n:e.length>1&&(r=Math.max(1,Math.min(e.length,l.toInt(t.aspectRatio-1)))),1==r)return[e];for(var o=l.toDouble(e.length)/l.toDouble(r),i=[],a=0,s=l.iter(l.range(0,r,!1));!s.done;s.next()){for(var u=s.value,h=[];l.toDouble(a)<l.toDouble(u+1)*o&&a<e.length;)h.push(e[a]),a+=1;i.push(l.clone(h))}return c.CoreAssert.isTrue(a==e.length,void 0,"AlignmentGroupController.splitChildren","AlignmentGroupController.swift",1005),i},applyStyle:function(e,t){var n,r;(n=l.as(e,u.AlignmentGroupStyle))&&(r=this.alignmentGroupStyle)&&(r.match(n),this.setFormaDistances(l.clone(this.getSortedChildren())),this.layoutGroup())},createLayoutItemsFromColumnLayout:function(e,t){var n,r=[];if(n=this.alignmentGroupStyle){for(var o=l.iter(l.range(0,t.columns.length,!1));!o.done;o.next()){for(var i=o.value,h=t.columns[i],f=l.clone(t.contentSizes[i]),m=l.clone(t.contentScales[i]),p=l.clone(t.contentSpacing[i]),d=l.clone(t.seperatorHeights[i]),g=l.clone(t.seperatorPositions[i]),v=p[0],C=[],S=l.iter(l.range(0,e.length,!1));!S.done;S.next()){var y=S.value;t.contentColumn[y]==i&&C.push(e[y])}c.CoreAssert.isTrue(C.length==f.length,void 0,"AlignmentGroupController.createLayoutItemsFromColumnLayout","AlignmentGroupController.swift",1061);for(var b=[],_=l.iter(l.range(0,f.length,!1));!_.done;_.next()){y=_.value;var A=new F.TheoPoint(h.center.x,v),T=new F.TheoPoint(.5,0);n.horizontalAlignment==s.AlignmentType.Left?(A=new F.TheoPoint(h.minX+t.marginLeft[i],v),T=new F.TheoPoint(0,0)):n.horizontalAlignment==s.AlignmentType.Right&&(A=new F.TheoPoint(h.maxX-t.marginRight[i],v),T=new F.TheoPoint(1,0));var P=l.clone(new a.AlignmentLayoutItem(C[y],a.AlignmentGroupItemType.DefaultContent,T,A,f[y],m[y],null,null));b.push(l.clone(P)),r.push(l.clone(P)),v+=f[y].height+p[y+1]}for(var x=0,w=l.iter(l.range(0,f.length,!1));!w.done;w.next())y=w.value,x=Math.max(x,f[y].width);for(var I=l.iter(l.range(0,d.length,!1));!I.done;I.next()){var M=g[y=I.value];P=null,P=-1==M?l.clone(b[0]):M>=b.length?l.clone(b[b.length-1]):l.clone(b[M]);var G=new D.TheoSize(.75*x,d[y]),L=null;if(n.seperatorStyle==u.SeperatorStyle.FirstInner||n.seperatorStyle==u.SeperatorStyle.BottomAll)L=new F.TheoPoint(P.parentPosition.x,P.parentPosition.y+P.size.height);else if(n.seperatorStyle==u.SeperatorStyle.Outer)G=new D.TheoSize(.75*x,d[y]),L=-1==M?new F.TheoPoint(P.parentPosition.x,P.parentPosition.y-G.height):new F.TheoPoint(P.parentPosition.x,P.parentPosition.y+P.size.height);else if(n.seperatorStyle==u.SeperatorStyle.Inner){var E=l.clone(b[M+1]);L=new F.TheoPoint(P.parentPosition.x,(P.parentPosition.y+P.size.height+E.parentPosition.y)/2)}r.push(l.clone(new a.AlignmentLayoutItem(null,a.AlignmentGroupItemType.SeperatorShape,P.formaPin,L,G,null,n.seperatorArtworkID,n.colors.fieldSecondary)))}}null!=n.backingArtworkID&&r.push(l.clone(new a.AlignmentLayoutItem(null,a.AlignmentGroupItemType.BackingShape,F.TheoPoint.ZERO,F.TheoPoint.ZERO,this.forma.bounds.size,null,n.backingArtworkID,n.colors.fieldPrimary)))}return r},applyColors:function(e,t){void 0===t&&(t=h.ColorRole.FieldPrimary),p.GroupController.prototype.applyColors.call(this,l.clone(e),t),this.updateBackingShape()},conformFormaToLayoutItems:function(e,t){for(var n=this,r=l.clone(this.forma.filterWithCallback((function(e){return null==e.controller&&e.kind==S.ShapeForma.KIND&&e!=n.backingShape_}),f.FormaTraversal.JustChildren)),o=l.iter(t);!o.done;o.next()){var i=o.value;if(i.type==a.AlignmentGroupItemType.DefaultContent&&null!=i.forma){var s=i.forma.placement.transformValues;l.opt(i.forma.controller,(function(e){return e.fit(T.TheoRect.fromSize(i.size))})),i.forma.move(v.Matrix2D.scalingXY(s.xscale,s.yscale)),i.forma.move(v.Matrix2D.rotation(s.rotCosine,s.rotSine)),i.forma.movePinToPoint(i.formaPin,i.parentPosition),l.opt(i.forma.controller,(function(e){return e.setAlignmentType(n.alignmentGroupStyle.horizontalAlignment)}))}else if(i.type!=a.AlignmentGroupItemType.SeperatorShape&&i.type!=a.AlignmentGroupItemType.BulletShape||null==i.artworkID){if(i.type==a.AlignmentGroupItemType.BackingShape&&null!=i.artworkID){if(null==this.backingShape_){for(var u=l.iter(this.forma.visitAsArray(f.FormaTraversal.JustChildren));!u.done;u.next()){var c=u.value;c.formaID==this.backingShapeID_&&c instanceof S.ShapeForma&&(this.backingShape_=l.as(c,S.ShapeForma),r.includes(this.backingShape_)&&l.remove(r,this.backingShape_))}null==this.backingShape_&&(this.backingShape_=l.as(this.forma.page.createForma(S.ShapeForma.KIND),S.ShapeForma),this.backingShapeID_=this.backingShape_.formaID,(C=this.forma).insertChildAt(this.backingShape_,0))}if(null!=this.backingShape_){b.ShapeLibrary.applyToShapeForma(this.backingShape_,i.artworkID),this.backingShape_.style.opacity=this.alignmentGroupStyle.opacity,(A=i.primaryColor)&&(this.backingShape_.style.colors.fieldPrimary=A);var h,m=T.TheoRect.fromSize(i.size);null!=(h=l.opt(this.alignmentGroupStyle,(function(e){return e.padding})))&&(m=m.outsetXY(h*m.width*.5,h*m.height*.5));var p=new _.SVGBackgroundDecorationStrategy(i.artworkID).calcSVGFrame(m),d=p.frame,g=p.preScale;this.backingShape_.preScale=g,this.backingShape_.size=d.size,this.backingShape_.movePinToPoint(i.formaPin,i.parentPosition),this.backingShape_.move(v.Matrix2D.translationXY(d.minX,d.minY))}}}else{var C,y,A,F=null;0==r.length?(F=l.as(this.forma.page.createForma(S.ShapeForma.KIND),S.ShapeForma),(C=this.forma).insertChildAt(F,C.childCount-1)):F=r.pop(),(y=F)&&(b.ShapeLibrary.applyToShapeForma(y,i.artworkID),(A=i.primaryColor)&&(y.style.colors.fieldPrimary=A),y.size=i.size,y.movePinToPoint(i.formaPin,i.parentPosition))}}for(var D=l.iter(r);!D.done;D.next())D.value.removeFromParent();l.opt(this.alignmentGroupStyle,(function(e){return null==e.backingArtworkID}))&&(l.opt(this.backingShape_,(function(e){return e.removeFromParent()})),this.backingShapeID_=null,this.backingShape_=null)},updateBackingShape:function(){var e;if(e=this.alignmentGroupStyle){var t=l.clone(this.getSortedChildren());if(null!=e.backingArtworkID){var n=l.clone(new a.AlignmentLayoutItem(null,a.AlignmentGroupItemType.BackingShape,F.TheoPoint.ZERO,F.TheoPoint.ZERO,this.forma.bounds.size,null,e.backingArtworkID,e.colors.fieldPrimary));this.conformFormaToLayoutItems(l.clone(t),[n])}}},layoutGroup:function(){var e,t,n=l.clone(this.getSortedChildren());if(n.length<1||this.blockAlignmentLayout_)this.updateBackingShape();else if((e=this.forma.bounds)&&(t=this.getColumnLayout(l.clone(n),e))){var r=l.clone(this.createLayoutItemsFromColumnLayout(l.clone(n),l.clone(t)));this.conformFormaToLayoutItems(l.clone(n),l.clone(r))}},fit:function(e){var t;(t=this.forma)&&(this.blockAlignmentLayout_=null==this.getChildrenAlignment(),t.bounds=T.TheoRect.fromSize(e.size),t.placement=v.Matrix2D.translation(e.origin),this.updateParentGroup(),this.blockAlignmentLayout_=!1)},updateChildren:function(){var e,t,n;if((e=this.oldBounds)&&(t=l.opt(this.forma,(function(e){return e.bounds})))&&(n=this.alignmentGroupStyle))for(var r=t.height/e.height,o=l.keys(n.bottomDistances),i=l.iter(o);!i.done;i.next()){var a=i.value;n.setBottomDistance(a,n.bottomDistances[a]*r),n.setTopDistance(a,n.topDistances[a]*r)}},match:function(e){this.blockAlignmentLayout_=!0,p.GroupController.prototype.match.call(this,e),this.blockAlignmentLayout_=!1},updateGroup:function(){this.blockUpdate||this.blockChildUpdates_||(this.blockChildUpdates_=!0,p.GroupController.prototype.updateGroup.call(this),this.updateChildren(),this.layoutGroup(),this.blockChildUpdates_=!1)},setFormaDistances:function(e){var t={},n={};if(!(e.length<1)){for(var r,o=l.clone(this.splitChildren(l.clone(e),this.forma.bounds)),i=l.iter(o);!i.done;i.next())for(var a=i.value,s=l.iter(l.range(0,a.length,!1));!s.done;s.next()){var u=s.value,c=0,h=0,f=a[u];l.opt(g.Host.logging,(function(e){return e.info("child frame "+f.finalFrame)})),c=u<a.length-1?this.getFormaFrame(a[u+1]).minY-this.getFormaFrame(f).maxY:Math.max(this.forma.bounds.maxY-this.getFormaFrame(f).maxY,0),((h=u>0?this.getFormaFrame(f).minY-this.getFormaFrame(a[u-1]).maxY:Math.max(this.getFormaFrame(f).minY-this.forma.bounds.minY,0))<0||c<0)&&l.opt(g.Host.logging,(function(e){return e.info("possible error with negative distances")})),n[f.formaID]=h,t[f.formaID]=c,l.opt(g.Host.logging,(function(e){return e.info("forma "+f.formaID+" has bottom distance: "+h+" top distance: "+c)}))}if(r=this.alignmentGroupStyle)for(var m=l.iter(l.keys(t));!m.done;m.next()){var p=m.value;r.setTopDistance(p,t[p]),r.setBottomDistance(p,n[p])}}},getFormaFrame:function(e,t){void 0===t&&(t=!1);var n,r=t?e.finalFrame:e.frame;if(n=l.as(e.controller,A.TypeLockupController)){var o=n.textFinalFrame,i=n.textFrame;null!=o&&null!=i?r=t?o:i:l.opt(g.Host.logging,(function(e){return e.error("text frame nil")}))}return r},addFormaToGroup:function(e){var t;if(t=l.as(this.forma,d.GroupForma)){if(null!=t.indexOfChild(e))return void c.CoreAssert.fail("can't add an existing child","AlignmentGroupController.addFormaToGroup","AlignmentGroupController.swift",1516);t.appendChild(e,!0),this.setAlignmentSortOrder(),this.setFormaDistances(l.clone(this.getSortedChildren()))}},insertForma:function(e,t,n){var r,o;if(void 0===t&&(t=null),void 0===n&&(n=!0),(r=l.as(this.forma,d.GroupForma))&&(o=this.alignmentGroupStyle)){if(null!=r.indexOfChild(e))return void c.CoreAssert.fail("can't insert an existing child","AlignmentGroupController.insertForma","AlignmentGroupController.swift",1537);var i=l.clone(this.getSortedChildren());if(null!=t&&(t<0||t>i.length))return void c.CoreAssert.fail("index not valid ","AlignmentGroupController.insertForma","AlignmentGroupController.swift",1545);var a=this.getFormaFrame(e),s=null!=t?t:0;if(null==t)for(var u=l.iter(l.range(0,i.length,!1));!u.done;u.next()){var h=u.value;a.minY>this.getFormaFrame(i[h]).minY&&(s=h+1)}0==s?(o.setBottomDistance(e.formaID,o.bottomDistances[i[0].formaID]),o.setTopDistance(e.formaID,o.topDistances[i[0].formaID]),o.setBottomDistance(i[0].formaID,o.topDistances[e.formaID])):s==i.length?(o.setBottomDistance(e.formaID,o.bottomDistances[i[s-1].formaID]),o.setTopDistance(e.formaID,o.topDistances[i[s-1].formaID]),o.setTopDistance(i[s-1].formaID,o.bottomDistances[e.formaID])):(o.setBottomDistance(e.formaID,o.topDistances[i[s-1].formaID]),o.setTopDistance(e.formaID,o.topDistances[i[s-1].formaID]));var f=l.clone(o.order);f.splice(s,0,e.formaID),o.setOrder(l.clone(f)),null!=o.topDistances[e.formaID]&&null!=o.bottomDistances[e.formaID]||c.CoreAssert.fail("missing distances","AlignmentGroupController.insertForma","AlignmentGroupController.swift",1642),r.appendChild(e,!0),this.layoutGroup()}},removeFormaFromGroup:function(e){var t;p.GroupController.prototype.removeFormaFromGroup.call(this,e),(t=this.alignmentGroupStyle)&&(t.removeChild(e.formaID),this.inferStyleProperties())},handleRemoval:function(){for(var e=l.iter(this.getSortedChildren());!e.done;e.next()){var t=e.value;l.opt(l.opt(this.forma,(function(e){return e.parent})),(function(e){return e.appendChild(t,!0)}))}},scaleChildren:function(e){},beginChildResizeEvent:function(e){this.updatedChild=e.forma},endChildResizeEvent:function(e){this.updatedChild=null,l.removeKey(this.childScales_,e.forma.formaID)},childUpdate:function(e){void 0===e&&(e=null)},processBeginFormaDrag:function(e){p.GroupController.prototype.processBeginFormaDrag.call(this,e)},processEndFormaDrag:function(e){p.GroupController.prototype.processEndFormaDrag.call(this,e),this.containsForma(e.forma)||(l.opt(l.opt(this.forma,(function(e){return e.parent})),(function(t){return t.appendChild(e.forma,!0)})),l.opt(this.alignmentGroupStyle,(function(t){return t.removeChild(e.forma.formaID)}))),this.inferStyleProperties(),this.claimSiblingForma()},afterProcessEndFormaDrag:function(e){this.containsForma(e.forma)||(l.opt(l.opt(this.forma,(function(e){return e.parent})),(function(t){return t.appendChild(e.forma,!0)})),l.opt(this.alignmentGroupStyle,(function(t){return t.removeChild(e.forma.formaID)}))),this.inferStyleProperties(),this.claimSiblingForma()},processFormaDrag:function(e){p.GroupController.prototype.processFormaDrag.call(this,e)},inferStyleProperties:function(){var e;if(e=this.alignmentGroupStyle){this.setAlignmentSortOrder();var t,n,r=l.clone(this.getSortedChildren());this.setFormaDistances(l.clone(r)),e.spacing=null,r.length>0&&null!=(t=e.bottomDistances[r[0].formaID])&&null!=(n=e.topDistances[r[r.length-1].formaID])&&(e.verticalAlignment=t>2*n&&t>50?s.AlignmentType.Bottom:n>2*t&&n>50?s.AlignmentType.Top:s.AlignmentType.CenterY);var o=this.getChildrenAlignment();null!=o&&(this.alignmentGroupStyle.horizontalAlignment=o),this.childrenAligned_=null!=o||r.length<=1}},canClaimForma:function(e){var t,n,r=e.finalFrame,o=l.opt(this.forma,(function(e){return e.finalFrame}));if(null!=r&&null!=o&&(t=l.opt(this.forma,(function(e){return e.parent})))&&(n=this.alignmentGroupStyle)){if(n.layoutMode==u.GroupLayoutMode.None)return!1;var i,a;if(e.parent==t&&null!=(i=t.indexOfChild(this.forma))&&null!=(a=t.indexOfChild(e))&&i>a)return!1;if(this.containsForma(e))return!0}return!1},claimForma:function(e){p.GroupController.prototype.claimForma.call(this,e),this.forma!=e.parent&&!l.eq(f._equality_Forma_Forma,this.forma,e)&&this.canClaimForma(e)&&this.inferStyleProperties()},claimSiblingForma:function(){for(var e=l.iter(this.forma.siblingForma());!e.done;e.next()){var t=e.value;this.claimForma(t)}},getChildrenAlignment:function(){var e=l.clone(this.moveableFormae());if(0==e.length)return null;var t,n=1,r=l.first(e);(t=l.opt(l.opt(r,(function(e){return e.page.view})),(function(e){return e.getViewportTransform()})))&&(n=Math.sqrt(Math.abs(t.determinant)));for(var o,i=s.AlignmentDetector.DISTANCE_THRESHOLD/n,a=l.iter(e);!a.done;a.next()){var u=a.value;if(u.placement.transformValues.rotCosine<.99)return null;for(var c,h=0,m={},p=l.clone(s.AlignmentDetector.init_a05b(u).detectFormaAlignments(2*i)),d=l.iter(e);!d.done;d.next()){var g=d.value;if(!l.eq(f._equality_Forma_Forma,u,g)&&u.finalFrame.xDistance(g.finalFrame)<=0){h+=1;for(var v=l.iter(p);!v.done;v.next()){var C,S=v.value;l.eq(f._equality_Forma_Forma,S.forma,g)&&(null!=(C=m[S.line.type])?m[S.line.type]=C+1:m[S.line.type]=1)}}}for(var y=l.iter(m,!0);!y.done;y.next()){var b=y.key;y.value==h&&(c=s.AlignmentType.toCaseValue(b))}if(0==h)c=l.opt(u.controller,(function(e){return e.preferredXAlignment}));else if(null==c)return null;o=c}return o},preferredXAlignment:{get:function(){return l.opt(this.alignmentGroupStyle,(function(e){return e.horizontalAlignment}))}},setupWithFormae:function(e,t,n){if(void 0===t&&(t=null),void 0===n&&(n=null),0!=e.length){var r=n;null==r&&(r=e[0]);var o,i=t;null==i&&(i=null!=(o=l.opt(r.controller,(function(e){return e.preferredXAlignment})))?o:s.AlignmentType.CenterX),this.setHorizontalAlignment(i,n);for(var a,u=null,c=l.iter(e);!c.done;c.next()){var h=c.value;u=T.TheoRect.unionOf(u,this.getFormaFrame(h,!0))}(a=u)&&l.opt(this.forma,(function(e){return e.placement}))&&(l.opt(this.forma,(function(e){return e.bounds=T.TheoRect.fromSize(a.size)})),l.opt(this.forma,(function(e){return e.placement=v.Matrix2D.translationXY(a.minX,a.minY)})));for(var f=l.iter(e);!f.done;f.next())h=f.value,p.GroupController.prototype.addFormaToGroup.call(this,h);this.setFormaDistances(l.clone(this.getSortedChildren()))}},processBeginFormaResize:function(e){p.GroupController.prototype.processBeginFormaResize.call(this,e),this.childrenAligned_=null!=this.getChildrenAlignment()},processFormaResize:function(e){this.blockAlignmentLayout_=!0;var t,n,r=null;if((n=e.pin)&&(r=this.forma.totalPlacement.transformPoint(this.forma.bounds.eval(n))),this.forma.placement=this.forma.placement.scaleTo(1,1),this.forma.bounds=T.TheoRect.fromSize(e.newSize),(t=r)&&(n=e.pin)){var o=this.forma.totalPlacement.transformPoint(this.forma.bounds.eval(n));this.forma.move(v.Matrix2D.translation(t.subtract(o)))}this.updateParentGroup()},processEndFormaResize:function(e){p.GroupController.prototype.processEndFormaResize.call(this,e),this.blockAlignmentLayout_=!1,this.claimSiblingForma()},dispose:function(){},clone:function(e){return new m.FormaControllerFactory(this.owner).createController(this.kind,e)}}}),i)},"aen+":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("H9Ol");o.AbsolutePositionController=(r=function(e,t,n){a.FormaController.call(this,e,t,n)},i.defineClass({name:"AbsolutePositionController",ctor:r,superName:"FormaController",statics:{KIND:{get:function(){return"AbsolutePositionController"}}}}),r)},bccX:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("7siz");o.IAttributesModel=i.defineProtocol("IAttributesModel",{find:"(String) -> IEditorAttribute"}),o.AttributesState=(r=function(e){void 0===e&&(e=null),this.attributes=i.clone(e||{})},i.defineClass({name:"AttributesState",ctor:r,superName:"EditorStateMember",statics:{_implements:function(e){return"IAttributesModel"==e}},props:{clone:function(){return new r(i.clone(this.attributes))},find:function(e){return this.attributes[e]},add:function(e){this.beforeChange(),this.attributes[e.key]=e,this.afterChange()},remove:function(e){this.beforeChange(),i.removeKey(this.attributes,e),this.afterChange()},clear:function(){this.beforeChange(),i.removeAll(this.attributes),this.afterChange()},diff:function(e){for(var t=[],n=i.iter(this.attributes);!n.done;n.next()){var r,o=n.key,l=n.value;(r=e.attributes[o])&&l.isEqualTo(r)||t.push(a.EditorModelChangedMessage.CHG_ATTRIBUTE_PREFIX+o)}for(var s=i.iter(e.attributes);!s.done;s.next())o=s.key,null==this.attributes[o]&&t.push(a.EditorModelChangedMessage.CHG_ATTRIBUTE_PREFIX+o);return t}}}),r)},d820:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("7siz");o.IHandlesModel=i.defineProtocol("IHandlesModel",{getAll:"() -> Array<BaseHandle>"}),o.IMutableHandlesModel=i.defineProtocol("IMutableHandlesModel",{clear:"() -> Void",setAll:"(Array<BaseHandle>) -> Void"}),o.HandlesState=(r=function(e){void 0===e&&(e=null),this.handles=i.clone(e||[])},i.defineClass({name:"HandlesState",ctor:r,superName:"EditorStateMember",statics:{_implements:function(e){return"IMutableHandlesModel"==e||"IHandlesModel"==e}},props:{clone:function(){return new r(i.clone(this.handles))},getAll:function(){return this.handles},clear:function(){this.setAll([])},setAll:function(e){this.beforeChange(),this.handles=i.clone(e),this.afterChange()},diff:function(e){return[a.EditorModelChangedMessage.CHG_HANDLES]}}}),r)},dHJt:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("SpAV"),l=n("16hp"),s=n("6Rk9"),u=n("tGKA"),c=n("oKlP");o.BadgeLayoutController=(r=function(e,t){void 0===t&&(t=!0),this._formae=i.clone(e),this._usePerceivedBounds=t},i.defineClass({name:"BadgeLayoutController",ctor:r,props:{update:function(){if(0!=this._formae.length){var e=this._formae[0],t=e.page.root,n=s.GeometryFacade.getFormaeBounds(i.clone(this._formae),this._usePerceivedBounds),r=new l.FormaPlacementSuggester(e,t),o=i.clone(r.createPlacementSuggestions(!0,n.aspectRatio));if(0==!o.length)for(var h=o[0].location,f=h.height/n.height,m=u.Matrix2D.translation(h.origin),p=i.iter(this._formae);!p.done;p.next()){var d=p.value;d.bounds=d.bounds.scale(f,c.TheoPoint.ZERO);var g=d.totalPlacement,v=(g.tx-n.minX)*f,C=(g.ty-n.minY)*f;d.placement=new u.Matrix2D(g.a,g.b,g.c,g.d,v,C).concat(m)}else a.CoreAssert.warning("Did not find a placement suggestion for badge.")}}}}),r)},k7ZV:function(e,t,n){n("oAGj")},lgJd:function(e,t,n){n("oAGj")},mD2h:function(e,t,n){var r,o,i,a=t,l=n("oAGj"),s=n("7siz"),u=n("FNB+");a.IActiveSwapModel=l.defineProtocol("IActiveSwapModel",{getActive:"() -> ActiveSwap"}),a.ActiveSwap=(r=function(e,t){this.swapThumbnailForma=e,this.swapThumbnailLocation=t},o={},l.defineClass({name:"ActiveSwap",ctor:r,superName:"CoreObject",statics:{NONE:{get:function(){return void 0===o.NONE&&(o.NONE=new r(null,null)),o.NONE}}}}),r),a.ActiveSwapState=(i=function(e){void 0===e&&(e=null),this.activeSwap=e||a.ActiveSwap.NONE},l.defineClass({name:"ActiveSwapState",ctor:i,superName:"EditorStateMember",statics:{_implements:function(e){return"IActiveSwapModel"==e}},props:{clone:function(){return new i(this.activeSwap)},getActive:function(){return this.activeSwap},setActive:function(e){this.beforeChange(),this.activeSwap=e,this.afterChange()},diff:function(e){return l.eq(u._equality_Forma_Forma,this.activeSwap.swapThumbnailForma,e.activeSwap.swapThumbnailForma)&&this.activeSwap.swapThumbnailLocation==e.activeSwap.swapThumbnailLocation?[]:[s.EditorModelChangedMessage.CHG_SWAP_STATE]}}}),i)},voLh:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),l=n("FNB+"),s=n("P83h"),u=n("oKlP");o.ProportionalLayoutController=(r=function(e){this.group_=e,this.oldBounds_={},a.CoreObject.call(this)},i.defineClass({name:"ProportionalLayoutController",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"ResizeLayoutController"==e}},props:{setInitBounds:function(){this.oldBounds_[this.group_.formaID]=this.group_.bounds},beginUpdateGroup:function(){this.startBounds_=this.group_.bounds,null==this.oldBounds_[this.group_.formaID]&&(this.oldBounds_[this.group_.formaID]=this.group_.bounds);for(var e=i.iter(this.group_.visitAsArray(l.FormaTraversal.JustChildren));!e.done;e.next()){var t=e.value;null==this.oldBounds_[t.formaID]&&(this.oldBounds_[t.formaID]=t.bounds)}},updateGroup:function(){if(null!=this.startBounds_){var e=this.startBounds_.size,t=this.group_.bounds.size,n=new u.TheoPoint(t.width/e.width,t.height/e.height),r=new s.FormaAnimationTransactionEvent(this.group_);this.group_.beginUpdate(r);for(var o=i.iter(this.group_.visitAsArray(l.FormaTraversal.JustChildren));!o.done;o.next()){var a,c,h,f=o.value;if((a=f.frame)&&(c=this.oldBounds_[f.formaID])&&(h=this.oldBounds_[this.group_.formaID])&&a.area>0){var m=f.placement.transformValues,p=Math.abs(m.rotCosine)/(Math.abs(m.rotCosine)+Math.abs(m.rotSine)),d=Math.abs(m.rotSine)/(Math.abs(m.rotCosine)+Math.abs(m.rotSine)),g=new u.TheoPoint(n.x*p+n.y*d,n.x*d+n.y*p);if(null!=f.controller&&f.controller.maintainAspectRatio){var v=new u.TheoPoint(t.width/h.size.width,t.height/h.size.height),C=new u.TheoPoint(v.x*p+v.y*d,v.x*d+v.y*p),S=Math.min(C.x,C.y);f.bounds=c.scaleXY(S,S,new u.TheoPoint(0,0))}else f.bounds=i.opt(f.bounds,(function(e){return e.scaleXY(g.x,g.y,new u.TheoPoint(0,0))}));f.moveCenterToPoint(new u.TheoPoint(a.center.x*n.x,a.center.y*n.y))}}this.group_.endUpdate(r)}},endUpdateGroup:function(){}}}),r)},waL6:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("XmBt"),l=n("SpAV"),s=n("gXiO"),u=n("6ZWm"),c=n("9Lk3"),h=n("ZK0l"),f=n("NkBu"),m=n("uxH+"),p=n("JO5d"),d=n("hpGl"),g=n("8t9B"),v=n("fGVU");o.FormaControllerFactory=(r=function(e){this.constructors_={},this.owner_=e,s.CoreObject.call(this),this.setConstructors()},i.defineClass({name:"FormaControllerFactory",ctor:r,superName:"CoreObject",props:{owner:{get:function(){return this.owner_},set:function(e){this.owner_=e,this.setConstructors()}},setConstructors:function(){var e=this;this.constructors_[h.GroupController.KIND]=function(t,n,r){return new h.GroupController(t,n,i.opt(e,(function(e){return e.owner_})))},this.constructors_[m.RootController.KIND]=function(t,n,r){return new m.RootController(t,n,i.opt(e,(function(e){return e.owner_})))},this.constructors_[u.FrameController.KIND]=function(t,n,r){return new u.FrameController(t,n,i.opt(e,(function(e){return e.owner_})))},this.constructors_[f.ImageController.KIND]=function(t,n,r){return new f.ImageController(t,n,i.opt(e,(function(e){return e.owner_})))},this.constructors_[v.VideoController.KIND]=function(t,n,r){return new v.VideoController(t,n,i.opt(e,(function(e){return e.owner_})))},this.constructors_[p.ShapeController.KIND]=function(t,n,r){return new p.ShapeController(t,n,i.opt(e,(function(e){return e.owner_})))},this.constructors_[g.TypeLockupController.KIND]=function(t,n,r){return new g.TypeLockupController(t,n,i.opt(e,(function(e){return e.owner_})))},this.constructors_[a.AlignmentGroupController.KIND]=function(t,n,r){return new a.AlignmentGroupController(t,n,i.opt(e,(function(e){return e.owner_})))},this.constructors_[c.GridController.KIND]=function(t,n,r){return new c.GridController(t,n,i.opt(e,(function(e){return e.owner_})))},this.constructors_[d.ShapeGroupController.KIND]=function(t,n,r){return new d.ShapeGroupController(t,n,i.opt(e,(function(e){return e.owner_})))},this.constructors_.AbsolutePositionController=function(t,n,r){return new m.RootController(t,n,i.opt(e,(function(e){return e.owner_})))},this.constructors_.responsive=function(t,n,r){return new h.GroupController(t,n,i.opt(e,(function(e){return e.owner_})))}},createController:function(e,t){var n=this.constructors_[e];return null==n?(l.CoreAssert.warning("createController: No constructor for kind "+e+" available."),null):n(e,t,this.owner_)}}}),r)}}]);
//# sourceMappingURL=vendors_npm_spark_133cb50e-0b685fe4.js.map