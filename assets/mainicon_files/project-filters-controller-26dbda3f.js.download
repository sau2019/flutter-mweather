(window.webpackJsonp=window.webpackJsonp||[]).push([["project-filters-controller"],{890:function(e,t,r){var i,s;i=[r(1),r(0),r(2),r(3),r(8),r(5),r(26)],void 0===(s=function(e,t,r,i,s,n,o){"use strict";var a={types:{modifiedDate:{requiresManifest:!1,ascendingString:s.getString("organizer-project-sort-oldest-first"),descendingString:s.getString("organizer-project-sort-newest-first"),defaultToAscending:!1},projectName:{requiresManifest:!0,ascendingString:s.getString("organizer-project-sort-alpha"),descendingString:s.getString("organizer-project-sort-alpha-reverse"),defaultToAscending:!0}},enabledTypes:{},formatOrder:["post","page","video"],menuOrder:["modifiedDate","projectName"]};return r.Model.extend({_currentFiltersDataVersion:1,initialize:function(e){this.projectFilterId=e.projectFilterId,this._storageItemId="_mrvl-project-filters-settings-"+this.projectFilterId,this._setupProjectFilters()},_setupProjectFilters:function(){if(n.hasFeature("organizer-project-filters-are-sticky")&&window.localStorage){var e;try{e=window.localStorage.getItem(this._storageItemId)}catch(e){window.marvel.logger.debug("local storage error retrieving projectFiltersString",e)}if(e)try{var r=JSON.parse(e);this._projectFiltersSettings=this._versionCheckStickyProjectFilters(r)}catch(e){window.marvel.logger.error("error parsing projectFiltersString",e)}}var i=0;t.each(a.types,function(e,t){e.id=t,n.hasFeature("organizer-project-filters-sort-"+t)&&(a.enabledTypes[t]=e,i++)}.bind(this)),0===i?a.singleTypeSettings=a.types.modifiedDate:1===i&&t.find(a.enabledTypes,function(e,t){return a.singleTypeSettings=e,!0}.bind(this)),this._projectFiltersSettings&&this._setSortTypeToDefault(this._projectFiltersSettings),this._projectFiltersSettings=this._projectFiltersSettings||this._getProjectFilterDefaults()},_setSortTypeToDefault:function(e){a.enabledTypes.modifiedDate?e.currentSortType="modifiedDate":e.currentSortType=t.find(a.menuOrder,function(e){return!!a.enabledTypes[e]}.bind(this))},_getProjectFilterDefaults:function(){var e={apps:{},currentSortType:"modifiedDate",sorting:{modifiedDate:-1}};return t.each(o.apps,function(t){if(t.isaProjectFormat()){var r=t.typeName;t.isEnabled()&&(e.apps[r]={show:!0})}}.bind(this)),t.each(a.enabledTypes,(function(t,r){e.sorting[r]=t.defaultToAscending?1:-1})),this._setSortTypeToDefault(e),e},_versionCheckStickyProjectFilters:function(e){return e.dataVersion===this._currentFiltersDataVersion?e:this._getProjectFilterDefaults()},reapplyFilters:function(){return this._triggerProjectsRefresh()},_triggerProjectsRefresh:function(){var e=i.defer();return marvel.events.trigger("project-filters-updated",{refreshDefer:e,projectFilterId:this.projectFilterId,requiresManifest:this.filteringRequiresManifest()}),e.promise},_projectFiltersUpdated:function(){if(n.hasFeature("organizer-project-filters-are-sticky")&&window.localStorage)try{this._projectFiltersSettings.dataVersion=this._currentFiltersDataVersion,window.localStorage.setItem(this._storageItemId,JSON.stringify(this._projectFiltersSettings))}catch(e){window.marvel.logger.error("error writing project-filters-settings",e)}return this._triggerProjectsRefresh()},toggleSort:function(e){return this._projectFiltersSettings.sorting[e]*=-1,this._projectFiltersUpdated()},applySortFromMenuItemValue:function(e){var t=e.split(":"),r=a.enabledTypes[t[0]];return"ascending"===t[1]?this._projectFiltersSettings.sorting[r.id]=1:this._projectFiltersSettings.sorting[r.id]=-1,this._projectFiltersSettings.currentSortType=r.id,this._projectFiltersUpdated()},applyAppFilter:function(e){var r;if(t.isArray(e)&&(1===e.length?e=e[0]:r=e),r)t.each(this._projectFiltersSettings.apps,(function(e,t){e.show=-1!==r.indexOf(t)}));else{var i="all"===e;t.each(this._projectFiltersSettings.apps,(function(t,r){t.show=i||e===r}))}return this._projectFiltersUpdated()},isSortTypeAscending:function(e){return 1===this._projectFiltersSettings.sorting[e]},shouldShowAppProjects:function(e){var r;r=t.isObject(e)?e.typeName:e;var i=this._projectFiltersSettings.apps[r];return!i||i.show},filteringRequiresManifest:function(){var e=this._projectFiltersSettings.currentSortType||"modifiedDate";return!!a.types[e].requiresManifest},sortDocRefs:function(e,r){var i=r||this._projectFiltersSettings.currentSortType||"modifiedDate",s=this._projectFiltersSettings.sorting[i],n=[];if("modifiedDate"===i)n=t.sortBy(e,(function(e){var t,r=e.get("modified");return t=r?new Date(r):new Date,s*t.getTime()}));else{if("projectName"!==i)return window.marvel.logger.debug("unknown filter sort type:"+i),this.sortDocRefs(e,"modifiedDate");n=t.sortBy(e,(function(e){return(e._modelDoc&&e._modelDoc.getProjectName("card")||"").trim().toLowerCase()})),-1===s&&n.reverse()}return n},doProjectsNeedRefreshBeforeOrganizerLoad:function(e){var r=!1;if(e&&"OrganizerView"===e.cachename)r=!1;else if(!n.hasFeature("organizer-project-filters-are-sticky")){var i=this._getProjectFilterDefaults();t.isEqual(i,this._projectFiltersSettings)||(r=!0)}return r},refreshingProjects:function(){n.hasFeature("organizer-project-filters-are-sticky")||(this._projectFiltersSettings=this._getProjectFilterDefaults())},getSortingMenuItemIdForCurrentType:function(){var e=this._projectFiltersSettings.currentSortType,t=a.enabledTypes[e],r=-1===this._projectFiltersSettings.sorting[e]?"descending":"ascending";return t.id+":"+r},getAppTypesToShow:function(){var e=[];return t.each(this._projectFiltersSettings.apps,(function(t,r){t.show&&e.push(r)})),e},_getOneSortDropdownItemData:function(e,t,r){var i=r?"ascending":"descending";return{name:e[i+"String"],id:t+":"+i}},getSingleTypeSorting:function(){return a.singleTypeSettings},getAppsItemsDataForSortDropdown:function(){if(!this._sortDropdownItemsData){var e=[];t.each(a.menuOrder,function(t){var r=a.enabledTypes[t];if(r){var i=this._getOneSortDropdownItemData(r,t,!0),s=this._getOneSortDropdownItemData(r,t,!1);r.defaultToAscending?e.push(i,s):e.push(s,i)}}.bind(this)),this._sortDropdownItemsData=e}return this._sortDropdownItemsData},getAppsItemsDataForDropdown:function(){if(!this._appsDropdownItemsData){var e=[];t.each(o.apps,function(t){var r=t.typeName;if(this._projectFiltersSettings.apps[r]){var i=t.getDisplayName();e.push({name:i,id:r,buttonDisplay:i,buttonDisplayMulti:i})}}.bind(this)),e.length>1&&(e.sort((function(e,t){var r=a.formatOrder.indexOf(e.name.toLowerCase()),i=a.formatOrder.indexOf(t.name.toLowerCase());return-1===r?1:-1===i?-1:r-i})),e.unshift({name:s.getString("organizer-project-filter-all"),id:"all",buttonDisplay:s.getString("organizer-project-filter-all"),isAllItem:!0})),this._appsDropdownItemsData=e}return this._appsDropdownItemsData}})}.apply(t,i))||(e.exports=s)}}]);
//# sourceMappingURL=project-filters-controller-26dbda3f.js.map