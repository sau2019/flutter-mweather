(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[35],{"8/a0":function(t,e,o){var i,r=e,a=o("oAGj"),n=o("SpAV"),l=o("JgVS"),s=o("cEEQ"),c=o("c+uM"),u=o("tGKA"),h=o("hgLm"),g=o("oKlP"),p=o("sIWg"),d=o("1NAc");r.BannerDecorationStrategy=(i=function(){this.spacingScalar=.75,l.BaseDecorationStrategy.call(this)},a.defineClass({name:"BannerDecorationStrategy",ctor:i,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{easeOutQuad:function(t,e,o,i){var r=t/i;return-o*r*(r-2)+e},easeOut:function(t,e,o){return this.easeOutQuad(o,t,e-t,1)},supportsConfiguration:function(t){return t.style.backing==c.LockupBacking.Banner},decorate:function(t,e){function o(t,e){return new g.TheoPoint(t,e)}var i=t.style,r=i.padding;e.numberOfLines>1&&(r+=i.spacing*this.spacingScalar);var f=e.avgTextPointSize*r,y=[],k=p.TheoRect.fromSize(e.size).transform(e.placement),S=!1;t.style.backing==c.LockupBacking.BannerHorizontal?S=!1:t.style.backing==c.LockupBacking.BannerVertical?S=!0:n.CoreAssert.isTrue(!1,"Invalid backing shape.","BannerDecorationStrategy.decorate","BannerDecorationStrategy.swift",99);var L=l.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,t.style.font.fontData.italicAngle),m=e.typographicBoundingRatios.backingVerticalOffsetRatio*e.avgLinePointSize,C=this.easeOut(0,m,Math.min(1,r)),v=S?k.minX-f:-4093,A=S?-4093:k.minY-f+C,b=h.TheoPathBuilder.init_d41d(),R=L+(S?k.size.width+2*f:8186),w=S?8186:k.size.height+2*f,D=new d.TheoSize(R,w),T=u.Matrix2D.translationXY(v,A),x=function(t,e,i){var r=h.TheoPathBuilder.init_d41d(),n=e.transformPoint(t.eval(o(0,0)));r.moveTo(n.x,n.y);var l=new p.TheoRect(n.x,n.y,n.x,n.y);if(i)for(var s=a.iter([o(0,1),o(1,1),o(1,0)]);!s.done;s.next()){var c=s.value;n=e.transformPoint(t.eval(c)),r.lineTo(n.x,n.y),l=l.expandToFit(n)}else for(var u=a.iter([o(1,0),o(1,1),o(0,1)]);!u.done;u.next())c=u.value,n=e.transformPoint(t.eval(c)),r.lineTo(n.x,n.y),l=l.expandToFit(n);return r.closePath(),{path:r.path,bounds:l}}(p.TheoRect.fromSize(D),u.Matrix2D.Identity,!0).path;b.addPath(x,e.placement);var O=b.path,I=new d.TheoSize(a.opt(O.bounds,(function(t){return t.width})),a.opt(O.bounds,(function(t){return t.height})));return y.push(a.clone(s.LockupItem.init_708e(!1,I,T,O))),new l.DecorationResults(a.clone(y))}}}),i)},"9kak":function(t,e,o){var i,r=e,a=o("oAGj");r.LockupRowInfo=(i=function(){this.aspectRatio=0,this.words=[],this.text="",this.appendable=!0,this.rowHeightAdjustRatio=1,this.colOffsetLeft=0,this.colOffsetRight=0},a.defineClass({name:"LockupRowInfo",ctor:i,props:{init_d97e:function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!0),null!=t)for(var o=a.iter(t);!o.done;o.next()){var i=o.value;this.addWord(a.clone(i))}this.appendable=e},addWord:function(t){if(this.words.length>0){var e=a.clone(this.words[this.words.length-1]);this.aspectRatio+=e.spaceAspectRatio,this.text+=" "}this.text+=t.text,this.words.push(a.clone(t)),this.aspectRatio+=t.aspectRatio,1!=this.words.length&&t.characterHeightRatio!=this.rowHeightAdjustRatio?this.rowHeightAdjustRatio=1:this.rowHeightAdjustRatio=t.characterHeightRatio},init_implicit:function(t,e,o,i,r,n,l){void 0===t&&(t=0),void 0===e&&(e=[]),void 0===o&&(o=""),void 0===i&&(i=!0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===l&&(l=0),this.aspectRatio=t,this.words=a.clone(e),this.text=o,this.appendable=i,this.rowHeightAdjustRatio=r,this.colOffsetLeft=n,this.colOffsetRight=l},clone:function(){return i.init_implicit(this.aspectRatio,this.words,this.text,this.appendable,this.rowHeightAdjustRatio,this.colOffsetLeft,this.colOffsetRight)}}}),i)},EDIN:function(t,e,o){var i,r=e,a=o("oAGj"),n=o("JgVS"),l=o("cEEQ"),s=o("c+uM"),c=o("8t9B");r.NoDecorationStrategy=(i=function(){n.BaseDecorationStrategy.call(this)},a.defineClass({name:"NoDecorationStrategy",ctor:i,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.backing==s.LockupBacking.None},decorate:function(t,e){var o,i=t.style,r=!1;if((o=t.style.characterStyles[c.TypeLockupController.HIGHLIGHT_STYLE])&&(r=o.textLook==s.LockupTextLook.FillAndOutline2),i.textLook!=s.LockupTextLook.FillAndOutline2&&!r)return new n.DecorationResults([]);for(var u=[],h=a.iter(a.range(0,e.items.length,!1));!h.done;h.next()){var g=h.value,p=a.clone(e.items[g]);if(p.type==l.LockupItemType.Text){var d,f,y=i.textLook==s.LockupTextLook.FillAndOutline2;null!=(d=p.characterStyle)&&(f=t.style.characterStyles[d])&&(y=f.textLook==s.LockupTextLook.FillAndOutline2||f.textLook==s.LockupTextLook.UNSET&&y),y&&(p.hasPrimaryColor=!1,u.push(a.clone(p)))}}return new n.DecorationResults(a.clone(u))}}}),i)},GFAD:function(t,e,o){var i,r=e,a=o("oAGj");r.LockupUtils=(i=function(){},a.defineClass({name:"LockupUtils",ctor:i,statics:{percentageDiff:function(t,e){return 100*Math.abs((t-e)/((t+e)/2))}}}),i)},JEnV:function(t,e,o){var i,r=e,a=o("oAGj"),n=o("SpAV"),l=o("cEEQ"),s=o("9kak"),c=o("c+uM"),u=o("GFAD"),h=o("tGKA"),g=o("8t9B"),p=o("3UhB"),d=o("uUew"),f=o("1NAc");r.EvenRowHeightsLayoutStrategy=(i=function(t){this.paddingScalar=.6,this.spacingScalar=.75,t==c.LockupAlignment.Left||t==c.LockupAlignment.Right||t==c.LockupAlignment.Center?this.alignment=t:(n.CoreAssert.fail("Unexpected alignment: "+t,"EvenRowHeightsLayoutStrategy.init","EvenRowHeightsLayoutStrategy.swift",22),this.alignment=c.LockupAlignment.Left)},a.defineClass({name:"EvenRowHeightsLayoutStrategy",ctor:i,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.layout==c.LockupLayout.Standard&&t.style.alignment==this.alignment},layout:function(t){var e=t.text,o=t.style,i=o.font.fontData,r=t.containerSize,n=r.width,s=r.height,c=o.spacing*this.spacingScalar,u=n,y=s,k=u/y,S=l.getTypographicBoundingRatiosOfString(e,i,!1),L=g.TypeLockupController.HIGHLIGHT_STYLE,m=a.opt(a.opt(o.characterStyles[L],(function(t){return t.font})),(function(t){return t.fontData})),C=p.TypeLockupUtils.getCharFontAdjust(o,S.hasUppercase),v=!1,A=t.characterStyleRanges.length>0&&null!=o.characterStyles[L]&&-1!=o.characterStyles[L].spacing&&0!=o.characterStyles[L].spacing;A&&o.characterStyles[L].spacing>1&&((o=t.style.clone()).characterStyles[L].spacing=C,v=!0,null!=m&&(m=i,i=o.characterStyles[L].font.fontData,o.characterStyles[L].font=o.font));var b=a.clone(this.getCompactedRows(t,k,t.highlightMethod,null!=t.preferredFontSize,S));if(0==b.length)return l.LayoutResults.init_8322([],new f.TheoSize(0,0),h.Matrix2D.Identity,S,0);var R,w,D,T=this.getAspectRatioOfAllRows(a.clone(b),c),x=a.clone(this.getWidestRowAspectRatio(a.clone(b)));if(0==x.aspectRatio)return l.LayoutResults.init_8322([],new f.TheoSize(0,0),h.Matrix2D.Identity,S,0);null!=(D=t.preferredFontSize)?y=(u=(R=(w=D)*S.heightRatio)*x.aspectRatio)/T:(T<k?u=y*T:y=u/T,w=(R=u/x.aspectRatio)/S.heightRatio);for(var O=y,I=u,B=u/(x.aspectRatio/c),F=w*C,_=w*i.capRatio,E=w*S.textVerticalOffsetRatio-_,W=p.TypeLockupUtils.getCharFontYAdjust(o,w,F),P=E,U=0,M=[],H=0,V=a.iter(a.range(0,b.length,!1));!V.done;V.next()){var N=V.value,K=a.clone(b[N]),G=K.words.length>20||e.length>300&&b.length>5?0:3;if(H=w,A){for(var z=!0,Y=a.iter(K.words);!Y.done;Y.next()){var j=Y.value;if(a.isEmpty(j.characterStyle)||w==F){z=!1;break}}H=z?F:w}N>0&&(P+=B);var q=K.aspectRatio*R;switch(this.alignment){case 0:U=0;break;case 1:U=u-q+0;break;case 2:U=0+(u-q)/2}for(var X=0,J=0,Q=a.iter(K.words);!Q.done;Q.next()){j=Q.value;var Z=a.isEmpty(j.characterStyle)||H==F?0:W,$=a.isEmpty(j.characterStyle)?w:F,tt=j.aspectRatio*R,et=U,ot=P+0+Z,it=a.isEmpty(j.characterStyle)?null:j.characterStyle;v&&(it=a.isEmpty(j.characterStyle)?L:null);var rt,at=a.clone(l.LockupItem.init_e7b2(!0,it,new f.TheoSize(tt,_),h.Matrix2D.translationXY(et,ot),j.text,a.isEmpty(j.characterStyle)?i:m||i,$,w,S,N,j.rangeInLockup));if(rt=a.last(M)){var nt=rt.font.spaceWidthRatio*rt.pointSize;if((Math.abs(nt-X)<.001||0==X)&&t.useOptimization&&rt.characterStyle==at.characterStyle&&rt.placement.ty==ot&&J>G&&J<K.words.length-G&&!t.forceLetterForma){var lt=a.clone(rt);lt.text=0!=X?lt.text+" "+at.text:lt.text+at.text,lt.rangeInLockup=new d.TextRange(rt.rangeInLockup.start,at.rangeInLockup.end),lt.size=new f.TheoSize(lt.size.width+X+at.size.width,_),M.pop(),M.push(a.clone(lt))}else M.push(a.clone(at))}else M.push(a.clone(at));J+=1,U+=tt+(X=j.spaceAspectRatio*R)}P+=H*S.heightRatio}return l.LayoutResults.init_8322(a.clone(M),new f.TheoSize(I,O),h.Matrix2D.translationXY(0,0),S,x.aspectRatio)},calculateTracking:function(t,e){var o=t.text,i=t.style.font.fontData,r=t.containerSize.width,n=t.style.spacing*this.spacingScalar,s=l.getTypographicBoundingRatiosOfString(o,i,!1),c=0,u=e.width,h=e.height,g=u/h,p=a.clone(this.getCompactedRows(t,g,t.highlightMethod,!0,s));if(0==p.length)return t.style.tracking;var d=this.getAspectRatioOfAllRows(a.clone(p),n),f=a.clone(this.getWidestRowAspectRatio(a.clone(p))),y=f.aspectRatio;if(0==y)return t.style.tracking;var k=(u=h*d)/y,S=y*k;if(S<r){c=this.getSpacing(a.clone(p),a.clone(f),k,r,!1).letterSpacing;for(var L=a.iter(p);!L.done;L.next()){var m=L.value;if(m.words.length>1){var C=this.getSpacing(a.clone(p),a.clone(m),k,r,!1);C.letterSpacing<c&&(c=C.letterSpacing)}}(c/=k/s.heightRatio)<.01&&(c=0)}else c=-S;return c},calculateLeading:function(t,e){var o=t.containerSize,i=o.width,r=o.height,n=0,s=e.width,c=e.height,u=s/c,h=l.getTypographicBoundingRatiosOfString(t.text,t.style.font.fontData,!1),g=a.clone(this.getCompactedRows(t,u,t.highlightMethod,!1,h));if(g.length<=1)return t.style.spacing;var p=this.getAspectRatioOfAllRows(a.clone(g),n),d=a.clone(this.getWidestRowAspectRatio(a.clone(g)));c=s/p;var f=s/d.aspectRatio,y=d.aspectRatio*f;if(c<r){var k=i/((r-c)/(a.toDouble(g.length)-1));n=d.aspectRatio/k/this.spacingScalar}else a.info("fits in width. old tracking is :",t.style.tracking,y,"CW:",i,r,s,c),n=-c;return n},getSpacing:function(t,e,o,i,r){var n=0,l=0,s=0,c=0;if(e.words.length<=1)return{letterSpacing:s,wordSpacing:c};for(var u=a.iter(e.words);!u.done;u.next()){var h=u.value;n+=h.aspectRatio*o+h.spaceAspectRatio*o,0!=h.spaceAspectRatio&&h.canBreak&&(l+=1)}return n-=a.last(e.words).spaceAspectRatio*o,r?c=(i-n)/(a.toDouble(l)-1):(s=(i-n)/(a.toDouble(e.words.length)-1),l>1&&s>0&&(s=(i-n-(c=s)*(a.toDouble(l)-1))/(a.toDouble(e.words.length)-1))),{letterSpacing:s,wordSpacing:c}},getWidestRowAspectRatio:function(t){for(var e=a.clone(t[0]),o=a.iter(t);!o.done;o.next()){var i=o.value;i.aspectRatio>e.aspectRatio&&(e=a.clone(i))}return e},getAspectRatioOfAllRows:function(t,e){var o=t.length-1,i=a.clone(this.getWidestRowAspectRatio(a.clone(t)));if(0==i.aspectRatio)return 0;for(var r=i.aspectRatio/e,n=0,l=a.iter(t);!l.done;l.next()){var s=l.value;n+=1/i.aspectRatio*s.rowHeightAdjustRatio}return 1/(n+1/r*a.toDouble(o))},rowsForTargetRowAspectRatio:function(t,e,o){var i=[];i.push(a.clone(s.LockupRowInfo.init_d97e()));for(var r=0,n=0,l=!0,c=t.length,h=0;h<c;){var g=a.clone(i[r]),p=a.clone(t[h]);if(p.isNewLine)g.appendable=!1,i[r]=a.clone(g),h+=1;else{for(var d=g.aspectRatio,f=p.aspectRatio+p.spaceAspectRatio,y=h;y+1<c&&!t[y].canBreak;)f+=t[y+=1].aspectRatio+t[y].spaceAspectRatio;var k=d+f,S=u.LockupUtils.percentageDiff(e,d),L=u.LockupUtils.percentageDiff(e,k);if(n>0&&S<L||0==g.appendable||!l&&h>0&&t[h-1].canBreak){r+=1,n=1;var m=a.clone(s.LockupRowInfo.init_d97e());if(o)l=!(h>0&&!t[h-1].canBreak);else for(;!p.canBreak&&h<c;)m.addWord(a.clone(p)),(h+=1)<c&&(p=a.clone(t[h]));m.addWord(a.clone(p)),i.push(a.clone(m))}else{if(!o)for(;!p.canBreak&&h<c;)g.addWord(a.clone(p)),(h+=1)<c&&(p=a.clone(t[h]));g.addWord(a.clone(p)),n+=1,i[r]=a.clone(g)}h+=1}}return i},getCompactedRows:function(t,e,o,i,r){var n=t.text,l=t.style,c=l.font.fontData,u=l.spacing*this.spacingScalar,h=l.tracking,f=i||t.forceLetterForma,y=a.clone(t.characterStyleRanges),k=g.TypeLockupController.HIGHLIGHT_STYLE,S=a.opt(a.opt(l.characterStyles[k],(function(t){return t.font})),(function(t){return t.fontData})),L=p.TypeLockupUtils.getCharFontAdjust(l,r.hasUppercase);t.characterStyleRanges.length>0&&null!=l.characterStyles[k]&&-1!=l.characterStyles[k].spacing&&0!=l.characterStyles[k].spacing&&l.characterStyles[k].spacing>1&&((l=t.style.clone()).characterStyles[k].spacing=L,y=a.clone(p.TypeLockupUtils.invertRanges(a.clone(t.characterStyleRanges),n.length)),null!=S&&(S=c,c=l.characterStyles[k].font.fontData,l.characterStyles[k].font=l.font));var m=a.clone(p.TypeLockupUtils.computeLockupMeasurements(n,c,r.heightRatio,!1,f,h,a.clone(y),a.clone(l.characterStyles),L,t.forceLetterForma)),C=m.length;if(0==C)return[];var v,A=s.LockupRowInfo.init_d97e(a.clone(m)).aspectRatio,b=.5,R=.6+1.6*A;if(null!=(v=t.preferredFontSize)){var w=v*r.heightRatio,D=t.containerSize.width/w;b=D,R=D}for(var T=a.clone(this.getOptimalCompactedRows(a.clone(m),A,e,u,b,R,!1,i)),x=0,O=a.iter(m);!O.done;O.next())x+=O.value.isNewLine?0:1;if(null!=t.rowWordLengths&&t.rowWordLengths.reduce((function(t,e){return t+e}),0)==x&&(!t.allowFewerLineBreaks||T.length>=t.rowWordLengths.length)&&(T=a.clone(this.getPrecomputedRows(a.clone(m),a.clone(t.rowWordLengths)))),null!=l.characterStyles[k]&&null!=l.characterStyles[k].font&&(C>1&&!f||f&&T.length>1)&&(o==g.HighlightMethod.EvenRows||o==g.HighlightMethod.OddRows||o==g.HighlightMethod.Bracket||o==g.HighlightMethod.InsideBracket)){var I=a.clone(p.TypeLockupUtils.computeLockupMeasurements(n,c,r.heightRatio,!1,f,h,a.clone([]),a.clone({}),void 0,t.forceLetterForma)),B=[new d.TextRange(0,a.chars(n).length)],F=a.clone(p.TypeLockupUtils.computeLockupMeasurements(n,S,r.heightRatio,!1,f,h,a.clone(B),a.clone(l.characterStyles),L,t.forceLetterForma));T=a.clone(this.getOptimalCompactedAutoRows(a.clone(I),a.clone(F),A,e,u,.5,.6+1.6*A,!1,!1,o))}if(i&&l.tracking>0)for(var _=a.iter(a.range(0,T.length,!1));!_.done;_.next()){var E=_.value;T[E].aspectRatio=0;for(var W=a.iter(a.range(0,T[E].words.length,!1));!W.done;W.next()){var P=W.value;T[E].aspectRatio+=T[E].words[P].aspectRatio,T[E].words[P].canBreak&&P!=T[E].words.length-1?(T[E].words[P].spaceAspectRatio=c.spaceWidthRatio/r.heightRatio,T[E].aspectRatio+=T[E].words[P].spaceAspectRatio):T[E].words[P].spaceAspectRatio=0}}return T},getOptimalCompactedRows:function(t,e,o,i,r,n,l,s){var c=n-r,h=.25*c,g=r+.5*c,p=r+h,d=n-h,f=a.clone(this.rowsForTargetRowAspectRatio(a.clone(t),p,l)),y=a.clone(this.rowsForTargetRowAspectRatio(a.clone(t),d,l)),k=this.getAspectRatioOfAllRows(a.clone(f),i),S=this.getAspectRatioOfAllRows(a.clone(y),i),L=u.LockupUtils.percentageDiff(o,k),m=u.LockupUtils.percentageDiff(o,S);return c<.2?L<m?f:y:L<=m?this.getOptimalCompactedRows(a.clone(t),e,o,i,r,g,l,s):this.getOptimalCompactedRows(a.clone(t),e,o,i,g,n,l,s)},getWordForAutoMethod:function(t,e,o,i,r){var n=r==g.HighlightMethod.EvenRows?0:1,l=a.clone(o%2==n?e:t);return r!=g.HighlightMethod.Bracket&&r!=g.HighlightMethod.InsideBracket||(l=0==o||i?a.clone(r==g.HighlightMethod.Bracket?e:t):a.clone(r==g.HighlightMethod.InsideBracket?e:t)),l},rowsForTargetRowAspectRatioAutoRows:function(t,e,o,i,r,n){var l=[];l.push(a.clone(s.LockupRowInfo.init_d97e()));for(var c=0,h=0,p=!0,d=t.length,f=0,y=0;f<d;){var k=a.clone(l[c]),S=a.clone(this.getWordForAutoMethod(a.clone(t[f]),a.clone(e[f]),c,f==d-1,n));if(S.isNewLine)k.appendable=!1,l[c]=a.clone(k),f+=1;else{for(var L=k.aspectRatio,m=S.aspectRatio+S.spaceAspectRatio,C=f;C+1<d&&!t[C].canBreak;)m+=t[C+=1].aspectRatio+t[C].spaceAspectRatio;var v=L+m,A=u.LockupUtils.percentageDiff(i,L),b=u.LockupUtils.percentageDiff(i,v);if(h>0&&A<b||0==k.appendable||!p&&f>0&&t[f-1].canBreak){c+=1,y=f,S=a.clone(this.getWordForAutoMethod(a.clone(t[f]),a.clone(e[f]),c,f==d-1,n)),h=1;var R=a.clone(s.LockupRowInfo.init_d97e());if(r)p=!(f>0&&!t[f-1].canBreak);else for(;!S.canBreak&&f<d;)R.addWord(a.clone(S)),(f+=1)<d&&(S=a.clone(this.getWordForAutoMethod(a.clone(t[f]),a.clone(e[f]),c,f==d-1,n)));R.addWord(a.clone(S)),l.push(a.clone(R))}else{if(!r)for(;!S.canBreak&&f<d;)k.addWord(a.clone(S)),(f+=1)<d&&(S=a.clone(this.getWordForAutoMethod(a.clone(t[f]),a.clone(e[f]),c,f==d-1,n)));k.addWord(a.clone(S)),h+=1,l[c]=a.clone(k)}f+=1}}if(n==g.HighlightMethod.Bracket||n==g.HighlightMethod.InsideBracket){for(var w=a.clone(s.LockupRowInfo.init_d97e()),D=a.iter(a.range(y,d,!1));!D.done;D.next()){f=D.value;var T=a.clone(n==g.HighlightMethod.Bracket?e[f]:t[f]);w.addWord(a.clone(T))}l[l.length-1]=a.clone(w)}return l},getOptimalCompactedAutoRows:function(t,e,o,i,r,l,s,c,h,g){n.CoreAssert.isTrue(t.length==e.length,void 0,"EvenRowHeightsLayoutStrategy.getOptimalCompactedAutoRows","EvenRowHeightsLayoutStrategy.swift",905);var p=s-l,d=.25*p,f=l+.5*p,y=l+d,k=s-d,S=a.clone(this.rowsForTargetRowAspectRatioAutoRows(a.clone(t),a.clone(e),r,y,c,g)),L=a.clone(this.rowsForTargetRowAspectRatioAutoRows(a.clone(t),a.clone(e),r,k,c,g)),m=this.getAspectRatioOfAllRows(a.clone(S),r),C=this.getAspectRatioOfAllRows(a.clone(L),r);if(h){if(m>i&&C<i)return L;if(C>i&&m<i)return S}var v=u.LockupUtils.percentageDiff(i,m),A=u.LockupUtils.percentageDiff(i,C);return p<.2?v<A?S:L:v<=A?this.getOptimalCompactedAutoRows(a.clone(t),a.clone(e),o,i,r,l,f,c,h,g):this.getOptimalCompactedAutoRows(a.clone(t),a.clone(e),o,i,r,f,s,c,h,g)}}}),i)},JgVS:function(t,e,o){var i,r,a=e,n=o("oAGj"),l=o("SpAV");a.DecorationResults=(i=function(t){this.items=n.clone(t)},n.defineClass({name:"DecorationResults",ctor:i}),i),a.LockupDecorationStrategy=n.defineProtocol("LockupDecorationStrategy",{supportsConfiguration:"(LockupConfiguration) -> Boolean",decorate:"(LockupConfiguration, LayoutResults) -> DecorationResults"}),a.BaseDecorationStrategy=(r=function(){},n.defineClass({name:"BaseDecorationStrategy",ctor:r,statics:{getHorizontalOffsetForItalicAngle:function(t,e){var o=Math.abs(e),i=(180-o-90)*Math.PI/180,r=o*Math.PI/180,a=t/Math.sin(i)*Math.sin(r);return(a>t||a<0)&&(a=t/2),a},_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return l.CoreAssert.fail("Implement in subclass","BaseDecorationStrategy.supportsConfiguration","LockupDecorationStrategy.swift",31),!1},decorate:function(t,e){return l.CoreAssert.fail("Implement in subclass","BaseDecorationStrategy.decorate","LockupDecorationStrategy.swift",36),new a.DecorationResults([])}}}),r)},KdeS:function(t,e,o){var i,r=e,a=o("oAGj"),n=o("1NAc");r.LockupWordInfo=(i=function(){},a.defineClass({name:"LockupWordInfo",ctor:i,props:{init_e9d6:function(t,e,o,i,r,a,l,s,c){void 0===c&&(c=n.TheoSize.Zero),this.text=t,this.aspectRatio=e,this.spaceAspectRatio=o,this.characterStyle=i,this.characterHeightRatio=r,this.isNewLine=a,this.canBreak=l,this.rangeInLockup=s,this.relativeMargins=c},init_implicit:function(t,e,o,i,r,a,n,l,s){this.text=t,this.aspectRatio=e,this.spaceAspectRatio=o,this.characterStyle=i,this.characterHeightRatio=r,this.isNewLine=a,this.canBreak=n,this.rangeInLockup=l,this.relativeMargins=s},clone:function(){return i.init_implicit(this.text,this.aspectRatio,this.spaceAspectRatio,this.characterStyle,this.characterHeightRatio,this.isNewLine,this.canBreak,this.rangeInLockup,this.relativeMargins)}}}),i)},PXlJ:function(t,e,o){var i,r=e,a=o("oAGj"),n=o("JgVS"),l=o("cEEQ"),s=o("c+uM"),c=o("tGKA"),u=o("JKVa"),h=o("8t9B"),g=o("sIWg");r.LetterDecorationStrategy=(i=function(){n.BaseDecorationStrategy.call(this)},a.defineClass({name:"LetterDecorationStrategy",ctor:i,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return s.LockupStyle.isLetterGrid(t.style.layout)},decorate:function(t,e){var o,i,r,u=[];if(0==e.items.length)return new n.DecorationResults(a.clone(u));var p,d,f,y=t.style,k=y.font.fontData;y.backing==s.LockupBacking.SVGBackground&&(p=y.backingArtworkID);var S,L,m,C=0;if(0==!t.characterStyleRanges.length&&(d=y.characterStyles[h.TypeLockupController.HIGHLIGHT_STYLE],f=a.opt(d.font,(function(t){return t.fontData})),C=d.padding,d.backing==s.LockupBacking.SVGBackground&&(S=d.backingArtworkID)),null==p&&null==S)return new n.DecorationResults(a.clone(u));for(var v=a.iter(a.toSequence(e.items));!v.done;v.next()){var A=v.value,b=A.offset,R=A.element,w=k,D=p,T=!1;if(R.characterStyle==h.TypeLockupController.HIGHLIGHT_STYLE&&(T=!0,w=f||w,D=(o=S)||null!=o?o:p),null!=D){var x=g.TheoRect.fromXYWH(R.placement.tx,R.placement.ty,R.size.width,R.size.height).outsetXY((i=a.opt(R.margins,(function(t){return t.width})))||null!=i?i:0,(r=a.opt(R.margins,(function(t){return t.height})))||null!=r?r:0),O=T?m:L;null==O&&(O=this.getSVGConfig(t.style,T?C:null,a.clone(e),D,a.clone(R),x),T?m=O:L=O);var I=(e.typographicBoundingRatios.textVerticalOffsetRatio-w.capRatio)*R.pointSize;u.push(a.clone(l.LockupItem.init_9cc6(!1,O.frame.size,c.Matrix2D.translation(O.frame.origin).translate(x.origin).translateXY(0,-I),D,O.preScale,b+e.numberOfLines,R.characterStyle)))}}return new n.DecorationResults(a.clone(u))},getSVGConfig:function(t,e,o,i,r,n){var s=a.clone(l.LayoutResults.init_8322([r],n.size,o.placement,o.typographicBoundingRatios,o.avgRowAspect)),c=t;return null!=e&&((c=t.clone()).padding=e),new u.SVGBackgroundDecorationStrategy(i).calcSVGConfiguration(c,a.clone(s))}}}),i)},TkOd:function(t,e,o){var i,r,a,n,l,s,c,u,h,g,p,d,f,y=e,k=o("oAGj"),S=o("0wFF"),L=o("cZuM"),m=o("6h7+"),C=o("SpAV"),v=o("yhkb"),A=o("gXiO"),b=o("C42b"),R=o("YSlt"),w=o("Ohrj"),D=o("ascj"),T=o("FNB+"),x=o("lq1z"),O=o("G1DZ"),I=o("iCxV"),B=o("3lr5"),F=o("VDg0"),_=o("c+uM"),E=o("hb8m"),W=o("3DEm"),P=o("jcfx"),U=o("Zifs"),M=o("35Q0"),H=o("p+tC"),V=o("UqVc"),N=o("umUn"),K=o("T6jX"),G=o("8t9B"),z=o("3UhB"),Y=o("oKlP"),j=o("oKI3");y.kColorPairDistanceThreshold=10,y.kPuffyTextThreshold=.12,k.gvar(y,"BACKING_SHAPES_BASIC",(function(){return M.ShapeLibrary.NonSvgBackingShapeIDs})),k.gvar(y,"BACKING_SHAPES_SVG",(function(){return M.ShapeLibrary.BrowsableBackingShapes})),k.gvar(y,"ALLOWED_BACKING_VALUES",(function(){return y.BACKING_SHAPES_BASIC.concat(y.BACKING_SHAPES_SVG)})),k.gvar(y,"BACKING_COUNT_SCALE",(function(){return k.toDouble(y.ALLOWED_BACKING_VALUES.length)})),k.gvar(y,"ALLOWED_LAYOUT_VALUES",(function(){return["left","right","center","fill"]})),k.gvar(y,"LAYOUT_COUNT_SCALE",(function(){return k.toDouble(y.ALLOWED_LAYOUT_VALUES.length)})),k.gvar(y,"ALLOWED_OPACITY_VALUES",(function(){return["full","mediumBacking","faintBacking","medium","faint"]})),k.gvar(y,"OPACITY_COUNT_SCALE",(function(){return k.toDouble(y.ALLOWED_OPACITY_VALUES.length)})),k.gvar(y,"ALLOWED_SHADOWANGLE_VALUES",(function(){return[45,135,225,315]})),k.gvar(y,"SHADOWANGLE_COUNT_SCALE",(function(){return k.toDouble(y.ALLOWED_SHADOWANGLE_VALUES.length)})),k.gvar(y,"ALLOWED_PADDING_VALUES",(function(){return[0,.33,.66,1]})),k.gvar(y,"PADDING_COUNT_SCALE",(function(){return k.toDouble(y.ALLOWED_PADDING_VALUES.length)})),k.gvar(y,"ALLOWED_SPACING_VALUES",(function(){return[0,.5,1]})),k.gvar(y,"SPACING_COUNT_SCALE",(function(){return k.toDouble(y.ALLOWED_SPACING_VALUES.length)})),k.gvar(y,"ALLOWED_TRACKING_VALUES",(function(){return[-.1,0,.5]})),y.LockupStyleAttributes=(i=function(t,e,o,i,r,a,n,l,s,c,u,h,g,p,d,f){this.font=0,this.layout="fill",this.backing="none",this.opacity="useLockupOpacities",this.textOpacity=1,this.backingOpacity=1,this.primaryColor="themeColor0",this.secondaryColor="themeColor1",this.shadowAngle=135,this.spacing=.35,this.tracking=0,this.padding=.35,this.textLook="fill",this.shadowOffset=_.LockupStyle.DEFAULT_SHADOWOFFSET,this.strokeWeight=_.LockupStyle.DEFAULT_STROKEWEIGHT,this.wheelUsed=!1,void 0===t&&(t=0),void 0===e&&(e="fill"),void 0===o&&(o="none"),void 0===i&&(i="useLockupOpacities"),void 0===r&&(r=1),void 0===a&&(a=1),void 0===n&&(n="themeColor0"),void 0===l&&(l="themeColor1"),void 0===s&&(s=135),void 0===c&&(c=.35),void 0===u&&(u=0),void 0===h&&(h=.35),void 0===g&&(g="fill"),void 0===p&&(p=_.LockupStyle.DEFAULT_SHADOWOFFSET),void 0===d&&(d=_.LockupStyle.DEFAULT_STROKEWEIGHT),void 0===f&&(f=!1),this.font=t,this.layout=e,this.backing=o,this.opacity=i,this.textOpacity=r,this.backingOpacity=a,this.primaryColor=n,this.secondaryColor=l,this.shadowAngle=s,this.spacing=c,this.tracking=u,this.padding=h,this.textLook=g,this.shadowOffset=p,this.strokeWeight=d,this.wheelUsed=f},k.defineClass({name:"LockupStyleAttributes",ctor:i,props:{clone:function(){return new i(this.font,this.layout,this.backing,this.opacity,this.textOpacity,this.backingOpacity,this.primaryColor,this.secondaryColor,this.shadowAngle,this.spacing,this.tracking,this.padding,this.textLook,this.shadowOffset,this.strokeWeight,this.wheelUsed)}}}),i),y.getFontPairingMatrix=function(t){for(var e={},o=t.count,i=k.iter(k.range(0,o,!1));!i.done;i.next()){for(var r=i.value,a=t.fontAt(r),n=a.postScriptName,l={},s=k.iter(k.range(0,o,!1));!s.done;s.next()){var c=s.value,u=t.fontAt(c),h=u.postScriptName,g=r==c,p=1;p+=1+k.toDouble(10-W.MathUtils.absInt(a.formality-u.formality)),p+=1+k.toDouble(10-W.MathUtils.absInt(a.width-u.width)),p+=1+k.toDouble(W.MathUtils.absInt(a.blackness-u.blackness));var d=k.toDouble(a.drama-u.drama);p+=d,d<-1&&(p*=.1),a.square==u.square&&(p*=2),a.geometric==u.geometric&&(p*=2),a.italic==u.italic&&(p*=2),a.handdrawn&&u.handdrawn&&(p*=2);var f=a.slab&&u.slab,y=0==(a.slab||u.slab);f&&(p*=2);var S=a.serif&&u.serif;S&&y&&(p*=2),0==(a.serif||u.serif)&&(p*=2),S&&a.slab!=u.slab&&(p*=0);var L=a.decorative&&u.decorative;0==g&&L&&(p*=0),a.calligraphic&&u.calligraphic&&0==g&&(p*=0),l[h]=p}e[n]=k.clone(l)}return e},y.getFontPairScore=function(t,e,o){var i,r;if((i=t[e])&&null!=(r=i[o]))return r;return 0},y.hasSufficientLegibilityContrast=function(t,e){return t.contrasts(e,!1)},y.needsContrastingColor=function(t,e,o){return e!=_.LockupTextLook.Fill&&e!=_.LockupTextLook.KnockoutOnly||o},y.getTextOpacity=function(t){switch(t.opacity){case"medium":return F.kOpacityRuleMediumAlpha;case"faint":return F.kOpacityRuleFaintAlpha;case"useLockupOpacities":return t.textOpacity;default:return 1}},y.getBackingOpacity=function(t){switch(t.opacity){case"medium":case"mediumBacking":return F.kOpacityRuleMediumAlpha;case"faint":case"faintBacking":return F.kOpacityRuleFaintAlpha;case"useLockupOpacities":return t.backingOpacity;default:return 1}},y.getTextLook=function(t){var e;switch(t.textLook){case"fill":e=_.LockupTextLook.Fill;break;case"knockoutOnly":e=_.LockupTextLook.KnockoutOnly;break;case"knockoutAndOutline":e=_.LockupTextLook.KnockoutAndOutline;break;case"outlineOnly":e=_.LockupTextLook.OutlineOnly;break;case"fillAndOutline":e=_.LockupTextLook.FillAndOutline;break;case"fillAndOutline2":e=_.LockupTextLook.FillAndOutline2;break;case"shadow":e=_.LockupTextLook.Shadow;break;case"shadowAndOutline":e=_.LockupTextLook.ShadowAndOutline;break;case"knockoutAndShadow":e=_.LockupTextLook.KnockoutAndShadow;break;default:e=_.LockupTextLook.Fill}return e},y.InterestingLockupData=(r=function(){},k.defineClass({name:"InterestingLockupData",ctor:r,props:{init_a05b:function(t){var e,o,i,r,a,n,l,s,c,u,h,g,p,d,f,S,L,m,C,v,A,b,R;(A=k.as(t.style,_.LockupStyle))&&(g=k.clone(y.lockupStyleToLockupStyleAttributes(A,t.page.document)),u=k.opt(A.font,(function(t){return t.fontData.postScriptName})),(b=k.as(t.controller,G.TypeLockupController))&&(h=b.getCurrentFontSize()),v=y.lockupStyleToLockupStyleAttributes(A,t.page.document).backing),(b=k.as(t.controller,G.TypeLockupController))&&((R=b.size)&&(m=R.width,C=R.height,p=k.toDouble(R.width/R.height)),d=k.clone(t.totalPlacement.transformPoints(k.clone(t.bounds.points))),f=b.text.length,S=b.text,L=b.wordCount()),this.id=t.formaID,this.width=(e=m)||null!=e?e:100,this.height=(o=C)||null!=o?o:100,this.font=(i=u)||null!=i?i:"BebasNeue",this.lineHeight=(r=h)||null!=r?r:1,this.styleAttributes=k.clone(g||new y.LockupStyleAttributes),this.aspectRatio=(a=p)||null!=a?a:1,this.pts=k.clone(d||[]),this.wordCount=(n=L)||null!=n?n:1,this.charCount=(l=f)||null!=l?l:1,this.originalBacking=(s=v)||null!=s?s:"",this.lockupString=(c=S)||null!=c?c:""},init_implicit:function(t,e,o,i,r,a,n,l,s,c,u,h){this.id=t,this.font=e,this.lineHeight=o,this.styleAttributes=k.clone(i),this.aspectRatio=r,this.pts=k.clone(a),this.charCount=n,this.lockupString=l,this.wordCount=s,this.width=c,this.height=u,this.originalBacking=h}}}),r),y.InterestingPageData=(a=function(){this.colorsBehindSelectedLockup=[],this.numImages=0,this.shapeCount=0},k.defineClass({name:"InterestingPageData",ctor:a,props:{init_a05b:function(t){this.selectedLockup=y.InterestingLockupData.init_a05b(t);var e=this.selectedLockup,o=[this.selectedLockup],i=10,r=1e3,a=1e3;if(t.page.hasRoot()){var n,l;r=t.page.pageSize.width,a=t.page.pageSize.height,(n=k.as(t.controller,G.TypeLockupController))&&(this.colorsBehindSelectedLockup=k.clone(n.getBackgroundColors()),i=n.getBackgroundLightnessSpread(k.clone(this.colorsBehindSelectedLockup)),this.shapeCount=n.shapeCount()),0==this.colorsBehindSelectedLockup.length&&(l=t.page.root.style.colors.fieldPrimary)&&this.colorsBehindSelectedLockup.push(l);for(var s=k.clone(t.page.root.filterWithCallback((function(t){return t.isTypeLockup()}))),c=k.iter(s);!c.done;c.next())if((t=c.value).formaID!=this.selectedLockup.id){var u=y.InterestingLockupData.init_a05b(t);u.lineHeight>e.lineHeight&&(e=u),o.push(u)}}this.height=a,this.width=r,this.numImages=t.root.filterWithCallback((function(t){return t.isBackgroundImage()})).length,this.lockups=k.clone(o),this.largestLineHeightLockup=e,0==this.colorsBehindSelectedLockup.length&&this.colorsBehindSelectedLockup.push(U.SolidColor.BLACK),this.lightnessSpreadBehindSelectedLockup=i},isColorVisibleAgainstBackground:function(t){for(var e=k.iter(this.colorsBehindSelectedLockup);!e.done;e.next()){var o=e.value;if(!y.hasSufficientLegibilityContrast(t,o))return!1}return!0},ensureCorrectBackgroundColors:function(t){var e,o,i=[];(e=k.as(t.controller,G.TypeLockupController))&&(i=k.clone(e.getBackgroundColors())),0==i.length&&(o=t.page.root.style.colors.fieldPrimary)&&i.push(o),i.length>0&&(this.colorsBehindSelectedLockup=k.clone(i))},init_implicit:function(t,e,o,i,r,a,n,l,s){void 0===i&&(i=[]),void 0===l&&(l=0),void 0===s&&(s=0),this.largestLineHeightLockup=t,this.selectedLockup=e,this.lockups=k.clone(o),this.colorsBehindSelectedLockup=k.clone(i),this.lightnessSpreadBehindSelectedLockup=r,this.width=a,this.height=n,this.numImages=l,this.shapeCount=s},clone:function(){return a.init_implicit(this.largestLineHeightLockup,this.selectedLockup,this.lockups,this.colorsBehindSelectedLockup,this.lightnessSpreadBehindSelectedLockup,this.width,this.height,this.numImages,this.shapeCount)}}}),a),y.getBackingStringForBackingEnumAndArtworkId=function(t,e){var o="none";switch(t){case 0:o="none";break;case 2:o="row";break;case 9:o="bannerHorizontal";break;case 8:o="bannerVertical";break;case 11:o="knockout";break;case 4:o="none";break;default:null!=e&&(o=e)}return o},y.getBackingEnumAndArtworkIdForBackingString=function(t){var e,o=null;switch(t){case"none":e=_.LockupBacking.None;break;case"row":e=_.LockupBacking.Rows;break;case"bannerHorizontal":e=_.LockupBacking.BannerHorizontal;break;case"bannerVertical":e=_.LockupBacking.BannerVertical;break;case"knockout":e=_.LockupBacking.Knockout;break;default:e=_.LockupBacking.SVGBackground,o=t}return{backing:e,artworkID:o}},y.lockupStyleToLockupStyleAttributes=function(t,e){var o,i=k.clone(new y.LockupStyleAttributes),r=I.Host.fontProvider.getIncludedFonts(e);i.shadowAngle=t.shadowAngle;var a,n,l,s,c,u=-1;switch((a=t.font)&&(u=(o=r.indexOf(a.fontData))||null!=o?o:-1),i.font=u,i.spacing=t.spacing,i.tracking=t.tracking,i.padding=t.padding,i.textLook=t.textLookAsString,i.shadowOffset=t.shadowOffset,i.strokeWeight=t.strokeWeight,null!=(n=t.colors.colorID(D.ColorRole.FieldPrimary))&&(i.primaryColor=n),null!=(l=t.colors.colorID(D.ColorRole.FieldSecondary))&&(i.secondaryColor=l),t.opacityRule){case 1:s="mediumBacking";break;case 2:s="faintBacking";break;case 3:s="medium";break;case 4:s="faint";break;case 0:s="full";break;default:s="useLockupOpacities"}i.opacity=s,i.textOpacity=t.textOpacity,i.backingOpacity=t.backingOpacity;var h=t.layout;if(_.LockupStyle.isLetterGrid(h)||h==_.LockupLayout.Standard){var g=_.LockupStyle.isLetterGrid(h)?"letter-grid-":"";switch(t.alignment){case 0:c=g+"left";break;case 1:c=g+"right";break;case 2:c=g+"center";break;default:C.CoreAssert.fail("Unexpected alignment: "+t.alignment,"lockupStyleToLockupStyleAttributes","LockupStyleController.swift",636),c=g+"left"}}else if(_.LockupStyle.isPath(h)){c="path"+t.pathID}else c="fill";return i.layout=c,i.backing=y.getBackingStringForBackingEnumAndArtworkId(t.backing,t.backingArtworkID),i.wheelUsed=t.wheelUsed,i},y.lockupStyleAttributesToLockupStyle=function(t,e,o){var i,r,a=null,n=t.font;(C.CoreAssert.isTrue(n>-1,"lockupStyleAttributesToLockupStyle called with no font. It is valid for a character style to have no font but this function doesn't work for character styles ","lockupStyleAttributesToLockupStyle","LockupStyleController.swift",675),n>-1)&&((r=I.Host.fontProvider.getIncludedFonts(o).fontAt(n))&&(a=z.TypeLockupUtils.createTheoFont(r,I.Host.brandkitManager.brandkitForDocument(o))));var l,s,c=D.ColorTable.init_25f6([{key:D.ColorRole.FieldPrimary,value:t.primaryColor},{key:D.ColorRole.FieldSecondary,value:t.secondaryColor}]);switch(t.opacity){case"mediumBacking":l=_.OpacityRule.MediumBacking;break;case"faintBacking":l=_.OpacityRule.FaintBacking;break;case"medium":l=_.OpacityRule.Medium;break;case"faint":l=_.OpacityRule.Faint;break;case"full":l=_.OpacityRule.Full;break;default:l=_.OpacityRule.UseLockupOpacities}var u,h,g=_.LockupAlignment.UNSET,p=j.TextPathID.UNSET,d=null;if(t.layout.startsWith("path"))s=_.LockupLayout.Path,null!=(u=k.toInt(t.layout.substr("path".length)))&&(p=(i=j.TextPathID.toCaseValue(u))||null!=i?i:j.TextPathID.UNSET)==j.TextPathID.Custom&&(h=e.customPath)&&(d=h);else switch(t.layout){case"left":s=_.LockupLayout.Standard,g=_.LockupAlignment.Left;break;case"right":s=_.LockupLayout.Standard,g=_.LockupAlignment.Right;break;case"center":s=_.LockupLayout.Standard,g=_.LockupAlignment.Center;break;case"letter-grid-left":s=_.LockupLayout.LetterGrid,g=_.LockupAlignment.Left;break;case"letter-grid-right":s=_.LockupLayout.LetterGrid,g=_.LockupAlignment.Right;break;case"letter-grid-center":s=_.LockupLayout.LetterGrid,g=_.LockupAlignment.Center;break;case"fill":default:s=_.LockupLayout.FitJustified}var f=y.getBackingEnumAndArtworkIdForBackingString(t.backing),S=y.getTextLook(k.clone(t)),L=t.wheelUsed,m=_.LockupStyle.init_a132(t.textOpacity,t.backingOpacity,c,a,t.spacing,t.tracking,t.padding,f.backing,f.artworkID,t.shadowAngle,s,g,l,S,t.shadowOffset,t.strokeWeight,p,d,L);return m.setCharacterStyles(k.clone(e.characterStyles)),m},y.randomDbl=function(){return k.toDouble(b.CoreRandom.nextInt)/k.toDouble(b.CoreRandom.randMax)},y.getWeightedIndex=function(t,e){for(var o=t.length,i=e*y.randomDbl(),r=0,a=0,n=k.iter(k.range(0,o,!1));!n.done;n.next()){var l=n.value;if((r+=t[l])>=i){a=l;break}}return a},y.selectWeightedValue=function(t,e,o,i,r){var a,n=i,l=k.clone(o);return null!=(a=k.indexOf(e,t))&&o[a]>0&&(l[a]+=n*r,n+=n*r),e[y.getWeightedIndex(k.clone(l),n)]},y.WeightedAttributeSelector=k.defineProtocol("WeightedAttributeSelector",{inertiaRatio:"Double",forma:"Forma",pageData:"InterestingPageData",values:"Array<TypeAlias>",weights:"Array<Double>",weightSum:"Double",scoreValue:"(TypeAlias) -> Double",updateWeights:"(InterestingPageData) -> Void",select:"(LockupStyleAttributes, Boolean, Boolean, Boolean, Boolean) -> TypeAlias"}),y.WeightedFontSelector=(n=function t(e,o){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.machineRecommend=!0;var i=this;this.forma=e,this.pageData=k.clone(o),this.listOfFonts=I.Host.fontProvider.getIncludedFonts(e.page.document),this.values=k.toArray(k.range(0,this.listOfFonts.count,!1));var r=this.listOfFonts.revisionNumber,a=this.listOfFonts.fontSetID;r==t.cacheRevisionNumber&&a==t.cacheFontSetID?this.fontPairingMatrix=k.clone(t.fontPairingMatrixCache):(this.fontPairingMatrix={},t.fontPairingMatrixCache={},k.each(y.getFontPairingMatrix(this.listOfFonts),(function(e,o){i.fontPairingMatrix[e]=k.clone(o),t.fontPairingMatrixCache[e]=k.clone(o)})),t.cacheRevisionNumber=r,t.cacheFontSetID=a)},k.defineClass({name:"WeightedFontSelector",ctor:n,statics:{cacheRevisionNumber:0,cacheFontSetID:"charlie",_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=k.clone(t);var e=!1;if(this.values.length!=I.Host.fontProvider.getIncludedFonts(this.forma.page.document).count&&(this.listOfFonts=I.Host.fontProvider.getIncludedFonts(this.forma.page.document),this.values=k.toArray(k.range(0,this.listOfFonts.count,!1)),e=!0),this.machineRecommend){var o,i=new x.FontSuggester;(o=i.getFontFeatures(k.clone(t),this.forma))?(e&&i.clearCache(),this.weights=k.clone(i.getScores(this.listOfFonts,o))):this.weights=this.values.map(this.scoreValue,this)}0!=this.machineRecommend&&1!=(new V.SuggestionUtils).weightsEqualNaNOrEmpty(k.clone(this.weights))||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},getTopFonts:function(t){C.CoreAssert.isTrue(t<this.listOfFonts.count,"cannot get top fonts more than total number","WeightedFontSelector.getTopFonts","LockupStyleController.swift",973);for(var e=[],o=k.iter(k.toSequence(this.weights));!o.done;o.next()){var i=o.value,r=i.offset,a=i.element;e.push([a,r])}e=k.sort(e,(function(t,e){return t[0]>e[0]}));for(var n=[],l=0,s=k.iter(e);!s.done;s.next()){var c=s.value;if(!(l<t))break;n.push(this.listOfFonts.fontAt(c[1])),l+=1}return n},scoreValue:function(t){return this.manuallyScoreValue(t)},manuallyScoreValue:function(t){var e=this.listOfFonts.fontAt(t),o=e.postScriptName,i=I.Host.fontProvider.descriptorForPostScriptName(o,B.ANY_DOCUMENT),r=this.pageData.selectedLockup.lineHeight;if(!I.Host.fontProvider.getSuggestableFonts(k.opt(this.forma,(function(t){return t.page.document}))).contains(e))return 0;for(var a=.1,n=k.iter(this.pageData.lockups);!n.done;n.next()){var l=n.value;if(l.id!=this.pageData.selectedLockup.id){var s=W.MathUtils.absDouble(r-l.lineHeight)/r,c=l.lineHeight>r,u=c?l.font:o,h=c?o:l.font;a+=y.getFontPairScore(k.clone(this.fontPairingMatrix),u,h),o==l.font&&(a*=2,s<.5&&(a*=2))}}return a*=i.popularity,z.TypeLockupUtils.createTheoFont(e,I.Host.brandkitManager.brandkitForDocument(this.forma.page.document)).isSparkFont()&&(a*=2),r<40&&0==i.bodyAllowed&&(a=0),r>150&&0==i.displayAllowed&&(a=0),a},select:function(t,e,o,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0);var a=t.font,n=o?this.inertiaRatio:0;return y.selectWeightedValue(a,k.clone(this.values),k.clone(this.weights),this.weightSum,n)}}}),n),y.WeightedLayoutSelector=(l=function(t,e){this.inertiaRatio=0,this.values=y.ALLOWED_LAYOUT_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=k.clone(e)},k.defineClass({name:"WeightedLayoutSelector",ctor:l,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=k.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=this.pageData.selectedLockup.aspectRatio,i=this.pageData.selectedLockup.wordCount,r=this.pageData.selectedLockup.id;"left"!=t&&"right"!=t||(i<=1||o>4?e=0:e*=.05),0==this.pageData.lockups.length&&("fill"==t&&(e*=5),"center"==t&&(e*=4)),"fill"==t&&this.pageData.selectedLockup.wordCount>10&&(e*=4/k.toDouble(this.pageData.selectedLockup.wordCount));var a=[];K.TheoDocumentUtils.enableFastHeuristicsForComplexPage(this.forma.page)||(a=k.clone(L.AlignmentDetector.init_a05b(this.forma).detectFormaAlignments(20)));for(var n=!1,l=!1,s=k.iter(a);!s.done;s.next()){var c=s.value;c.line.type==L.AlignmentType.Left&&(n=!0),c.line.type==L.AlignmentType.Right&&(l=!0)}n&&!l&&"left"==t&&(e=2.5),l&&!n&&"right"==t&&(e=2.5);for(var u=k.iter(this.pageData.lockups);!u.done;u.next()){var h=u.value;h.id!=r&&t==h.styleAttributes.layout&&(e*=y.LAYOUT_COUNT_SCALE/2)}return e},select:function(t,e,o,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0);var a=t.layout,n=o?this.inertiaRatio:0;return y.selectWeightedValue(a,k.clone(this.values),k.clone(this.weights),this.weightSum,n)}}}),l),y.WeightedBackingSelector=(s=function(t,e){this.inertiaRatio=1,this.values=y.ALLOWED_BACKING_VALUES,this.weights=[],this.weightSum=0,this.machineRecommend=!0,this.forma=t,this.pageData=k.clone(e)},k.defineClass({name:"WeightedBackingSelector",ctor:s,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){if(this.pageData=k.clone(t),1==this.machineRecommend){var e=new H.ShapeSuggester,o=k.clone(e.getShapeSuggesterFeatures(k.clone(t),this.forma));this.weights=k.clone(e.getScores(k.clone(this.values),k.clone(o)))}0!=this.machineRecommend&&1!=(new V.SuggestionUtils).weightsEqualNaNOrEmpty(k.clone(this.weights))||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=this.pageData.largestLineHeightLockup,i=e.lineHeight,r=o.id==e.id,a=M.ShapeLibrary.shapeDictionary[t]||M.ShapeLibrary.shapeDictionary.none,n=1;if(a.premium)return 0;if(M.ShapeLibrary.NonSuggestableBackingShapes.includes(t))return 0;this.pageData.lockups.length>0&&y.BACKING_SHAPES_SVG.includes(t)&&(n*=.1);for(var l=k.iter(this.pageData.lockups);!l.done;l.next()){var s,c=l.value;c.id!=e.id&&(W.MathUtils.absDouble(i-c.lineHeight)/i<.4&&(n*=3),(s=M.ShapeLibrary.shapeDictionary[c.styleAttributes.backing])&&(n*=(11-k.toDouble(W.MathUtils.absInt(a.formality-s.formality)))/2,n*=(11-k.toDouble(W.MathUtils.absInt(a.drama-s.drama)))/2))}var u,h=W.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height);if(a.maxScale<1&&h>a.maxScale&&(n=0),(a.maxAspect<e.aspectRatio||a.minAspect>e.aspectRatio)&&(n=0),0==r&&(u=M.ShapeLibrary.shapeDictionary[o.styleAttributes.backing])){var g=u.drama;a.drama<g&&(n*=2)}return"none"==t&&(n*=10),"row"==t&&(n*=10),this.pageData.lightnessSpreadBehindSelectedLockup>=20&&0==a.filled&&(n*=.01),n},select:function(t,e,o,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0);var a=this.values.length,n=k.clone(this.weights),l=t.layout,s="center"==l||"fill"==l,c=!1,u=I.Host.fontProvider.getIncludedFonts(this.forma.page.document).fontAt(t.font),h=this.pageData.selectedLockup.width/this.pageData.selectedLockup.height,g=!0,p=this.pageData.selectedLockup.originalBacking;"none"!=p&&"shadow"!=p&&"row"!=p||(g=!1),"knockout"==t.backing&&(g=!1);for(var d=k.iter(this.pageData.lockups);!d.done;d.next()){var f,S=d.value,L=S.styleAttributes.backing;S.id!=this.pageData.selectedLockup.id&&("none"!=L&&(c=!0),t.font==S.styleAttributes.font&&null!=(f=k.indexOf(y.ALLOWED_BACKING_VALUES,L))&&(n[f]*=5))}for(var m=k.iter(k.range(0,a,!1));!m.done;m.next()){var C,v=m.value,A=this.values[v];if(C=M.ShapeLibrary.shapeDictionary[A]){s&&1==C.centered&&(n[v]*=5),h>4&&C.category==M.ShapeCategory.Circle&&(n[v]*=0),h<4&&C.category==M.ShapeCategory.Banner&&(n[v]*=0),C.category!=M.ShapeCategory.Cutout&&C.category!=M.ShapeCategory.Avoid||(n[v]*=0),"knockoutOnly"!=t.textLook||"none"!=A&&"shadow"!=A||(n[v]*=0);var b=k.toDouble(10-W.MathUtils.absInt(u.formality-C.formality));n[v]*=b/5;var R=k.toDouble(10-W.MathUtils.absInt(u.drama-C.drama));n[v]*=R/5,c&&"row"!=A&&"none"!=A&&(n[v]/=5)}}var w=t.backing,D=o?this.inertiaRatio:0,T=n.reduce((function(t,e){return t+e}),0);return w=1==g?y.selectWeightedValue(w,k.clone(this.values),k.clone(n),T,D):p}}}),s),y.WeightedShadowAngleSelector=(c=function(t,e){this.inertiaRatio=1,this.values=y.ALLOWED_SHADOWANGLE_VALUES,this.weights=[],this.weightSum=0,this.foo=4,this.forma=t,this.pageData=k.clone(e)},k.defineClass({name:"WeightedShadowAngleSelector",ctor:c,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=k.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return 1},select:function(t,e,o,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0);var a=t.shadowAngle,n=o?this.inertiaRatio:0;return y.selectWeightedValue(a,k.clone(this.values),k.clone(this.weights),this.weightSum,n)}}}),c),y.WeightedOpacitySelector=(u=function(t,e){this.inertiaRatio=1,this.values=y.ALLOWED_OPACITY_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=k.clone(e)},k.defineClass({name:"WeightedOpacitySelector",ctor:u,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=k.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=this.pageData.selectedLockup.width*this.pageData.selectedLockup.height,i=this.pageData.width*this.pageData.height;return"full"==t&&o>.5*i&&(e*=.1),"faint"==t&&(o<.5*i?e=0:e*=.5),e},select:function(t,e,o,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0);var a=t.opacity,n=k.clone(this.weights);(M.ShapeLibrary.shapeDictionary[t.backing]||M.ShapeLibrary.shapeDictionary.none).filled?(n[k.indexOf(y.ALLOWED_OPACITY_VALUES,"faint")]=0,n[k.indexOf(y.ALLOWED_OPACITY_VALUES,"medium")]=0):(n[k.indexOf(y.ALLOWED_OPACITY_VALUES,"faintBacking")]=0,n[k.indexOf(y.ALLOWED_OPACITY_VALUES,"mediumBacking")]=0);var l=o?this.inertiaRatio:0,s=n.reduce((function(t,e){return t+e}),0);return y.selectWeightedValue(a,k.clone(this.values),k.clone(n),s,l)}}}),u),y.WeightedPaddingSelector=(h=function(t,e){this.inertiaRatio=1,this.values=y.ALLOWED_PADDING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=k.clone(e)},k.defineClass({name:"WeightedPaddingSelector",ctor:h,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=k.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=1,i=1;if(0==this.pageData.lockups.length)i=W.MathUtils.absDouble(t-_.LockupStyle.DEFAULT_PADDING);else for(var r=k.iter(this.pageData.lockups);!r.done;r.next()){var a=r.value;i=W.MathUtils.minDouble(i,W.MathUtils.absDouble(t-a.styleAttributes.padding))}o*=W.MathUtils.maxDouble(1/(i+.1),.05);var n=W.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height)+t;return o/=4*W.MathUtils.absDouble(n-1)},select:function(t,e,o,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0);var a=t.padding,n=o?this.inertiaRatio:0;return y.selectWeightedValue(a,k.clone(this.values),k.clone(this.weights),this.weightSum,n)}}}),h),y.WeightedSpacingSelector=(g=function(t,e){this.inertiaRatio=1,this.values=y.ALLOWED_SPACING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=k.clone(e)},k.defineClass({name:"WeightedSpacingSelector",ctor:g,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=k.clone(t),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=1;if(0==this.pageData.lockups.length)o=W.MathUtils.absDouble(t-_.LockupStyle.DEFAULT_SPACING);else for(var i=k.iter(this.pageData.lockups);!i.done;i.next()){var r=i.value;o=W.MathUtils.minDouble(o,W.MathUtils.absDouble(t-r.styleAttributes.spacing))}return e*=W.MathUtils.maxDouble(1/(o+.1),.05)},select:function(t,e,o,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0);var a=t.spacing,n=o?this.inertiaRatio:0;return y.selectWeightedValue(a,k.clone(this.values),k.clone(this.weights),this.weightSum,n)}}}),g),y.PrimaryColorSelector=(p=function(t,e){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=k.clone(e),this.values=t.page.colorLibraryController.getThemeColorKeys().concat(v.ColorLibraryController.THEME_DERIVED_BW_KEYS).concat(t.page.colorLibraryController.getProfilingColorKeys())},k.defineClass({name:"PrimaryColorSelector",ctor:p,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=k.clone(t),this.values=this.forma.page.colorLibraryController.getThemeColorKeys().concat(v.ColorLibraryController.THEME_DERIVED_BW_KEYS).concat(this.forma.page.colorLibraryController.getProfilingColorKeys()),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return"themeDerivedDark"==t?.1:1},select:function(t,e,o,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0);for(var a=(M.ShapeLibrary.shapeDictionary[t.backing]||M.ShapeLibrary.shapeDictionary.none).filled||"fill"!=t.textLook,n=this.values.length,l=t.primaryColor,s=k.clone(this.weights),c=new R.ColorRankSuggester,u=[],h=k.iter(k.range(0,n,!1));!h.done;h.next()){var g,p=h.value;(g=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[p]))&&u.push(g)}if(C.CoreAssert.isTrue(n==u.length,"not all value colors were added.","PrimaryColorSelector.select","LockupStyleController.swift",2049),n!=u.length)return l;var d=[];if(0==a){this.pageData.ensureCorrectBackgroundColors(this.forma);for(var f=k.iter(this.pageData.colorsBehindSelectedLockup);!f.done;f.next()){var S=f.value;d.push(k.clone(R.ColorForComparison.init_c063(S,1)))}}else{var L;(L=this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&d.push(k.clone(R.ColorForComparison.init_c063(L,1)))}i&&(L=this.forma.page.colorLibraryController.getSolidColorForKey(t.primaryColor))&&d.push(k.clone(R.ColorForComparison.init_c063(L,.33))),s=k.clone(c.weightedColorContrastRanker(k.clone(d),k.clone(u),r));var m=(s=k.clone((new V.SuggestionUtils).normalizedWeights(k.clone(s)))).reduce((function(t,e){return t+e}),0),v=o?this.inertiaRatio:0;return y.selectWeightedValue(l,k.clone(this.values),k.clone(s),m,v)}}}),p),y.SecondaryColorSelector=(d=function(t,e){this.inertiaRatio=0,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=k.clone(e),this.values=t.page.colorLibraryController.getThemeColorKeys().concat(v.ColorLibraryController.THEME_DERIVED_BW_KEYS)},k.defineClass({name:"SecondaryColorSelector",ctor:d,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=k.clone(t),this.values=this.forma.page.colorLibraryController.getThemeColorKeys().concat(v.ColorLibraryController.THEME_DERIVED_BW_KEYS),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return 1},select:function(t,e,o,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0);for(var a=t.secondaryColor,n=(M.ShapeLibrary.shapeDictionary[t.backing]||M.ShapeLibrary.shapeDictionary.none).filled,l=this.values.length,s=k.clone(this.weights),c=new R.ColorRankSuggester,u=[],h=k.iter(k.range(0,l,!1));!h.done;h.next()){var g,p=h.value;(g=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[p]))?u.push(g):C.CoreAssert.isTrue(!1,"failed to get SolidColor for key "+this.values[p]+". colorCount:"+l+". num color keys:"+this.forma.page.colorLibraryController.getNumThemeColorKeys(),"SecondaryColorSelector.select","LockupStyleController.swift",2160)}if(C.CoreAssert.isTrue(l==u.length,"not all value colors were added.","SecondaryColorSelector.select","LockupStyleController.swift",2163),l!=u.length)return a;var d=[];if(i&&n){var f;(f=this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&d.push(k.clone(R.ColorForComparison.init_c063(f,1)))}else{this.pageData.ensureCorrectBackgroundColors(this.forma);for(var S=k.iter(this.pageData.colorsBehindSelectedLockup);!S.done;S.next()){var L=S.value;d.push(k.clone(R.ColorForComparison.init_c063(L,1)))}}s=k.clone(c.weightedColorContrastRanker(k.clone(d),k.clone(u),r));var m=(s=k.clone((new V.SuggestionUtils).normalizedWeights(k.clone(s)))).reduce((function(t,e){return t+e}),0),v=o?this.inertiaRatio:0;return y.selectWeightedValue(a,k.clone(this.values),k.clone(s),m,v)}}}),d),y.LockupStyleController=(f=function(t){this._sessionAttrsDict={},this.hasScoresForAttributes=!1,this.loggedDesignIngredientColorChanged=!1,this.forma=t,this.targetedLockupStyleName_="",this.pageData=k.clone(y.InterestingPageData.init_a05b(t)),this.fontSelector=new y.WeightedFontSelector(t,k.clone(this.pageData)),this.layoutSelector=new y.WeightedLayoutSelector(t,k.clone(this.pageData)),this.backingSelector=new y.WeightedBackingSelector(t,k.clone(this.pageData)),this.opacitySelector=new y.WeightedOpacitySelector(t,k.clone(this.pageData)),this.primaryColorSelector=new y.PrimaryColorSelector(t,k.clone(this.pageData)),this.profilingBackgroundColorSelector=new w.ProfilingBackgroundColorSelector(t,!0),this.profilingPrimaryColorSelector=new w.ProfilingPrimaryColorSelector(t,!1),this.secondaryColorSelector=new y.SecondaryColorSelector(t,k.clone(this.pageData)),this.shadowAngleSelector=new y.WeightedShadowAngleSelector(t,k.clone(this.pageData)),this.spacingSelector=new y.WeightedSpacingSelector(t,k.clone(this.pageData)),this.paddingSelector=new y.WeightedPaddingSelector(t,k.clone(this.pageData)),A.CoreObject.call(this),this.resetSessionAttrs()},k.defineClass({name:"LockupStyleController",ctor:f,superName:"CoreObject",props:{targetedLockupStyleName:{get:function(){var t;return((t=k.opt(k.opt(k.opt(this.forma,(function(t){return t.page.document})),(function(t){return t.controller})),(function(t){return t.selection.inCharStyleMode})))||null!=t)&&t?G.TypeLockupController.HIGHLIGHT_STYLE:""}},targetedLockupStyle:{get:function(){return""!=this.targetedLockupStyleName?this.forma.controller.getCharacterStyle(this.targetedLockupStyleName):this.forma.style}},targetedFont:{get:function(){var t;return(t=this.targetedLockupStyle.font)?t:this.forma.style.font}},targetedShadowAngle:{get:function(){return this.forma.style.shadowAngle},set:function(t){this.forma.style.shadowAngle=t}},targetedShadowOffset:{get:function(){return this.forma.style.shadowOffset},set:function(t){this.forma.style.shadowOffset=t}},targetedStrokeWeight:{get:function(){return this.forma.style.strokeWeight},set:function(t){this.forma.style.strokeWeight=t}},targetedTextLook:{get:function(){return this.targetedLockupStyle.textLook!=_.LockupTextLook.UNSET?this.targetedLockupStyle.textLook:this.forma.style.textLook}},updateScoring:function(){this.pageData=k.clone(y.InterestingPageData.init_a05b(this.forma)),this.fontSelector.updateWeights(k.clone(this.pageData)),this.layoutSelector.updateWeights(k.clone(this.pageData)),this.backingSelector.updateWeights(k.clone(this.pageData)),this.opacitySelector.updateWeights(k.clone(this.pageData)),this.primaryColorSelector.updateWeights(k.clone(this.pageData)),this.secondaryColorSelector.updateWeights(k.clone(this.pageData)),this.shadowAngleSelector.updateWeights(k.clone(this.pageData)),this.spacingSelector.updateWeights(k.clone(this.pageData)),this.paddingSelector.updateWeights(k.clone(this.pageData)),this.profilingPrimaryColorSelector.updateBackgroundColors(k.clone(this.pageData.colorsBehindSelectedLockup)),this.profilingBackgroundColorSelector.updateBackgroundColors(k.clone(this.pageData.colorsBehindSelectedLockup)),this.hasScoresForAttributes=!0},getRecommendedFonts:function(){return this.fontSelector.getTopFonts(10)},onlineLearning:function(t){var e,o=new x.FontSuggester;(e=o.getFontFeatures(k.clone(this.pageData),this.forma))&&o.onlineLearning(t,e)},getDominantColorRole:function(){var t,e=k.clone(y.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,this.forma.page.document)).backing,o=D.ColorRole.FieldPrimary;return(t=M.ShapeLibrary.shapeDictionary[e])&&1==t.filled&&(o=D.ColorRole.FieldSecondary),o},fixUpSecondaryColor:function(){var t;if((t=k.as(this.forma.controller,G.TypeLockupController))&&t.secondaryColorVisible()&&this.targetedLockupStyle.textBacked&&this.targetedLockupStyle.backing!=_.LockupBacking.UNSET){var e=this.targetedLockupStyle.colors.colorID(D.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(D.ColorRole.FieldSecondary),i=this.calculateContrastingSecondaryColorID();null!=i&&i!=o&&i!=e&&null!=this.forma.page.colorLibraryController.getSolidColorForKey(i)&&this.targetedLockupStyle.colors.setColorId(D.ColorRole.FieldSecondary,i)}},calculateContrastingSecondaryColorID:function(){var t,e=this.targetedLockupStyle.colors.colorID(D.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(D.ColorRole.FieldSecondary);if(null!=e&&e==o&&(t=this.forma.page.colorLibraryController.getSolidColorForKey(e)))for(var i=k.iter(this.forma.page.colorLibraryController.getThemeColorKeys().concat(v.ColorLibraryController.THEME_DERIVED_BW_KEYS));!i.done;i.next()){var r,a=i.value;if(a!=e&&(r=this.forma.page.colorLibraryController.getSolidColorForKey(a))&&r.contrasts(t,!1)){o=a;break}}return o},fixUpBackingShape:function(){var t,e,o=this.forma.style;if((t=M.ShapeLibrary.shapeDictionary[y.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=M.ShapeLibrary.shapeDictionary[y.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])){if(_.LockupStyle.isKnockoutLook(this.targetedLockupStyle.textLook)){(this.targetedLockupStyle===this.forma.style?t.filled:_.LockupStyle.isLetterGrid(o.layout)?(this.targetedLockupStyle.backing!=_.LockupBacking.None?e:t).filled:t.filled||e.filled)||(k.opt(k.as(this.forma.controller,G.TypeLockupController),(function(t){return t.beginBlockedUpdate()})),this.targetedLockupStyle.backing=_.LockupBacking.SVGBackground,this.targetedLockupStyle.backingArtworkID="square_001",k.opt(k.as(this.forma.controller,G.TypeLockupController),(function(t){return t.endBlockedUpdate()})),k.opt(k.as(this.forma.controller,G.TypeLockupController),(function(t){return t.styleChanged()})))}!e.filled||this.targetedLockupStyle.textLook!=_.LockupTextLook.Shadow&&this.targetedLockupStyle.textLook!=_.LockupTextLook.ShadowAndOutline&&this.targetedLockupStyle.textLook!=_.LockupTextLook.FillAndOutline&&this.targetedLockupStyle.textLook!=_.LockupTextLook.FillAndOutline2&&this.targetedLockupStyle.textLook!=_.LockupTextLook.OutlineOnly||1!=this.targetedLockupStyle.backingOpacity||(this.targetedLockupStyle.opacityRule=_.OpacityRule.UseLockupOpacities,this.targetedLockupStyle.backingOpacity=.5)}},getKnockoutColor:function(){var t,e,o=this.forma.style;return this.targetedLockupStyle!==this.forma.style&&(t=M.ShapeLibrary.shapeDictionary[y.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=M.ShapeLibrary.shapeDictionary[y.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])&&(e.filled||!t.filled)?this.targetedLockupStyle.colors.fieldSecondary:o.colors.fieldSecondary},getTextLookForUI:function(){return this.targetedTextLook==_.LockupTextLook.FillAndOutline2||this.targetedTextLook==_.LockupTextLook.OutlineOnly?_.LockupTextLook.FillAndOutline:this.targetedTextLook},getStrokeWeightPercentForUI:function(){return 99*this.targetedStrokeWeight+1},getShadowOffsetPercentForUI:function(){return 99*this.targetedShadowOffset+1},setTextLook:function(t){this.targetedLockupStyle!==this.forma.style&&t==this.forma.style.textLook?this.targetedLockupStyle.textLook=_.LockupTextLook.UNSET:(this.targetedLockupStyle.textLook=t,this.targetedLockupStyle.textLook==_.LockupTextLook.KnockoutAndShadow&&(135==this.targetedShadowAngle&&225==this.targetedShadowAngle||(this.targetedShadowAngle=135)),this.targetedLockupStyle.textLook==_.LockupTextLook.ShadowAndOutline?this.targetedShadowOffset=_.LockupStyle.DEFAULT_SHADOWOFFSET/2:this.targetedShadowOffset=_.LockupStyle.DEFAULT_SHADOWOFFSET,this.targetedLockupStyle.textLook==_.LockupTextLook.KnockoutAndOutline?this.targetedStrokeWeight=0:this.targetedStrokeWeight=_.LockupStyle.DEFAULT_STROKEWEIGHT),this.fixUpSecondaryColor(),this.fixUpBackingShape(),this.forma.controller.styleChanged()},applyBacking:function(t,e){k.opt(k.as(this.forma.controller,G.TypeLockupController),(function(t){return t.beginBlockedUpdate()}));var o,i=y.getBackingStringForBackingEnumAndArtworkId(t,e);if(null!=(o=k.opt(this.forma,(function(t){return t.source})))&&O.FormaSourceUtils.isDesignIngredient(o)){var r=m.BadgeFacade.getDesignIngredientIDAndType(o),a=r.id,n=r.type;k.opt(I.Host.logging,(function(t){return t.logToAnalytics(S.AnalyticsConstants.kDesignIngredientBackingShapeChanged,{contextualData1:"designIngredientId:"+a,contextualData2:"designIngredientType:"+n,contextualData12:"shapeName:"+i})}))}var l=k.clone(y.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,this.forma.page.document)),s=null;this.targetedLockupStyle!==this.forma.style&&(s=this.targetedLockupStyle);var c,u=!1,h=!1,g=this.targetedLockupStyle.currentBackingOpacity,p=this.targetedLockupStyle.textLook;if(t==_.LockupBacking.Knockout){_.LockupStyle.isKnockoutLook(p)||(p=_.LockupTextLook.KnockoutOnly,l.textLook="knockoutOnly"),null!=this.forma.root&&this.forma.root.visitAll(T.FormaTraversal.PreOrder,(function(t){if(t.style instanceof _.LockupStyle){var e=t.style;e.backing==_.LockupBacking.Knockout&&(e.backing=_.LockupBacking.None,e.textLook=_.LockupTextLook.Fill)}}));var d=this.forma.parent;if(null!=d){var f=k.clone(d.filterWithCallback((function(t){return(t.isBackgroundImage()||t.isShape())&&null!=t.controller&&!t.controller.floating}),T.FormaTraversal.JustChildren));d.insertChildAt(this.forma,f.length)}}null!=s&&(t==_.LockupBacking.None||t==_.LockupBacking.Rows||t==_.LockupBacking.SVGBackground?(s.backing=t,s.backingArtworkID=e):t==_.LockupBacking.Knockout&&(s.backing=_.LockupBacking.UNSET,p=_.LockupTextLook.KnockoutOnly),l=k.clone(y.lockupStyleToLockupStyleAttributes(s,this.forma.page.document)),i=y.getBackingStringForBackingEnumAndArtworkId(s.backing,s.backingArtworkID),p=s.textLook),l.backing!=i&&(c=M.ShapeLibrary.shapeDictionary[i])&&(u=y.needsContrastingColor(i,p,c.filled),0==c.filled&&p!=_.LockupTextLook.FillAndOutline&&p!=_.LockupTextLook.FillAndOutline2&&(h=!0),0==c.filled&&(g=1)),l.backing=i,t!=_.LockupBacking.None||p!=_.LockupTextLook.KnockoutOnly&&p!=_.LockupTextLook.KnockoutAndOutline||(l.textLook="none");var L,C=k.clone(this.updateOpacityAttributes(g,k.clone(l)));if(u&&(x=this.forma.page.colorLibraryController.getSolidColorForKey(l.secondaryColor))&&(D=this.forma.page.colorLibraryController.getSolidColorForKey(l.primaryColor))){var v=y.getBackingOpacity(k.clone(l));v==_.LockupStyle.OPACITY_UNSET&&(v=y.getBackingOpacity(k.clone(y.lockupStyleToLockupStyleAttributes(this.forma.style,this.forma.page.document))));for(var A=!0,b=k.iter(this.pageData.colorsBehindSelectedLockup);!b.done;b.next()){var R=b.value.blend(x,v);if(!y.hasSufficientLegibilityContrast(D,R)){A=!1;break}}if(!A){var w=this.getContrastingColorKey(l.secondaryColor,l.primaryColor);C.secondaryColor=w}}if(h){var D,x,B,F=l.primaryColor,E=l.secondaryColor;(D=this.forma.page.colorLibraryController.getSolidColorForKey(F))&&(this.pageData.isColorVisibleAgainstBackground(D)||(x=this.forma.page.colorLibraryController.getSolidColorForKey(E))&&(this.pageData.isColorVisibleAgainstBackground(x)&&!k.opt(M.ShapeLibrary.shapeDictionary[i],(function(t){return t.category==M.ShapeCategory.Cutout}))?(C.primaryColor=E,C.secondaryColor=F):null!=(B=this.getThemeColorContrastingWithBackground())&&(C.primaryColor=B)))}if(null!=s)s.textOpacity!=_.LockupStyle.OPACITY_UNSET&&(s.textOpacity=C.textOpacity),s.backingOpacity!=_.LockupStyle.OPACITY_UNSET&&(s.backingOpacity=C.backingOpacity),this.pickVisibleColorsForCharStyle();else{var W=y.lockupStyleAttributesToLockupStyle(k.clone(C),this.forma.style,this.forma.page.document);if(W.shapeSupportsKnockout)W.textLook!=_.LockupTextLook.Shadow&&W.textLook!=_.LockupTextLook.ShadowAndOutline&&W.textLook!=_.LockupTextLook.FillAndOutline&&W.textLook!=_.LockupTextLook.FillAndOutline2&&W.textLook!=_.LockupTextLook.OutlineOnly||1!=W.backingOpacity||(W.backingOpacity=.5);else{_.LockupStyle.isKnockoutLook(W.textLook)&&(W.textLook=_.LockupTextLook.Fill);for(var P=k.iter(W.characterStyles);!P.done;P.next()){var U=P.value;!U.shapeSupportsKnockout&&_.LockupStyle.isKnockoutLook(U.textLook)&&(U.textLook=_.LockupTextLook.UNSET)}}this.forma.applyStyle(W)}(L=k.as(this.forma.controller,G.TypeLockupController))&&(L.endBlockedUpdate(),L.styleChanged()),this.onBackingShapeChanged()},switchPrimaryColorAndSecondaryColor:function(){var t,e=!1;if(t=k.as(k.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){var o=k.clone(y.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(null!=i&&null!=r){var a=o.primaryColor;o.primaryColor=o.secondaryColor,o.secondaryColor=a;var n=y.lockupStyleAttributesToLockupStyle(k.clone(o),this.forma.style,this.forma.page.document);this.forma.applyStyle(n),e=!0}}return e},getContrastingThemeColorBasedOnSolidColor:function(t,e){if(void 0===e&&(e=null),null==t)return null;for(var o=this.forma.page.colorLibraryController,i=k.iter(o.getThemeColorKeys().concat(v.ColorLibraryController.THEME_DERIVED_BW_KEYS));!i.done;i.next()){var r,a=i.value;if((r=o.getSolidColorForKey(a))&&r.contrasts(t,!1)&&!r.isEqual(e))return a}return null},getThemeColorContrastingWithBackground:function(t){void 0===t&&(t=null);for(var e=this.forma.page.colorLibraryController,o=k.iter(e.getThemeColorKeys().concat(v.ColorLibraryController.THEME_DERIVED_BW_KEYS));!o.done;o.next()){var i,r=o.value;if((i=e.getSolidColorForKey(r))&&(null==t||!i.isEqual(t))){for(var a=!0,n=k.iter(this.pageData.colorsBehindSelectedLockup);!n.done;n.next()){var l=n.value;if(!i.contrasts(l,!1)){a=!1;break}}if(a)return r}}return null},doesLockupContrastWithBackground:function(){var t,e=!0;if(t=k.as(k.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){var o=k.clone(y.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);t.secondaryColorVisible?t.textBacked?null!=i&&null!=r&&(e=this.pageData.isColorVisibleAgainstBackground(r)&&i.contrasts(r,!1)):null!=i&&null!=r&&(e=this.pageData.isColorVisibleAgainstBackground(i)&&this.pageData.isColorVisibleAgainstBackground(r)):null!=i&&(e=this.pageData.isColorVisibleAgainstBackground(i))}return e},pickVisibleColorsForLockup:function(){var t=this.pickVisibleColorsForTextAndShape(),e=this.pickVisibleColorsForCharStyle(),o=t||e;return o&&this.forma.controller.styleChanged(),o},pickVisibleColorsForTextAndShape:function(){if(this.doesLockupContrastWithBackground())return!1;if(this.switchPrimaryColorAndSecondaryColor()){if(this.doesLockupContrastWithBackground())return!0;this.switchPrimaryColorAndSecondaryColor()}var t,e=!1;if(t=k.as(k.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){var o=k.clone(y.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(t.secondaryColorVisible){if(t.textBacked){if(null!=i&&null!=r)if(this.pageData.isColorVisibleAgainstBackground(r))i.contrasts(r,!1)||null!=(a=this.getContrastingThemeColorBasedOnSolidColor(r))&&(o.primaryColor=a,e=!0);else if(null!=(l=this.getThemeColorContrastingWithBackground())){o.secondaryColor=l;var a,n=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);e=!0,y.hasSufficientLegibilityContrast(i,n)||null!=(a=this.getContrastingThemeColorBasedOnSolidColor(n))&&(o.primaryColor=a)}}else if(null!=i&&null!=r){var l;this.pageData.isColorVisibleAgainstBackground(i)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0),this.pageData.isColorVisibleAgainstBackground(r)||(i.isEqual(r)?(o.secondaryColor=o.primaryColor,e=!0):null!=(l=this.getThemeColorContrastingWithBackground(i))?(o.secondaryColor=l,e=!0):(o.secondaryColor=o.primaryColor,e=!0))}}else null!=i&&(this.pageData.isColorVisibleAgainstBackground(i)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0));if(e){var s=y.lockupStyleAttributesToLockupStyle(k.clone(o),this.forma.style,this.forma.page.document);this.forma.applyStyle(s)}}return e},pickVisibleColorsForCharStyle:function(){var t,e=!1;if(t=k.as(k.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){if(0==k.count(t.characterStyles))return e;for(var o=_.LockupStyle.isKnockoutLook(t.textLook)?"":t.colors.colorID(D.ColorRole.FieldPrimary),i=t.textBacked?t.colors.colorID(D.ColorRole.FieldSecondary):"",r=this.forma.page.colorLibraryController,a=[],n=k.iter(r.getThemeColorKeys().concat(v.ColorLibraryController.THEME_DERIVED_BW_KEYS));!n.done;n.next()){var l,s=n.value;(l=r.getSolidColorForKey(s))&&this.pageData.isColorVisibleAgainstBackground(l)&&a.push(s)}for(var c=k.iter(t.characterStyles);!c.done;c.next()){var u=c.value,h=u.colors.colorID(D.ColorRole.FieldPrimary),g=u.secondaryColorVisible?u.colors.colorID(D.ColorRole.FieldSecondary):"";if(u.secondaryColorVisible&&u.backing!=_.LockupBacking.UNSET){var p,d=!1;if(""==i&&(p=r.getSolidColorForKey(g))&&(this.pageData.isColorVisibleAgainstBackground(p)||(d=!0)),d)for(var f=k.iter(a);!f.done;f.next())(w=f.value)!=i&&(u.colors.setColorId(D.ColorRole.FieldSecondary,w),e=!0);else if(g==i)for(var y=k.iter(r.getThemeColorKeys().concat(v.ColorLibraryController.THEME_DERIVED_BW_KEYS));!y.done;y.next())(s=y.value)!=i&&(u.colors.setColorId(D.ColorRole.FieldSecondary,s),e=!0)}var S=!1,L=h!=o,m=r.getSolidColorForKey(t.colors.colorID(D.ColorRole.FieldPrimary));if(null==m)return e;if(!u.textBacked){var C=r.getSolidColorForKey(h);L&&""!=o&&(L=C.contrasts(m,!1)),""!=i||this.pageData.isColorVisibleAgainstBackground(C)||(S=!0)}if((u.backing!=_.LockupBacking.None&&u.backing!=_.LockupBacking.UNSET||L&&h!=i)&&!S){if(u.textBacked&&h==u.colors.colorID(D.ColorRole.FieldSecondary))for(var A=k.iter(r.getThemeColorKeys());!A.done;A.next())if((s=A.value)!=u.colors.colorID(D.ColorRole.FieldSecondary)){u.colors.setColorId(D.ColorRole.FieldPrimary,s),e=!0;break}}else for(var b=k.iter(a);!b.done;b.next()){var R=b.value,w=r.getSolidColorForKey(R),T=""==o||w.contrasts(m,!1);if(R!=o&&R!=i&&(!T&&e||u.colors.setColorId(D.ColorRole.FieldPrimary,R),e=!0,T))break}}}return e},getBrandkitColorsInUse:function(){for(var t=[],e=this.forma.page.colorLibraryController,o=k.iter(e.getColorThemeAsArrayOfTheoColors());!o.done;o.next()){var i=o.value;i.isBrandkitColor()&&t.push(i)}return t},getAllColorsFromDocumentBrandkit:function(){var t=[],e=I.Host.brandkitManager.brandkitForDocument(this.forma.page.document);if(null!=e)for(var o=k.iter(e.colors);!o.done;o.next()){var i=o.value,r=N.TheoColor.init_bb45(i);t.push(r)}return t},getBaseSuggestableColors:function(){for(var t=this.forma.page.colorLibraryController,e=k.clone(t.getColorThemeAsArrayOfTheoColors()),o=k.clone(t.getThemeDerivedColorsAsArrayOfTheoColors()),i=k.clone(t.getSuggestedColorsAsArraysOfTheoColors()),r=e.concat(i).concat(o),a=[],n=k.clone(this.getAllColorsFromDocumentBrandkit()),l=k.iter(r);!l.done;l.next()){var s=l.value;if(!s.isBrandkitColor()){for(var c=!0,u=k.iter(a);!u.done;u.next()){var h=u.value;if(s.rgbColor.distanceTo(h)<20){c=!1;break}}for(var g=k.iter(n);!g.done;g.next()){var p=g.value;if(s.rgbColor.distanceTo(p.rgbColor)<20){c=!1;break}}if(c&&a.push(s.rgbColor),a.length>=10)break}}return a},getSuggestableSingleColors:function(){for(var t=k.clone(this.getBaseSuggestableColors()),e=y.getTextOpacity(k.clone(this.pageData.selectedLockup.styleAttributes)),o=[],i=k.iter(t);!i.done;i.next()){for(var r=i.value,a=r.withAlphaOf(e),n=!0,l=k.iter(this.pageData.colorsBehindSelectedLockup);!l.done;l.next()){var s=l.value;if(!y.hasSufficientLegibilityContrast(a,s)){n=!1;break}}n&&o.push(r)}return o},getSuggestableColors:function(){var t=k.clone(this.getSuggestableColorPairs());if(0==t.length)for(var e=k.clone(this.getSuggestableSingleColors()),o=k.iter(e);!o.done;o.next()){var i=o.value;t.push([i])}for(var r=[],a=k.iter(t);!a.done;a.next()){for(var n=a.value,l=[],s=k.iter(n);!s.done;s.next()){var c=s.value;l.push(this.forma.page.colorLibraryController.getTheoColorForSolidColor(c))}r.push(k.clone(l))}return r},isCurrentlyShowingMultipleColors:function(){var t;return!((t=k.as(this.forma.controller,G.TypeLockupController))&&(!t.secondaryColorVisible()||this.targetedLockupStyle.textLook==_.LockupTextLook.KnockoutOnly||this.targetedLockupStyle.textLook==_.LockupTextLook.OutlineOnly))},getSuggestableColorPairs:function(){var t=[];if(!this.isCurrentlyShowingMultipleColors())return t;var e=this.targetedLockupStyle,o=k.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=(M.ShapeLibrary.shapeDictionary[o.backing]||M.ShapeLibrary.shapeDictionary.none).filled,r=y.getBackingOpacity(k.clone(o));r==_.LockupStyle.OPACITY_UNSET&&(r=y.getBackingOpacity(k.clone(y.lockupStyleToLockupStyleAttributes(this.forma.style,this.forma.page.document))));var a=k.clone(this.getBaseSuggestableColors()),n=a.length;if(0==n)return t;for(var l={},s=k.toArray(k.range(0,n,!1)),c=k.clone(k.shuffle(s)),u=k.iter(this.pageData.lockups);!u.done;u.next()){var h=u.value;if(h.id!=this.forma.formaID&&"none"!=h.styleAttributes.backing){var g=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.primaryColor),p=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.secondaryColor);if(null!=g&&null!=p&&y.hasSufficientLegibilityContrast(g,p)){for(var d=-1,f=-1,S=k.iter(k.range(0,a.length,!1));!S.done;S.next()){var L=S.value;a[L].distanceTo(g)<.1&&(d=L),a[L].distanceTo(p)<.1&&(f=L)}null==l[b=k.toString(W.MathUtils.maxInt(d,f))+" "+k.toString(W.MathUtils.minInt(d,f))]&&(t.push([g,p]),l[b]=!0)}}}for(var m=k.iter(k.range(0,2,!0));!m.done;m.next()){for(var C=k.iter(c);!C.done;C.next()){d=C.value;for(var v=k.clone(k.shuffle(s)),A=k.iter(v);!A.done;A.next()){var b;if(f=A.value,t.length>=10)break;if(null==l[b=k.toString(W.MathUtils.maxInt(d,f))+" "+k.toString(W.MathUtils.minInt(d,f))]){var R=a[d],w=a[f],D=R,T=w;R.lightness<w.lightness&&(D=w,T=R);var x=[];x=this.pageData.colorsBehindSelectedLockup[0].lightness>D.lightness?[T,D]:[D,T],i&&(x=k.reverse(x));for(var O=x[0],I=!0,B=k.iter(this.pageData.colorsBehindSelectedLockup);!B.done;B.next()){var F=B.value.blend(x[1],r),E=O.distanceTo(x[1]);if(!y.hasSufficientLegibilityContrast(O,F)||E<y.kColorPairDistanceThreshold){I=!1;break}}I&&(l[b]=!0,t.push(k.clone(x)))}}if(t.length>=10)break}if(t.length>=10)break}return t},applyColors:function(t,e){var o=this.targetedLockupStyle,i=this.forma.page.colorLibraryController;if(0!=t.length){var r;if(null!=(r=k.opt(this.forma,(function(t){return t.source})))&&!this.loggedDesignIngredientColorChanged&&O.FormaSourceUtils.isDesignIngredient(r)){var a=m.BadgeFacade.getDesignIngredientIDAndType(r),n=a.id,l=a.type;k.opt(I.Host.logging,(function(t){return t.logToAnalytics(S.AnalyticsConstants.kDesignIngredientColorChanged,{contextualData1:"designIngredientId:"+n,contextualData2:"designIngredientType:"+l})})),this.loggedDesignIngredientColorChanged=!0}var s=k.clone(i.addColorsToTheme(k.clone(t),this.targetedLockupStyle!==this.forma.style?null:this.forma));if(1==t.length)this.applyColor(e,s[0]);else{var c=e==D.ColorRole.FieldPrimary?D.ColorRole.FieldSecondary:D.ColorRole.FieldPrimary;o.colors.setColorIDs([{key:e,value:s[0]},{key:c,value:s[1]}])}this.targetedLockupStyle!==this.forma.style&&(this.forma.style.colorTableBeforeChanged(),this.forma.style.colorTableAfterChanged(),this.forma.controller.styleChanged())}},applyColor:function(t,e){var o=this.targetedLockupStyle,i=k.clone(y.lockupStyleToLockupStyleAttributes(o,this.forma.page.document)),r=(M.ShapeLibrary.shapeDictionary[i.backing]||M.ShapeLibrary.shapeDictionary.none).filled,a=y.needsContrastingColor(i.backing,o.textLook,r),n=this.getContrastingColorKey(e,null);switch(t){case 1:i.primaryColor=e,i.secondaryColor=a?n:e;break;case 2:i.secondaryColor=e,i.primaryColor=a?n:e;break;default:return}o.colors.setColorIDs([{key:D.ColorRole.FieldPrimary,value:i.primaryColor},{key:D.ColorRole.FieldSecondary,value:i.secondaryColor}])},getContrastingColorKey:function(t,e){var o,i=this.forma.page.colorLibraryController.getTheoColorForKey(t);if(null==i)return"";null!=e&&(o=this.forma.page.colorLibraryController.getTheoColorForKey(e));var r=this.forma.page.colorLibraryController,a="";if(i.isBrandkitColor())for(var n=k.clone(this.getBrandkitColorsInUse()),l=i.getBrandkitShadeRole(),s=k.iter(n);!s.done;s.next()){var c=s.value,u=c.getBrandkitShadeRole();if((null==l&&(u==N.TheoColor.SPARK_COLOR_ROLE_SHADE0||u==N.TheoColor.SPARK_COLOR_ROLE_SHADE6)||null!=l&&(u==N.TheoColor.SPARK_COLOR_ROLE_SHADE1||u==N.TheoColor.SPARK_COLOR_ROLE_SHADE5))&&c.rgbColor.distanceTo(i.rgbColor)>30&&(null==o||c.rgbColor.distanceTo(o.rgbColor)>30)){a=r.getKeyOfColorInTheme(c);break}}return""==a&&null!=i&&(a=r.setLightnessContrastColorAndReturnKey(t,i)),a},setContrastingColor:function(t,e,o,i,r){var a=t.contrastWithColor(e),n=v.ColorLibraryController.getBackgroundContrastKey(i);return this.forma.page.colorLibraryController.setTheoColorToLibrary(N.TheoColor.init_5344(a,null,null),n),r.colors.setColorIDs([{key:o,value:n}]),n},backgroundContrastCheck:function(t){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var e=this.targetedLockupStyle,o=k.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=M.ShapeLibrary.shapeDictionary[o.backing],r=k.count(e.characterStyles)>0;if(null!=i){var a=i.filled;if(!a||e.textLook==_.LockupTextLook.KnockoutOnly||r){for(var n,l,s=e.textLook==_.LockupTextLook.KnockoutOnly,c=e.strokeWeight>.15,u=s||c?D.ColorRole.FieldSecondary:D.ColorRole.FieldPrimary,h=!1,g=k.iter(this.forma.style.characterStyles);!g.done;g.next())(L=g.value).colors.colorID(u)==e.colors.colorID(u)&&(h=!0);if((n=k.as(this.forma.controller,G.TypeLockupController))&&(l=n.getBackgroundColor())){var p=e.colors.color(u);if(null!=p&&!p.contrasts(l,t)){var d=this.getContrastingColorKey(e.colors.colorID(u),null);e.colors.setColorId(u,d),this.forma.controller.styleChanged()}if(r&&!h)for(var f=k.iter(this.forma.style.characterStyles);!f.done;f.next()){var S,L=f.value;if(S=a?e.colors.color(D.ColorRole.FieldSecondary):l){var m=L.colors.color(u);if(null!=m&&!m.contrasts(S,t)){var v=L.colors.colorID(u);d=this.getContrastingColorKey(v,null),L.colors.setColorId(u,d)}}}}}}else C.CoreAssert.fail("shape is not set up in ShapeLibrary.shapeDictionary","LockupStyleController.backgroundContrastCheck","LockupStyleController.swift",3792)},shuffleColorAssignment:function(){this.updateScoring();var t=k.as(this.forma.controller,G.TypeLockupController);null!=t&&t.beginBlockedUpdate();var e=this.targetedLockupStyle,o=k.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=_.LockupStyle.isOutlineLook(e.textLook)||_.LockupStyle.isShadowLook(e.textLook),r=!1;i||(r=M.ShapeLibrary.shapeDictionary[o.backing].filled),("none"!=o.backing||i)&&(o.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0));var a,n=null;(r||i)&&(a=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor))&&(n=k.clone(R.ColorForComparison.init_c063(a,i?.7:1)));var l=!r;l&&this.pageData.lockups.length<=2?o.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,k.clone(n),!1):o.primaryColor=this.profilingPrimaryColorSelector.selectColorForGlobalRecolor(l,k.clone(n),!0),this.setSecondaryMultiStyleLockupColors(e,k.clone(o)),e.colors.setColorIDs([{key:D.ColorRole.FieldPrimary,value:o.primaryColor},{key:D.ColorRole.FieldSecondary,value:o.secondaryColor}]),null!=t&&t.endBlockedUpdate(),this.forma.controller.styleChanged()},shuffleMultiStyleLockupColors:function(){this.pageData=k.clone(y.InterestingPageData.init_a05b(this.forma)),this.profilingPrimaryColorSelector.updateBackgroundColors(k.clone(this.pageData.colorsBehindSelectedLockup)),this.profilingBackgroundColorSelector.updateBackgroundColors(k.clone(this.pageData.colorsBehindSelectedLockup));var t=this.targetedLockupStyle,e=k.clone(y.lockupStyleToLockupStyleAttributes(t,this.forma.page.document));this.setSecondaryMultiStyleLockupColors(t,k.clone(e))},setSecondaryMultiStyleLockupColors:function(t,e,o){void 0===o&&(o=!0);for(var i=k.iter(t.characterStyles);!i.done;i.next()){var r=i.value,a=k.eq(U._equality_SolidColor_SolidColor,t.colors.fieldPrimary,t.colors.fieldSecondary);if(r.backing!=_.LockupBacking.None&&r.backing!=_.LockupBacking.UNSET&&!a&&k.eq(U._equality_SolidColor_SolidColor,r.colors.fieldPrimary,t.colors.fieldSecondary)&&k.eq(U._equality_SolidColor_SolidColor,r.colors.fieldSecondary,t.colors.fieldPrimary)&&o)r.colors.setColorIDs([{key:D.ColorRole.FieldPrimary,value:e.secondaryColor},{key:D.ColorRole.FieldSecondary,value:e.primaryColor}]);else{for(var n=k.clone(this.getStylePrimarySecondaryColorForMSL(k.clone(e),r,!0)),l=k.iter(k.range(0,5,!0));!l.done&&n[0]==n[1];l.next())n=k.clone(this.getStylePrimarySecondaryColorForMSL(k.clone(e),r,!0));r.colors.setColorIDs([{key:D.ColorRole.FieldPrimary,value:n[0]},{key:D.ColorRole.FieldSecondary,value:n[1]}])}}},getStylePrimarySecondaryColor:function(t){var e=k.clone(t);e.secondaryColor=this.secondaryColorSelector.select(k.clone(e),!1,!0,!1,!1),e.primaryColor=this.primaryColorSelector.select(k.clone(e),!1,!0,!1,!1);for(var o=k.iter(k.range(0,5,!0));!o.done&&e.primaryColor==e.secondaryColor;o.next())e.secondaryColor=this.secondaryColorSelector.select(k.clone(e),!1,!0,!1,!1),e.primaryColor=this.primaryColorSelector.select(k.clone(e),!1,!0,!1,!1);return[e.primaryColor,e.secondaryColor]},getStylePrimarySecondaryColorForMSL:function(t,e,o){var i,r=this.secondaryColorSelector.select(k.clone(t),!0,!1,!0,o),a=!0;if(e.backing!=_.LockupBacking.None||_.LockupStyle.isOutlineLook(e.textLook)||_.LockupStyle.isShadowLook(e.textLook)){var n=k.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document));n.secondaryColor=r,i=this.primaryColorSelector.select(k.clone(n),!0,!1,!1,o)}else a=!1,i=this.primaryColorSelector.select(k.clone(t),!1,!1,!0,o);var l,s,c=(new P.ProfilingColorMap).overridePaletteMappingDueToContrast(r,this.forma.formaID+P.ProfilingColorMap.lockupMSLBackingColorKey),u=(new P.ProfilingColorMap).overridePaletteMappingDueToContrast(i,this.forma.formaID+P.ProfilingColorMap.lockupMSLPrimaryColorKey);return(l=this.forma.page.colorLibraryController.getSolidColorForKey(u))&&(s=this.forma.page.colorLibraryController.getSolidColorForKey(c))&&(a&&!s.contrasts(l)||(r=c,i=u)),[i,r]},generateAndApplyInitialStyleAttributes:function(){0==this.hasScoresForAttributes&&this.updateScoring();for(var t=this.forma.style,e=k.clone(y.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),o=["Lato-Light","Lora-Regular","Montserrat-Regular","PlayfairDisplay-Regular","CantataOne-Regular","FuturaPT-Medium"],i=["square_001","row"],r=o[b.CoreRandom.nextIntUniform(o.length)],a=I.Host.fontProvider.getIncludedFonts(this.forma.page.document),n=k.iter(k.range(0,a.count,!1));!n.done;n.next()){var l=n.value;k.opt(a.fontAt(l),(function(t){return t.postScriptName==r}))&&(e.font=l)}e.layout=this.layoutSelector.select(k.clone(e),!1,!1,!1,!1),"fill"!=e.layout&&"right"!=e.layout||(e.layout="center");var s=b.CoreRandom.nextIntUniform(i.length);e.backing=i[s],e.padding=0,"row"==e.backing&&(e.spacing=1,e.padding=.33),e.textOpacity=1,e.backingOpacity=1,e=k.clone(this.setNewStyleColors(k.clone(e),t));var c=y.lockupStyleAttributesToLockupStyle(k.clone(e),this.forma.style,this.forma.page.document);this.forma.applyStyle(c)},setNewStyleColors:function(t,e){var o,i=k.clone(t),r=M.ShapeLibrary.shapeDictionary[i.backing].filled,a=_.LockupStyle.isOutlineLook(e.textLook)||_.LockupStyle.isShadowLook(e.textLook),n=null,l=!r;return("none"!=i.backing||a)&&(i.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0,void 0,!0),(o=this.forma.page.colorLibraryController.getSolidColorForKey(i.secondaryColor))&&(n=k.clone(R.ColorForComparison.init_c063(o,a?.7:1)))),i.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,k.clone(n),!0),i},getNewStyleAttributes:function(t,e,o){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var i,r,a=this.forma.style,n=k.clone(y.lockupStyleToLockupStyleAttributes(a,this.forma.page.document));return n.font=this.fontSelector.select(k.clone(n),!1,t,!1,!1),n.layout=this.layoutSelector.select(k.clone(n),!1,t,!1,!1),n.backing=this.backingSelector.select(k.clone(n),!1,t,!1,!1),o||(n.secondaryColor=this.secondaryColorSelector.select(k.clone(n),!1,t,!1,!1),n.primaryColor=this.primaryColorSelector.select(k.clone(n),!1,t,!1,!1),this.setSecondaryMultiStyleLockupColors(a,k.clone(n),!1)),n.shadowAngle=this.shadowAngleSelector.select(k.clone(n),!1,t,!1,!1),n.spacing=this.spacingSelector.select(k.clone(n),!1,t,!1,!1),n.wheelUsed=!0,o?(i=y.lockupStyleAttributesToLockupStyle(k.clone(n),a,this.forma.page.document),i=this.updateLockupStyleWithNewColors(i),(r=e)&&(i=r.lockupStyleEvaluator.styleEvaluatedWithReadability(i))):(i=y.lockupStyleAttributesToLockupStyle(k.clone(n),a,this.forma.page.document),(r=e)&&r.lockupStyleEvaluator.initializeReadabilityInformation(i)),i},evaluateLockupStyleWithReadability:function(t){return new E.LockupStyleEvaluator(this.forma).styleEvaluatedWithReadability(t)},updateLockupStyleWithNewColors:function(t){(new P.ProfilingColorMap).eraseCurrentPaletteMappingDictionary();var e=k.clone(y.lockupStyleToLockupStyleAttributes(t,this.forma.page.document)),o=k.clone(this.getStylePrimarySecondaryColor(k.clone(e)));return e.primaryColor=o[0],e.secondaryColor=o[1],t.colors.setColorIDs([{key:D.ColorRole.FieldPrimary,value:o[0]},{key:D.ColorRole.FieldSecondary,value:o[1]}]),this.setSecondaryMultiStyleLockupColors(t,k.clone(e),!1),t},updateOpacityAttributes:function(t,e){var o=(M.ShapeLibrary.shapeDictionary[e.backing]||M.ShapeLibrary.shapeDictionary.none).filled,i=k.clone(e);return i.opacity="useLockupOpacities",o?(y.getTextLook(k.clone(i))==_.LockupTextLook.KnockoutAndOutline?i.textOpacity=t:i.textOpacity=1,i.backingOpacity=t):(i.textOpacity=t,i.backingOpacity=t),i},setOpacity:function(t){var e=this.targetedLockupStyle,o=k.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=k.clone(this.updateOpacityAttributes(t,k.clone(o)));this.targetedLockupStyle===this.forma.style?this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(k.clone(i),this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.opacityRule=_.OpacityRule.UseLockupOpacities,this.targetedLockupStyle.textOpacity=i.textOpacity,this.targetedLockupStyle.backingOpacity=i.backingOpacity,this.forma.controller.styleChanged())},getOpacityValue:function(){return this.targetedLockupStyle.opacityRule!=_.OpacityRule.UNSET?this.targetedLockupStyle.currentBackingOpacity:this.forma.style.currentBackingOpacity},hasSpacingOptions:function(){return this.targetedLockupStyle===this.forma.style&&!(!(t=k.as(this.forma.controller,G.TypeLockupController))||!(t.numLines()>1||0==t.numLines()));var t},hasPaddingOptions:function(){var t=this.targetedLockupStyle;return t.backing!=_.LockupBacking.None&&t.backing!=_.LockupBacking.Knockout&&t.backing!=_.LockupBacking.UNSET},areSpacingAndPaddingOptionsAvailable:function(){return this.hasSpacingOptions()||this.hasPaddingOptions()},setNextSpacingAndPaddingOption:function(){var t,e;if(this.targetedLockupStyle===this.forma.style){var o=this.hasPaddingOptions(),i=this.hasSpacingOptions();if(o||i){var r=this.forma.style,a=k.clone(y.lockupStyleToLockupStyleAttributes(r,this.forma.page.document)),n=y.ALLOWED_PADDING_VALUES.length,l=y.ALLOWED_SPACING_VALUES.length,s=n*l,c=(t=k.indexOf(y.ALLOWED_PADDING_VALUES,a.padding))||null!=t?t:0,u=(e=k.indexOf(y.ALLOWED_SPACING_VALUES,a.spacing))||null!=e?e:0,h=(o?u*n+c:c*l+u)+1;h%=s;var g=o?k.toInt(h/n):h%l,p=o?h%n:k.toInt(h/l);a.padding=y.ALLOWED_PADDING_VALUES[p],a.spacing=y.ALLOWED_SPACING_VALUES[g],this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(k.clone(a),this.forma.style,this.forma.page.document))}}else this.setNextPaddingOption()},setNextSpacingOption:function(){var t,e=this.forma.style,o=k.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=((t=k.indexOf(y.ALLOWED_SPACING_VALUES,o.spacing))||null!=t?t:0)+1;i>=y.ALLOWED_SPACING_VALUES.length&&(i=0),o.spacing=y.ALLOWED_SPACING_VALUES[i],this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(k.clone(o),this.forma.style,this.forma.page.document))},setSpacingFromSlider:function(t){this.setSpacing(K.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setSpacing:function(t){var e,o=this.forma.style,i=k.clone(y.lockupStyleToLockupStyleAttributes(o,this.forma.page.document)),r=((e=k.indexOf(y.ALLOWED_SPACING_VALUES,i.spacing))||null!=e?e:0)+1;r>=y.ALLOWED_SPACING_VALUES.length&&(r=0),i.spacing=t,this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(k.clone(i),this.forma.style,this.forma.page.document))},setNextPaddingOption:function(){var t;if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==_.LockupBacking.Rows&&this.forma.style.backing==_.LockupBacking.Rows&&(e=this.forma.style);var o=k.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=((t=k.indexOf(y.ALLOWED_PADDING_VALUES,o.padding))||null!=t?t:0)+1;i>=y.ALLOWED_PADDING_VALUES.length&&(i=0),o.padding=y.ALLOWED_PADDING_VALUES[i],e===this.forma.style?this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(k.clone(o),this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setPaddingFromSlider:function(t){this.setPadding(K.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setPadding:function(t){if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==_.LockupBacking.Rows&&this.forma.style.backing==_.LockupBacking.Rows&&(e=this.forma.style);var o=k.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document));o.padding=t,e===this.forma.style?this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(k.clone(o),this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setNextTrackingOption:function(){var t=this.forma.style,e=k.clone(y.lockupStyleToLockupStyleAttributes(t,this.forma.page.document));e.tracking+=.2,e.tracking>.9&&(e.tracking=0),this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(k.clone(e),this.forma.style,this.forma.page.document))},setTrackingFromSlider:function(t){var e;if(e=k.as(k.opt(this.forma,(function(t){return t.controller})),G.TypeLockupController)){var o=e.getCurrentFontSize();this.targetedLockupStyle.tracking=t;var i=k.opt(e.getPin(!0,!0),(function(t){return t.pinPoint}))||Y.TheoPoint.ZERO;e.setSizeSliderValue(o,[],i)}},setNextShadowAngle:function(){var t;if(_.LockupStyle.isShadowLook(this.targetedLockupStyle.textLook)){var e=this.forma.style,o=k.clone(y.lockupStyleToLockupStyleAttributes(e,this.forma.page.document)),i=((t=k.indexOf(y.ALLOWED_SHADOWANGLE_VALUES,o.shadowAngle))||null!=t?t:0)+1;i>=y.ALLOWED_SHADOWANGLE_VALUES.length&&(i=0),o.shadowAngle=y.ALLOWED_SHADOWANGLE_VALUES[i],this.forma.applyStyle(y.lockupStyleAttributesToLockupStyle(k.clone(o),this.forma.style,this.forma.page.document))}},legacyColorConversion:function(){if(null==this.forma)return I.Host.logging.info("forma has been de-alloc'd"),void C.CoreAssert.isTrue(!1,void 0,"LockupStyleController.legacyColorConversion","LockupStyleController.swift",4517);for(var t=this.forma.style,e=[D.ColorRole.FieldPrimary,D.ColorRole.FieldSecondary],o=k.iter(e);!o.done;o.next()){var i=o.value,r=t.colors.color(i),a=t.colors.colorID(i),n=null!=a&&v.ColorLibraryController.keyFromImage(a);if(null!=r&&null==a||n){var l=this.forma.page.colorLibraryController.addUnlinkedColor(r);t.colors.setColorId(i,l)}}},onTrackingChanged:function(){var t=this.forma.style;this._sessionAttrsDict[this.getSessionAttrsKey("tracking",t.layout)]=t.tracking},onSpacingChanged:function(){var t=this.forma.style;this._sessionAttrsDict[this.getSessionAttrsKey("spacing",t.layout)]=t.spacing},onBackingShapeChanged:function(){this._sessionAttrsDict[this.getSessionAttrsKey("backing")]="none"},onLayoutChanged:function(t){var e=this.forma.style,o=e.layout;if(this.getSessionAttrsKey("",t)!=this.getSessionAttrsKey("",o)){this._sessionAttrsDict[this.getSessionAttrsKey("tracking",t)]=e.tracking,this._sessionAttrsDict[this.getSessionAttrsKey("spacing",t)]=e.spacing,e.tracking=this._sessionAttrsDict[this.getSessionAttrsKey("tracking",o)],e.spacing=this._sessionAttrsDict[this.getSessionAttrsKey("spacing",o)];var i=_.LockupStyle.isLetterGrid(e.layout);if(_.LockupStyle.isLetterGrid(t)!=i)if(i)M.ShapeLibrary.isBackingShapeLetterGridCompatible(e.backing,e.backingArtworkID)||(this._sessionAttrsDict[this.getSessionAttrsKey("backing")]=y.getBackingStringForBackingEnumAndArtworkId(e.backing,e.backingArtworkID),e.backing=_.LockupBacking.None,e.backingArtworkID=null);else{var r=this._sessionAttrsDict[this.getSessionAttrsKey("backing")];if("none"!=r){var a=y.getBackingEnumAndArtworkIdForBackingString(r);e.backing=a.backing,e.backingArtworkID=a.artworkID,this._sessionAttrsDict[this.getSessionAttrsKey("backing")]="none"}}}},getSessionAttrsKey:function(t,e){void 0===e&&(e=null);var o,i="default";return null!=(o=e)&&(_.LockupStyle.isLetterGrid(o)?i="letterGrid":_.LockupStyle.isPath(o)&&(i="path")),i+"_"+t},resetSessionAttrs:function(){this._sessionAttrsDict[this.getSessionAttrsKey("backing")]="none",this._sessionAttrsDict[this.getSessionAttrsKey("tracking")]=0,this._sessionAttrsDict[this.getSessionAttrsKey("spacing")]=.35,this._sessionAttrsDict[this.getSessionAttrsKey("tracking",_.LockupLayout.LetterGrid)]=.35,this._sessionAttrsDict[this.getSessionAttrsKey("spacing",_.LockupLayout.LetterGrid)]=.35,this._sessionAttrsDict[this.getSessionAttrsKey("tracking",_.LockupLayout.Path)]=.15,this._sessionAttrsDict[this.getSessionAttrsKey("spacing",_.LockupLayout.Path)]=.35},endSession:function(){this.resetSessionAttrs()}}}),f)},UB0O:function(t,e,o){var i,r=e,a=o("oAGj"),n=o("SpAV"),l=o("cEEQ"),s=o("9kak"),c=o("c+uM"),u=o("GFAD"),h=o("tGKA"),g=o("8t9B"),p=o("3UhB"),d=o("uUew"),f=o("1NAc");r.EvenRowWidthsLayoutStrategy=(i=function(){this.paddingScalar=.6,this.spacingScalar=.75,l.BaseLockupLayoutStrategy.call(this)},a.defineClass({name:"EvenRowWidthsLayoutStrategy",ctor:i,superName:"BaseLockupLayoutStrategy",statics:{getCombinedAspectOfAllRows:function(t,e){for(var o=0,i=a.iter(t);!i.done;i.next())o+=1/i.value.aspectRatio;return e>0?1/(a.toDouble(t.length-1)*(1/e)+o):1/o},getCombinedAspectOfAllRowsFinal:function(t,e){for(var o=0,i=a.iter(t);!i.done;i.next()){var r=i.value,n=r.rowHeightAdjustRatio<1?r.rowHeightAdjustRatio:1;o+=1/r.aspectRatio*(n*n)}return 0!=e?1/(a.toDouble(t.length-1)*(1/e)+o):1/o},getAverageRowAspect:function(t){for(var e=0,o=a.iter(a.range(0,t.length,!1).reversed());!o.done;o.next())e+=t[o.value].aspectRatio;return e/a.toDouble(t.length)},getTallestRowPairIndex:function(t){for(var e=5e3,o=t.length,i=null,r=a.iter(a.range(0,o-1,!1));!r.done;r.next()){var n=r.value,l=a.clone(t[n]);if(l.appendable){var s=n+1,c=a.clone(t[s]),u=l.aspectRatio+c.aspectRatio;u<e&&(e=u,i=n)}}return i},aspectDifference:function(t,e){return 1/(1/t-1/e)},aspectStacked:function(t,e){return 1/(1/t+1/e)},mergeRows:function(t,e,o){var i=a.clone(t);n.CoreAssert.isTrue(e<o,void 0,"EvenRowWidthsLayoutStrategy.mergeRows","EvenRowWidthsLayoutStrategy.swift",592);var r=i[e].words.concat(i[o].words),l=a.clone(s.LockupRowInfo.init_d97e(a.clone(r),i[o].appendable));return i.splice(o,1),i.splice(e,1),i.splice(e,0,a.clone(l)),i},mergeAutoRows:function(t,e,o,r,n,l){for(var s=a.clone(i.mergeRows(a.clone(t),e,o)),c=l==g.HighlightMethod.EvenRows?0:1,u=0,h=a.iter(a.range(0,s.length,!1));!h.done;h.next()){for(var p=h.value,d=0,f=a.iter(a.range(0,s[p].words.length,!1));!f.done;f.next()){for(var y=f.value;r[u].isNewLine;)u+=1;var k=a.clone(p%2==c?n[u]:r[u]);s[p].words[y]=a.clone(k),d+=k.aspectRatio,y-1>=0&&(d+=a.clone(s[p].words[y-1]).spaceAspectRatio),u+=1}s[p].aspectRatio=d}return s},compactRowsIntoAspect:function(t,e,o){var r=t.length;if(r<=1)return t;var n=i.getCombinedAspectOfAllRows(a.clone(t),0),l=i.getTallestRowPairIndex(a.clone(t));if(null==l)return t;for(var s=l+1,c=a.clone(t[l]),h=a.clone(t[s]),g=c.aspectRatio,p=h.aspectRatio,d=g+p,f=0,y=0,k=a.iter(a.toSequence(t));!k.done;k.next()){var S=k.value,L=S.offset,m=S.element;f+=m.aspectRatio,L==l?y+=d:L!=s&&(y+=m.aspectRatio)}var C=f/a.toDouble(r),v=y/a.toDouble(r)/o,A=C/o/a.toDouble(r-1),b=v/a.toDouble(r-2),R=i.aspectStacked(i.aspectDifference(n,i.aspectStacked(p,g)),d),w=i.aspectStacked(b,R),D=i.aspectStacked(A,n);if(u.LockupUtils.percentageDiff(e,D)<=u.LockupUtils.percentageDiff(e,w))return t;var T=a.clone(i.mergeRows(a.clone(t),l,s));return i.compactRowsIntoAspect(a.clone(T),e,o)},compactAutoRowsIntoAspect:function(t,e,o,r,n,l){var s=t.length;if(s<=1)return t;var c=i.getCombinedAspectOfAllRows(a.clone(t),0),h=i.getTallestRowPairIndex(a.clone(t));if(null==h)return t;for(var g=h+1,p=a.clone(t[h]),d=a.clone(t[g]),f=p.aspectRatio,y=d.aspectRatio,k=f+y,S=0,L=0,m=a.iter(a.toSequence(t));!m.done;m.next()){var C=m.value,v=C.offset,A=C.element;S+=A.aspectRatio,v==h?L+=k:v!=g&&(L+=A.aspectRatio)}var b=S/a.toDouble(s),R=L/a.toDouble(s)/o,w=b/o/a.toDouble(s-1),D=R/a.toDouble(s-2),T=i.aspectStacked(i.aspectDifference(c,i.aspectStacked(y,f)),k),x=i.aspectStacked(D,T),O=i.aspectStacked(w,c);if(u.LockupUtils.percentageDiff(e,O)<=u.LockupUtils.percentageDiff(e,x))return t;var I=a.clone(i.mergeAutoRows(a.clone(t),h,g,a.clone(r),a.clone(n),l));return i.compactAutoRowsIntoAspect(a.clone(I),e,o,a.clone(r),a.clone(n),l)},getOptimalCompactedAutoRows:function(t,e,o,r,n,l){var s=t.length;if(s<=1)return t;var c=i.getCombinedAspectOfAllRows(a.clone(t),0),h=i.getTallestRowPairIndex(a.clone(t));if(null==h)return t;for(var g=h+1,p=a.clone(t[h]),d=a.clone(t[g]),f=p.aspectRatio,y=d.aspectRatio,k=f+y,S=0,L=0,m=a.iter(a.toSequence(t));!m.done;m.next()){var C=m.value,v=C.offset,A=C.element;S+=A.aspectRatio,v==h?L+=k:v!=g&&(L+=A.aspectRatio)}var b=S/a.toDouble(s),R=L/a.toDouble(s)/n,w=b/n/a.toDouble(s-1),D=R/a.toDouble(s-2),T=i.aspectStacked(i.aspectDifference(c,i.aspectStacked(y,f)),k),x=i.aspectStacked(D,T),O=i.aspectStacked(w,c);if(u.LockupUtils.percentageDiff(r,O)<=u.LockupUtils.percentageDiff(r,x))return t;var I=a.clone(i.mergeAutoRows(a.clone(t),h,g,a.clone(e),a.clone(o),l));return i.compactAutoRowsIntoAspect(a.clone(I),r,n,a.clone(e),a.clone(o),l)},_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.layout==c.LockupLayout.FitJustified},layout:function(t){var e=t.text,o=t.style.font.fontData,r=t.containerSize,s=r.width,u=r.height,y=t.style,k=y.spacing*this.spacingScalar,S=s,L=u,m=S/L,C=a.clone(t.characterStyleRanges);y.alignment!=c.LockupAlignment.UNSET&&n.CoreAssert.warning("Unexpected alignment "+y.alignment+" for fit-justified text");var v=o.allCapsAllowed?e.toUpperCase():e,A=l.getTypographicBoundingRatiosOfString(v,o),b=g.TypeLockupController.HIGHLIGHT_STYLE,R=a.opt(a.opt(y.characterStyles[b],(function(t){return t.font})),(function(t){return t.fontData})),w=p.TypeLockupUtils.getCharFontAdjust(y,A.hasUppercase),D=!1;t.characterStyleRanges.length>0&&null!=y.characterStyles[b]&&-1!=y.characterStyles[b].spacing&&0!=y.characterStyles[b].spacing&&y.characterStyles[b].spacing>1&&((y=t.style.clone()).characterStyles[b].spacing=w,C=a.clone(p.TypeLockupUtils.invertRanges(a.clone(t.characterStyleRanges),e.length)),D=!0,null!=R&&(R=o,o=y.characterStyles[b].font.fontData,y.characterStyles[b].font=y.font));for(var T=a.clone(p.TypeLockupUtils.computeLockupMeasurements(v,o,A.heightRatio,o.allCapsAllowed,t.forceLetterForma,y.tracking,a.clone(C),a.clone(y.characterStyles),w,t.forceLetterForma)),x=a.clone(this.getUncompactedRows(a.clone(T),!1)),O=a.clone(i.compactRowsIntoAspect(a.clone(x),m,k)),I=0,B=a.iter(T);!B.done;B.next())I+=(ct=B.value).isNewLine?0:1;if(null!=t.rowWordLengths&&t.rowWordLengths.reduce((function(t,e){return t+e}),0)==I&&(!t.allowFewerLineBreaks||O.length>=t.rowWordLengths.length)&&(O=a.clone(this.getPrecomputedRows(a.clone(T),a.clone(t.rowWordLengths)))),T.length>1&&(t.highlightMethod==g.HighlightMethod.EvenRows||t.highlightMethod==g.HighlightMethod.OddRows)&&""!=b&&null!=y.characterStyles[b]&&null!=R){var F=a.clone(p.TypeLockupUtils.computeLockupMeasurements(v,o,A.heightRatio,o.allCapsAllowed,!1,y.tracking,a.clone([]),a.clone({}))),_=[new d.TextRange(0,a.chars(e).length)],E=a.clone(p.TypeLockupUtils.computeLockupMeasurements(v,R,A.heightRatio,o.allCapsAllowed,!1,y.tracking,a.clone(_),a.clone(y.characterStyles),w)),W=a.clone(this.getUncompactedAutoRows(a.clone(F),a.clone(E),!1,t.highlightMethod));O=a.clone(i.getOptimalCompactedAutoRows(a.clone(W),a.clone(F),a.clone(E),m,k,t.highlightMethod))}if(0==O.length)return l.LayoutResults.init_8322([],new f.TheoSize(0,0),h.Matrix2D.Identity,A,0);var P=i.getAverageRowAspect(a.clone(O)),U=P/k,M=i.getCombinedAspectOfAllRowsFinal(a.clone(O),U);M<m?S=L*M:L=S/M;for(var H=S/U,V=L,N=S,K=0,G=0,z=[],Y=a.iter(a.range(0,O.length,!1));!Y.done;Y.next()){var j=Y.value,q=a.clone(O[j]),X=q.rowHeightAdjustRatio<1?q.rowHeightAdjustRatio:1,J=S/(isFinite(q.aspectRatio)?q.aspectRatio:1)*X,Q=l.getTypographicBoundingRatiosOfString(q.text,o);G=0,X<1&&(G+=(S-q.aspectRatio*J)/2);for(var Z=J/A.heightRatio,$=Z*w,tt=Z*o.capRatio,et=A.textVerticalOffsetRatio,ot=A.heightRatio,it=Q.textVerticalOffsetRatio,rt=et-(ot/2-Q.heightRatio/2)-it,at=p.TypeLockupUtils.getCharFontYAdjust(y,Z,$),nt=(A.textVerticalOffsetRatio-o.capRatio-rt)*Z,lt=K+0,st=a.iter(a.range(0,q.words.length,!1));!st.done;st.next()){var ct,ut=st.value,ht=(ct=a.clone(q.words[ut])).aspectRatio*J,gt=ct.spaceAspectRatio*J,pt=G,dt=o.allCapsAllowed?ct.text.toUpperCase():ct.text,ft=a.isEmpty(ct.characterStyle)?Z:$,yt=a.isEmpty(ct.characterStyle)||1!=X?0:at,kt=a.isEmpty(ct.characterStyle)?null:ct.characterStyle;D&&(kt=a.isEmpty(ct.characterStyle)?b:null);var St=a.clone(l.LockupItem.init_e7b2(!0,kt,new f.TheoSize(ht,tt),h.Matrix2D.translationXY(pt,lt+nt+yt),dt,a.isEmpty(ct.characterStyle)?o:R||o,ft,Z,Q,j,ct.rangeInLockup));z.push(a.clone(St)),G+=ht+gt}K+=X<1?$*A.heightRatio+H:J+H}return l.LayoutResults.init_8322(a.clone(z),new f.TheoSize(N,V),h.Matrix2D.translationXY(0,0),A,P)},calculateTracking:function(t,e){var o=t.text,r=t.style.font.fontData,n=t.containerSize,s=n.width,c=n.height,u=t.style,h=u.spacing*this.spacingScalar,f=c,y=r.allCapsAllowed?o.toUpperCase():o,k=l.getTypographicBoundingRatiosOfString(y,r),S=0,L=g.TypeLockupController.HIGHLIGHT_STYLE,m=a.opt(a.opt(u.characterStyles[L],(function(t){return t.font})),(function(t){return t.fontData})),C=1;null!=m&&(C=k.hasUppercase?r.capRatio/m.capRatio:r.meanRatio/m.meanRatio);var v=a.clone(p.TypeLockupUtils.computeLockupMeasurements(y,r,k.heightRatio,!1,!0,u.tracking,a.clone(t.characterStyleRanges),a.clone(u.characterStyles),C,t.forceLetterForma));if(0==v.length)return t.style.tracking;var A=a.clone(this.getUncompactedRows(a.clone(v),!1)),b=e.width/e.height,R=a.clone(i.compactRowsIntoAspect(a.clone(A),b,h));if(v.length>1&&(t.highlightMethod==g.HighlightMethod.EvenRows||t.highlightMethod==g.HighlightMethod.OddRows)&&""!=L&&null!=u.characterStyles[L]&&null!=m){var w=a.clone(p.TypeLockupUtils.computeLockupMeasurements(y,r,k.heightRatio,r.allCapsAllowed,!0,u.tracking,a.clone([]),a.clone({}),void 0,t.forceLetterForma)),D=[new d.TextRange(0,a.chars(o).length)],T=a.clone(p.TypeLockupUtils.computeLockupMeasurements(y,m,k.heightRatio,r.allCapsAllowed,!0,u.tracking,a.clone(D),a.clone(u.characterStyles),C,t.forceLetterForma)),x=a.clone(this.getUncompactedAutoRows(a.clone(w),a.clone(T),!1,t.highlightMethod));R=a.clone(i.getOptimalCompactedAutoRows(a.clone(x),a.clone(w),a.clone(T),b,h,t.highlightMethod))}if(0==R.length)return t.style.tracking;if(u.tracking>0)for(var O=a.iter(a.range(0,R.length,!1));!O.done;O.next()){var I=O.value;R[I].aspectRatio=0;for(var B=a.iter(a.range(0,R[I].words.length,!1));!B.done;B.next()){var F=B.value;R[I].aspectRatio+=R[I].words[F].aspectRatio,R[I].words[F].canBreak&&F!=R[I].words.length-1?(R[I].words[F].spaceAspectRatio=r.spaceWidthRatio/k.heightRatio,R[I].aspectRatio+=R[I].words[F].spaceAspectRatio):R[I].words[F].spaceAspectRatio=0}}var _=i.getAverageRowAspect(a.clone(R))/h,E=f*i.getCombinedAspectOfAllRows(a.clone(R),_)/(isFinite(R[0].aspectRatio)?R[0].aspectRatio:1),W=R[0].aspectRatio*E;if(W<s)if(R[0].words.length<=1)S=0;else{var P=(s-W)/a.toDouble(R[0].words.length-1);S=P<1?0:P/(E/k.heightRatio)}else S=-W;return S},calculateLeading:function(t,e){var o=t.text,r=t.style.font.fontData,n=t.containerSize,s=n.width,c=n.height,u=t.style,h=0,f=r.allCapsAllowed?o.toUpperCase():o,y=l.getTypographicBoundingRatiosOfString(f,r),k=u.tracking,S=g.TypeLockupController.HIGHLIGHT_STYLE,L=a.opt(a.opt(u.characterStyles[S],(function(t){return t.font})),(function(t){return t.fontData})),m=1;null!=L&&(m=y.hasUppercase?r.capRatio/L.capRatio:r.meanRatio/L.meanRatio);var C=a.clone(p.TypeLockupUtils.computeLockupMeasurements(f,r,y.heightRatio,!1,!0,k,a.clone(t.characterStyleRanges),a.clone(u.characterStyles),m,t.forceLetterForma));if(0==C.length)return t.style.spacing;var v=a.clone(this.getUncompactedRows(a.clone(C),!1)),A=e.width,b=e.height,R=A/b,w=a.clone(i.compactRowsIntoAspect(a.clone(v),R,t.style.spacing));if(C.length>1&&(t.highlightMethod==g.HighlightMethod.EvenRows||t.highlightMethod==g.HighlightMethod.OddRows)&&""!=S&&null!=u.characterStyles[S]&&null!=L){var D=a.clone(p.TypeLockupUtils.computeLockupMeasurements(f,r,y.heightRatio,r.allCapsAllowed,!0,u.tracking,a.clone([]),a.clone({}),void 0,t.forceLetterForma)),T=[new d.TextRange(0,a.chars(o).length)],x=a.clone(p.TypeLockupUtils.computeLockupMeasurements(f,L,y.heightRatio,r.allCapsAllowed,!0,u.tracking,a.clone(T),a.clone(u.characterStyles),m,t.forceLetterForma)),O=a.clone(this.getUncompactedAutoRows(a.clone(D),a.clone(x),!1,t.highlightMethod));w=a.clone(i.getOptimalCompactedAutoRows(a.clone(O),a.clone(D),a.clone(x),R,h,t.highlightMethod))}if(w.length<=1)return u.spacing;var I=i.getAverageRowAspect(a.clone(w))/h;if((b=A/i.getCombinedAspectOfAllRows(a.clone(w),I))<c){var B=s/((c-b)/(a.toDouble(w.length)-1));h=w[0].aspectRatio/B/this.spacingScalar}else h=-b;return h},getUncompactedRows:function(t,e){for(var o=[],i=0;i<t.length;){var r=a.clone(t[i]),n=a.clone(s.LockupRowInfo.init_d97e());if(r.isNewLine)o.length>0&&(o[o.length-1].appendable=!1);else{if(!e)for(;!r.canBreak&&i<t.length;)n.addWord(a.clone(r)),(i+=1)<t.length&&(r=a.clone(t[i]));n.addWord(a.clone(r)),o.push(a.clone(n))}i+=1}return o},getUncompactedAutoRows:function(t,e,o,i){n.CoreAssert.isTrue(t.length==e.length,void 0,"EvenRowWidthsLayoutStrategy.getUncompactedAutoRows","EvenRowWidthsLayoutStrategy.swift",812);for(var r=[],l=0,c=i==g.HighlightMethod.EvenRows?0:1,u=0;u<t.length;){var h=a.clone(l%2==c?e[u]:t[u]),p=a.clone(s.LockupRowInfo.init_d97e());if(h.isNewLine)r.length>0&&(r[r.length-1].appendable=!1);else{if(!o)for(;!h.canBreak&&u<t.length;)p.addWord(a.clone(h)),(u+=1)<t.length&&(h=a.clone(t[u]));p.addWord(a.clone(h)),r.push(a.clone(p)),l+=1}u+=1}return r}}}),i)},VDg0:function(t,e,o){var i,r=e,a=o("oAGj"),n=o("8t9B");r.kOpacityRuleFaintAlpha=.5,r.kOpacityRuleMediumAlpha=.7,r.LockupConfiguration=(i=function(t,e,o,i,r,a,l,s){this.characterStyleRanges=[],this.highlightMethod=n.HighlightMethod.Manual,this.rowWordLengths=null,this.allowFewerLineBreaks=!1,this.preferredFontSize=null,void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=!1),void 0===l&&(l=!1),void 0===s&&(s=null),this.text=t,this.style=e,this.containerSize=o,this.placement=i,this.parentBounds=r,this.useOptimization=a,this.forceLetterForma=l,this.preferredFontSize=s},a.defineClass({name:"LockupConfiguration",ctor:i}),i)},Zc5V:function(t,e,o){var i,r=e,a=o("oAGj");r.GridArrangementUtils=(i=function(){},a.defineClass({name:"GridArrangementUtils",ctor:i,statics:{MAX_COLS:100,ASPECT_RATIO_EPSILON:.005,getArrangement:function(t,e,o,r){var n=a.max(r),l=t*a.toDouble(o)/a.toDouble(n),s=i.getBestFittingArrangement(l,e,n),c=s.numCols,u=i.evaluateAllSegments(t,e,o,a.clone(r),c),h=u.penalty,g=u.aspectRatioDelta;if(0!=h)for(var p=i.getColumnCountSearchRange(o,c),d=a.iter(a.range(p.start,p.end,!0));!d.done;d.next()){var f=d.value;if(f!=s.numCols){var y=(u=i.evaluateAllSegments(t,e,o,a.clone(r),f)).penalty,k=u.aspectRatioDelta;(y<h||y==h&&k<g)&&(c=f,h=y,g=k)}}return{numRows:i.getNumRows(o,c),numCols:c}},getNumRows:function(t,e){return a.toInt(t/e)+(t%e==0?0:1)},getGridAspectRatio:function(t,e,o){var r=i.getNumRows(e,o);return a.toDouble(o)/a.toDouble(r)*t},getBestFittingArrangement:function(t,e,o,r,n){var l,s;void 0===r&&(r=1),void 0===n&&(n=i.MAX_COLS);var c=Math.min(o,n);if(r<c){l=a.toInt((r+c)/2),s=i.getGridAspectRatio(e,o,l);var u=Math.abs(t-s);if(u>i.ASPECT_RATIO_EPSILON){var h,g=(h=s<t?i.getBestFittingArrangement(t,e,o,l+1,c):i.getBestFittingArrangement(t,e,o,r,l-1)).numCols,p=h.aspectRatio;Math.abs(t-p)<u&&(l=g,s=p)}}else s=i.getGridAspectRatio(e,o,l=r);return{numCols:l,aspectRatio:s}},evaluateAllSegments:function(t,e,o,r,n){for(var l=0,s=0,c=a.iter(r);!c.done;c.next()){var u=c.value;i.evaluateOneSegment(u,n)||(l+=1),s+=1/i.getGridAspectRatio(e,u,n)}return s=1/s,{penalty:l,aspectRatioDelta:Math.abs(t-s)}},evaluateOneSegment:function(t,e){if(t<=e)return!0;var o=t%e;0==o&&(o=e);var r=a.toDouble(o)/a.toDouble(e),n=.5;return e>4&&i.getNumRows(t,e)>2&&(n=.25),r>=n},getColumnCountSearchRange:function(t,e){var o=Math.min(2,a.toInt(t/6));return{start:Math.max(1,e-o),end:Math.min(e+o,t)}}}}),i)},cEEQ:function(t,e,o){var i,r,a,n,l=e,s=o("oAGj"),c=o("SpAV"),u=o("9kak"),h=o("tGKA"),g=o("1NAc");l.LockupItemType=s.defineEnum("LockupItemType",{Text:0,Path:1,Artwork:2}),l.LockupItem=(i=function(){this.isFullCanvas=!1},s.defineClass({name:"LockupItem",ctor:i,props:{init_e7b2:function(t,e,o,i,r,a,n,s,c,u,h,g){void 0===g&&(g=null),this.type=l.LockupItemType.Text,this.hasPrimaryColor=t,this.characterStyle=e,this.size=o,this.placement=i,this.text=r,this.font=a,this.pointSize=n,this.rowPointSize=s,this.typographicBoundingRatios=c,this.rowIndex=u,this.rangeInLockup=h,this.margins=g},init_708e:function(t,e,o,i,r,a,n){void 0===r&&(r=null),void 0===a&&(a=!1),void 0===n&&(n=null),this.type=l.LockupItemType.Path,this.hasPrimaryColor=t,this.size=e,this.placement=o,this.path=i,this.rowIndex=r,this.isFullCanvas=a,this.characterStyle=n},init_9cc6:function(t,e,o,i,r,a,n){void 0===a&&(a=null),void 0===n&&(n=null),this.type=l.LockupItemType.Artwork,this.hasPrimaryColor=t,this.size=e,this.placement=o,this.artworkID=i,this.preScale=r,this.rowIndex=a,this.characterStyle=n},init_implicit:function(t,e,o,i,r,a,n,l,s,c,u,h,g,p,d,f,y){void 0===y&&(y=!1),this.type=t,this.hasPrimaryColor=e,this.size=o,this.placement=i,this.text=r,this.font=a,this.pointSize=n,this.rowPointSize=l,this.rowIndex=s,this.margins=c,this.typographicBoundingRatios=u,this.characterStyle=h,this.rangeInLockup=g,this.path=p,this.artworkID=d,this.preScale=f,this.isFullCanvas=y},clone:function(){return i.init_implicit(this.type,this.hasPrimaryColor,this.size,this.placement,this.text,this.font,this.pointSize,this.rowPointSize,this.rowIndex,this.margins,this.typographicBoundingRatios,this.characterStyle,this.rangeInLockup,this.path,this.artworkID,this.preScale,this.isFullCanvas)}}}),i),l.descenderCharacters="gjqpyQ",l.shortCharacters=" qweryuopasg;zxcvnm,.*-~",l.tallSpecialsThatAreNotCaps="!^'",l.TypographicBoundingRatios=(r=function(t,e,o,i,r,a){this.sideInsetRatio=t,this.textVerticalOffsetRatio=e,this.backingVerticalOffsetRatio=o,this.heightRatio=i,this.heightFromBaselineRatio=r,this.hasUppercase=a},s.defineClass({name:"TypographicBoundingRatios",ctor:r}),r),l.getTypographicBoundingRatiosOfString=function(t,e,o){void 0===o&&(o=!0);for(var i=t.split("\n").join(),r=!1,a=!1,n=!1,c=!1,u=!1,h=!1,g=!1,p=!1,d=!1,f=e.meanRatio,y=0,k=0,S=0,L=0,m=0,C=0,v=s.iter(s.chars(i));!v.done;v.next()){var A=v.value,b=!1,R=!1;" "!=A&&(k+=1,!b&&e.upperCaseCharsArray.includes(A)?b=!0:!R&&e.lowerCaseCharsArray.includes(A)&&(R=!0),!r&&b?r=!0:!a&&R&&(a=!0),e.meanCharsArray.includes(A)?S+=e.meanRatio:e.capCharsArray.includes(A)?(u=!0,S+=e.capRatio):e.ascentCharsArray.includes(A)?(c=!0,S+=e.ascentRatio):e.meanAccentCharsArray.includes(A)?(h=!0,S+=e.meanAccentRatio):e.capAccentCharsArray.includes(A)?(n=!0,S+=e.capAccentRatio):(u=!0,S+=e.capRatio),b&&(k+=1,S+=e.capRatio),b||R||""==A||""==A||""==A||(d=!0),e.tailCharsArray.includes(A)?(g=!0,L+=e.tailRatio):e.descentCharsArray.includes(A)&&(p=!0,L+=e.descentRatio))}if(d&&(f=1),n&&(f=Math.max(f,e.capAccentRatio)),c&&(f=Math.max(f,e.ascentRatio)),u&&(f=Math.max(f,e.capRatio)),h&&(f=Math.max(f,e.meanAccentRatio)),g&&(y=Math.max(y,e.tailRatio)),p&&(y=Math.max(y,e.descentRatio)),k>0&&(m=S/k,C=L/k),o){var w=f-(r?e.capRatio:e.meanRatio);m=f+=Math.max(0,y-w),C=y}var D=y/2,T=e.baselineOffsetRatio+f,x=.8*(f-m-y+C),O=f+y;return new l.TypographicBoundingRatios(D,T,x,O,f,r)},l.LayoutResults=(a=function(){},s.defineClass({name:"LayoutResults",ctor:a,props:{init_8322:function(t,e,o,i,r){for(var a=0,n=0,c=0,u=1e5,h=0,g=0,p=0,d={},f=s.iter(t);!f.done;f.next()){var y=f.value;y.type==l.LockupItemType.Text&&(a+=y.size.height,n+=y.pointSize,c+=1,y.rowIndex<u&&(u=y.rowIndex),y.rowIndex>h&&(h=y.rowIndex),null==d[y.rowIndex]&&(g+=y.pointSize,d[y.rowIndex]=!0),y.pointSize>p&&(p=y.pointSize))}this.items=s.clone(t),this.size=e,this.placement=o,this.numberOfLines=h<u?0:h-u+1,this.avgLinePointSize=g/s.toDouble(this.numberOfLines),this.avgTextItemHeight=a/c,this.avgTextPointSize=n/c,this.largestPointSize=p,this.typographicBoundingRatios=i,this.avgRowAspect=r},flipForRightToLeft:function(){for(var t=this.size.width,e=[],o=s.iter(this.items);!o.done;o.next()){var i=o.value;i.placement=h.Matrix2D.scalingXY(-1,1).translateXY(i.size.width,0).concat(i.placement.scaleXY(-1,1)).translateXY(t,0),e.splice(0,0,s.clone(i))}this.items=s.clone(e)},init_implicit:function(t,e,o,i,r,a,n,l,c,u){this.items=s.clone(t),this.size=e,this.placement=o,this.avgTextItemHeight=i,this.avgTextPointSize=r,this.avgLinePointSize=a,this.largestPointSize=n,this.typographicBoundingRatios=l,this.numberOfLines=c,this.avgRowAspect=u},clone:function(){return a.init_implicit(this.items,this.size,this.placement,this.avgTextItemHeight,this.avgTextPointSize,this.avgLinePointSize,this.largestPointSize,this.typographicBoundingRatios,this.numberOfLines,this.avgRowAspect)}}}),a),l.LockupLayoutStrategy=s.defineProtocol("LockupLayoutStrategy",{supportsConfiguration:"(LockupConfiguration) -> Boolean",layout:"(LockupConfiguration) -> LayoutResults",calculateTracking:"(LockupConfiguration, TheoSize) -> Double",calculateLeading:"(LockupConfiguration, TheoSize) -> Double",adjustHeightForLeading:"(TheoRect, LayoutResults, Double, Double) -> Double",adjustWidthForTracking:"(String, LayoutResults, Double, Double) -> Double"}),l.LockupLayoutStrategyFactory=s.defineProtocol("LockupLayoutStrategyFactory",{supportsConfiguration:"(LockupConfiguration) -> Boolean",createForConfiguration:"(LockupConfiguration) -> LockupLayoutStrategy"}),l.BaseLockupLayoutStrategy=(n=function(){},s.defineClass({name:"BaseLockupLayoutStrategy",ctor:n,statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return c.CoreAssert.fail("Implement in subclass","BaseLockupLayoutStrategy.supportsConfiguration","LockupLayoutStrategy.swift",394),!1},layout:function(t){return c.CoreAssert.fail("implement in subclass","BaseLockupLayoutStrategy.layout","LockupLayoutStrategy.swift",399),l.LayoutResults.init_8322([],new g.TheoSize(0,0),h.Matrix2D.Identity,new l.TypographicBoundingRatios(0,1,0,1,1,!1),0)},calculateTracking:function(t,e){return c.CoreAssert.fail("implement in subclass","BaseLockupLayoutStrategy.calculateTracking","LockupLayoutStrategy.swift",420),0},calculateLeading:function(t,e){return c.CoreAssert.fail("implement in subclass","BaseLockupLayoutStrategy.calculateLeading","LockupLayoutStrategy.swift",427),0},adjustHeightForLeading:function(t,e,o,i){var r=i-o;return s.toDouble(e.numberOfLines-1)*(t.width/e.avgRowAspect)*(.75*r)},adjustWidthForTracking:function(t,e,o,i){var r=0,a=i-o;if(0!=a){for(var n=-1,l=0,c=0,u=0,h=0,g=t,p=s.iter(e.items);!p.done;p.next()){var d=p.value;d.rowIndex!=n?(u>h&&(h=u,r=l),c=d.placement.tx,l=0):l+=a*d.pointSize,l+=a*d.pointSize*s.toDouble(d.text.length-1),u=d.placement.tx+d.size.width-c,d.rangeInLockup.start>0&&" "==g.substr(d.rangeInLockup.start-1,1)&&c!=d.placement.tx&&(i<0?l-=a*d.pointSize:l+=a*d.pointSize),n=d.rowIndex}u>h&&(h=u,r=l)}return r},getPrecomputedRows:function(t,e){var o=[];if(0==t.length||0==e.length)return o;for(var i=s.clone(u.LockupRowInfo.init_d97e()),r=0,a=0,n=s.iter(t);!n.done;n.next()){var l=n.value;l.isNewLine||(a>=e[r]&&(o.push(s.clone(i)),i=s.clone(u.LockupRowInfo.init_d97e()),r+=1,a=0),i.addWord(s.clone(l)),a+=1)}return o.push(s.clone(i)),o}}}),n)},d3iY:function(t,e,o){var i,r,a=e,n=o("oAGj"),l=o("Zc5V"),s=o("iCxV"),c=o("cEEQ"),u=o("9kak"),h=o("c+uM"),g=o("KdeS"),p=o("tGKA"),d=o("8t9B"),f=o("3UhB"),y=o("uUew"),k=o("1NAc");a.LetterGridLayoutStrategy=(i=function(){this.trackingScalar=3,this.spacingScalar=3,c.BaseLockupLayoutStrategy.call(this)},n.defineClass({name:"LetterGridLayoutStrategy",ctor:i,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return h.LockupStyle.isLetterGrid(t.style.layout)},layout:function(t){var e=[],o=0,i=0,r=0,a=this.getWireframeLayout(t),l=a.typographicBoundingRatios,s=n.clone(a.rows);if(0==!s.length){var u,h,g,y,S=a.horizontalPaddingRatio,L=a.verticalPaddingRatio,m=this.getCombinedAspectRatio(n.clone(s),S,L),C=t.style,v=a.font;null!=(y=t.preferredFontSize)?(h=(u=y)*l.heightRatio,g=(i=(o=a.constraintWidth)/m)/n.toDouble(s.length)):(m<a.constraintAspectRatio?(i=a.constraintHeight,o=a.constraintHeight*m):(o=a.constraintWidth,i=a.constraintWidth/m),u=(h=(g=i/n.toDouble(s.length))/(1+L))/l.heightRatio);var A=L*h,b=S*h;a.charFontAdjustRatio>1&&(u/=a.charFontAdjustRatio);for(var R=u*v.capRatio,w=u*l.textVerticalOffsetRatio-R,D=n.opt(n.opt(C.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||v,T=u*a.charFontAdjustRatio,x=f.TypeLockupUtils.getCharFontYAdjust(C,u,T),O=A/2+w,I=n.iter(n.toSequence(s));!I.done;I.next()){var B=I.value,F=B.offset,_=B.element;if(0==!_.words.length)for(var E=n.first(_.words).aspectRatio*h,W=E+b,P=b/2+_.colOffsetLeft*W,U=n.iter(_.words);!U.done;U.next()){var M=U.value,H=M.characterStyle,V=H==d.TypeLockupController.HIGHLIGHT_STYLE,N=V?D:v,K=V?T:u,G=M.relativeMargins.multiply(h),z=G.width,Y=P+z,j=O+(V?x:0),q=n.clone(c.LockupItem.init_e7b2(!0,H,new k.TheoSize(E-2*z,R),p.Matrix2D.translationXY(Y,j),M.text,N,K,u,l,F,M.rangeInLockup,G));e.push(n.clone(q)),P+=W}O+=g}r=this.getWidestRowAndAspectRatio(n.clone(s),S,L).aspectRatio}return c.LayoutResults.init_8322(n.clone(e),new k.TheoSize(o,i),p.Matrix2D.Identity,l,r)},getCharacterStyle:function(t,e,o){for(var i=n.iter(t);!i.done;i.next()){var r=i.value;if(e>=r.start&&e<r.end)return d.TypeLockupController.HIGHLIGHT_STYLE}return""},getWireframeLayout:function(t,e){var o;void 0===e&&(e=null);for(var i=t.text.toUpperCase(),r=t.style,h=r.alignment,p=t.containerSize,S=(e||p).width,L=(e||p).height,m=S/L,C=r.spacing*this.spacingScalar,v=r.tracking*this.trackingScalar,A=r.font.fontData,b=c.getTypographicBoundingRatiosOfString(i,A,!1),R=0,w=0,D=[],T=(o=t.preferredFontSize)||null!=o?o:32,x=n.opt(n.opt(r.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||A,O=f.TypeLockupUtils.getCharFontAdjust(r,b.hasUppercase,!1),I=T*O,B=[],F=n.iter(n.toSequence(n.chars(i)));!F.done;F.next()){var _=F.value,E=_.offset,W=_.element,P=n.toString(W);if(f.TypeLockupUtils.isWhiteSpace(P)){if("\n"==P){var U=w;w=E-R,D.push(w-U)}R+=1}var M=this.getCharacterStyle(n.clone(t.characterStyleRanges),E,E+1)==d.TypeLockupController.HIGHLIGHT_STYLE,H=M?x:A,V=M?I:T,N=s.Host.textModelUtils.measureInkBounds(P,H,V);B.push(N.width)}var K=B.length-R;D.push(K-w);var G,z=Math.max(T,I)*b.heightRatio,Y=n.max(B)/z,j=(Y+v)/(1+C);G=null!=t.preferredFontSize?n.toInt(Math.floor(S/(n.max(B)+v*z))):l.GridArrangementUtils.getArrangement(m,j,K,n.clone(D)).numCols;for(var q=n.clone(u.LockupRowInfo.init_d97e()),X=[],J=(E=0,n.iter(n.chars(i)));!J.done;J.next()){if(W=J.value,P=n.toString(W),f.TypeLockupUtils.isWhiteSpace(P))"\n"==W&&(this.commitRow(X,n.clone(q),G,h),q=n.clone(u.LockupRowInfo.init_d97e()));else{P=n.toString(W);var Q=(Y-B[E]/z)/2,Z=n.clone(g.LockupWordInfo.init_e9d6(P,Y,0,this.getCharacterStyle(n.clone(t.characterStyleRanges),E,E+1),1,!1,!0,new y.TextRange(E,E+1),new k.TheoSize(Q,0)));q.words.length==G&&(this.commitRow(X,n.clone(q),G,h),q=n.clone(u.LockupRowInfo.init_d97e())),q.addWord(n.clone(Z))}E+=1}return this.commitRow(X,n.clone(q),G,h),a.WireframeLayout.init_c604(A,b,O,S,L,m,v,C,n.clone(X),G)},commitRow:function(t,e,o,i){var r=n.toDouble(o-e.words.length);i==h.LockupAlignment.Right?e.colOffsetLeft=r:i==h.LockupAlignment.Center&&(e.colOffsetLeft=r/2,e.colOffsetRight=r/2),t.push(n.clone(e))},calculateTracking:function(t,e){var o=this.getWireframeLayout(t,e),i=n.clone(o.rows);if(0==i.length)return t.style.tracking;var r=this.getCombinedAspectRatio(n.clone(i),0,o.verticalPaddingRatio),a=o.constraintHeight*r,l=t.containerSize.width;if(a<l){var s=n.toDouble(i.length);return(l-a)/n.toDouble(o.numCols)/(o.constraintHeight/s/(1+o.verticalPaddingRatio))/this.trackingScalar}return-a},calculateLeading:function(t,e){var o=this.getWireframeLayout(t,e),i=n.clone(o.rows);if(0==i.length)return t.style.spacing;var r=this.getCombinedAspectRatio(n.clone(i),o.horizontalPaddingRatio,0),a=o.constraintWidth/r,l=t.containerSize.height;if(a<l){var s=n.toDouble(i.length),c=a/s;return(l/s-c)/c/this.spacingScalar}return-a},adjustHeightForLeading:function(t,e,o,i){if(0==!e.items.length){var r=i-o,a=n.clone(n.first(e.items));return n.toDouble(e.numberOfLines)*a.rowPointSize*a.typographicBoundingRatios.heightRatio*r*this.spacingScalar}return 0},adjustWidthForTracking:function(t,e,o,i){var r=this.getNumColsInLayout(n.clone(e));if(r>0){var a=i-o,l=n.clone(n.first(e.items));return l.rowPointSize*l.typographicBoundingRatios.heightRatio*a*this.trackingScalar*n.toDouble(r)}return 0},getNumColsInLayout:function(t){for(var e=0,o=0,i=-1,r=n.iter(t.items);!r.done;r.next()){var a=r.value;i!=a.rowIndex?(i=a.rowIndex,o=1):o+=1,e=Math.max(e,o)}return e},calculateRowAspectRatio:function(t,e,o,i){var r=n.toDouble(t.words.length),a=r+n.toDouble(i),l=t.aspectRatio*a/r;return(l+=a*e)/(1+o)},getWidestRowAndAspectRatio:function(t,e,o){for(var i,r=0,a=n.iter(t);!a.done;a.next()){var l=a.value,s=this.calculateRowAspectRatio(n.clone(l),e,o,n.toInt(l.colOffsetLeft+l.colOffsetRight));s>r&&(i=n.clone(l),r=s)}return{row:i,aspectRatio:r}},getCombinedAspectRatio:function(t,e,o){return this.getWidestRowAndAspectRatio(n.clone(t),e,o).aspectRatio/n.toDouble(t.length)}}}),i),a.WireframeLayout=(r=function(){},n.defineClass({name:"WireframeLayout",ctor:r,props:{init_c604:function(t,e,o,i,r,a,l,s,c,u){this.font=t,this.typographicBoundingRatios=e,this.charFontAdjustRatio=o,this.constraintWidth=i,this.constraintHeight=r,this.constraintAspectRatio=a,this.horizontalPaddingRatio=l,this.verticalPaddingRatio=s,this.rows=n.clone(c),this.numCols=u},init_implicit:function(t,e,o,i,r,a,l,s,c,u){this.font=t,this.typographicBoundingRatios=e,this.charFontAdjustRatio=o,this.constraintWidth=i,this.constraintHeight=r,this.constraintAspectRatio=a,this.horizontalPaddingRatio=l,this.verticalPaddingRatio=s,this.rows=n.clone(c),this.numCols=u}}}),r)},fGVU:function(t,e,o){var i,r=e,a=o("oAGj"),n=o("NkBu"),l=o("RkYL"),s=o("sW6f"),c=o("zjod");r.VideoController=(i=function(t,e,o){n.ImageController.call(this,t,e,o)},a.defineClass({name:"VideoController",ctor:i,superName:"ImageController",statics:{KIND:{get:function(){return"video"}}},props:{replaceable:{get:function(){return!0}},duplicatable:{get:function(){return!1}},selectable:{get:function(){return!0}},canMultiSelect:{get:function(){return!1}},contentNode:{get:function(){var t=a.opt(a.as(this.forma,c.VideoForma),(function(t){return t.videoContentID}));return null==t?null:a.as(a.opt(a.opt(this.forma,(function(t){return t.page.document})),(function(e){return e.content.nodeByID(t)})),s.VideoContentNode)}},videoDuration:{get:function(){return a.opt(this.contentNode,(function(t){return t.duration}))||l.TheoTime.Zero}}}}),i)}}]);
//# sourceMappingURL=vendors_npm_spark_eed0fd33-152f75a1.js.map