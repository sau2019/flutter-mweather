(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[40],{"14LO":function(e,t,n){"use strict";n.r(t),n.d(t,"DCXDocumentComposite",(function(){return i}));var o=n("uTW7");function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i{constructor(e){r(this,"dcxComposite",void 0),r(this,"current",void 0),r(this,"localStoragePath",void 0),this.dcxComposite=e.composite,this.current=new o.DCXDocumentBranch({branch:e.composite.current,componentURLfn:e.componentURLfn,overrideIDfn:e.overrideIDfn}),this.localStoragePath="local-storage://"}}},"1tmr":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n("UzQk");function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i{constructor(e,t){r(this,"branch",void 0),r(this,"node",void 0),this.branch=e,this.node=t}reparent(e){if(e!==this.node){const t=this.node.childComponents.indexOf(this);t>=0?(e.childComponents.push(this),this.node.childComponents.splice(t,1),this.node=e,this.attachToNode()):o.CoreAssert.fail("internal error: component isn't attached to the node we think it is")}}update(e){const t=this.node.childComponents.indexOf(this);t<0?o.CoreAssert.fail("replaceWith: component isn't attached to the node we think it is"):e.node===this.node?(this.detachFromNode(),this.node.childComponents.splice(t,1,e),e.attachToNode()):o.CoreAssert.fail("replaceWith: only supports same-node replacement")}}},"3xdQ":function(e,t,n){var o,r;function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}o=[n("xeH2"),n("YLtl"),n("UFvF"),n("MOGj"),n("XTC/"),n("MGCh"),n("9gt3"),n("a8ov"),n("r3b0"),n("LI3u"),n("U44B"),n("UzQk"),n("mwMu"),n("qnb0"),n("TdwW"),n("O0ct"),n("ZLL8"),n("hEO4")],void 0===(r=function(e,t,n,o,r,c,l,s,u,d,p,h,m,f,g,v,y,C){const S=s.default,F=c.channel("core-wrapper");return function(e){e=e||{};var o={};o.events=new l;var r,c=null,s=!1,d=null,b=!1,k=null,I=null,T=null,w=null,A=[],D=null,P=null,x=0,L=h.TheoPoint.ZERO,N=!1,U=function(){var e=!0;return c.content.root.visitAll((function(t){"image"===t.kind?t.url&&"data:"!==t.url.substr(0,"data:".length)||(e=!1):"vector"===t.kind&&"uploading svg"===t.url&&(e=!1)})),e};o.monitorTransactions=function(){C.monitorTransactionsForDocument(c)},o.validateDoc=function(e){const t=h.TheoDocumentUtils.validateDoc(c,e);t&&F.error("validateDoc: ".concat(t.errorMsg),t)},o.getManifestData=function(){return c.encodeToJSON()},o.getDocumentCCID=function(){return c.uuid||" "};var O=function(e){var t=new u({makeComponentUrl:function(){return S.encodeDesignFilterComponentUrl()},trackAbsolutePath:!1,branch:e});return new h.TheoDocument.newDocumentFromDataObject(t,null)};o.getTemporaryDocumentWithFontsLoaded=function(e){var t=O(e),o=t.missingFontList;return o.length?v.loadMissingFonts(o).then((function(){return O(e)})):n.resolve(t)};var M=t.throttle((function(){b&&U()&&o.events.publish("save-requested")}),500),E=[];function R(){E.forEach((function(e){e.unsubscribe()}));var e={};(E=[]).push(c.firstPage.subscribeWithCallback((function(n){0===--x&&(t.each(e,(function(e){(e.transform||e.geometry||e.style)&&o.events.publish("forma-dirty",e)})),o.events.publish("document-in-new-renderable-state"))}),h.FormaEndUpdateMessage.TYPE)),E.push(c.firstPage.subscribeWithCallback((function(t){if(0===x&&(e={}),t.event.forma){var n=t.event.forma.formaID,o=e[n];o||(e[n]=o={formaID:n}),t.event instanceof h.FormaTransformChangedEvent?o.transform=!0:t.event instanceof h.FormaGeometryChangedEvent?o.geometry=!0:t.event instanceof h.FormaStyleChangedEvent&&(o.style=!0)}x++}),h.FormaBeginUpdateMessage.TYPE)),E.push(c.controller.subscribeWithCallback((function(e){o.inCharStyleMode&&o.handleTapped({x:e.state.clickLocation.x,y:e.state.clickLocation.y,forma:e.state.forma})}),h.ClickMessage.TYPE)),E.push(c.controller.subscribeWithCallback((function(e){o.events.publish("layer-double-tapped")}),h.DoubleClickMessage.TYPE)),E.push(c.controller.model.subscribeWithCallback((function(e){e.changes.indexOf("snaplines")>=0&&o.events.publish("update-snap-lines",{lines:c.controller.model.snapLines.getAll()}),e.changes.indexOf("handles")>=0&&o.events.publish("update-handles"),e.changes.indexOf("swapState")>=0&&o.events.publish("update-swap-state")}),h.EditorModelChangedMessage.TYPE))}function B(e){return e?e.contentNode&&e.contentNode.url?S.decodeUrl(e.contentNode.url):(F.error("image forma has no contentNode or url"),null):(F.error("image forma is not defined"),null)}function W(e){if(e){var t=e.bounds;return e.controller&&(t=e.controller.size||e.bounds),{width:t.width,height:t.height}}}function G(){var e=c.controller.model.handles.getAll();if(e.length>0&&e[0]instanceof h.BoxTransformHandles){var t=e[0],n=!1;t.activeTransform==h.TransformType.Translate&&(n=!0);var r=[];n||t.allowedTransforms.forEach((function(e){var t,n,o=(t=e,(n=Y.find((function(e){return e.type==t})))?n.spot:null);o&&r.push(o)}));var i=null;t instanceof h.BoxTransformMultipleFormae&&(i=t.formaIDs.map((function(e){var t=o.getFormaById(e);return{formaID:e,bounds:t.bounds,placement:t.totalPlacement}})));var a=t.allowedTransforms.includes(h.TransformType.RotateAboutCenter)&&!t.displayHints.includes(h.BoxHandleDisplayHint.SuppressRotationHandle)&&(t.activeTransform===h.TransformType.None||t.activeTransform===h.TransformType.RotateAboutCenter),l=o.getDocumentSize();return{documentSize:new h.TheoSize(l.width,l.height),matrix2d:t.reference.placement,bounds:t.reference.bounds,enablePips:r.length>0,rotateable:a,handlePoints:r,thinOutline:t.displayHints.includes(h.BoxHandleDisplayHint.ThinOutline),transparentOutline:n,textFrame:t.displayHints.includes(h.BoxHandleDisplayHint.TextFrame),highlightRects:i,inCropMode:o.inCropMode()}}return null}function H(e){if(e){var t=o.getDocumentSize(),n=e.totalPlacement,r=W(e);return{forma:e,matrix2d:[n.a,n.b,n.c,n.d,n.tx,n.ty],documentWidth:t.width,documentHeight:t.height,width:r.width,height:r.height,showLeftLine:e.isRangeStart(),showRightLine:e.isRangeEnd()}}}function _(){var e=c.firstPage.colorLibraryController.getColorThemeAsArrayOfSolidColors();return t.map(e,(function(e){return e.red+":"+e.green+":"+e.blue})).join(":")}function j(e){return t.map(e,(function(e){var t=e.sprkElemId||e.id||null,n=e.sprkRoles||e.roles||null,o=g.rgb2SolidColor(e);return g.solidColor2TheoColor(o,t,n)}))}function z(e){return t.map(e,(function(e){if("string"==typeof e){var t=g.hex2SolidColor(e);return g.solidColor2TheoColor(t,null,null)}t=g.hex2SolidColor(e.color);return g.solidColor2TheoColor(t,e.id,e.roles)}))}function V(){return r.getActionDepth()>1}function X(e,t,r){return e?o.beginUserAction(t).then(r).finally(o.endUserAction):n.resolve(!1)}function K(){return n.Promise((function(e){r.invalidatePatches(e)}))}o.doWithinUserActionInterface=function(e,t,n){return X(e,t,n)};var Y=[{type:h.TransformType.TopLeftCornerTranslate,spot:new h.TheoPoint(0,0)},{type:h.TransformType.TopRightCornerTranslate,spot:new h.TheoPoint(1,0)},{type:h.TransformType.BottomLeftCornerTranslate,spot:new h.TheoPoint(0,1)},{type:h.TransformType.BottomRightCornerTranslate,spot:new h.TheoPoint(1,1)},{type:h.TransformType.TopSideTranslate,spot:new h.TheoPoint(.5,0)},{type:h.TransformType.BottomSideTranslate,spot:new h.TheoPoint(.5,1)},{type:h.TransformType.LeftSideTranslate,spot:new h.TheoPoint(0,.5)},{type:h.TransformType.RightSideTranslate,spot:new h.TheoPoint(1,.5)}];function J(e){var t=Y.find((function(t){return t.spot.x===e.x&&t.spot.y===e.y}));return t?t.type:null}function Q(e){return n.Promise((function(t,n){c.controller.designController.actions.doActionWithCallback(e,(function(e){t(e)}))}))}function q(){var e=o.getAllSelectedFormas();!1===c.controller.selection.inCharStyleMode&&!0===o.inCharStyleMode&&o.exitCharStyleMode(),0!=e.length&&e[0].isTypeLockup()||o.events.publish("text-forma-selected",{id:null,forma:null,selectionBoxes:[]}),e.length>0?o.events.publish("forma-selected",{id:e[0].formaID,forma:e[0],selectionBox:G()}):o.events.publish("forma-selected",{id:null,forma:null})}function Z(e,t,n){for(var r=e.controller.linkedForma(t),i=0;i<r.length;i++){var a=r[i];o.events.publish("forma-updated",{id:a.formaID,snapLines:n,data:{forma:a}})}}function $(e,t){e&&o.events.publish("forma-updated",{id:e.formaID,selected:o.getSelectedForma()&&e.formaID===o.getSelectedFormaId(),snapLines:t,selectionBox:G(),data:{forma:e}})}function ee(e){null==e&&(e=!0),o.events.publish("design-updated",{formaAdded:e})}function te(e){for(var t=e.controller,n=[],r=1;r<t.owner.selection.selectedCount;r++){var i=t.owner.selection.formaAt(r);n.push(H(i))}o.events.publish("text-forma-selected",{id:e.formaID,forma:e,selectionBoxes:n})}function ne(e,t){e&&t&&(e.selectCharStyleForma(),e.updateGroup(),ee(!1),e.selectCharStyleForma(),te(t))}return o.inCharStyleMode=!1,o.getGraph=function(e){return c.firstPage.pgm.getGraph(e?h.PGMExportSettings.DYNAMIC:h.PGMExportSettings.STATIC)},o.postDocumentHasHighResImageSaveableState=function(){var e=n.defer();return function t(){if(U()){var n=c.stateID;e.resolve(n)}else setTimeout(t,1e3)}(),e.promise},o.saveWithRenditions=function(e,t,n){return w.saveWithRenditions(c,e,t,n)},o.saveCopyWithRenditions=function(e,t,n){return e.saveWithRenditions(c,t,n)},o.saveImageComponent=function(e,t,n,o,r){return w.saveImageComponent(e,t,n,o,r)},o.initializeNewPost=function(e){var r,i=h.TypeLockupUtils.fixUpQuotes(e.text,""),a=e.palette,l=o.imageFormas(),s=n.defer(),u=o.hostImages(),d=t.map(u,(function(e){return e.imgLoadedPromise}));if(l.length>=1)Promise.all(d).then((function(){X(!0,h.UserActions.SetColorTheme(),(function(){c.firstPage.colorLibraryController.createInitialThemeFromImage()})).then(s.resolve)}));else{if(e.defaultBackgroundColor){var p=c.firstPage.root.filterByKind(h.ShapeForma.KIND),m=p&&p[0];m&&(r={shape:m,color:e.defaultBackgroundColor})}o.setColorPalette({colors:a,id:"0"},{shuffle:!r}).then(s.resolve)}return s.promise.then((function(){return r&&r.shape.style.colors.setColorId(h.ColorRole.FieldPrimary,r.color),0===o.lockupFormas().length?i.length?(o.downloadNewLockupRandomFontsAsync(),o.addNewLockup(i,{silent:!0,select:!!e.selectText})):n.resolve():(F.error("initializeNewPost error. We shouldn't be adding multiple lockups. Probably git issue 2093."),n.resolve())})).then((function(){return l.length>1?o.createPaddedCollage().then((function(){ee(!1)})):n.resolve()})).then((function(){return o.retrieveAndApplyASuggestedGridStyle()})).then((function(){M()}))},o.resetUserActions=function(){r.reset()},o.undoToInitialState=function(){return n.Promise((function(e,t){r.setCurrentTimelineIndex(0,e)}))},o.getActionDepth=function(){return r.getActionDepth()},o.beginBranch=function(){r.beginBranch()},o.endBranch=function(e){r.endBranch(e)},o.beginGesture=function(){return r.beginGesture(),r.gestureScope},o.endGesture=function(e){r.endGesture(e)},o.beginUserAction=function(e){return n.Promise((function(t,n){r.beginUserAction(e,t)})).then((function(){if(D){var e=o.getFormaById(D);e&&(e.controller.updateGroup(),e.controller.updateScoring()),D=null}}))},o.endUserAction=function(){return n.Promise((function(e,t){r.endUserAction(e)}))},o.undo=function(){return n.Promise((function(e,t){r.undo((function(){o.events.publish("undo-finished"),e()}))}))},o.redo=function(){return n.Promise((function(e,t){r.redo((function(){o.events.publish("redo-finished"),e()}))}))},o.canUndo=function(){return r.getCurrentTimelineIndex()>0&&0===r.getActionDepth()},o.canRedo=function(){return r.getCurrentTimelineIndex()<r.getTimelineLength()-1&&0===r.getActionDepth()},o.getUndoDescription=function(){return r.getUndoDescription()},o.getRedoDescription=function(){return r.getRedoDescription()},o.getCurrentTimelineIndex=function(){return r.getCurrentTimelineIndex()},o.documentId=function(){return T.documentId()},o.backgroundColor=function(){return c.firstPage.root.style.colors.color(h.ColorRole.FieldPrimary)},o.getFormaBackgroundColor=function(e){var t=e.style.colors.fieldPrimary;return t?c.firstPage.colorLibraryController.getTheoColorForSolidColor(t):null},o.triggerEnteredPalette=function(){c.firstPage.colorLibraryController.enteredPalettePicker()},o.triggerTextSidebarDisplayed=function(){c.firstPage.colorLibraryController.enteredPalettePicker()},o.isBackgroundVisible=function(){var e=o.getGridForma();return e?e.controller.isBackgroundVisible():0===o.imageFormas().length},o.getImageFormaForURL=function(e){for(var t=o.imageFormas(),n=0;n<t.length;n++){var r=t[n];if(null!=r.contentNode&&r.contentNode.url===e)return r}return null},o.getImagePreviewData=function(e){if(e&&e.isImage()){var t=h.ImageFacade.getImageFormaForForma(e);return t&&t.contentNode?(F.info("image preview placement:",t.placement),{colorThemeKey:_(),formaID:t.formaID,forma:t,url:B(t),styleFilter:t.style,placement:t.placement,width:t.contentNode.pixelWidth,height:t.contentNode.pixelHeight}):{}}},o.getFormaRenderList=function(){var e=[];let t=!1;const n=z(["FF0000"])[0];var r=c.firstPage.root.visitAsArray(h.FormaTraversal.PreOrder);const l=(t,n)=>e.push(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{type:n}));for(var s=0;s<r.length;s++){const i=r[s],{controller:a,formaID:u,kind:d}=i;if(a){const r={forma:i,formaID:u};if("Root"===d&&l(r,"background"),"Shape"===d&&l(r,"shape"),"Frame"===d)continue;if(i.isTypeLockup()&&l(r,"lockup"),d===h.ImageForma.KIND||d===h.VideoForma.KIND){const r=B(i);null==r?(F.error("no image url, cleaning up the document",{docId:c.uuid,imageFormaId:i.uuid}),t=!0,o.replaceImagesWithColors([i],[n]).done()):e.push({forma:i.parent,type:"image",formaID:i.parent.formaID,url:r,logo:i.isLogo(),colorThemeKey:_()})}}}return t&&(o.events.publish("show-image-forma-corrupted-modal",{backgroundColor:n.rgbColor.rgbHex}),o.validateDoc("missingContentCleanup")),e},o.imageFormas=function(){return c.firstPage.root.filterByKind(h.ImageForma.KIND)},o.canAddMoreImages=function(e){return o.imageFormas().length+e<=h.GridController.MAX_IMAGE_COUNT},o.hostImages=function(){var e=[];return o.imageFormas().forEach((function(t){null!=t.contentNode.image&&e.push(t.contentNode.image)})),e},o.iconFormas=function(){return c.firstPage.root.filterWithCallback((function(e){return e.hasIntent(h.Forma.INTENT_ICON)}))},o.lockupFormas=function(){return c.firstPage.root.filterByControllerKind(h.TypeLockupController.KIND)},o.logoFormas=function(){return o.imageFormas().filter((function(e){return e.isLogo()}))},o.backgroundImageFormas=function(){return c.firstPage.root.filterWithCallback((function(e){return e.kind==h.FrameForma.KIND&&e.isBackgroundImage()}))},o.getLockupWordCount=function(){for(var e=[],t=o.lockupFormas(),n=0;n<t.length;n++)e.push(t[n].controller.text.trim().split(/ |\n/).length);return e},o.getIconCount=function(){return o.iconFormas().length},o.getImageCount=function(){return o.imageFormas().length},o.getPotentialBackgroundImageCount=function(){return c.firstPage.root.filterWithCallback(e=>h.ImageFacade.isPotentialBackgroundImage(e)).length},o.documentSize=function(){return{width:c.firstPage.pageSize.width,height:c.firstPage.pageSize.height}},o.getDocumentSize=function(){return{width:c.firstPage.pageSize.width,height:c.firstPage.pageSize.height}},o.getImageSizeIfFullBleed=function(){var e=o.imageFormas();if(1==e.length){var t=e[0],n=o.getDocumentSize(),r=t.parent;if(r.finalFrame.width==n.width&&r.finalFrame.height==n.height&&t.contentNode)return{width:t.contentNode.pixelWidth,height:t.contentNode.pixelHeight}}return null},o.doAction=Q,o.flipForma=function(e,t){Q(new h.FlipAction(e,[t])).then((function(){o.events.publish("forma-flipped",{id:t.formaID,isImage:t.isImage()})}))},o.canDuplicateFormae=function(e){return h.DuplicateAction.canAddImages(e)},o.duplicateFormae=function(e){if(r.currentlyExecutingAction()){var t=n.defer();return t.resolve(),t.promise}return Q(new h.DuplicateAction(e,!0,!0)).then((function(t){for(var n=!1,r=0;r<e.length;r++)if(e[r].isImage()){n=!0;break}return o.events.publish("formae-duplicated",{duplicatedImage:n}),t}))},o.inCropMode=function(){return c.controller.selection.inCropMode},o.enterCropMode=function(){return N&&F.error("probable error. cropModeBranchStarted shouldn't be true"),N||r.currentlyExecutingAction()||o.inCropMode()?n():(N=!0,o.beginBranch(),Q(new h.EnterCropModeAction(o.getSelectedForma())))},o.exitCropMode=function(){return r.currentlyExecutingAction()?n():Q(new h.ExitCropModeAction).then(()=>{N&&(o.endBranch(!0),N=!1)})},o.setImageAsBackground=function(){return r.currentlyExecutingAction()?n():Q(new h.SetImageAsBackgroundAction).then(e=>(o.events.publish("image-set-background",{}),e))},o.setImageAsForeground=function(){return r.currentlyExecutingAction()?n():Q(new h.SetImageAsFloatingAction).then(e=>(o.events.publish("image-set-foreground",{}),e))},o.deleteFormae=function(e){for(var t=[],n=0;n<e.length;n++)t.push(o.getFormaById(e[n].formaID));return e=t,o.inCharStyleMode&&null!=selected&&selected.isTypeLockup()&&o.exitCharStyleMode(),o.deselect(),y.doAction(c,new h.DeleteAction(e)).then((function(){for(var t=[],n=!1,r=0;r<e.length;r++)t.push(e[r].formaID),n||(n=e[r].isImage());o.events.publish("formae-deleted",{ids:t,deletedImage:n})}))},o.replaceImagesWithColors=function(e,t){return Q(new h.ReplaceImagesWithColorsAction(e,t))},o.showDeleteImageOption=function(e){for(var t=o.getGridForma(),n=t&&1===t.style.numBackgroundCells,r=!1,i=!0,a=0;a<e.length;a++)if(e[a]&&e[a].isImage()&&e[a].isBackgroundImage()){r=!0,i=t.controller.canDeleteCellForForma(e[a]);break}return!n&&r&&i},o.getSelectedBoundingBox=function(){return G()},o.getSwapState=function(){return c.controller.model.activeSwap.getActive()},o.isMultiSelect=function(){return h.SelectionFacade.isMultiSelect(c.controller.selection)},o.getSelectedForma=function(){return c.controller.selection.selectedCount?c.controller.selection.formaAt(0):null},o.getAllSelectedFormas=function(){for(var e=[],t=0;t<c.controller.selection.selectedCount;t++)e.push(c.controller.selection.formaAt(t));return e},o.getSelectedFormaId=function(){var e=o.getSelectedForma();return e?e.formaID:null},o.getRootForma=function(){return c.firstPage.root},o.getDocument=function(){return c},o.getFormaById=function(e){return c.firstPage.formaByID(e)},o.selectFormaById=function(e){if(e.forma=o.getFormaById(e.formaId),e.forma)return o.selectForma(e),e.forma},o.deselect=function(e){e=e||{};var t=o.getSelectedForma();o.inCharStyleMode&&null!=t&&t.isTypeLockup()&&o.exitCharStyleMode(),o.inCropMode()&&(o.events.publish("exit-crop-mode"),o.exitCropMode().done()),c.controller.selection.clearSelection(!e.silent)},o.deselectForma=function(e){c.controller.selection.deselectForma(e)},o.selectForma=function(e){var t=o.getSelectedForma(),n=e.forma,r=e.silent,i=!e.multiselect;if(n&&(e.multiselect||o.getSelectedFormaId()!==n.formaID))if(e.multiselect&&function(e){return c.controller.selection.isSelected(e)}(e.forma))o.deselectForma(e.forma);else{if(o.inCharStyleMode&&null!=t&&t.isTypeLockup()&&o.exitCharStyleMode(),"Root"==n.kind&&!o.isBackgroundVisible())return F.error("error in selection. background is not visible, so don't allow selection"),void o.deselect();n.isTypeLockup()&&(D=n.formaID),i&&o.deselect({silent:!0}),c.controller.selection.selectForma(n,!r)}},o.ensureBackgroundFormaSelected=function(){var e=o.getSelectedForma(),t=e&&!e.isTypeLockup()&&!e.isLogo()&&e.controller.moveable;if(!e||!(e.isBackgroundImage()||e.isShape()||"Root"==e.kind||e.isGridCell()||t)){var n=o.backgroundImageFormas();if(n.length>0)o.selectForma({forma:n[0]});else{var r=c.firstPage.root.filterByControllerKind("shape");r.length>0?o.selectForma({forma:r[0]}):o.selectForma({forma:c.firstPage.root})}}},o.ensureLockupSelected=function(){var e=o.getSelectedForma();if(!e||!e.isTypeLockup()){var t=o.lockupFormas();t.length>0&&o.selectForma({forma:t[0]})}},o.handleSelectBoxBeginResize=function(e,t){(e=e||o.getSelectedForma())&&o.beginUserAction(h.UserActions.ResizeItem()).then((function(){var e=new h.TheoPoint(t.spot.x,t.spot.y);c.controller.designController.resize.handleBeginSelectionBoxResize(e)}))},o.handleSelectBoxEndResize=function(e,t){if(e=e||o.getSelectedForma()){var n=new h.TheoPoint(t.spot.x,t.spot.y);c.controller.designController.resize.handleEndSelectionBoxResize(n),e.isTypeLockup()&&e.controller.updateScoring(),o.endUserAction()}},o.handleFormaResize=function(e,t){if((e=e||o.getSelectedForma())&&t.width&&t.height){var n=t.width,r=t.height,i=new h.TheoSize(n,r),a=new h.TheoPoint(t.spot.x,t.spot.y),l=new h.TheoPoint(-1*a.x+1,-1*a.y+1);c.controller.designController.resize.handleSelectionBoxResize(i,l,a,null)}},o.handleNudge=function(e){var t=e.translate;return Q(new h.NudgeAction(new h.TheoPoint(t.x,t.y)))},o.handleHandleFeedback=function(e){var t=c.controller.model.handles.getAll().find((function(e){return e instanceof h.BoxTransformHandles}));if(t){var n;switch(e.action){case"begin":n=h.HandleTransformStage.Begin;break;case"update":n=h.HandleTransformStage.Update;break;case"end":n=h.HandleTransformStage.End;break;default:return void F.error("handleHandleFeedback: params.action wasn't an expected value; it was "+e.action)}var r=null;switch(e.part){case"rotate":r=new h.RotateAboutCenterTransformEvent(t,n,e.totalDeltaRadians||0);break;case"corner":var i=J(e.spot);r=new h.CornerTranslateTransformEvent(t,n,i,new h.TheoPoint(e.location.x,e.location.y));break;case"side":i=J(e.spot);r=new h.SideTranslateTransformEvent(t,n,i,new h.TheoPoint(e.location.x,e.location.y));break;default:return void F.error("handleHandleFeedback: params.part wasn't an expected value; it was "+e.part)}r.viewportScale=o.getViewScale(),c.controller.designController.handles.handleTransformEvent(r)}},o.getSelectedFormaRotation=function(){var e=o.getSelectedForma();if(!e)return null;var t=e;return"Frame"===e.kind&&(t=t.childAt(0)),180*Math.atan2(t.placement.transformValues.rotSine,t.placement.transformValues.rotCosine)/Math.PI},o.getSelectedFormaHasShapeMask=function(){return h.ImageFacade.formaHasShapeMask(o.getSelectedForma())},o.getSelectedFormaScale=function(){var e=o.getSelectedForma();if(!e)return null;var t=e;return"Frame"===e.kind&&(t=t.childAt(0)),t.placement.extractedScale.scale.x},o.getSelectedFormaPlacement=function(){var e=o.getSelectedForma();if(!e)return null;var t=e,n="";return"Frame"===e.kind&&(n=(t=t.childAt(0)).contentNode.pixelWidth+"_"+t.contentNode.pixelHeight),{placement:t.placement,id:n}},o.getSelectedFormaScaleRange=function(){var e={},t=o.getSelectedForma();if(t&&"Frame"===t.kind&&!t.controller.moveable){var n=t.childAt(0),r=.1;if(n.contentNode){var i=t.finalFrame.size,a=n.contentNode.pixelWidth,c=n.contentNode.pixelHeight,l=a/c,s=i.width/i.height,u=i.width/a,d=i.height/c;r=l>s?d:u}n.hasAlpha()?(e.min=.1,e.max=2):(e.min=r,e.max=10*r)}return e},o.scaleSelectedForma=function(e,t){var n=o.getSelectedForma();"Frame"!==n.kind||n.controller.moveable&&!o.inCropMode()||(n=n.childAt(0));var r=e/n.placement.extractedScale.scale.x;return Q(new h.ScaleAction(r,[n]))},o.changeImageAdjustments=function(e){var t=o.getSelectedForma(),n=t;return t&&"Frame"===t.kind&&(n=t.childAt(0)),Q(h.ChangeImageAdjustmentsAction.ActionWithDictionary(e,[n]))},o.resetImageAdjustments=function(e){return r.whenNoCurrentAction((function(){return o.changeImageAdjustments(e)}))},o.getImageAdjustments=function(e){var t=e||o.getSelectedForma();return t&&"Frame"===t.kind&&(t=t.childAt(0)),t.style.adjustments},o.rotateSelectedForma=function(e,t){var n=e/180*Math.PI,r=o.getSelectedForma();return"Frame"!==r.kind||r.controller.moveable&&!o.inCropMode()||(r=r.childAt(0)),Q(new h.RotateAction.init_5d34(n,t,[r]))},o.handleTextFormaBeginResize=function(e){if(e=e||o.getSelectedForma()){o.beginGesture();null!=e&&e.isTypeLockup()&&(e.controller.beginTouches(null),I=null)}},o.handleTextFormaEndResize=function(e){(e=e||o.getSelectedForma())&&o.endGesture(!0)},o.handleTextFormaResize=function(e,t){if(e&&e.isTypeLockup()&&null!=t.startForma){var o=new h.TheoPoint(t.touchPoint.x,t.touchPoint.y),r=0===t.spot.x&&.5===t.spot.y;return Q(new h.CharRangeHandleAction(e,o,t.startForma,r,I)).then((function(){I=o,te(e)}))}return n.resolve(!1)},o.handleTapped=function(e){var t,n=e.forma||o.getFormaById(e.id);if(o.inCharStyleMode){null!=n&&n.isTypeLockup()&&n.controller.owner.selection.isSelected(n)&&n.controller.selectCharStyleForma();var r=new h.TheoPoint(e.x,e.y),i=c.firstPage.formaAtPointInSelection(r,c.controller.selection);if(null!=i&&null!=i.lockupForma)X((t=i)&&t.lockupForma,h.UserActions.ModifyStyleRanges(),(function(){t.lockupForma.controller.applyCharStyle(t,h.TypeLockupController.HIGHLIGHT_STYLE,h.CharStyleApplyMode.Toggle,t.rangeInLockup),V()&&ee(!1)}));else{var a=o.getSelectedForma();a.formaID&&e.forma.formaID!=a.formaID&&(o.exitCharStyleMode(),o.selectForma({forma:n}))}}else void 0!==n&&o.selectForma({forma:n});return!o.inCharStyleMode},o.getOriginalImageSize=function(){if(!o.inVisibleGridLayout()){var e=o.backgroundImageFormas();if(1==e.length){var t=e[0];return{width:t.childAt(0).contentNode.pixelWidth,height:t.childAt(0).contentNode.pixelHeight}}return null}},o.recordOriginalSize=function(){return Q(new h.RecordOriginalPageSizeAction(c.firstPage))},o.setPageSizeFromDesignSize=function(e,t){return X(!0,h.UserActions.ChangePageSize(),(function(){t=t||{},o.deselect(),c.controller.setAutomaticLayoutInteractionMode(),c.firstPage.setPageSizeFromDesignSize(e),c.controller.setDefaultInteractionMode();var n=o.getDocumentSize(),r={width:n.width,height:n.height};return o.events.publish("document-size-changed",r),y.delay(t.delay||100)}))},o.getPageAspectRatio=function(){var e=o.getDocumentSize();return e.width/e.height},o.getDocumentSizeId=function(){return c.firstPage.sizeID},o.getDocumentOriginalSizeId=function(){return c.firstPage.originalSizeID},o.getPageCustomSizeFormat=function(){return c.firstPage.customSizeFormat},o.getPageCustomSizePPI=function(){return c.firstPage.customSizePPI},o.getPageExportData=function(){return c.firstPage.getPageExportData()},o.getExportData=function(){return c.firstPage.getExportData()},o.lockupFormaIDs=function(){var e=o.lockupFormas();return t.map(e,(function(e){return e.formaID}))},o.downloadNewLockupRandomFontsAsync=function(){if(!P){P=n.defer();v.loadMissingFonts(["Lato-Light","Lora-Regular","Montserrat-Regular","PlayfairDisplay-Regular","CantataOne-Regular","FuturaPT-Medium"]).then((function(){P.resolve()}))}},o.addNewLockup=function(e,t){F.assert(!!P,"Invalid random fonts loading promise."),t=t||{};var r=n.defer(),i=r.promise,a=o.imageFormas();return a.length>0?i=a[0].contentNode.image.getImageLoadedPromise():r.resolve(),i.then((function(){return Q(new h.AddTextContentAction(e))}))},o.addBadge=function(e,t){return o.getTemporaryDocumentWithFontsLoaded(e).then((function(e){return Q(new h.AddBadgeAction(e,t))}))},o.applyDesignTheme=function(e,t){var i=n.defer();return o.getTemporaryDocumentWithFontsLoaded(e).done((function(e){r.whenNoCurrentAction((function(){t=t||0;var n=c.firstPage.root;Q(h.ApplyTemplateAction.init_e1db(e,n,t,n)).then((function(){y.delay(40).done(i.resolve)}))}))})),i.promise},o.applyRetargetSuggestion=function(e,t){return X(!0,h.UserActions.ApplyTemplate(),(function(){var n=c.firstPage.root;n.controller.createGridControllerIfNone();var o=new h.RetargetSuggester(n,n,e).createSuggestions(),r=t%o.length;return x++,r>=0&&o[r].apply(),x--,y.delay(10)}))},o.getThemeId=function(){return c.content.root.getTag("theme:id")},o.getColorPaletteId=function(){return c.firstPage.colorLibrary.paletteID},o.getColorPalette=function(){var e=c.firstPage.colorLibraryController.getColorThemeAsArrayOfTheoColors();return t.map(e,(function(e){return{color:g.rgb2hex({r:255*e.rgbColor.red,g:255*e.rgbColor.green,b:255*e.rgbColor.blue}),roles:e.sparkRoles,id:e.sparkElementID}}))},o.setColorPalette=function(e,t){return t=t||{},X(!0,h.UserActions.SetColorTheme(),(function(){c.firstPage.colorLibraryController.applyColorTheme(z(e.colors),e.id),t.shuffle&&c.firstPage.colorLibraryController.shuffleColorAssignments()}))},o.applyAspectRatioCropToImage=function(e){if(e.id==h.CropRatioPresetLibrary.FREEFORM_ID){var t=h.ImageFacade.getImageFormaForForma(o.getSelectedForma());return Q(new h.SetImageCropToFreeformAction(t))}var n=e.id==h.CropRatioPresetLibrary.ORIGINAL_ID?0:e.aspectRatio,r=h.ImageFacade.getImageFormaForForma(o.getSelectedForma());return Q(new h.CropImageToRatioAction(r,n,e.cropToRatioUsingFrameBounds))},o.applyShapeMaskToImage=function(e){return Q(new h.ApplyShapeMaskToImageAction(o.getSelectedForma(),e.shapeId,e.cropToRatioUsingFrameBounds))},o.shuffleColorPalette=function(){return Q(new h.ShuffleColorThemeAction(c.firstPage))},o.getImageFilters=function(){for(var e=c.firstPage.imageFilterLibrary.getImageStyles(),t=e.length-1;t>=0;t--)e[t].colors.library=c.firstPage.colorLibrary;return e},o.setImageFilterForSelection=function(e,t,r){var i=o.getSelectedForma();return i&&i.isImage()?Q(0===t?new h.SetImageFilterAction(e,r):new h.ShuffleImageFilterAction(e,c.firstPage,r)):n.resolve(!1)},o.getTextForSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller.contentNode;return t?t.text:null}},o.shouldSuggestTransparentBackground=function(){return c.firstPage.root.controller.suggestTransparentBackground()},o.setBackgroundTransparency=function(e){return X(!0,h.UserActions.SetBackgroundTransparency(),(function(){c.firstPage.root.controller.setBackgroundTransparency(e)}))},o.getFullCanvasColor=function(){var e=h.TypeLockupUtils.getFullCanvasLockups(c.firstPage.root);return e.length>0&&1==e[0].lockupStyle.backingOpacity?e[0].lockupStyle.colors.fieldSecondary:null},o.setTextForSelectedLockup=function(e){return o.setTextForLockup(e,o.getSelectedForma())},o.setTextForLockup=function(e,t){var n=t&&t.formaID;return X(n,h.UserActions.ChangeText(n),(function(){return t=o.getFormaById(n),h.TextFacade.replaceTextForLockup(t,e),o.events.publish("forma-text-updated",{forma:t}),y.delay(10)}))},o.getDominantColorRoleOfLockup=function(e){if(!e||!e.isTypeLockup())return h.ColorRole.FieldPrimary;var t=e.controller.styleController.targetedLockupStyle;return t.textLook===h.LockupTextLook.KnockoutOnly||t.textLook===h.LockupTextLook.OutlineOnly?h.ColorRole.FieldSecondary:h.ColorRole.FieldPrimary},o.setColorsForSelectedLockup=function(e,t){var r=o.getSelectedForma();if(r&&r.isTypeLockup()&&r.formaID){var i=j(e);return Q(new h.ApplyColorAction(null,i,o.inCharStyleMode,t))}return n.resolve(!1)},o.getShapeFormaTheoColor=function(e){if((e=e||o.getSelectedForma())&&e.isShape()){var t=e.style.colors.color(h.ColorRole.FieldPrimary);return c.firstPage.colorLibraryController.getTheoColorForSolidColor(t)}},o.getLockupFormaColors=function(e,t){if((e=e||o.getSelectedForma())&&e.isTypeLockup()){t="boolean"!=typeof t||t;var n=e.controller,r=t?n.styleController.targetedLockupStyle.colors:n.lockupStyle.colors,i=r.fieldPrimary||new h.SolidColor(1,1,1,1),a=r.fieldSecondary||new h.SolidColor(1,1,1,1),l=c.firstPage.colorLibraryController.getTheoColorForSolidColor(i),s=c.firstPage.colorLibraryController.getTheoColorForSolidColor(a),u=[{red:Math.round(255*l.rgbColor.red),green:Math.round(255*l.rgbColor.green),blue:Math.round(255*l.rgbColor.blue),alpha:1,id:l.sparkElementID,roles:l.sparkRoles},{red:Math.round(255*s.rgbColor.red),green:Math.round(255*s.rgbColor.green),blue:Math.round(255*s.rgbColor.blue),alpha:1,id:s.sparkElementID,roles:s.sparkRoles}];return o.selectedLockupHasOnlyOneColor(e)&&(o.getDominantColorRoleOfLockup(e)===h.ColorRole.FieldSecondary?u.splice(0,1):u.splice(1)),u}},o.selectedLockupHasOnlyOneColor=function(e){if(!(e=e||o.getSelectedForma())||!e.isTypeLockup())return!0;var t="none"!==o.getShapeOfSelectedLockup(e),n=e.controller.styleController.targetedLockupStyle.textLook;return t?n===h.LockupTextLook.KnockoutOnly||n===h.LockupTextLook.OutlineOnly:n===h.LockupTextLook.OutlineOnly||n===h.LockupTextLook.Fill||h.LockupTextLook.UNSET},o.setFontForSelectedLockup=function(e){var t=o.getSelectedForma(),r=t&&t.isTypeLockup()&&t.formaID,i=p.fontProvider.descriptorForPostScriptName(e.postScriptName);if(i.postScriptName==e.postScriptName){var a=r;return this.inCharStyleMode&&(a+=":"+h.TypeLockupController.HIGHLIGHT_STYLE),X(r,h.UserActions.SelectFont(a),(function(){var t=o.getSelectedForma(),n=t&&t.controller;o.inCharStyleMode&&(n.styleController.targetedLockupStyleName=h.TypeLockupController.HIGHLIGHT_STYLE);var r=v.getFontData(e.postScriptName);h.TypeLockupUtils.applyFontToController(h.TheoFont.init_9e5c(i,r.sparkElementId,r.acRoles),t&&t.controller),t.controller.snapSizeToBounds(),$(t)}))}return n.reject("cannot find font with PostScriptName: "+e.postScriptName)},o.updataDocForTypekitFontDeactivated=function(e){c&&e&&(h.TypeLockupUtils.replaceFontsInDocument(c,[e]),ee(!1),M())},o.getLockupFontOfSelectedLockup=function(e,t){if((e=e||o.getSelectedForma())&&e.isTypeLockup()){t="boolean"!=typeof t||t;var n=e.controller;return t?n.styleController.targetedLockupStyle.font:n.lockupStyle.font}},o.setShapeForSelectedLockup=function(e){return o.getSelectedForma()?isNaN(e)?o.applyBackingToLockup(7,e,o.getSelectedFormaId()):o.applyBackingToLockup(e,null,o.getSelectedFormaId()):n.resolve()},o.getEffectForSelectedLockup=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup())return e.controller.styleController.getTextLookForUI()},o.setEffectForSelectedLockup=function(e){if(o.getSelectedForma()){var t=o.getSelectedFormaId(),r=o.inCharStyleMode?t+":secondary":t;return X(!0,h.UserActions.ChangeTextEffect(r),(function(){var n=o.getFormaById(t).controller.styleController;o.inCharStyleMode&&(n.targetedLockupStyleName=h.TypeLockupController.HIGHLIGHT_STYLE),n.setTextLook(e)}))}return n.resolve()},o.toggleFillOfSelectedLockup=function(e){var t=o.getSelectedForma()&&o.getSelectedForma().isTypeLockup();return X(t,h.UserActions.ChangeTextEffect(),(function(){var t=o.getSelectedForma(),n=t.controller.styleController;o.inCharStyleMode&&(n.targetedLockupStyleName=h.TypeLockupController.HIGHLIGHT_STYLE),e?n.targetedLockupStyle.textLook=h.LockupTextLook.OutlineOnly:n.targetedStrokeWeight>.12?n.targetedLockupStyle.textLook=h.LockupTextLook.FillAndOutline2:n.targetedLockupStyle.textLook=h.LockupTextLook.FillAndOutline,t.controller.styleChanged()}))},o.isLockupOutlineOnly=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup())return e.controller.styleController.targetedLockupStyle.textLook===h.LockupTextLook.OutlineOnly},o.getStrokeWeightOfSelectedLockupForUI=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup())return Math.round(e.controller.styleController.getStrokeWeightPercentForUI())},o.setStrokeWeightSelectedLockup=function(e,t){t=t||o.getSelectedForma();var n=function(e){return(e-1)/99}(e);return Q(new h.SetTextEffectsAttributesAction(n,NaN,NaN)).then((function(){V()&&$(t)}))},o.getShadowOffsetOfSelectedLockupForUI=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup())return Math.round(e.controller.styleController.getShadowOffsetPercentForUI())},o.setShadowOffsetOfSelectedLockup=function(e,t){t=t||o.getSelectedForma();var n=function(e){return(e-1)/99}(e);return Q(new h.SetTextEffectsAttributesAction(NaN,n,NaN)).then((function(){V()&&$(t)}))},o.getShadowAngleOfSelectedLockup=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup()){var t=e.controller.styleController.targetedShadowAngle;return t>180?t-360:t}},o.setShadowAngleOfSelectedLockup=function(e,t){return t=t||o.getSelectedForma(),e=e<0?e+360:e,Q(new h.SetTextEffectsAttributesAction(NaN,NaN,e)).then((function(){V()&&$(t)}))},o.applyBackingToLockup=function(e,t,n){var r=o.getFormaById(n),i=e;if(9===e){var a=r.controller.size;i=a.width>a.height?9:8}return Q(new h.ChangeBackgroundShapeAction([r],i,t,o.inCharStyleMode))},o.getShapeOfSelectedLockup=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup()){var t,n=e.controller.styleController.targetedLockupStyle.backing;if(7===n)t=e.controller.styleController.targetedLockupStyle.backingArtworkID;else{t={0:"none",2:"row",4:"shadow",8:"banner",9:"banner",11:"knockout"}[n]}return t}},o.setNextSpacingForSelectedLockup=function(){return X(o.getSelectedForma()&&o.getSelectedForma().isTypeLockup(),h.UserActions.ChangeLineSpacing(),(function(){var e=o.getSelectedForma(),t=e&&e.controller.styleController;t.areSpacingAndPaddingOptionsAvailable()&&t.setNextSpacingAndPaddingOption(),V()&&$(e)}))},o.setLetterSpacingForSelectedLockup=function(e){return o.getSelectedForma()&&o.getSelectedForma().isTypeLockup()?Q(new h.SetTrackingAction(e,L)).then((function(){V()&&$(selected)})):n.resolve(!1)},o.setCurrentPin=function(){if(L=h.TheoPoint.ZERO,o.getSelectedForma()&&o.getSelectedForma().isTypeLockup()){var e=o.getSelectedForma().controller.getPin(!0,!0);null!=e&&(L=e.pinPoint)}},o.setSpacingForSelectedLockup=function(e){return o.getSelectedForma()&&o.getSelectedForma().isTypeLockup()?Q(new h.SetLeadingAction(e,L)).then((function(){V()&&$(selected)})):n.resolve(!1)},o.setPaddingForSelectedLockup=function(e){return o.getSelectedForma()&&o.getSelectedForma().isTypeLockup()?Q(new h.SetPaddingAction(e,L)).then((function(){V()&&$(selected)})):n.resolve(!1)},o.getSpacingAndPaddingOfSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller.styleController,n=t.targetedLockupStyle.spacing,r=t.targetedLockupStyle.padding;return{spacing:"number"==typeof n?n:parseFloat(n),padding:"number"==typeof r?r:parseFloat(r)}}},o.getLetterSpacingSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup())return e.controller.styleController.targetedLockupStyle.tracking},o.areSpacingAndPaddingAvailableForSelectedLockup=function(){var e=o.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.areSpacingAndPaddingOptionsAvailable()},o.isSpacingAvailableForSelectedLockup=function(){var e=o.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.hasSpacingOptions()},o.isPaddingAvailableForSelectedLockup=function(){var e=o.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.hasPaddingOptions()},o.setNextAlignmentForSelectedLockup=function(){var e=o.getSelectedForma(),t=e&&e.isTypeLockup()&&e.formaID;return X(t,h.UserActions.ChangeTextAlignment(t),(function(){var e=o.getSelectedForma().style,t=e.layout;e.layout=t>=3?0:t+1}))},o.setLayoutAndAlignmentForSelectedLockup=function(e,t){var r=o.getSelectedForma();return r&&r.isTypeLockup()&&r.formaID?(x++,Q(new h.ChangeTextLayoutAndAlignmentAction(e,t)).then((function(){x--}))):n.resolve(!1)},o.getSuggestedColorsForLockup=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup()){var n=e.controller.styleController.getSuggestableColors();return t.map(n,(function(e){return t.map(e,(function(e){return{red:255*e.rgbColor.red,green:255*e.rgbColor.green,blue:255*e.rgbColor.blue,id:e.sparkElementID,roles:e.sparkRoles}}))}))}},o.getBrandKitColorsPalettesForSelectedLockup=function(e){if(!o.getSelectedForma()||!o.getSelectedForma().isTypeLockup()||!e)return{colors:[]};var n=h.TheoBrandkitUtils.getBrandkitColorsForUI(e,o.getSelectedForma()),r=t.map(n,(function(e){return t.map(e,(function(e){return{red:255*e.rgbColor.red,green:255*e.rgbColor.green,blue:255*e.rgbColor.blue,id:e.sparkElementID,roles:e.sparkRoles}}))}));return{name:e.name,id:e.id,colors:r}},o.createFormaFromSVG=function(e,t,i){var a=e.original.link,l=new XMLHttpRequest;l.open("GET",a,!0),l.onload=function(s){var u=l.responseText,d=h.SVGParserUtils.theoArtworkFromSVGData(u,!0);p.pathUtils.cacheArtworkForURL(a,d),r.whenNoCurrentAction((function(){var r="";X(!0,i?h.UserActions.ReplaceIcon():h.UserActions.AddIcon(),(function(){return n(h.SVGParserUtils.addShapeFromSVGURL(c,i,a,t)).then(e=>{if(!(e instanceof h.ShapeForma))throw new Error("addShapeFromSVGURL did not return a shape");r=e.contentID,o.selectForma({forma:e}),e.contentNode.url="uploading svg",o.events.publish("design-updated",{formaAdded:e})})}));var l=new Blob([u],{type:e.mimeType});o.saveImageComponent(l,e.mimeType).then((function(e){var t={contentNodeID:r,url:e.encodedUrl,componentID:e.component.id};o.updateVectorContentNodeWithComponent(t)})).catch((function(e){F.error("failed to upload SVG file",e)})).done()}))},l.onerror=function(){F.error("failed to download SVG icon file")},l.send()},o.getLayoutOfSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup())return h.TextFacade.getLayoutForForma(e)},o.getAlignmentOfSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup())return h.TextFacade.getAlignmentForForma(e)},o.getAllowedAlignmentStates=function(){var e=o.getSelectedForma();return e?e.controller.styleController.layoutSelector.values:[]},o.matchNextSizeForSelectedForma=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=new h.TheoPoint(0,0),r=h.TypeLockupUtils.sizesInDocument(e.controller.forma.page.document,e.controller.forma);return Q(new h.MatchSizeAction(NaN,r,t,"document")).then((function(){V()&&($(e),Z(e,"FormaResizeEvent"))}))}return n.resolve(!1)},o.setSizeForSelectedForma=function(e){var t=new h.TheoPoint(0,0);return Q(new h.MatchSizeAction(e,[],t)).then((function(){V()&&($(selected),Z(selected,"FormaResizeEvent"))}))},o.getSizeSliderValueOfSelectedForma=function(){var e=o.getSelectedForma();if(e)return e.isTypeLockup()?e.controller.getCurrentFontSize():20},o.getOpacitySliderValueOfSelectedForma=function(){var e=o.getSelectedForma();if(e)return e.isTypeLockup()?e.controller.styleController.getOpacityValue():e.isLogo()?e.childAt(0).style.opacity:e.controller.moveable&&"Frame"===e.kind&&e.childCount?e.childAt(0).style.opacity:e.controller.moveable&&"Shape"===e.kind?e.style.opacity:1},o.setLayerForSelectedForma=function(e){var t=o.getSelectedForma(),n=t.controller.getMinLayerIndex()+e;return Q(new h.ChangeZOrderAction(n)).then((function(){o.updateLayers(t),V()&&$(t)}))},o.getLayerSliderValueOfSelectedForma=function(){var e=o.getSelectedForma();if(e)return e.controller.getZOrder()-e.controller.getMinLayerIndex()},o.getNumLayers=function(){var e=o.getSelectedForma();if(e)return e.controller.getReorderableLayerCount()},o.updateLayers=function(){o.events.publish("forma-layer-changed")},o.canSave=function(){return b&&U()},o.setColorForSelection=function(e){return Q(new h.ApplyColorAction(null,j(e)))},o.addLogo=function(e){var t=c.content.root.visit(t=>t instanceof h.URLBasedContentNode&&t.sparkElementID===e.id);return Q(t?new h.AddContentAction(t):new h.AddLogoContentAction(c.firstPage,e,null,null,e.componentId))},o.addOrReplaceImage=function(e){F.info("adding image. is low res? "+String(e.isLowResImage));var i=e.replacementForma;if(null!=e.replacementFrame&&null==i.parent)for(var a=c.firstPage.root.filterByKind(h.FrameForma.KIND),l=0;l<a.length;l++)a[l].finalFrame.equalWithAccuracy(e.replacementFrame,.001)&&(i=a[l],F.info("matched by frame"));i&&i.isShape()&&i.controller.moveable&&(F.error("Assertion fail. We shouldn't be asking to replace a moveable shape (at this point)."),i=null),p.imageAnalysis.updateHostImageCacheKey(e.metadata.sourceURL,e.url);var s=n.defer();return r.whenNoCurrentAction((function(){var n=e.floatingImageStrategy||h.FloatingImageStrategy.IfHasAlphaOrIsLogo,r=new h.AddFormaParams(h.ControllerSettingsBehaviorEnum.IgnoreControllerSettings,!0,i,n),a=new h.AddImageContentAction(c.firstPage,e.url,e.mimeType,e.width,e.height,e.hasAlpha,e.metadata,null,null,r,h.ActionUndoability.useDefault,e.id,!0);c.controller.doActionWithCompletion(a,(function(){var n=o.getImageFormaForURL(e.url),r=n.parent.isBackgroundImage()?n.parent:n;e.formaId=r.formaID,e.contentNodeId=r.contentID,o.events.publish("forma-added",{id:r.contentID,isLowResImage:e.isLowResImage}),t.delay((function(){s.resolve(e)}),10)}))})),s.promise},o.replaceImageWithHighRes=function(e){F.assert("string"==typeof e.contentNodeId,"can not patch content node with contentNodeId"),F.assert("string"==typeof e.lowResImageUrl,"can not patch content node without lowResImageUrl");return A.push((function(){var n=c.content.nodeByID(e.contentNodeId);if(n&&n.url===e.lowResImageUrl){var i=h.Matrix2D.uniformScaling(e.width>e.height?n.pixelWidth/e.width:n.pixelHeight/e.height);t.each(o.imageFormas(),(function(t){t.contentNode.id===e.contentNodeId&&(r.beginPatch(),n.mediaMetadata=e.metadata,n.url=e.url,n.pixelWidth=e.width,n.pixelHeight=e.height,n.mimeType=e.mimeType,n.hasAlpha=e.hasAlpha,p.imageAnalysis.updateHostImageCacheKey(e.lowResImageUrl,e.url),t.placement=i.concat(t.placement),t.invalidateCachedBounds(),r.endPatch())}))}})),K()},o.updateVectorContentNodeWithComponent=function(e){return A.push((function(){var t=c.content.nodeByID(e.contentNodeID);t&&"uploading svg"===t.url&&"vector"===t.kind&&(r.beginPatch(),t.url=e.url,t.componentID=e.componentID,r.endPatch())})),K()},o.fitSelectedImageToFrame=function(e){var t=e||o.getSelectedForma();return X(t&&t.isImage(),h.UserActions.FitImageToFrame(),(function(){t.controller.fitChildrenToFrame()}))},o.checkAndNotifyFormaUpdated=function(e){V()&&$(e)},o.textLockupHighlight=function(){return X(o.getSelectedForma()&&o.getSelectedForma().isTypeLockup(),h.UserActions.ChangeTextStyle(),(function(){var e=o.getSelectedForma();(new h.FormaCalloutUtils).applyLockupHighlightBox(e)}))},o.getLockupStyleStringWithRole=function(e){var t="";null!=e&&e.style.wheelUsed&&(t=e.style.getCompressedStringOfFeatures(),t+="{role:"+(new h.RoleSuggester).getRole(e).role+"|id:"+e.formaID+"|docId:"+c.uuid+"}");return t},o.getStyleServiceMetaDataString=function(e){var t=null;if(null!=e){const{controller:n}=e,{text:o,size:{width:r,height:i}}=n,{tracking:a,spacing:c}=n.lockupStyle,{width:l,height:s}=e.page.pageSize,u=o.replace(/^\W+|\W+$/g,"").split(/\W+/g).length,d=n.numLines();t="trng:".concat(a,",spng:").concat(c,",w:").concat(Math.round(r),",h:").concat(Math.round(i))+",page_w:".concat(Math.round(l),",page_h:").concat(Math.round(s))+",words:".concat(u,",lines:").concat(d)}return t},o.getAllStringForFormaUsedWheelSuggestions=function(){var e=[];return o.lockupFormas().forEach((function(t){var n=o.getLockupStyleStringWithRole(t);n.length>0&&e.push(n)})),e},o.getCurrentDocumentSynthesizedName=function(){return c.getSynthesizedTitle()},o.getCurrentDocumentDescription=function(){return c.getSynthesizedDescription()},o.getGridForma=function(e){var t=c.firstPage.root.filterByControllerKind(h.GridController.KIND);return t.length>0?t[0]:e?c.firstPage.root.controller.createGridControllerIfNone().forma:null},o.getAllGridStyles=function(){var e=n.defer();return setTimeout((function(){try{var t=c.firstPage.layoutLibrary.getLayoutsForRoot(c.firstPage.root);e.resolve(t)}catch(t){e.reject(t)}}),0),e.promise},o.retrieveAndApplyASuggestedGridStyle=function(){var e=h.LayoutSuggester.createContentAwareSuggestions(c.firstPage.root);return e.length?o.applyGridStyle({name:e[0].name,gridStyle:e[0].gridStyle,silent:!1},0):n.resolve()},o.applyGridStyle=function(e,t){return Q(new h.SetGridStyleAction(e.gridStyle,t))},o.shuffleCustomGridStyle=function(e){return X(!0,h.UserActions.ShuffleGridStyle(),(function(){o.deselect(),x++;var t=c.firstPage.root.controller.createGridControllerIfNone();if(t){var n=t.gridStyle;n.formaMapping={},t.applyStyle(n,e)}x--}))},o.inAutomaticLayoutMode=function(){return c.controller.inAutomaticLayoutInteractionMode},o.enableAutomaticLayoutMode=function(){c.controller.setAutomaticLayoutInteractionMode();var e=o.getGridForma();if(e){var t=o.beginTransaction("inferGridCellAssignment");e.controller.inferGridCellAssignment(),o.endTransactionAndMergeWithPrevious(t),e.style.moveableShift=!0}},o.disableAutomaticLayoutMode=function(){c.controller.setDefaultInteractionMode()},o.enterCharStyleMode=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t,n=e.controller;o.inCharStyleMode=!0,n.owner.selection.inCharStyleMode=!0,n.getCharacterStyleRanges().length?(n.styleController.targetedLockupStyleName=h.TypeLockupController.HIGHLIGHT_STYLE,n.selectCharStyleForma(),te(e)):X((t=e)&&t.isTypeLockup(),h.UserActions.ModifyStyleRanges(),(function(){var e=t.controller;e.styleController.targetedLockupStyleName=h.TypeLockupController.HIGHLIGHT_STYLE,e.autoApplyCharStyle(!1,!1,!1),V()&&ee(!1),e.selectCharStyleForma(),te(t)})),o.events.publish("enter-char-style-mode")}},o.exitCharStyleMode=function(){if(o.inCharStyleMode){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller;o.inCharStyleMode=!1,t.owner.selection.inCharStyleMode=!1,t.styleController.targetedLockupStyleName="",o.events.publish("text-forma-selected",{id:e.formaID,forma:e,selectionBoxes:[]}),o.events.publish("exit-char-style-mode")}}},o.exitCharStyleModeAndSelect=function(){if(o.inCharStyleMode){var e=o.getAllSelectedFormas();0!==e.length&&e[0].isTypeLockup()&&(o.exitCharStyleMode(),o.deselect({silent:!0}),o.selectForma({forma:e[0]}),o.events.publish("forma-selected",{id:e[0].formaID,forma:e[0],selectionBox:G()}))}},o.toggleCharStyleLinesMethods=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller;switch(t.highlightMethod){case h.HighlightMethod.EvenRows:t.highlightMethod=h.HighlightMethod.OddRows;break;case h.HighlightMethod.OddRows:t.highlightMethod=h.HighlightMethod.Bracket;break;case h.HighlightMethod.Bracket:t.highlightMethod=h.HighlightMethod.InsideBracket;break;default:t.highlightMethod=h.HighlightMethod.EvenRows}ne(t,e)}},o.toggleCharStyleWordsMethods=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller;t.highlightMethod===h.HighlightMethod.EvenWords?t.highlightMethod=h.HighlightMethod.OddWords:t.highlightMethod=h.HighlightMethod.EvenWords,ne(t,e)}},o.clearStyleRanges=function(){var e=o.getSelectedForma();return X(e&&e.isTypeLockup(),h.UserActions.ModifyStyleRanges(),(function(){var t=e.controller;t.clearCharStyle(),V()&&ee(!1),t.selectCharStyleForma()}))},o.getLayoutMargin=function(){var e=o.getGridForma();return null!=e?e.controller.margin:0},o.getLayoutSpacing=function(){var e=o.getGridForma();return null!=e?e.controller.spacing:0},o.setLayoutSpacing=function(e){return Q(new h.SetGridParametersAction(e,NaN)).then((function(){V()&&$(!1)}))},o.setLayoutMargin=function(e){return Q(new h.SetGridParametersAction(NaN,margin)).then((function(){V()&&$(!1)}))},o.createPaddedCollage=function(){return X(c.firstPage,h.UserActions.CreateCollage(),(function(){h.GridFacade.createPaddedCollage(c.firstPage)}))},o.setLayoutSpacingAndMargin=function(e,t){var n=NaN,o=NaN;return e>=0&&(n=e),t>=0&&(o=t),Q(new h.SetGridParametersAction(n,o)).then((function(){V()&&$(!1)}))},o.prepareForGridLayouts=function(){Q(new h.EnterGridLayoutModeAction)},o.inVisibleGridLayout=function(){var e=o.getGridForma();return null!=e&&e.style.gridCells.length>1},o.spacingChangesVisible=function(){var e=o.getGridForma();return null!=e&&e.controller.spacingChangesVisible},o.allowFlip=function(e){return e.controller.flippable},o.allowDuplication=function(e){return e.controller.duplicatable},o.allowCrop=function(e){return h.ImageFacade.canCropImage(e)},o.allowSetForeground=function(e){return h.ImageFacade.canSetFloatingImage(e)},o.allowSetBackground=function(e){return h.ImageFacade.canSetBackgroundImage(e)},o.allowDeletion=function(e){for(var t=!0,n=0;n<e.length;n++)if(!e[n].controller.deleteable){t=!1;break}return t},o.hasImageAttribution=function(e){if((e=e||o.getSelectedForma()).hasIntent(h.Forma.INTENT_ICON)||e.isImage()&&!e.isLogo()){var n=o.getImageFormaAttributionInfo(e);if(t.isEmpty(n))return!1;var r=n.sourceName;if(r&&-1!==["unsplash","pixabay","flickr","adobe stock","the noun project","giphy"].indexOf(r.toLowerCase()))return!0}return!1},o.isIcon=function(e){return!!(e=e||o.getSelectedForma()).hasIntent(h.Forma.INTENT_ICON)},o.isGiphy=function(e){return o.getImageFormaAttributionInfo(e).sourceName==h.MediaMetadata.kMediaGiphySourceName},o.swapFormas=function(e,t){return X(o.getSelectedForma(),h.UserActions.SwapCells(),(function(){var n=o.getGridForma();null!=n&&(n.controller.swapGridChildren(e,t),ee(!0),o.selectForma({forma:e}))})).then((function(){var e=r.getCurrentTimelineIndex();e>0&&r.removeTimelineStateAtIndex(e-1)}))},o.formaOpacityChangeable=function(){var e=o.getSelectedForma();return!!e&&e.controller.opacityChangeable},o.getFormaOpacity=function(){return o.getSelectedForma().style.opacity},o.setFormaOpacity=function(e){return X(o.getSelectedForma(),h.UserAction.ChangeOpacity,(function(){var t=o.getSelectedForma();t.style.opacity=e,V()&&$(t)}))},o.isFormaSwappable=function(e){return!!o.getGridForma()&&(e.controller&&!e.controller.moveable&&"Root"!=e.kind)},o.getSwappableForma=function(){for(var e=[],t=c.firstPage.root.visitAsArray(h.FormaTraversal.PreOrder),n=0;n<t.length;n++){var r=t[n];if(o.isFormaSwappable(r)){var i={forma:r,formaID:r.formaID};"Shape"==r.kind&&(i.type="shape",e.push(i)),"Frame"==r.kind&&(i.type="frame",e.push(i))}}return e},o.setSwapMode=function(e,t){s=e;var n=o.getSelectedForma();if(n&&"Frame"===n.kind){var r=n.childAt(0);!s&&t&&d&&(F.info("disable swap mode ",d),r.placement=d,d=null)}},o.getPointInDocumentSpace=function(e,t){var n=o.getDocumentSize(),r=n.width*e,i=n.height*t;return new h.TheoPoint(r,i)},o.getDesignHeight=function(){return o.getSelectedForma().root.finalFrame.height},o.getFormaSize=function(e){return W(e)},o.getDocumentMetadataEvents=function(){return h.TheoDocumentUtils.getMetadataEvents(c,!1)},o.getAllDesignIngredientIDsAndTypes=function(){return h.TheoDocumentUtils.getAllDesignIngredientIDsAndTypes(c)},o.getFormaCountsByType=function(){return h.TheoDocumentUtils.getFormaCountsByType(c)},o.getContentCountsString=function(){return h.TheoDocumentUtils.getContentCountsString(c)},o.getAppliedVariationTemplateId=function(){return h.TheoDocumentUtils.getAppliedVariationTemplateId(c)},o.getAppliedLayoutId=function(){return h.TheoDocumentUtils.getAppliedLayoutId(c)},o.getMaxGridCells=function(){return h.GridController.MAX_CELL_COUNT},o.setPersistSave=function(e){return(w=e).initialize()},o.whenInitialized=function(){return k},o.updateColorInTheme=function(e,t){var n=g.solidColor2TheoColor(g.hex2SolidColor(e.color),e.id,e.roles),r=g.solidColor2TheoColor(g.hex2SolidColor(t.color),t.id,t.roles),i=c.firstPage.colorLibraryController.getKeyOfColorInTheme(n);return X(i,h.UserActions.ModifyColorTheme(),(function(){c.firstPage.colorLibraryController.setTheoColorToLibrary(r,i),o.lockupFormas().forEach((function(e){e.style.characterStyles.Highlight&&e.controller.styleChanged()}))}))},o.isSparkColorInUse=function(e){return c.firstPage.colorLibraryController.isSparkColorInUse(e)},o.updateSparkColor=function(e){return c.firstPage.colorLibraryController.isSparkColorInUse(e.sparkElementID)?X(!0,h.UserActions.AddBranding(),(function(){c.firstPage.colorLibraryController.updateSparkColor(e)})):n.resolve()},o.areSparkFontsInUse=function(e){return h.TheoBrandkitUtils.areSparkFontsInUse(c,e)},o.updateSparkFont=function(e){return h.TheoBrandkitUtils.areSparkFontsInUse(c,[e.id])?X(!0,h.UserActions.AddBranding(),(function(){h.TheoBrandkitUtils.updateSparkFont(c,e)})):n.resolve()},o.relinkSparkFont=function(e,t){return h.TheoBrandkitUtils.areSparkFontsInUse(c,[e])?X(!0,h.UserActions.AddBranding(),(function(){h.TheoBrandkitUtils.relinkSparkFont(c,e,t)})):n.resolve()},o.areSparkLogosInUse=function(e){return h.TheoBrandkitUtils.areSparkLogosInUse(c,e)},o.updateSparkLogo=function(e){return h.TheoBrandkitUtils.areSparkLogosInUse(c,[e.id])?X(!0,h.UserActions.AddBranding(),(function(){h.TheoBrandkitUtils.updateSparkLogo(c,e)})):n.resolve()},o.relinkSparkLogo=function(e,t){return h.TheoBrandkitUtils.areSparkLogosInUse(c,e)?X(!0,h.UserActions.AddBranding(),(function(){h.TheoBrandkitUtils.relinkSparkLogo(c,e,t)})):n.resolve()},o.brandDocument=function(e){var t=e.fonts&&e.fonts.length,n=e.logos&&e.logos.length,o=e.colors&&e.colors.length;return Q(new h.BrandifyAction(e,t,n,o))},o.changeBranding=function(e){return Q(new h.ChangeBrandingAction(e))},o.handleCurrentBrandChanged=function(e){o.events.publish("current-brand-changed",e)},o.addBranding=function(e){return p.setCoreWrapper(this),y.doAction(c,new h.AddBrandingAction(e))},o.stripBranding=function(){return X(!0,h.UserActions.RemoveBranding(),()=>h.BrandingFacade.removeBranding(c))},o.getBrandedElementsUsage=function(){return h.TheoBrandkitUtils.getDocumentBrandedElementsUsage(c,!0,!1)},o.includesUploadedFonts=function(){return o.getBrandedElementsUsage().indexOf(h.TheoBrandkitUtils.kBrandUsageCustomFont)>-1},o.getFontsUsed=function(){return h.TheoDocumentUtils.getFontsUsed(c)},o.getDocFontSourceUsage=function(){return h.TheoDocumentUtils.getFontSourceUsage(c)},o.getWatermarkEnabledForDoc=function(){return c?!("watermarkEnabled"in c)||c.watermarkEnabled:(F.error("Attempting to set watermarkEnabled with no document loaded."),!1)},o.setWatermarkEnabledForDoc=function(e){if(c){var t=o.beginTransaction("setWatermarkEnabledForDoc");c.watermarkEnabled=e,o.endTransactionAndMergeWithPrevious(t)}else F.error("Attempting to set watermarkEnabled with no document loaded.")},o.getImageFormaAttributionInfo=function(e){return e&&(t=e.kind===h.ImageForma.KIND||e.hasIntent(h.Forma.INTENT_ICON)?e.contentNode:e.childAt(0).contentNode)&&t.mediaMetadata||{};var t},o.setAuthoringContextThemeId=function(e){var t=o.beginTransaction("set branded template ID");c.authoringContextThemeID=e,o.endTransactionAndMergeWithPrevious(t)},o.getAuthoringContextThemeId=function(){return c.authoringContextThemeID},o.updateConstrainedImages=function(){h.TheoDocumentUtils.updateConstrainedImageInfo(c)},o.getConstrainedImages=function(){return c.constrainedImages},o.getUnreportedNounProjectIds=function(){return h.TheoDocumentUtils.getUnreportedUsedIcons(c)||[]},o.setNounProjectIdsReported=function(e){var t=o.beginTransaction("setNounProjectIdsReported");h.TheoDocumentUtils.reportedIconUsage(c,e),o.endTransactionAndMergeWithPrevious(t)},o.getHighlightMethodEnum=function(){return h.HighlightMethod},o.synthesizeEmptyImages=function(){c.content.root.visitAll((function(e){if("image"===e.kind&&null==e.url){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.pixelWidth,t.height=e.pixelHeight;var o=n.createLinearGradient(0,0,t.width,t.height),r=e.imageColorData;r.sort((function(e,t){return e.coverage<t.coverage?1:e.coverage>t.coverage?-1:0})),r.length>1?(o.addColorStop(0,"#"+r[0].rgbColor.hex.substring(0,6)),o.addColorStop(1,"#"+r[1].rgbColor.hex.substring(0,6))):(o.addColorStop(0,"#000"),o.addColorStop(1,"#fff")),n.fillStyle=o,n.fillRect(0,0,t.width,t.height),e.componentID=h.GUIDUtils.makeGUID(),e.url=t.toDataURL()}}))},o.setRemixParentCpId=function(e){c.setRemixParentCpId(e)},o.getRemixParentsCpIds=function(){return c.remixAncestorsCpAssetIDs},o.getRemixAncestorsIntoMachineTags=function(e){return e=(e=e||[]).filter((function(e){return-1===e.indexOf("_REMIX_")})),e=t.union(e,c.getRemixAncestorsCpMachineTags())},o.getEditorModelColorSelection=function(){var e=c.controller.model.attributes.find(h.ColorAttribute.KEY);return e?e.colors:[]},o.handlePointerChanged=function(e){var t=new h.TheoPoint(e.x,e.y),n="touch"===e.pointerType?1:0,o=p.async.getSystemUptimeInSeconds(),r=new h.PointerUpdate(""+e.pointerId,n,c.firstPage,t,o);r.tapCount=e.tapCount,r.modifierKeys=e.modifierKeys,"pointerDown"===e.updateType?c.controller.pointers.onPointersDown([r]):"pointerMove"===e.updateType?c.controller.pointers.onPointersMoved([r]):"pointerUp"===e.updateType&&c.controller.pointers.onPointersUp([r])},o.setViewScale=function(e){c.controller.viewScale=e},o.getViewScale=function(){return c.controller.viewScale},o.getSettableFeatures=function(){var e={},t=c.controller.model.featureSets.find(h.AlignSpacingAttributesFeature.KEY);e.canAlign=t&&t.canAlign,e.canDistribute=t&&t.canDistribute;var n=c.controller.model.featureSets.find(h.OpacityAttributesFeature.KEY);e.opacity=!!n;var o=c.controller.model.featureSets.find(h.ImageFeature.KEY);return e.imageFilter=!!o&&o.canApplyFilter,e},o.getAlignmentTypes=function(){return h.AlignmentType},o.getDistributeTypes=function(){return h.DistributeType},o.setOpacityForSelectedFormae=function(e){return Q(new h.SetOpacityAction(e))},o.getOpacityValuesForSelectedFormae=function(){return c.controller.model.attributes.find(h.OpacityAttribute.KEY).opacities},o.setAlignmentForSelectedFormae=function(e){return Q(new h.AlignFormaeAction(e))},o.distributeSelectedFormae=function(e){return Q(new h.DistributeFormaeAction(e))},o.animate=function(){o.events.publish("animate")},o.downloadAnimation=function(){o.events.publish("download-animation")},o.beginTransaction=function(e){return c.beginTransaction(e||"unknown")},o.endTransactionAndMergeWithPrevious=function(e){return e.mergeWithPrevious()},o.endTransaction=function(e){return e.end()},o.containsBrandedContent=function(){return h.BrandingFacade.doesDocumentContainBrandedElements(c,!1)},o.updateCharStyleRanges=function(e,t){return Q(new h.UpdateCharStyleRangeAction(coreWrapper.getSelectedForma(),e,t))},o.missingFontListInDoc=function(){return c.missingFontList},o.setCPProjectID=function(e){c&&(tr=o.beginTransaction("setCPProjectID"),c.publishedResourcePath=e,o.endTransactionAndMergeWithPrevious(tr))},o.setCommunityPlatformAlias=function(e){c&&(tr=o.beginTransaction("setCommunityPlatformAlias"),c.communityPlatformAlias=e,o.endTransactionAndMergeWithPrevious(tr))},o.setCommunityPlatformAssetID=function(e){c&&(tr=o.beginTransaction("setCommunityPlatformAssetID"),c.communityPlatformAssetID=e,o.endTransactionAndMergeWithPrevious(tr))},o.setPublishedEtag=function(e){c&&(tr=o.beginTransaction("setPublishedEtag"),c.publishedEtag=e,o.endTransactionAndMergeWithPrevious(tr))},o.getIsExported=function(){return c?c.isExported:null},o.setIsExported=function(e){c&&(tr=o.beginTransaction("setIsExported"),c.isExported=e,o.endTransactionAndMergeWithPrevious(tr))},o.replaceCorruptImageFrames=function(){const e=[];let t;c.content.root.visitAll(n=>{"image"===n.kind&&(n.url&&"data:"!==n.url.substr(0,"data:".length)||(t||(t=o.beginTransaction("removeCorruptContentNodes")),e.push(n.id),n.parent&&n.parent.removeChild(n),n.releaseResources()))});const n=e.length>0;if(0===e.length)return n;const r=o.imageFormas().filter(t=>e.indexOf(t.contentID)>=0);if(r.length){const e=g.solidColor2TheoColor(g.hex2SolidColor("FF0000"),null,null);h.ImageFacade.replaceImagesWithColors(r,[e])}return t&&(t=o.endTransactionAndMergeWithPrevious(t)),n},function(){T=e.persistSource||m.fromDocument(e.dcxDoc),w=e.persistSave||f.toDocument(e.dcxDoc);var i=!1;k=T.open().then((function(e){return(i=e.hadMissingFontsWhenOpened)?v.loadMissingFonts(e.missingFontList):e})).then((function(e){return i?T.open():e})).then((function(e){return i=e.hadMissingFontsWhenOpened,(c=e).controller.selection.subscribeWithCallback(q,h.SelectionStateChangedMessage.TYPE),w.initialize()})).then((function(){var e=o.beginTransaction("create-grid-controller");if(c.firstPage.root.controller.createGridControllerIfNone(),o.endTransactionAndMergeWithPrevious(e),i){var a=o.beginTransaction("update missing fonts");o.lockupFormas().forEach((function(e){e.controller.updateGroup(),e.controller.updateScoring()})),o.endTransactionAndMergeWithPrevious(a)}return(r=c.controller.undoRedoMgr).reset(),c.controller.designControllerHandlesPointers=!0,r.subscribeWithCallback((function(e){if("state-changed"===e.changeType){ee();var t=o.getSelectedForma(),n=o.getSelectedFormaId();n&&(o.inCharStyleMode&&t.isTypeLockup()?(t.controller.selectCharStyleForma(),te(t)):(o.exitCharStyleMode(),o.events.publish("forma-selected",{id:n,forma:t,selectionBox:G()}))),o.events.publish("undo-redo-state-changed"),R(),M()}else"state-updated"===e.changeType?(ee(!1),M()):"timeline-changed"===e.changeType&&o.events.publish("undo-redo-state-changed")}),h.UndoRedoMessage.TYPE),r.registerPatch((function(e){return(o=n(),t.each(A,(function(e){o=o.then((function(){return e()}))})),o).then((function(){e()}));var o})),o.events.publish("undo-redo-state-changed"),b=!0,R(),!0}))}(),o}}.apply(t,o))||(e.exports=r)},"7the":function(e,t,n){var o,r;o=[n("xeH2"),n("YLtl"),n("UFvF"),n("MOGj"),n("a8ov")],void 0===(r=function(e,t,n,o,r){var i=r.default,a={},c=window.location.protocol+"//"+window.location.host;return a.loadFile=function(e,t){var r=n.defer();return o.dcxService.invoke("GET",c+i.decodeUrl(e),{},null,t,(function(e,t){e?r.reject(e):r.resolve(t.response)})),r.promise},a}.apply(t,o))||(e.exports=r)},"8VGm":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return h}));var o=n("MGCh"),r=n.n(o),i=n("b3Wv"),a=n.n(i),c=n("a8ov"),l=n("UzQk"),s=n("14LO");function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const d=n("UFvF"),p=r.a.channel("SourceCPAsset");class h{constructor(e){u(this,"assetId",void 0),u(this,"cpServiceDomain",void 0),this.assetId=e.assetId,this.cpServiceDomain=e.cpServiceDomain}documentId(){return this.assetId}open(){return d(this.openAsync())}async openAsync(){const e=await a.a.loadComposite(this.assetId,this.cpServiceDomain);e.name="";const t=new s.DCXDocumentComposite({composite:e,componentURLfn:e=>c.default.encodeCPUrl(this.assetId,e.absolutePath),overrideIDfn:e=>l.GUIDUtils.makeGUID()});var n,o=t.current;if(l.DocumentPersistenceFactory.usesJsonDocumentEncoding(o)){const e=l.JSONDocumentDecoder.getRequiredSynchronousComponents(o);await Promise.all(e.map(async e=>{const t=c.default.encodeCPUrl(this.assetId,e),n=await a.a.loadFile(t,{});var r=JSON.parse(n);o.registerContentForComponent(e,r)}))}try{n=l.TheoDocument.decodeDocument(t,(function(e){throw o.releaseRegisteredContent(),new Error(e.join(";"))})),o.releaseRegisteredContent()}catch(e){throw p.error("decoding from CP",e),n=l.TheoDocument.createDefault(),e}return n.history.postEntry("open,src=CP,was-vers="+n.versionDecoded.rawValue),n}}},FGv1:function(e,t,n){"use strict";n.r(t),n.d(t,"DCXDocumentComponentDeferred",(function(){return a}));var o=n("1tmr"),r=n("UzQk"),i=n("nNj6");class a extends o.a{constructor(e,t,n){var o,r,i;super(e,t),i=void 0,(r="params")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.params=n}attachToNode(){}detachFromNode(){}get absolutePath(){return""}get componentId(){return this.params.componentId||""}get name(){return this.params.name}get path(){return this.params.path}get type(){return this.params.type}get etag(){return""}get relationship(){return this.params.relationship}get sourceHref(){return this.params.sourceHref}get mutableCopy(){return new a(this.branch,this.node,this.params)}replaceWithReal(e){if(!e||!e.etag)return r.CoreAssert.fail("replaceWithReal: you need to pass an AdobeDCXComponent"),null;const t=new i.a(this.branch,this.node,e);return this.update(t),t}}},LI3u:function(e,t,n){var o,r=n("MOGj"),i=n("yAe2"),a=n("YLtl"),c=n("MGCh").channel("ManifestEncoder");function l(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(o.id===t)return o}}(o=function(e,t){if(this.config=a.extend({},e),this.branch=e.branch,this.rootNode=e.rootNode||this.branch.rootNode,this.node=t||this.rootNode,this.componentBranch=e.componentBranch||this.branch,this.componentRootNode=e.componentRootNode||this.componentBranch.rootNode,this.componentNode=e.componentNode||this.node,this.isRoot=this.node==this.rootNode,this._nodes=[],this._components=[],this._stashedComponents=[],this._childMetadataEncoders={},this.isRoot){var n=this.componentBranch.getComponentsOf(this.componentRootNode),o=function e(t,n,o){if(!n)return t.allComponents();o=o||[];var r=t.getComponentsOf(n);return r&&r.length>0&&(o=o.concat(r)),t.getChildrenOf(n).forEach((function(n){o=e(t,n,o)})),o}(this.componentBranch,this.componentRootNode);c.info("stashing: begin (".concat(o.length," components, ").concat(o.length-n.length," not at root)"));for(var r=0;r<o.length;r++){var i=o[r];if(!l(n,i.id)){this._stashedComponents.push(i),c.info("stashing: moving component ".concat(i.id," to node ").concat(this.componentRootNode.absolutePath));try{this.componentBranch.moveComponent(i,this.componentRootNode)}catch(e){e&&e.message.indexOf("Component not found in this branch.")>=0?this._stashedComponents.pop():c.warn(e)}}}c.info("stashing: complete"),this.config.stashedComponents=this._stashedComponents;var s=this.branch.getChildrenOf(this.node);for(c.info("removing all ".concat(s.length," root nodes")),r=0;r<s.length;r++){var u=s[r];this.branch.removeChild(u)}}else this._stashedComponents=this.config.stashedComponents})._implements=function(e){return"IExportDataObject"==e||"IExportDataObjectDocument"==e},o.prototype=Object.create(Object.prototype,{_implements:{value:function(e){return"IExportDataObject"===e||"IExportDataObjectDocument"===e}},setName:{value:function(e){this.node?this.node.name=e:this.branch.name=e}},setType:{value:function(e){this.node.setValue("type",e)}},setPath:{value:function(e){this.node.setValue("path",e)}},setProperty:{value:function(e,t){e.indexOf("#")<0&&(e="theo#"+e),this._childMetadataEncoders[e]&&delete this._childMetadataEncoders[e],this.node.setValue(e,t)}},setOptionalStringProperty:{value:function(e,t){t&&this.setProperty(e,t)}},setStringProperty:{value:function(e,t){this.setProperty(e,t)}},setNumberProperty:{value:function(e,t){this.setProperty(e,t)}},setIntProperty:{value:function(e,t){this.setProperty(e,t)}},setBooleanProperty:{value:function(e,t){this.setProperty(e,t)}},setOptionalBooleanProperty:{value:function(e,t){this.setProperty(e,t)}},appendMetadata:{value:function(e){var t="theo#"+e;this.node.getValue(t)&&this.node.removeValue(t);var n=new i;return this._childMetadataEncoders[t]=n,n}},appendChild:{value:function(e){var t=(new r.AdobeDCXBranch).addChild(null,e),n=new o(this.config,t);return this._nodes.push(n),n}},appendComponent:{value:function(e,t,n,o){var r={parentId:e,id:t,url:n,mimeType:o,confirmed:!0};this._components.push(r)}},setManifestFormatVersion:{value:function(e){}},setManifestProperty:{value:function(e,t){this.setProperty(e,t)}},setDocumentSize:{value:function(e,t){}},setCompositeID:{value:function(e){}},prepareForAttachment:{value:function(){for(var e in this._childMetadataEncoders){var t=this._childMetadataEncoders[e].encodeData();this.node.setValue(e,t)}}},finalizeAfterAttachment:{value:function(e){this.isRoot&&c.info("unstashing: begin");for(var t=0;t<this._components.length;t++){var n=this._components[t];c.assert(n.id,"finalizeAfterAttachment: A recorded component has no ID.");var o=l(this._stashedComponents,n.id),r=!1;if(this.config.finalizingComponent&&(r=this.config.finalizingComponent(e,n,o)),o)if(this.componentNode==this.componentRootNode);else try{var i=this.node==this.componentNode?e:this.componentNode;c.info("unstashing: moving stashed component ".concat(o.id," to node ").concat(i.absolutePath)),this.componentBranch.moveComponent(o,i)}catch(e){c.warn("moveComponent to node failed: "+e)}else c.assert(r,"finalizeAfterAttachment: no existing component, and finalizingComponent not provided or did not indicate that's OK.")}for(t=0;t<this._nodes.length;t++){var a=this._nodes[t];a.prepareForAttachment();try{var s=a.node,u=this.branch.copyChild(s,e||this.node,t,s.path,s.id);a.finalizeAfterAttachment(u)}catch(e){c.warn("addChild to node failed: "+e)}}if(this.isRoot){c.info("unstashing: complete");var d=this.componentBranch.getComponentsOf(this.componentRootNode);for(t=0;t<this._stashedComponents.length;t++){var p=l(d,(n=this._stashedComponents[t]).id);p&&(c.info("dumping unused component "+p.path),this.config.removeUnusedComponent?this.config.removeUnusedComponent(n,p):this.componentBranch.removeComponent(p))}}}}}),o.prototype.constructor=o,e.exports=o},SdaB:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));n("kSzJ");var o=n("Lkow"),r=n("a8ov");const i=new o.PixiJSRenderer;function a(e,t,n){return i.liveViewService.createView(e,t,n)}i.assetLoader=new o.WebAssetLoader(r.default)},SxBq:function(e,t,n){var o,r;o=[n("k99a"),n("SdaB"),n("UzQk")],void 0===(r=function(e,t,n){var o,r=function(e){this.coreWrapper=e},i=null;function a(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return i||(i=t.default(1,!0)),Promise.resolve().then(()=>i.setWatermark(e)).then(()=>(function(e){return new Promise(t=>{setTimeout(t,e)})})(0)).then(()=>i)}return r.initialize=function(t){var r=!!(t=t||{}).skipLoadingAuthenticatedFeatures;if(!o){var i=new e;o=i.loadFeatures({skipLoadingAuthenticatedFeatures:r}).then((function(){return n.Host.setFeatureController(i),this}))}return o},r.prototype.renderToCanvas=function(e,t){const n=t.height||t.longestSide,o=t.width||t.longestSide;let r;return a(t.honorDocWatermarkProp&&this.coreWrapper.getWatermarkEnabledForDoc()).then(e=>(r=e,e.asyncRender(this.coreWrapper.getGraph(),o,n))).then(()=>r.headless.getExportCanvas()).then(t=>{const n=e.canvas;return n.width=t.width,n.height=t.height,e.drawImage(t,0,0)})},r.prototype.renderToBlob=function(e){const t=e.height||e.longestSide,n=e.width||e.longestSide;let o;return a(e.honorDocWatermarkProp&&this.coreWrapper.getWatermarkEnabledForDoc()).then(e=>(o=e,e.asyncRender(this.coreWrapper.getGraph(),n,t))).then(()=>o.getRenditionBlob(e.outputFormat,e.imageQuality))},r.prototype.render=function(e){const t=e.height||e.longestSide,n=e.width||e.longestSide;let o;return a(e.honorDocWatermarkProp&&this.coreWrapper.getWatermarkEnabledForDoc()).then(e=>(o=e,e.asyncRender(this.coreWrapper.getGraph(),n,t))).then(()=>o.getRenditionDataUrl(e.outputFormat,e.imageQuality))},r.prototype.renderStack=function(e){},r}.apply(t,o))||(e.exports=r)},ZLL8:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF")],void 0===(r=function(e,t){var n={doAction:function(e,n){if(e&&e.controller){var o=t.defer();return e.controller.doActionWithCompletion(n,(function(e){o.resolve(e)})),o.promise}return t.reject("No document or controller")},doSerial:function(e){var n=[];return e.forEach((function(e){t.isPromise(e)?n.push((function(){return t.promise((function(t){e.then(t)}))})):n.push(e)})),n.reduce(t.when,t([]))},delay:function(n){var o=[].slice.apply(arguments);o.shift();var r=t.defer();return e.delay((function(){r.resolve.apply(r,o)}),n),r.promise},delayThen:function(n){return function(){var o=[].slice.apply(arguments),r=t.defer();return e.delay((function(){r.resolve.apply(r,o)}),n),r.promise}}};return n}.apply(t,o))||(e.exports=r)},b2xK:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF")],void 0===(r=function(e,t){var n=function(e){e=e||{};var n={initialize:function(){return t.resolve(!0)},saveWithRenditions:function(e,n,o,r){return t.resolve(!0)},saveImageComponent:function(e){return t.resolve(null)}};return n};return n.toBlackHole=function(){return new n({})},n}.apply(t,o))||(e.exports=r)},b3Wv:function(e,t,n){var o,r;o=[n("xeH2"),n("YLtl"),n("UFvF"),n("MOGj"),n("a8ov")],void 0===(r=function(e,t,n,o,r){var i,a,c=r.default,l={},s=window.location.protocol+"//"+window.location.host,u=s+"/api/post/v1/cp/";function d(){!i&&o.dcx&&(i=o.dcx.createHTTPService((function(e){}))),!a&&o.dcx&&(a=o.dcx.createCommunitySession(i,u))}return d(),l.loadComposite=function(e,t){var r=n.defer(),i=t?"host/".concat(t,"/"):"",c="".concat(u).concat(i,"dcx/").concat(e,"/"),l=o.dcx.newCompositeWithHref(c);return d(),o.dcx.compositeXfer.pullCompositeManifestOnly(l,a,(function(e,t){!e&&t?(l.resolvePullWithBranch(t),r.resolve(l)):r.reject(e)})),r.promise},l.loadFile=function(e,t){var o=n.defer(),r=c.decodeUrl(e);return i.invoke("GET",s+r,{},null,t,(function(e,t){e?o.reject(e):o.resolve(t.response)})),o.promise},l}.apply(t,o))||(e.exports=r)},hEO4:function(e,t,n){var o,r;o=[n("MGCh"),n("UzQk")],void 0===(r=function(e,t){const n=e.channel("Diagnostics"),o={truncateEncodedDOM:function(e){const t=["theo#placement","theo#bounds","theo#style","theo#color-library","theo#saliency-data","theo#artwork","theo#image-color-data","theo#edge-data"],n=["type-lockup"];return function e(o){const r={},i=o["theo#controller-kind"];try{Object.keys(o).forEach(a=>{let c=o[a];t.indexOf(a)>=0?c="…".concat(JSON.stringify(c).length,"…"):"children"===a?c=i&&n.indexOf(i)>=0?"…".concat(JSON.stringify(c).length,"…"):c.map(t=>e(t)):"string"==typeof c&&(c=c.replace(/(.{8})-.{4}-.{4}-.{4}-.{12}/g,"$1…")),r[a]=c})}catch(e){r.error="threw "+e}return r}(e)},validateDOM:function(e){try{if(!e.children)return"no root children";4!==e.children.length&&n.warn("expected 4 root children");const t=e.children.find(e=>"forma-document"===e.path);if(!t)return"no forma document";if("application/vnd.adobe.theo.forma+dcx"!==t.type&&n.warn("forma doc did not have correct type",t.type),!t.children||1!==t.children.length)return"expected exactly one forma root";const o=t.children[0];if("Root"!==o["theo#kind"])return"root forma did not have kind Root";if("root"!==o["theo#controller-kind"])return"root forma did not have controller kind root";if(!o.children||0===o.children.length)return"root forma did not have children";if(window.simulate_bad_dom){delete o.children.find(e=>"group"===e["theo#kind"]&&"grid"===e["theo#controller-kind"])["theo#controller-kind"]}const r=o.children.find(e=>"group"===e["theo#kind"]&&"grid"===e["theo#controller-kind"]);if(!r)return"root forma did not have a grid child";if(!r.path)return"grid is missing path property"}catch(e){return"validation threw: "+e}return null},findGrid:function(e){if(!e)return n.error("findGrid: document is null"),null;const t=e.firstPage.root;if(!t||0===t.childCount)return n.error("findGrid: root has no children"),null;const o=t.children_.find(e=>"group"===e.kind&&e.controller&&"grid"===e.controller.kind);return o||(1===t.children_.length?(n.error("findGrid: assuming the sole child of the root is the grid; it's not the correct kind"),t.children_[0]):(n.error("findGrid: root unexpectedly had more than one child and none looked like a grid"),null))},dumpPostDOM:function(e){return function e(n){try{const o={id:n.formaID,kind:n.kind},r=n.controller;if(r&&(o.ckind=r.kind),n instanceof t.GroupForma){const r=n.visitAsArray(t.FormaTraversal.JustChildren);o.children=r.map(t=>e(t))}return o}catch(e){return{error:"threw"+e}}}(e.firstPage.root)},dumpStateDelta:function(e,t,n){t=t||10,n=n||1e4;const o=[];try{const r=e.database;let i=0,a=r.currentState.state;for(;a&&i<t;){const e={guid:a.guid,gen:a.generation_};try{e.deltas=Object.keys(a.objectStates).map(e=>{const t=a.objectStates[e];return{id:e,cls:t.className,props:Object.keys(t.properties||{}).join(",")}})}catch(t){e.error="threw "+t}if(o.push(e),JSON.stringify(o).length>n&&(e.summary="".concat(e.deltas.length," objects mutated"),delete e.deltas,JSON.stringify(o).length>n)){o.pop();break}a=a.basedOn,i++}}catch(e){o.push({error:"state enumeration threw "+e})}return o},dumpUndoRedo:(e,t)=>{t=t||80;const n={states:[]};try{e.controller.undoRedoMgr.timeline.states.forEach(e=>{const o={};e.action&&(o.action=e.action.description),e.state&&e.state.state&&(o.guid=e.state.state.guid),e.beginSelectedFormaIDs&&(o.bfids=e.beginSelectedFormaIDs.concat()),e.endSelectedFormaIDs&&(o.efids=e.endSelectedFormaIDs.concat()),n.states.push(o),n.states.length>t&&n.states.shift()})}catch(e){n.error="throw: ".concat(e)}return n},snapshotFormaHistory:(e,t)=>{if(!t)return{error:"nil object"};const n=[];try{let o=t.state;for(;o;){const r={};Object.keys(o.properties).forEach(e=>{const t=o.properties[e];t.isArray?r[e]="array(".concat(t.value.length,")"):t.isDictionary?r[e]="object(".concat(Object.keys(t.value).join(","),")"):r[e]="".concat(t.schemaType,"(").concat(t.value,")")});const i=[];let a=e.database.currentState.state;for(;a;)a.objectStates[t.id]===o&&i.push(a),a=a.basedOn;n.push({props:r,dbStates:i.map(e=>e.guid)}),o=o.basedOn}}catch(e){n.push("throw ".concat(e))}return{kind:t.kind,id:t.formaID,ckind:t.controller?t.controller.kind:"no controller",states:n}},monitorTransactionsForDocument:function(e){const t=[];let r=!1;const i=(e,o)=>{try{r=!0;const i={msg:e,recent:t.concat()};void 0!==o&&(i.err=o);try{throw new Error}catch(e){i.stack=e.stack}n.error("grid validation failed",i)}catch(e){n.error("monitorTransactionsForDocument throw",e)}},a=n=>{try{if(r)return;if(t.push({event:n,history:o.snapshotFormaHistory(e,e.firstPage.root.childAt(0))}),t.length>10&&t.shift(),window.simulate_db_validation_failure)i("simulated failure"),r=!1;else if(1!==e.firstPage.root.childCount)i("root has ".concat(e.firstPage.root.childCount," children"));else{const t=e.firstPage.root.childAt(0);"group"!==t.kind?i("grid has kind ".concat(t.kind)):t.controller?"grid"!==t.controller.kind&&i("grid has controller kind ".concat(t.controller.kind)):i("grid has kind ".concat(t.kind))}}catch(n){i("throw validating",n)}};e.database.addListener({onBeginTransaction:(e,t)=>a("beginT ".concat(t.name)),onEndTransaction:(e,t)=>a("endT ".concat(t.name)),onStateChanged:(e,t)=>{},onObjectStateChanged:(e,t)=>{}})}};return o}.apply(t,o))||(e.exports=r)},jiRT:function(e,t,n){var o;(o=function(e){this.data=e}).prototype=Object.create(Object.prototype,{id:{get:function(){return this.property("id")}},type:{get:function(){return this.property("type")}},name:{get:function(){return this.property("name")}},path:{get:function(){return this.property("path")}},property:{value:function(e){return this.data[e]}},optionalStringProperty:{value:function(e){return this.data[e]}},stringProperty:{value:function(e,t){var n=this.data[e];return null==n?t:n}},numberProperty:{value:function(e,t){var n=this.data[e];return null==n?t:n}},intProperty:{value:function(e,t){var n=this.data[e];return null==n?t:n}},booleanProperty:{value:function(e,t){var n=this.data[e];return null==n?t:n}},optionalBooleanProperty:{value:function(e){return this.property(e)}},metadata:{value:function(e){var t=this.data[e];if(t)return new o(t)}},forEachChild:{value:function(e,t){}},forEachComponent:{value:function(e,t){}}}),o.prototype.constructor=o,e.exports=o},mwMu:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF"),n("2ofD"),n("MGCh"),n("a8ov"),n("UzQk"),n("r3b0"),n("14LO")],void 0===(r=function(e,t,n,o,r,i,a,c){var l=r.default,s=c.DCXDocumentComposite,u=o.channel("SourceCCStorage"),d=["id","local","manifest-format-version","name","projectContext#npwMethod","state","type","authctx#ctxid"],p=function(e){var o={},r=(e=e||{}).dcxDoc||n.currentDoc,c=e.branch||r.getDCXComposite().current,p=e.rootNode||c.root,h=e.domComponentPath;return o.open=function(){return(h?r.getComponent(p.absolutePath+"/"+h).then((function(e){var t,n=JSON.parse(e),o=new a({makeComponentUrl:function(e){return l.encodeComponentUrl(r.id,e.id,e.type)},manufactureComponentsForNode:function(e){var t=e&&e["theo#external-url"];return t?[{id:i.GUIDUtils.makeGUID(),url:t,mimeType:e["theo#mimetype"]}]:null},trackAbsolutePath:!0,branch:n});try{(t=new i.TheoDocument.newDocumentFromDataObject(o,(function(e){throw new Error(e.join(";"))}))).history.postEntry("open,src=AC,was-vers="+t.versionDecoded.rawValue),p.name&&(t.documentName=p.name)}catch(e){throw u.error("acOpen",e),t=new i.TheoDocument.createDefault,e}return t})):c===r.getDCXComposite().current?function(){var e,n,o=r.getDCXRoot();if(o._data.children)e=new s({composite:r.getDCXComposite()});else{for(var a in o._data)o._data.hasOwnProperty(a)&&-1===d.indexOf(a)&&console.error("unexpecte property: "+a+" found when creating a new doc.");e=null}n=e&&e.current;let c=t.resolve();return n&&i.DocumentPersistenceFactory.usesJsonDocumentEncoding(n)&&(c=c.then(()=>{const e=i.JSONDocumentDecoder.getRequiredSynchronousComponents(n);return t.all(e.map(e=>r.getComponent(e).then((function(t){var o=JSON.parse(t);n.registerContentForComponent(e,o)}))))})),c.then(()=>{var t;try{t=e?i.TheoDocument.decodeDocument(e,(function(e){throw n.releaseRegisteredContent(),new Error(e.join(";"))})):new i.TheoDocument.createDefault,n&&n.releaseRegisteredContent(),t.history.postEntry("open,src=CC,was-vers="+t.versionDecoded.rawValue)}catch(e){throw u.error("coreOpen",e),e}return t})}():function(){var e,n=c._data,o=new a({makeComponentUrl:function(e){return l.encodeComponentUrl(r.id,e.id,e.type)},trackAbsolutePath:!1,branch:n,rootNode:p});try{e=new i.TheoDocument.newDocumentFromDataObject(o,(function(e){throw new Error(e.join(";"))}))}catch(e){return u.error("decoding from nodes",e),t.reject(e)}return t.resolve(e)}()).then(e=>e)},o.documentId=function(){return r.id},o};return p.fromDocument=function(e){return new p({dcxDoc:e})},p.fromTemplate=function(e,t){return new p({dcxDoc:e.composite,rootNode:t,domComponentPath:"dom.json"})},p}.apply(t,o))||(e.exports=r)},nNj6:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n("1tmr"),r=n("UzQk");class i extends o.a{constructor(e,t,n){var o,r,i;super(e,t),i=void 0,(r="dcxComponent")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.dcxComponent=n}attachToNode(){if(this.branch.dcxBranch.getComponentsOf(this.node.dcxNode).indexOf(this.dcxComponent)<0)try{this.branch.dcxBranch.moveComponent(this.dcxComponent,this.node.dcxNode)}catch(e){r.CoreAssert.fail("attachToNode: moveComponent() failed",e)}}detachFromNode(){this.branch.dcxBranch.getComponentsOf(this.node.dcxNode).indexOf(this.dcxComponent)>=0&&this.branch.retireComponent(this.dcxComponent)}get absolutePath(){return this.dcxComponent.absolutePath||""}get componentId(){return this.dcxComponent.id||""}get name(){return this.dcxComponent.name}get path(){return this.dcxComponent.path}get type(){return this.dcxComponent.type}get etag(){return this.dcxComponent.etag}get relationship(){return this.dcxComponent.relationship}get sourceHref(){return null}get mutableCopy(){return new i(this.branch,this.node,this.dcxComponent)}}},qnb0:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF"),n("MOGj"),n("2ofD"),n("MGCh"),n("a8ov"),n("UzQk"),n("b3Wv"),n("7the"),n("LI3u"),n("DIoP"),n("uTW7"),n("FGv1"),n("hEO4")],void 0===(r=function(e,t,n,o,r,i,a,c,l,s,u,d,p,h){var m=i.default,f=r.channel("SaveCCStorage"),g=function(e,t){var n=e&&e.absolutePath;return n&&"/"!==n?n+"/"+t:"/"+t},v=function r(i){var v={},y=(i=i||{}).dcxDoc||o.currentDoc,C=i.branch||y.getDCXComposite().current,S=i.rootNode||C.rootNode,F=i.domComponentPath,b=i.isAuthoringContext||!!F,k=i.copyExternalImages,I=i.commitChanges||r.CommitChanges.AUTO,T=C.addElement("retirement","foo","retirement"),w=C.getChildWithAbsolutePath("/retirement");C.removeChild(w);var A={};function D(e,t){return"".concat(e,":").concat(t)}var P=[];function x(e,n){var o=b?e:e+".jpg";f.info("saving rendition "+o);var r=g(S,o);return y.pushComponentWithRetry({name:e,path:o,absolutePath:r,isUpdate:P.indexOf(r)>=0,relationship:"rendition",file:n,type:n.type,parent:S}).then((function(e){return f.info("finished saving rendition "+o),e})).catch((function(e){return f.error("error while saving image rendition",e),u.publish("post:saveCCStorageAttempt",{contextualData1:"path:"+o,contextualData2:"success:"+!1}),t.reject(e)}))}function L(){var e=C.getChildWithAbsolutePath(g(S,"assets"));return e||((e=C.addChild(void 0,void 0,0,S)).path="assets"),e}function N(e,o,i){f.info("legacyACSave: begin"),f.assert(i,"legacyACSave: expected a thumbnail rendition"),f.assert(F,"legacyACSave: expect to get here only with a domComponentPath"),f.assert(b,"legacyACSave: expect to get here only for legacy AC saving");var c,l=[],d=y.getDCXComposite().current,p={finalizingComponent:function(e,t,n){var o=A[D(t.id,t.url)]||t.url;return m.isEncodedCPUrl(o)||m.isEncodedAuthoringContextUrl(o)||(o.indexOf("theo-web/images")>=0?f.warn("legacyACSave: recording this url as external",o):f.error("legacyACSave: recording this url as external",o)),e.setValue("theo#external-url",o),!0},removeUnusedComponent:function(e,t){T.getComponentWithId(t.id)?f.info("not retiring component ".concat(t.id," because we already have a")):(f.info("retiring component ".concat(t.id)),T.copyComponent(t)),d.removeComponent(t)}};c=new n.AdobeDCXBranch,p.branch=c,p.componentBranch=d,p.componentRootNode=S,p.componentNode=L();try{f.info("encoding composite"),e.history.postEntry("save,dst=AC");var h=new s(p);e.encode(h),h.prepareForAttachment(),h.finalizeAfterAttachment()}catch(e){throw f.error("error during encoding",e),err}const v=[];return o&&l.push(x("preview",o).then((function(e){v.push(e)}))),i&&l.push(x("thumbnail",i).then((function(e){v.push(e)}))),c&&l.push(function(e,n,o){f.info("saving dom "+n);var r=g(S,n);return y.pushComponentWithRetry({name:e,path:n,absolutePath:r,isUpdate:P.indexOf(r)>=0,relationship:"dom",type:"application/vnd.adobe.adobesparkpost.dom+json",file:JSON.stringify(o),parent:S}).then((function(e){return f.info("finished saving dom "+n),e})).catch((function(e){return f.error("error while saving dom",e),u.publish("post:saveCCStorageAttempt",{contextualData1:"path:"+n,contextualData2:"success:"+!1}),t.reject(e)}))}("dom",F,c._data)),t.all(l).then((function(){S.setValue("theo#last-modified",(new Date).toISOString());var n=e.documentName;return S.name=n===a.TheoDocument.DEFAULT_NAME?"":n,U(v),I===r.CommitChanges.NEVER?(f.info("legacyACSave: complete; not saving, per client"),t.resolve()):(f.info("legacyACSave: saving changes"),y.saveChanges((function(){})).then(()=>f.info("legacyACSave: complete")))}))}function U(t){e.each(e.filter(y.getDCXComposite().current.getComponentsOf(S),(function(e){return"rendition"===e.relationship&&t.indexOf(e)<0})),(function(e){f.info("removing stale rendition component",e.id),y.getDCXComposite().current.removeComponent(e)}))}function O(e,n,o,i){f.info("coreSave() begin");var c=new d.DCXDocumentBranch({branch:y.getDCXComposite().current,retiredElement:T}),l=a.DocumentPersistenceFactory.encoderFor(c);try{"string"==typeof i?e.encodeStateByID(i,l):e.encode(l),l.finish()}catch(e){throw f.error("coreSave() threw during encoding process",e),e}const s=[],m=[],v=c.getDeferredComponents(),C=v.find(e=>"dom"===e.relationship);if(C){const n=C.params.content,o=h.validateDOM(n);if(o){f.error("validation failure '".concat(o,"'; encoded="),h.truncateEncodedDOM(n)),f.error("validation failure '".concat(o,"'; document="),h.dumpPostDOM(e)),f.error("validation failure '".concat(o,"'; delta="),h.dumpStateDelta(e)),f.error("validation failure '".concat(o,"'; undoredo="),h.dumpUndoRedo(e));const r=h.findGrid(e);return f.error("validation failure '".concat(o,"'; gridhist="),h.snapshotFormaHistory(e,r)),t.reject(o)}}return v.forEach(e=>{s.push(function(e){f.assert(e instanceof p.DCXDocumentComponentDeferred);var n=e.params,o=g(n.node,n.path);return f.info("saving deferred component ".concat(n.name," at ").concat(o)),y.pushComponentWithRetry({name:n.name,path:n.path,absolutePath:o,isUpdate:P.indexOf(o)>=0,relationship:n.relationship,file:JSON.stringify(n.content),type:n.type,parent:n.node.dcxNode}).then((function(t){return f.info("finished saving component "+n.path),e.replaceWithReal(t),t})).catch((function(e){return f.error("error while saving component",e),u.publish("post:saveCCStorageAttempt",{contextualData1:"path:".concat(path),contextualData2:"success:".concat(!1)}),t.reject(e)}))}(e))}),n&&s.push(x("preview",n).then((function(e){m.push(e)}))),o&&s.push(x("thumbnail",o).then((function(e){m.push(e)}))),f.info("coreSave waiting on ".concat(s.length," asynchronous operations")),t.all(s).then(()=>(U(m),I==r.CommitChanges.NEVER?t.resolve():(f.info("coreSave: requesting doc.saveChanges()"),y.saveChanges((function(){}))))).then(()=>{f.info("coreSave() finished")})}return v.initialize=function(){return t.resolve(!0)},v.documentId=function(){return y.id},v.saveImageComponent=function(e,n,o,r,i){n=n||"image/jpeg",o=o||L();var c="";"image/jpeg"===n?c=".jpg":"image/png"===n?c=".png":"image/svg"!==n&&"image/svg+xml"!==n||(c=".svg");var l=a.GUIDUtils.makeGUID()+c,s={name:i||"image",relationship:"image",type:n,path:l,absolutePath:g(o,l),parent:o};return r&&(s.id=r),e instanceof Blob?s.file=e:(s.copyFrom={source:e.source,assetId:e.assetId},e.source||f.error("save-ccstorage saveImageComponent imageFile.source is falsy, assetId:  "+e.assetId)),f.info("pushing component "+l),y.pushComponentWithRetry(s).then((function(e){return f.info("pushed component "+l),{component:e,encodedUrl:b?m.encodeAuthoringContextUrl(y.id,e.id,null,n):m.encodeComponentUrl(y.id,e.id,n)}})).catch((function(e){return f.error("save-ccstorage saveImageComponent failed with",e),u.publish("post:saveCCStorageAttempt",{contextualData1:"path:"+l,contextualData2:"success:"+!1}),t.reject(e)}))},v.saveWithRenditions=function(n,o,r,i){var s,u=n.beginTransaction();return a.TheoDocumentUtils.pruneOrphanedContent(n),s=y.getDCXComposite().current.allComponents()||[],P=s.map(e=>e.absolutePath),(k?function(n){const o=[];return n.content.root.visitAll((function(e){e instanceof a.URLBasedContentNode&&o.push(e)})),t.all(e.map(o,(function(e){let t=e.url;if(!t||!e.componentID){const n=e instanceof a.VectorContentNode;return f.assert(n||t,"doCopyExternalImages: should have a valid url"),f.assert(n||e.componentID,"doCopyExternalImages: should have a valid componentID"),null}t=A[D(e.componentID,t)]||t,t!=e.url&&f.info("doCopyExternalImages: applying domain-map of ".concat(e.url," to ").concat(t));let n=null;if(m.isEncodedCPUrl(t))"all"===k?(f.info("pulling CP image ".concat(t," for componentID ").concat(e.componentID)),n=c.loadFile(t,{responseType:"blob"})):f.info("not pulling CP image ".concat(t," because caller didn't ask us to"));else if(m.isEncodedAuthoringContextUrl(t)){m.decodeAuthoringContextUrlParameters(t).assetId!==y.id?(f.info("pulling AC image",t),n=l.loadFile(t,{responseType:"blob"})):f.info("not pulling AC image ".concat(t," because it's already in this AC"))}else if(m.isEncodedComponentUrl(t)){const e=m.decodeComponentUrlParameters(t);e.docId!==y.id&&(t=m.encodeComponentUrl(e.docId,e.componentId,e.mimeType),f.info("pulling doc image ".concat(t)),n=l.loadFile(t,{responseType:"blob"}))}if(n)return n.then((function(n){return f.info("pushing pulled image",t),v.saveImageComponent(n,e.mimeType,L(),e.componentID,e.componentID)})).then((function(t){return f.assert(t.component.id===e.componentID),f.info("image pushed as component id ".concat(t.component.id,"; aliasing from ").concat(e.url," to ").concat(t.encodedUrl)),A[D(e.componentID,e.url)]=t.encodedUrl,null})).catch((function(e){f.error("error while saving dom",e)}))}))).catch((function(e){throw f.error("error while copying images",e),e}))}(n):t.resolve(null)).then((function(){return u.end(),b?N(n,o,r):O(n,o,r,i)}))},v};return v.CommitChanges={AUTO:"AUTO",NEVER:"NEVER"},v.toDocument=function(e){return new v({dcxDoc:e,copyExternalImages:"all",commitChanges:v.CommitChanges.AUTO})},v.toTemplateLocal=function(e,t,n){return new v({dcxDoc:e.composite,rootNode:t,domComponentPath:"dom.json",commitChanges:n})},v.toTemplateExternal=function(e,t,n){return new v({dcxDoc:e.composite,rootNode:t,domComponentPath:"dom.json",copyExternalImages:"template",commitChanges:n})},v}.apply(t,o))||(e.exports=r)},r3b0:function(e,t,n){var o,r,i=n("jiRT");!function(){function e(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function t(e,t){return e=e||"/",t?("/"!=e.substring(e.length-1)&&(e+="/"),e+t):e}(r=function(t,n){this.config=t,this.branch=t.branch,this.node=n,t.remix&&(this.node?this.node.id=e():this.branch.id=e())})._implements=function(e){return"IImportDataObject"==e||"IImportDataObjectDocument"==e},r.prototype=Object.create(Object.prototype,{id:{get:function(){return this.node?this.node.id:this.branch.id}},name:{get:function(){return this.node?this.node.name:this.branch.name}},path:{get:function(){return this.node?this.node.path:this.branch.path}},property:{value:function(e){return e.indexOf("#")<0&&(e="theo#"+e),this.node?this.node[e]:this.branch[e]}},stringProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},numberProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},intProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},booleanProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},optionalBooleanProperty:{value:function(e){return this.property(e)}},optionalStringProperty:{value:function(e){return this.property(e)}},metadata:{value:function(e){var t=this.property(e);if(t)return new i(t)}},forEachChild:{value:function(e){var n=this.node?this.node.children:this.branch.children;if(n)for(var o=0;o<n.length;o++){var i=n[o];this.config.trackAbsolutePath&&(i.absolutePath=t(this.node?this.node.absolutePath:null,i.path)),e(new r(this.config,i),o)}}},forEachComponent:{value:function(e){var n=this.node?this.node.components:this.branch.components;if(n)for(var o=0;o<n.length;o++){var r=n[o];this.config.trackAbsolutePath&&(r.absolutePath=t(this.node?this.node.absolutePath:null,r.path)),e({id:r.id,mimeType:r.type,url:this.config.makeComponentUrl(r)},o)}if(this.config.manufactureComponentsForNode){var i=this.config.manufactureComponentsForNode(this.node);if(i)for(o=0;o<i.length;o++)e(i[o],(n?n.length:0)+o)}}}}),r.prototype.constructor=r}(),void 0!==e.exports?e.exports=r:void 0===(o=function(){return r}.apply(t,[]))||(e.exports=o)},uTW7:function(e,t,n){"use strict";n.r(t);var o=n("UzQk"),r=n("nNj6");function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class a{constructor(e,t,n){i(this,"overrideID",void 0),i(this,"dcxNode",void 0),i(this,"parent",void 0),i(this,"branch",void 0),i(this,"childNodes",void 0),i(this,"childComponents",void 0),this.dcxNode=e,this.branch=t,this.parent=n,this.overrideID=t.getOverrideIDForNode(e),this.childNodes=t.dcxBranch.getChildrenOf(this.dcxNode).map(e=>new a(e,t,this)),this.childComponents=t.dcxBranch.getComponentsOf(this.dcxNode).map(e=>new r.a(t,this,e))}get absolutePath(){return this.dcxNode.absolutePath}get nodeId(){return this.overrideID||this.dcxNode.id}get name(){return this.dcxNode.name}set name(e){this.dcxNode.name=e}get path(){return this.dcxNode.path}set path(e){this.dcxNode.path=e}get type(){return this.dcxNode.type}set type(e){this.dcxNode.type=e}getValue(e){return this.dcxNode.getValue(e)}setValue(e,t){this.dcxNode.setValue(e,t)}removeValue(e){this.dcxNode.removeValue(e)}visit(e){let t=e(this);if(t)return t;for(var n=0;n<this.childNodes.length;n++)if(t=this.childNodes[n].visit(e),t)return t;return null}findComponent(e){return this.visit(t=>t.childComponents.find(t=>e(t))||null)}findNode(e){return this.visit(t=>e(t)?t:null)}setManifestFormatVersion(e){}setCompositeID(e){}setManifestProperty(e,t){}setDocumentSize(e,t){}}var c=n("1tmr"),l=n("A+mC"),s=n("a8ov"),u=n("FGv1"),d=n("MGCh"),p=n.n(d);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"DCXDocumentBranch",(function(){return f}));const m=p.a.channel("DCXDocumentBranch");class f{constructor(e){h(this,"dcxBranch",void 0),h(this,"_root",void 0),h(this,"_retiredElement",void 0),h(this,"_componentPaths",{}),h(this,"_componentURLfn",void 0),h(this,"_overrideIDfn",void 0),this.dcxBranch=e.branch,this._retiredElement=e.retiredElement||null,this._componentURLfn=e.componentURLfn||null,this._overrideIDfn=e.overrideIDfn||null,this._root=new a(e.branch.rootNode,this,null)}getOverrideIDForNode(e){return this._overrideIDfn&&this._overrideIDfn(e)}registerContentForComponent(e,t){this._componentPaths[e]=o.Host.persistUtils.writeJsonContentToTempFile(t)}releaseRegisteredContent(){if(o.Host.persistUtils instanceof l.HostPersistUtilsImpl)for(var e in this._componentPaths)o.Host.persistUtils.deleteTempFile(this._componentPaths[e]);else o.CoreAssert.warning("persist utils is not of a known type; releasing temp files won't happen");this._componentPaths={}}getDeferredComponents(){let e=[];return this._root.visit(t=>e.push.apply(e,t.childComponents.filter(e=>e instanceof u.DCXDocumentComponentDeferred))),e}get root(){return this._root}getValue(e){return this.dcxBranch.rootNode.getValue(e)}get allComponents(){let e=[];return this._root.visit(t=>{e.push.apply(e,t.childComponents)}),e}appendNode(e,t,n){if(e=e||o.GUIDUtils.makeGUID(),!n||n instanceof a){let o=n||this._root,r=this.dcxBranch.addChild("",e,void 0,o.dcxNode);t&&(r.path=t);let i=new a(r,this,o);return o.childNodes.push(i),i}return m.error("appendNode: foreign node"),null}removeNode(e){if(e instanceof a)if(e.branch!==this)m.error("trying to remove a node from a branch it doesn't belong to");else if(e.parent){let t=e.parent.childNodes.indexOf(e);t<0?m.error("trying to remove a node from a parent it doesn't belong to"):(e.visit(e=>e.childComponents.forEach(e=>{e instanceof r.a&&this.retireComponent(e.dcxComponent)})),e.parent.childNodes.splice(t,1),this.dcxBranch.removeChild(e.dcxNode))}else m.error("can't remove the root node");else m.error("trying to remove a node that isn't really a node")}getChildrenOfNode(e){return o.CoreAssert.isTrue(!e||e instanceof a),e instanceof a?e.childNodes.concat():this._root.childNodes.concat()}getComponentsOfNode(e){return o.CoreAssert.isTrue(!e||e instanceof a),e instanceof a?e.childComponents.concat():this._root.childComponents.concat()}getComponentWithId(e){return this._root.findComponent(t=>t.componentId===e)}getPathForComponent(e){if(e instanceof c.a){const t=this._componentPaths[e.absolutePath];if(t)return t;if(this._componentURLfn){const t=this._componentURLfn(e);if(null!==t)return t}return o.CoreAssert.isTrue(!!e.componentId&&!!e.type),s.default.encodeComponentUrl(this.root.nodeId,e.componentId,e.type)}return m.error("passed in component isn't our type of component"),null}getComponentWithAbsolutePath(e){return this._root.findComponent(t=>t.absolutePath===e)}getNodeWithAbsolutePath(e){return this._root.findNode(t=>t.absolutePath===e)}addComponent(e,t,n,i,c,l,s,d,p){let h=l instanceof a?l.dcxNode:this.dcxBranch.rootNode,f=l&&l instanceof a?l:this._root;if(this._retiredElement){let e=this._retiredElement.getComponentsOf(this._retiredElement.rootNode).find(e=>e.id===t);if(e){m.info("copying component ".concat(e.id," from retirement zone")),this.dcxBranch.copyComponent(e,h);let t=new r.a(this,f,e);return f.childComponents.push(t),t}}if(s&&o.Host.persistUtils&&o.Host.persistUtils.fileExists(s)){m.info("creating deferred content component for ID ".concat(t," from source ").concat(s));const r={name:e,componentId:t||"",type:n,relationship:i,path:c,sourceFile:s,copy:d,sourceHref:p,node:f,content:o.Host.persistUtils.readJsonContentFromFile(s)};let a=new u.DCXDocumentComponentDeferred(this,f,r);return f.childComponents.push(a),a}return m.error("addComponent: on web we can't add arbitrary components.."),null}moveComponent(e,t){return e instanceof c.a?(m.info("moveComponent ".concat(e.componentId," to node ").concat(t instanceof a?t.absolutePath:"root")),e.reparent(t||this._root),e):(m.error("updateComponent: requires a DCXDocumentComponent"),null)}retireComponent(e){"rendition"!==e.relationship&&"dom"!==e.relationship?this._retiredElement.allComponents().find(t=>t.id===e.id)?m.info("not retiring component ".concat(e.id," (already have a copy of it in retirement zone)")):(m.info("retiring ".concat(e.id)),this._retiredElement.copyComponent(e)):m.info("not retiring ".concat(e.id," because it's a rendition or dom component"))}updateComponent(e,t,n){if(!(e instanceof c.a))return m.error("updateComponent: requires a DCXDocumentComponent"),null;const r=this.getComponentWithId(e.componentId);if(!r)return m.error("updateComponent: passed component's ID isn't in the branch; can only update existing components"),null;let i=e;if(t){if(!o.Host.persistUtils||!o.Host.persistUtils.fileExists(t))return m.error("updateComponent: sourceFile can't be used because it's not a faux-temp-file"),null;m.info("updating component ".concat(e.componentId," with new source file ").concat(t)),i=new u.DCXDocumentComponentDeferred(this,i.node,{name:i.name,componentId:i.componentId||"",type:i.type||"",relationship:i.relationship,path:i.path||"",sourceHref:i.sourceHref,node:i.node,sourceFile:t,copy:n,content:o.Host.persistUtils.readJsonContentFromFile(t)})}else r!==i?m.info("updating component ".concat(e.componentId," with new metadata only")):m.warn("updating component ".concat(e.componentId," but nothing has changed!"));return r!==i&&r.update(i),i}}},yAe2:function(e,t,n){var o;(o=function(){this.data={},this._childMeta={}}).prototype=Object.create(Object.prototype,{setPath:{value:function(e){this.data.path=e}},setName:{value:function(e){this.data.name=e}},setType:{value:function(e){this.data.type=e}},setProperty:{value:function(e,t){this.data[e]=t}},setOptionalStringProperty:{value:function(e,t){t&&(this.data[e]=t)}},setStringProperty:{value:function(e,t){this.data[e]=t}},setNumberProperty:{value:function(e,t){this.data[e]=t}},setIntProperty:{value:function(e,t){this.data[e]=t}},setBooleanProperty:{value:function(e,t){this.data[e]=t}},appendMetadata:{value:function(e){var t=new o;return this._childMeta[e]=t,t}},appendChild:{value:function(e){return console.warn("Someone's trying to nest a child data object in metadata, which isn't supported."),new o}},appendComponent:{value:function(e,t,n){console.warn("Someone's trying to add a component to metadata, which isn't supported.")}},encodeData:{value:function(){for(var e in this._childMeta)this.data[e]=this._childMeta[e].encodeData();return this.data}}}),o.prototype.constructor=o,e.exports=o}}]);
//# sourceMappingURL=post-render-action-view_post-render-doc-view_theo-publish-impl_theo-web-controller_theo-web-headless_6bc92e0e-125255b7.js.map