(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[20],{"06HC":function(t,e,n){var o,i=e,r=n("oAGj"),a=n("JgVS"),l=n("cEEQ"),s=n("c+uM"),h=n("tGKA");i.ShadowDecorationStrategy=(o=function(){a.BaseDecorationStrategy.call(this)},r.defineClass({name:"ShadowDecorationStrategy",ctor:o,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{rotatePoint:function(t,e,n){var o=n*Math.PI/180;return{x:Math.cos(o)*(t.x-e.x)-Math.sin(o)*(t.y-e.y)+e.x,y:Math.sin(o)*(t.x-e.x)+Math.cos(o)*(t.y-e.y)+e.y}},supportsConfiguration:function(t){return!1},decorate:function(t,e){for(var n=[],o=e.avgTextPointSize,i=t.style.shadowAngle,u=o/16*t.style.shadowOffset+.02*o,c=this.rotatePoint({x:0,y:-u},{x:0,y:0},i),g=r.iter(r.range(0,e.items.length,!1));!g.done;g.next()){var p=g.value,d=r.clone(e.items[p]);if(d.type==l.LockupItemType.Text){var f,m,y=t.style.textLook;if(null!=(f=d.characterStyle)&&(m=t.style.characterStyles[f])&&(y=m.textLook==s.LockupTextLook.UNSET?y:m.textLook),s.LockupStyle.isShadowLook(y)){u=y==s.LockupTextLook.KnockoutAndShadow?.08*d.pointSize*(1.7*t.style.shadowOffset+.25)/2:y==s.LockupTextLook.ShadowAndOutline?o/8*t.style.shadowOffset+.02*o:o/16*t.style.shadowOffset+.02*o,c=this.rotatePoint({x:0,y:-u},{x:0,y:0},i);var k=d.placement;d.hasPrimaryColor=!1,d.placement=new h.Matrix2D(k.a,k.b,k.c,k.d,k.tx+c.x,k.ty+c.y),n.push(r.clone(d))}}}return new a.DecorationResults(r.clone(n))}}}),o)},"3UhB":function(t,e,n){var o,i=e,r=n("oAGj"),a=n("0wFF"),l=n("6h7+"),s=n("kYI4"),h=n("SpAV"),u=n("gXiO"),c=n("FNB+"),g=n("QgZx"),p=n("G1DZ"),d=n("iCxV"),f=n("c+uM"),m=n("KdeS"),y=n("tGKA"),k=n("mGL3"),S=n("a9ow"),L=n("enh0"),v=n("VJ9E"),T=n("8t9B"),F=n("oKlP"),C=n("uUew"),x=n("sIWg");i.TypeLockupUtils=(o=function(){u.CoreObject.call(this)},r.defineClass({name:"TypeLockupUtils",ctor:o,superName:"CoreObject",statics:{replaceFontsInDocument:function(t,e){var n=d.Host.textModelUtils.defaultFont(),i=o.createTheoFont(n,null);t.firstPage.root.visitAll(c.FormaTraversal.PreOrder,(function(t){if(t.style instanceof f.LockupStyle){var n,o=!1,a=t.style,l=r.opt(a.font,(function(t){return t.fontData.postScriptName}));null!=l&&e.includes(l)&&(a.font=i,o=!0);for(var s=r.iter(a.characterStyles);!s.done;s.next()){var h=s.value;if(null!=h.font){var u=r.opt(h.font,(function(t){return t.fontData.postScriptName}));null!=u&&e.includes(u)&&(h.font=i,o=!0)}}o&&(n=r.as(t.controller,T.TypeLockupController))&&n.styleChanged()}}))},fontsInDocument:function(t){var e=new k.OrderedFontSet;return t.firstPage.root.visitAll(c.FormaTraversal.PreOrder,(function(t){var n;if(n=r.as(t,L.TextForma)){var o=n.textModel;o.forEachAttributeValueInRange(S.FontDescriptorAttribute.NAME,o.rangeAll,(function(t,n){var o;(o=r.as(n,S.FontDescriptorAttribute))&&e.append(o.value)}))}})),e},sizesInDocument:function(t,e){void 0===e&&(e=null);var n=[];return t.firstPage.root.visitAll(c.FormaTraversal.PreOrder,(function(t){var o;if((o=r.as(t,L.TextForma))&&o.lockupForma!=e){var i=o.textModel;i.forEachAttributeValueInRange(S.FontSizeAttribute.NAME,i.rangeAll,(function(t,e){var i=e;if(!n.includes(i.value)){var r=i.value*o.lockupForma.placement.extractedScale.scale.x;n.push(r)}}))}})),r.sortInPlace(n),n},applyFontToController:function(t,e){var n=this,o=t.fontData;if(o.availability==g.FontAvailability.LOADED){var i;if(null!=(i=r.opt(e.styleController.forma,(function(t){return t.source})))&&p.FormaSourceUtils.isDesignIngredient(i)){var h=l.BadgeFacade.getDesignIngredientIDAndType(i),u=h.id,c=h.type;r.opt(d.Host.logging,(function(e){return e.logToAnalytics(a.AnalyticsConstants.kDesignIngredientFontChanged,{contextualData1:"designIngredientId:"+u,contextualData2:"designIngredientType:"+c,contextualData10:"fontName:"+t.fontData.postScriptName})}))}e.styleController.targetedLockupStyle.font=t,null!=t.sparkElementID?s.BrandingFacade.brandDocumentForElement(e.forma.page.document,t.sparkElementID,s.AUTHORING_CONTEXT_TYPE_FONT):s.BrandingFacade.unBrandDocumentIfNoBrandedElements(e.forma.page.document),e.styleController.targetedLockupStyle!==e.styleController.forma.style&&(t.isEqual(e.styleController.forma.style.font)&&(e.styleController.targetedLockupStyle.font=null),e.styleChanged())}else o.availability==g.FontAvailability.LOADABLE&&d.Host.fontProvider.loadFont(o,(function(){return n.applyFontToController(t,e)}),(function(){return d.Host.logging.info("Failed to load font")}))},createTheoFont:function(t,e){if(null!=e)for(var n=r.iter(e.fonts);!n.done;n.next()){var o=n.value;if(null!=o.descriptor&&o.descriptor.isEqual(t))return v.TheoFont.init_a314(o)}return v.TheoFont.init_9e5c(t)},calculateFontRole:function(t,e){var n,i,a=null;if(null!=t){var l=o.createTheoFont(t,e);a=l.getSparkFontRole(),r.isEmpty((n=a)||null!=n?n:"")&&l.hasSparkFontRole("custom")&&(a="custom")}return r.isEmpty((i=a)||null!=i?i:"")?"":a},calculateFaceWithHighestRole:function(t,e){for(var n=["headline-font","body-font","body-font-italic","body-font-bold","body-font-bold-italic","secondary-font","custom"],i=null,a="",l=r.iter(t);!l.done;l.next()){var s=l.value,h=o.calculateFontRole(s,e);if(0==r.isEmpty(h)){var u=r.indexOf(n,h);null!=u&&(r.isEmpty(a)||u<r.indexOf(n,a))&&(a=h,i=s)}}return i},isLTRCharacter:function(t){return t>="A"&&t<="Z"||t>="a"&&t<="z"||t>="À"&&t<="Ö"||t>="Ø"&&t<="ö"||t>="ø"&&t<="ʻ"||t>="̀"&&t<="֐"||t>="ࠀ"&&t<="῿"||t>="Ⰰ"&&t<="﬜"||t>="﷾"&&t<="﹯"||t>="﻽"&&t<="￿"},isRTLCharacter:function(t){return t>="֑"&&t<="߿"||t>="יִ"&&t<="﷽"||t>="ﹰ"&&t<="ﻼ"},isTextRightToLeft:function(t){for(var e=0,n=0,i=r.iter(r.chars(t));!i.done;i.next()){var a=i.value;o.isLTRCharacter(a)?e+=1:o.isRTLCharacter(a)&&(n+=1)}return n>0&&n>e},canBreakAnywhere:function(t){return t>="ぁ"&&t<="ヿ"||t>="㐀"&&t<="䶵"||t>="一"&&t<="龥"},isWhiteSpace:function(t){for(var e=r.iter(r.chars(t));!e.done;e.next()){var n=e.value;if(!o.isWhiteSpace(n))return!1}return!0},isWhiteSpace:function(t){return t>="\t"&&t<="\r"||" "==t||""==t||" "==t||" "==t||t>=" "&&t<="​"||"\u2028"==t||"\u2029"==t||" "==t||" "==t||"　"==t},iskinsokuBefore:function(t){return"!"==t||")"==t||"."==t||":"==t||";"==t||"?"==t||"’"==t||"”"==t||"、"==t||"。"==t||"々"==t||"〉"==t||"》"==t||"」"==t||"』"==t||"】"==t||"〕"==t||"ゝ"==t||"ゞ"==t||"・"==t||"ヽ"==t||"ヾ"==t||"！"==t||"）"==t||"，"==t||"．"==t||"："==t||"？"==t||"］"==t||"｝"==t},iskinsokuAfter:function(t){return"("==t||"["==t||"{"==t||"£"==t||"§"==t||"‘"==t||"“"==t||"〈"==t||"《"==t||"「"==t||"『"==t||"【"==t||"〒"==t||"〔"==t||"〝"==t||"（"==t},lineBreaks:function(t,e,n){for(var i=0,a=0,l=!1,s=!0,h=r.iter(r.chars(t));!h.done;h.next()){var u=h.value;o.iskinsokuBefore(u)?s=!0:o.iskinsokuAfter(u)?(i!=a&&s&&(e.push(new C.TextRange(i,a)),i=a),l=u.charCodeAt(0)>=12288,s=!1):o.canBreakAnywhere(u)?(i!=a&&s&&(e.push(new C.TextRange(i,a)),i=a),l=!0,s=!0):o.isWhiteSpace(u)?(i!=a&&e.push(new C.TextRange(i,a)),"\n"==u&&n&&e.push(new C.TextRange(a,a+1)),i=a+1,l=!1,s=!0):l&&s?(i!=a&&(e.push(new C.TextRange(i,a)),i=a),l=!1,s=!0):(l=!1,s=!0),a+=1,u.charCodeAt(0)>65535&&(a+=1)}i!=a&&e.push(new C.TextRange(i,a))},getBreakRanges:function(t){var e=[];return o.lineBreaks(t,e,!0),e},getWordRanges:function(t,e){var n=[];o.lineBreaks(t,n,!1);for(var i=r.iter(r.toSequence(n));!i.done;i.next()){var a=i.value,l=a.offset,s=a.element;l+1<n.length&&(n[l]=new C.TextRange(s.start,n[l+1].start))}if(1==n.length){n.splice(0);for(var h=0,u=-1,c=-1,g=-1,p=0,d=!0,f=r.iter(r.chars(t));!f.done;f.next()){var m=f.value,y=r.toString(m).toLowerCase()!=r.toString(m);y&&!d&&(n.push(new C.TextRange(p,h)),p=h),d=y,h+=1,"."==m?(n.push(new C.TextRange(p,h)),p=h,-1==u&&(u=h),c=h,g=n.length-1,d=!0):"/"==m&&(n.push(new C.TextRange(p,h-1)),n.push(new C.TextRange(h-1,h)),p=h)}n.push(new C.TextRange(p,r.chars(t).length)),((e==T.HighlightMethod.Bracket||e==T.HighlightMethod.InsideBracket)&&-1!=u&&-1!=c||-1!=u&&u==c)&&(n[g]=new C.TextRange(n[g].start,c-1),n[g+1]=new C.TextRange(c-1,n[g+1].end))}return n},computeLockupMeasurements:function(t,e,n,i,a,l,s,h,u,c){void 0===u&&(u=1),void 0===c&&(c=!1);for(var g=e,p=32*n,f=32*g.spaceWidthRatio/p,y=a,k=c,S=i?t.toUpperCase():t,L=o.isTextRightToLeft(S),v=o.getBreakRanges(S),F=[],A=null!=h[T.TypeLockupController.HIGHLIGHT_STYLE]&&null!=h[T.TypeLockupController.HIGHLIGHT_STYLE].font,R=r.iter(v);!R.done;R.next()){var w=R.value,M=w,_="",I=!1;y=a,k=c;for(var b=r.iter(s);!b.done;b.next()){var D=b.value;if(1==v.length){y=!0,_=T.TypeLockupController.HIGHLIGHT_STYLE;break}(w.start>=D.start&&w.start<D.end||w.start<=D.start&&w.end>=D.start)&&((D.end<w.end||D.start>w.start)&&(y=!0,k=!0),_=T.TypeLockupController.HIGHLIGHT_STYLE),w.end!=D.end&&w.end!=D.end-1&&w.end!=D.start&&w.end!=D.start-1||(I=!0)}var H=32;g=""!=_&&null!=h[_]&&null!=h[_].font?h[_].font.fontData:e,""!=_&&null!=h[_]&&(H=32*u);var B=t.substr(w.start,w.length);L&&"\n"!=B&&(B="‫"+B);var P=i?B.toUpperCase():B;if(w.end<t.length)for(var E=t.substr(w.end),O=0,N=r.iter(r.chars(E));!N.done;N.next()){var G=N.value;if(!o.isWhiteSpace(G)&&"\n"!=G){0==O&&(f=0);break}if((A||1!=u)&&I){var z=32*u*(r.opt(h[T.TypeLockupController.HIGHLIGHT_STYLE].font,(function(t){return t.fontData}))||e).spaceWidthRatio/p;f=(32*e.spaceWidthRatio/p+z)/2}else f=H*g.spaceWidthRatio/p;O+=1,M=new C.TextRange(w.start,w.end+O)}else f=H*g.spaceWidthRatio/p;if(y&&!L){var U=0,Y=H*l/p,W=r.clone(d.Host.textModelUtils.getGlyphPositions(P,e,32,!k)),V=r.opt(r.opt(h[T.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||e,X=null;null!=h[T.TypeLockupController.HIGHLIGHT_STYLE]&&(X=r.clone(d.Host.textModelUtils.getGlyphPositions(P,V,32*u,!k)));for(var K=r.clone(W),Q=r.iter(r.toCharSequence(P));!Q.done;Q.next()){var q=Q.value.element,j=new C.TextRange(U+w.start,U+w.start+1);_="";for(var Z=r.iter(s);!Z.done;Z.next())D=Z.value,j.start>=D.start&&j.start<D.end&&(_=T.TypeLockupController.HIGHLIGHT_STYLE);""!=_&&null!=h[_]?(H=32*u,K=r.clone(X)):(H=32,K=r.clone(W)),""!=_&&null!=h[_]&&null!=h[_].font?g.isEqual(V)||(g=V):g.isEqual(e)||(g=e);var J=r.toString(q),$=d.Host.textModelUtils.measureInkBounds(J,g,H),tt=(z=(K[U+1]-K[U]-$.width)/p+Y,!1);U==P.length-1&&(z=f,Y>0&&(z+=2*Y),tt=!0);var et=""!=_&&null!=h[_]&&-1!=h[_].spacing&&0!=h[_].spacing?u:1,nt=r.clone(m.LockupWordInfo.init_e9d6(J,$.width/p,z,_,et,B.includes("\n"),tt,j));F.push(r.clone(nt)),U+=1}}else{var ot=d.Host.textModelUtils.measureInkBoundsWithTracking(P,g,H,l);0!=l&&(ot=new x.TheoRect(ot.minX,ot.minY,ot.maxX-0,ot.maxY),Y=H*l/p,0==f?f=Y:l>0&&(f+=2*Y));var it=""!=_&&null!=h[_]&&-1!=h[_].spacing&&0!=h[_].spacing?u:1;if(nt=r.clone(m.LockupWordInfo.init_e9d6(B,ot.width/p,f,_,it,B.includes("\n"),!0,M)),""!=_&&null!=h[_]&&-1!=h[_].spacing&&0!=h[_].spacing&&h[_].lineBreakAtCharacterStyleSizeChange&&r.opt(r.last(F),(function(t){return""==t.characterStyle}))&&!B.includes("\n")){var rt=r.clone(m.LockupWordInfo.init_e9d6("\n",0,0,_,it,!0,!0,new C.TextRange(w.start,w.start)));F.push(r.clone(rt))}if(F.push(r.clone(nt)),""!=_&&null!=h[_]&&-1!=h[_].spacing&&0!=h[_].spacing&&h[_].lineBreakAtCharacterStyleSizeChange&&I&&!B.includes("\n")){var at=r.clone(m.LockupWordInfo.init_e9d6("\n",0,0,_,it,!0,!0,new C.TextRange(w.end,w.end)));F.push(r.clone(at))}}}return F},getLockupStringsForRoot:function(t){var e=[];return t.visitAll(c.FormaTraversal.PreOrder,(function(t){var n=r.as(t.controller,T.TypeLockupController);null!=n&&e.push(n.text)})),e},getFullCanvasLockups:function(t){var e=[];return t.visitAll(c.FormaTraversal.PreOrder,(function(t){if(t.style instanceof f.LockupStyle&&t.style.backing==f.LockupBacking.Knockout){var n=r.as(t.controller,T.TypeLockupController);null!=n&&e.push(n)}})),e},getNewCharSelectionRange:function(t,e,n){for(var o=e,i=t,a=new C.TextRange(0,0),l=r.iter(n);!l.done;l.next()){var s=l.value;t.start>=s.start&&t.end<=s.end&&(i=s),e.start>=s.start&&e.end<=s.end&&(a=s)}if(i.start==a.start&&i.end==a.end){if(e.end<=t.start&&0!=a.length)return new C.TextRange(a.start,e.end);if(e.end<=a.end&&t.end<=e.start)return new C.TextRange(e.start,a.end);if(e.start==t.start&&e.end==t.end)return new C.TextRange(a.start,a.end)}return i.start<e.start?o=new C.TextRange(i.start,e.end):i.end>e.end&&(o=new C.TextRange(e.start,i.end)),o},rangesAreEqual:function(t,e){if(t.length!=e.length)return!1;for(var n=r.iter(r.toSequence(t));!n.done;n.next()){var o=n.value,i=o.offset,a=o.element;if(a.start!=e[i].start||a.end!=e[i].end)return!1}return!0},cleanupAndMerge:function(t){for(var e=[],n=r.iter(r.toSequence(t));!n.done;n.next()){var o=n.value,i=o.offset,a=o.element;if(0!=a.length){h.CoreAssert.isTrue(a.start<a.end,"cleanupAndMerge - bad range","TypeLockupUtils.cleanupAndMerge","TypeLockupUtils.swift",788);var l=e.length-1;if(e.length>0&&a.start<=e[l].end){var s=Math.max(a.end,e[l].end);e[l]=new C.TextRange(e[l].start,s)}else e.push(t[i])}}return e},invertRanges:function(t,e){for(var n=[],o=0,i=r.iter(t);!i.done;i.next()){var a=i.value;if(0!=a.start&&n.push(new C.TextRange(o,a.start)),(o=a.end)>e){h.CoreAssert.fail("invertRanges range beyond maxRangeEnd. currRange.start "+a.start+" currRange.end "+a.end+" maxRangeEnd - "+e,"TypeLockupUtils.invertRanges","TypeLockupUtils.swift",811);break}}return o<e&&n.push(new C.TextRange(o,e)),n},getCharFontAdjust:function(t,e,n){void 0===n&&(n=!0);var o=1,i=T.TypeLockupController.HIGHLIGHT_STYLE,a=t.font.fontData,l=r.opt(r.opt(t.characterStyles[i],(function(t){return t.font})),(function(t){return t.fontData}));return null!=t.characterStyles[i]&&-1!=t.characterStyles[i].spacing&&0!=t.characterStyles[i].spacing?(o=t.characterStyles[i].spacing,n&&o>1&&(o=1/o)):null!=l&&(o=e||a.capRatio==a.meanRatio||l.capRatio==l.meanRatio?a.capRatio/l.capRatio:a.meanRatio/l.meanRatio),o},getCharFontYAdjust:function(t,e,n){var o=0,i=T.TypeLockupController.HIGHLIGHT_STYLE;if(null==t.characterStyles[i])return h.CoreAssert.isTrue(e==n,"getCharFontYAdjust - charFontSize should match fontSize if no character style!","TypeLockupUtils.getCharFontYAdjust","TypeLockupUtils.swift",855),o;var a=t.font.fontData,l=r.opt(r.opt(t.characterStyles[i],(function(t){return t.font})),(function(t){return t.fontData}));return null!=l?(o=e*a.capRatio-e*a.baselineOffsetRatio-(n*l.capRatio-n*l.baselineOffsetRatio),t.characterStyles[i].alignment==f.LockupAlignment.Center?o-=(a.capRatio*e-l.capRatio*n)/2:t.characterStyles[i].alignment==f.LockupAlignment.Right&&(o-=a.capRatio*e-l.capRatio*n)):e!=n&&(o=e*a.capRatio-e*a.baselineOffsetRatio-(n*a.capRatio-n*a.baselineOffsetRatio),t.characterStyles[i].alignment==f.LockupAlignment.Center?o-=(a.capRatio*e-a.capRatio*n)/2:t.characterStyles[i].alignment==f.LockupAlignment.Right&&(o-=a.capRatio*e-a.capRatio*n)),o},polyFromForma:function(t){var e=[],n=t.bounds||x.TheoRect.Zero,o=y._asterisk_TheoPoint_Matrix2D(n.evalXY(0,0),t.totalPlacement);e.push(o);var i=y._asterisk_TheoPoint_Matrix2D(n.evalXY(1,0),t.totalPlacement);e.push(i);var r=y._asterisk_TheoPoint_Matrix2D(n.evalXY(1,1),t.totalPlacement);e.push(r);var a=y._asterisk_TheoPoint_Matrix2D(n.evalXY(0,1),t.totalPlacement);return e.push(a),e},formaIntersect:function(t,e){var n=r.clone(o.polyFromForma(t)),i=r.clone(o.polyFromForma(e)),a=[];a.push(r.clone(n)),a.push(r.clone(i));for(var l=r.iter(a);!l.done;l.next())for(var s=l.value,h=r.iter(r.toSequence(s));!h.done;h.next()){for(var u=h.value,c=u.offset,g=u.element,p=s[(c+1)%s.length],d=new F.TheoPoint(p.y-g.y,g.x-p.x),f=null,m=null,y=r.iter(n);!y.done;y.next()){var k=y.value,S=d.x*k.x+d.y*k.y;(null==f||S<f)&&(f=S),(null==m||S>m)&&(m=S)}for(var L=null,v=null,T=r.iter(i);!T.done;T.next()){var C=T.value,x=d.x*C.x+d.y*C.y;(null==L||x<L)&&(L=x),(null==v||x>v)&&(v=x)}if(null!=m&&null!=L&&m<L)return!1;if(null!=v&&null!=f&&v<f)return!1}return!0},sortTextFormae:function(t){var e,n=r.clone(t);return r.sortInPlace(n,(function(t,n){if(t.parent==n.parent)return t.rangeInLockup.start<n.rangeInLockup.start;var i,a,l,s,h,u,c,g;if((i=t.lockupForma)&&(a=n.lockupForma)&&(l=i.finalFrame)&&(s=a.finalFrame)&&(h=i.parent)&&null!=(u=h.indexOfChild(i))&&(c=a.parent)&&null!=(g=c.indexOfChild(a))){if(i!=a&&o.formaIntersect(i,a))return u<g;var p=.5*((e=r.opt(r.as(i.controller,T.TypeLockupController),(function(t){return t.averageLineHeight})))||null!=e?e:0);return l.minY-s.minY<-p||!(l.minY-s.minY>p)&&l.minX<s.minX}return!1})),n},padTextFormaeForLetterAnimation:function(t,e){for(var n=[],o=!1,i=r.iter(r.toSequence(t));!i.done;i.next()){var a=i.value,l=a.offset,s=a.element;if(o)o=!1;else{var h,u=s.textModel.text.length+1==s.rangeInLockup.length,c=e&&u?1:0,g=s.textModel.text.length+c;if((h=r.as(r.opt(s.lockupForma,(function(t){return t.style})),f.LockupStyle))&&f.LockupStyle.isOutlineLook(h.textLook)&&l+1<t.length){var p=t[l+1];if(s.parent==p.parent&&p.rangeInLockup.start==s.rangeInLockup.start){for(var d=r.iter(r.range(0,g,!0));!d.done;d.next())n.push(s),n.push(p);o=!0;continue}}o=!1;for(var m=r.iter(r.range(0,g,!0));!m.done;m.next())n.push(s)}}return n},leftSingleQuote:"‘",rightSingleQuote:"’",leftDoubleQuote:"“",rightDoubleQuote:"”",doubleStraightQuote:'"',singleStraightQuote:"'",isSingleCurlyQuote:function(t){return t==o.leftSingleQuote||t==o.rightSingleQuote},isDoubleCurlyQuote:function(t){return t==o.leftDoubleQuote||t==o.rightDoubleQuote},isCurlyQuote:function(t){return o.isSingleCurlyQuote(t)||o.isDoubleCurlyQuote(t)},isStraightQuote:function(t){return t==o.doubleStraightQuote||t==o.singleStraightQuote},isInteger:function(t){return t>="0"&&t<="9"},isLetter:function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"},getLeftCurlyQuoteForStraightQuote:function(t){return t==o.singleStraightQuote?o.leftSingleQuote:o.leftDoubleQuote},getRightCurlyQuoteForStraightQuote:function(t){return t==o.singleStraightQuote?o.rightSingleQuote:o.rightDoubleQuote},fixUpQuotes:function(t,e){if(t.length==e.length){for(var n=r.iter(r.toCharSequence(t));!n.done;n.next()){var i=n.value.element;if(o.isCurlyQuote(i))return t}for(var a=r.iter(r.toCharSequence(e));!a.done;a.next()){var l=a.value.element;if(o.isCurlyQuote(l))return t}}for(var s=r.chars(t),h=!1,u=0,c=r.iter(r.toCharSequence(t));!c.done;c.next()){var g=c.value,p=g.offset,d=g.element,f=" ",m=" ",y=" ",k=" ";if(p-1>=0&&(f=s[p-1]),p+1<s.length&&(m=s[p+1]),p+2<s.length&&(y=s[p+2]),p+3<s.length&&(k=s[p+3]),o.isStraightQuote(d)){if(d==o.singleStraightQuote){if(("s"==m||"S"==m)&&" "==y){s[p]=o.rightSingleQuote;continue}if("s"!=f&&"S"!=f||" "!=m||(s[p]=o.rightSingleQuote),o.isLetter(f)&&o.isLetter(m)&&(" "==y||" "==k)){s[p]=o.rightSingleQuote;continue}if(" "==f&&o.isInteger(m)&&o.isInteger(y)&&" "==k){s[p]=o.leftSingleQuote;continue}}if(!h&&o.isInteger(f))continue;if(!h&&" "==f){h=!0,u=p;continue}if(h&&" "==m){d==s[u]&&(h=!1,s[u]=o.getLeftCurlyQuoteForStraightQuote(s[u]),s[p]=o.getRightCurlyQuoteForStraightQuote(d));continue}}}return s.join("")}}}),o)},"8t9B":function(t,e,n){var o,i,r,a,l=e,s=n("oAGj"),h=n("0wFF"),u=n("cZuM"),c=n("8/a0"),g=n("kYI4"),p=n("SpAV"),d=n("CWW7"),f=n("9WSY"),m=n("yGNn"),y=n("AVHO"),k=n("ascj"),S=n("JEnV"),L=n("UB0O"),v=n("FNB+"),T=n("6ZWm"),F=n("waL6"),C=n("yHU1"),x=n("QgZx"),A=n("Pil/"),R=n("cmoc"),w=n("16hp"),M=n("P83h"),_=n("9Lk3"),I=n("ZK0l"),b=n("pnSN"),D=n("iCxV"),H=n("fdtz"),B=n("VDg0"),P=n("PXlJ"),E=n("d3iY"),O=n("cEEQ"),N=n("c+uM"),G=n("TkOd"),z=n("tGKA"),U=n("3DEm"),Y=n("EDIN"),W=n("X1F6"),V=n("Cj3Q"),X=n("K0Rh"),K=n("Zifs"),Q=n("06HC"),q=n("djAF"),j=n("35Q0"),Z=n("n/CE"),J=n("JKVa"),$=n("a9ow"),tt=n("byfQ"),et=n("lJxM"),nt=n("9YN4"),ot=n("enh0"),it=n("3UhB"),rt=n("x4Gy"),at=n("mL0c"),lt=n("hgLm"),st=n("oKlP"),ht=n("uUew"),ut=n("sIWg"),ct=n("LCGV"),gt=n("1NAc");l.CharStyleApplyMode=s.defineEnum("CharStyleApplyMode",{SwipeApply:0,Apply:1,Remove:2,Toggle:3}),l.HighlightMethod=s.defineEnum("HighlightMethod",{Manual:0,EvenRows:1,OddRows:2,EvenWords:3,OddWords:4,First:5,Last:6,Bracket:7,InsideBracket:8,Numbers:100,Nouns:101,Verbs:102,Names:103,Adjectives:104,SmallWords:105}),l.ControllerDBListener=(o=function(t,e){this.transactions_=[],this.controller_=e,t.addListener(this)},s.defineClass({name:"ControllerDBListener",ctor:o,statics:{_implements:function(t){return"IDatabaseListener"==t}},props:{onBeginTransaction:function(t,e){this.transactions_.push(e),1==this.transactions_.length&&s.opt(this.controller_,(function(t){return t.shrinkPools=!1}))},onEndTransaction:function(t,e){e===s.last(this.transactions_)&&this.transactions_.pop()},onObjectStateChanged:function(t,e){},onStateChanged:function(t,e){s.opt(this.controller_,(function(t){return t.updateFormaPools()}))}}}),o),l.LockupFormaPool=(i=function(t,e){this.stringsToFormae_={},this.shapeFormae_=[],this.shrinkPools_=!0,this.page_=t,this.createModelFormae_=e},s.defineClass({name:"LockupFormaPool",ctor:i,props:{createForma:function(t){var e=this.page_;return null==e?null:this.createModelFormae_?e.createModelForma(t):e.createForma(t)},clear:function(){this.stringsToFormae_={},this.shapeFormae_=[]},addForma:function(t){var e,n;if(e=s.as(t,q.ShapeForma))this.shapeFormae_.push(e);else if(n=s.as(t,ot.TextForma)){var o=n.textModel.text.toUpperCase();null==this.stringsToFormae_[o]&&(this.stringsToFormae_[o]=[]),this.stringsToFormae_[o].push(n)}},configureTextFormae:function(t){var e,n=this,o=[],i=[],r=[];if(s.each(this.stringsToFormae_,(function(a,l){var h=(e=t[a])||null!=e?e:0,u=l.length;if(0==h)s.append(o,l),r.push(a);else if(h<u){var c=u-h,g=l.slice(h,u);n.shrinkPools_&&l.splice(h,c),s.append(o,g)}else for(var p=h-u,d=s.iter(s.range(0,p,!1));!d.done;d.next())i.push(a)})),this.shrinkPools_)for(var a=s.iter(r);!a.done;a.next()){var l=a.value;s.removeKey(this.stringsToFormae_,l)}s.each(t,(function(t,e){if(null==n.stringsToFormae_[t]){n.stringsToFormae_[t]=[];for(var o=e,r=s.iter(s.range(0,o,!1));!r.done;r.next())i.push(t)}}));for(var h=s.iter(i);!h.done;h.next()){l=h.value;var u=this.createForma(ot.TextForma.KIND);this.stringsToFormae_[s.as(l,"String")].push(u)}return o},configureShapeFormae:function(t){var e=[],n=this.shapeFormae_.length;if(n>t){var o=n-t,i=this.shapeFormae_.slice(t,n);this.shrinkPools_&&this.shapeFormae_.splice(t,o),s.append(e,i)}else if(n<t){var r=t-n;if(r>0)for(var a=s.iter(s.range(1,r,!0));!a.done;a.next()){var l=s.as(this.createForma(q.ShapeForma.KIND),q.ShapeForma);null!=l&&this.shapeFormae_.push(l)}}return e},nthTextFormaForString:function(t,e){var n=s.opt(this.stringsToFormae_[e],(function(e){return e[t]}));return null==n?null:n},textFormaCount:function(){return s.keys(this.stringsToFormae_).length},nthShapeForma:function(t){var e=t<this.shapeFormae_.length?this.shapeFormae_[t]:null;return null==e?null:e},shapeFormaCount:function(){return this.shapeFormae_.length}}}),i),l.TypeLockupController=(r=function t(e,n,o){var i,r,a,s;this.changeSubscriptions_=[],this.settings_=null,this.tagsToFormae_={},this.isRightToLeft=!1,this.initialCharStyleRanges_=[],this.bannerRatio_=t.DEFAULT_BANNER_RATIO,this.forceLetterFormaMode=!1,this.currentPrimaryColor=K.SolidColor.WHITE,this.currentSecondaryColor=K.SolidColor.BLACK,this.cachedPin_=null,this.shouldCachePin_=!1,this.startSize_=null,this.passedARThreshold_=!1,this.lockLineBreaks_=!1,this.allowFewerLineBreaks_=!1,this.missingFontCount_=0,this.validDecode_=null,this.layoutStrategy_=null,this.decorationStrategy_=null,this.renderedConfiguration_=null,this.renderedColorLibrary_=null,this.renderedLayoutResults_=null,this.renderedDecorationResults_=null,this.updateQueued_=!1,this.thresholdGroupWidth=0,this.thresholdGroupHeight=0,this.hasFirstUpdateRun=!1,this.formaUpdateEvents_=[],this.sgID=n.formaID,this.layoutFormaePool_=new l.LockupFormaPool(n.page,n.isModel),this.decorationFormaePool_=new l.LockupFormaPool(n.page,n.isModel),this.styleController_=new G.LockupStyleController(n),this.missingFontCount_=0,null!=(i=n.style.colors.colorID(k.ColorRole.FieldPrimary))&&(r=n.page.colorLibraryController.getSolidColorForKey(i))&&(this.currentPrimaryColor=r),null!=(a=n.style.colors.colorID(k.ColorRole.FieldSecondary))&&(s=n.page.colorLibraryController.getSolidColorForKey(a))&&(this.currentSecondaryColor=s),I.GroupController.call(this,e,n,o),n.persisted&&(this.dbListener=new l.ControllerDBListener(n.database,this))},a={},s.defineClass({name:"TypeLockupController",ctor:r,superName:"GroupController",statics:{KIND:{get:function(){return"type-lockup"}},PROPERTY_SIZE_DEPRECATED:"size",PROPERTY_LOCKUPSTYLE_DEPRECATED:"lockup-style",PROPERTY_CONTENT_ID:"content-id",PROPERTY_WRAPPER_ID:"wrapper-id",PROPERTY_HIGHLIGHTMETHOD_ID:"highlightMethod",PROPERTY_CHARSTYLERANGES:"charstyle-ranges",MIN_LINE_HEIGHT:{get:function(){return 20}},DEFAULT_BANNER_RATIO:{get:function(){return 1.5}},HIGHLIGHT_STYLE:"Highlight",FIRST_AUTO_METHOD:{get:function(){return void 0===a.FIRST_AUTO_METHOD&&(a.FIRST_AUTO_METHOD=l.HighlightMethod.EvenRows),a.FIRST_AUTO_METHOD}},MAX_AUTO_METHOD:{get:function(){return void 0===a.MAX_AUTO_METHOD&&(a.MAX_AUTO_METHOD=l.HighlightMethod.InsideBracket),a.MAX_AUTO_METHOD}},FIRST_NLP_METHOD:{get:function(){return void 0===a.FIRST_NLP_METHOD&&(a.FIRST_NLP_METHOD=l.HighlightMethod.Numbers),a.FIRST_NLP_METHOD}},MAX_NLP_METHOD:{get:function(){return void 0===a.MAX_NLP_METHOD&&(a.MAX_NLP_METHOD=l.HighlightMethod.SmallWords),a.MAX_NLP_METHOD}},NUM_HIGHLIGHTMETHODS:14,DelayBetweenUpdates:{get:function(){return 16}}},props:{contentID_:{get:function(){return s.as(this.controllerMetadata.get(r.PROPERTY_CONTENT_ID),"String")},set:function(t){this.controllerMetadata.set(r.PROPERTY_CONTENT_ID,t)}},wrappingGroupID_:{get:function(){return s.as(this.controllerMetadata.get(r.PROPERTY_WRAPPER_ID),"String")},set:function(t){this.controllerMetadata.set(r.PROPERTY_WRAPPER_ID,t)}},highlightMethod:{get:function(){var t,e;return(t=l.HighlightMethod.toCaseValue((e=s.as(this.controllerMetadata.get(r.PROPERTY_HIGHLIGHTMETHOD_ID),"Int"))||null!=e?e:0))||null!=t?t:l.HighlightMethod.Manual},set:function(t){this.controllerMetadata.set(r.PROPERTY_HIGHLIGHTMETHOD_ID,t)}},charStyleRanges:{get:function(){var t,e=[];if(t=s.as(this.controllerMetadata.get(r.PROPERTY_CHARSTYLERANGES),["Dictionary","String",["Array","Int"]]))for(var n=s.iter(t);!n.done;n.next()){var o=n.key,i=n.value;p.CoreAssert.isTrue(o==r.HIGHLIGHT_STYLE,"unexpected character style","TypeLockupController","TypeLockupController.swift",291);for(var a=s.iter(s.range(0,i.length,!0));!a.done;a.next()){var l=a.value;if(l%2==0&&l<i.length-1){var h=new ht.TextRange(i[l],i[l+1]);e.push(h)}}}return e},set:function(t){for(var e=[],n=s.iter(t);!n.done;n.next()){var o=n.value;e.push(o.start),e.push(o.end)}var i={Highlight:e};this.controllerMetadata.set(r.PROPERTY_CHARSTYLERANGES,s.clone(i))}},processEvent:function(t){var e;return(e=s.as(t,A.BeginPointerTrackingEvent))?(e.trackingResponse=C.BeginPointerTrackingResponseEnum.TrackAsGroup,!1):I.GroupController.prototype.processEvent.call(this,t)},selectable:{get:function(){return!0}},moveable:{get:function(){return null==this.forma.allowUserMove||this.forma.allowUserMove}},rotateable:{get:function(){return!0}},duplicatable:{get:function(){return!0}},flippable:{get:function(){return!1}},nudgeable:{get:function(){return!0}},copyTo:function(t){void 0===t&&(t=null);var e=this,n=s.opt(t,(function(t){return t.document}))||this.owner.document,o=n.content.createNode(et.TextContentNode.KIND,null);return o.match(this.contentNode),d.CreationFacade.addContent(t||n.firstPage,o,void 0,void 0,new d.AddFormaParams(void 0,!1)).then((function(t){var n,o;return(n=s.as(t,v.Forma))?((o=s.as(n.controller,r))&&o.match(e),n.match(e.forma),s.opt(D.Host.logging,(function(t){return t.logToAnalytics(h.AnalyticsConstants.kAnalyticsDataTextDuplicated,{})})),n):m.CorePromise.reject("didn't get a forma back from addContent?")}))},size:{get:function(){return s.opt(s.opt(this.forma,(function(t){return t.bounds})),(function(t){return t.size}))},set:function(t){var e=ut.TheoRect.fromSize(t),n=s.opt(this.forma,(function(t){return t.bounds}));null!=n&&e.equal(n)||s.opt(this.forma,(function(t){return t.bounds=e}))}},contentDocument:{get:function(){return s.opt(s.opt(this.forma,(function(t){return t.page.document})),(function(t){return t.content}))}},contentID:{get:function(){return this.contentID_},set:function(t){t!=this.contentID_&&(p.CoreAssert.isFalse(!(null==this.contentID_||""==this.contentID_||null!=t&&""!=t),"Why are we setting a nil/empty text content node id?","TypeLockupController","TypeLockupController.swift",474),this.removeListenersFromNode(),this.contentID_=t,this.addListenersToNode(),this.updateGroup())}},lockupForma:{get:function(){return s.as(this.forma,b.GroupForma)}},contentNode:{get:function(){var t=this;return null==this.contentID_?null:s.as(s.opt(this.contentDocument,(function(e){return e.nodeByID(t.contentID_)})),et.TextContentNode)},set:function(t){p.CoreAssert.isFalse(null==t,"Why are we setting a nil text content node?","TypeLockupController","TypeLockupController.swift",493),this.contentID=s.opt(t,(function(t){return t.id})),p.CoreAssert.isFalse(""==this.contentID,"Why are we setting a text content node with empty id?","TypeLockupController","TypeLockupController.swift",495)}},text:{get:function(){var t,e=this;if(null==this.contentNode){var n=s.opt(this.forma,(function(t){return t.formaID!=s.opt(e.forma,(function(t){return t.originalID}))}))?"Forma is a clone":"NOT A CLONE",o=1==this.validDecode_?"VALID DECODE":"Decode not valid";p.CoreAssert.fail("Why do we have a type lockup with no content node? "+n+" "+o,"TypeLockupController","TypeLockupController.swift",504)}return(t=s.opt(this.contentNode,(function(t){return t.text})))||null!=t?t:""}},getCurrentMSLPrimaryColor:function(){for(var t=s.iter(this.forma.style.characterStyles);!t.done;t.next()){var e;if(e=t.value.colors.fieldPrimary)return e}return null},getCurrentMSLBackingColor:function(){for(var t=s.iter(this.forma.style.characterStyles);!t.done;t.next()){var e,n=t.value;if((e=n.colors.fieldSecondary)&&n.backing!=N.LockupBacking.None)return e}return null},settings:{get:function(){return null==this.settings_&&(this.settings_=new y.TypeLockupControllerSettings(this)),this.settings_}},loadFontsForStyle:function(){var t,e=this;(t=s.opt(s.as(s.opt(this.lockupForma,(function(t){return t.style})),N.LockupStyle),(function(t){return t.font})))&&D.Host.fontProvider.loadFont(t.fontData,(function(){null!=e.lockupForma&&e.updateGroup()}),(function(){return D.Host.logging.warning("Unable to load font "+t.fontData.postScriptName+" for style.")}))},styleChanged:function(){s.opt(s.opt(s.opt(this.forma,(function(t){return t.root})),(function(t){return t.animation})),(function(t){return t.invalidate()})),this.updateGroup()},maintainAspectRatio:{get:function(){var t=s.replace(s.replace(this.text,"\n","")," ","");return this.lockLineBreaks_||this.text==t}},getAlignments:function(t){var e;if(void 0===t&&(t=!1),null==this.localCoordinateAlignmentLines_&&(this.localCoordinateAlignmentLines_=s.clone(this.alignmentsInLocalCoords(t))),e=this.lockupForma){for(var n=[],o=e.totalPlacement,i=this.forma_.visit(v.FormaTraversal.FurthestAncestor,(function(t,e,n){return!0})),r=s.iter(this.localCoordinateAlignmentLines_);!r.done;r.next()){var a=r.value;p.CoreAssert.isTrue(a.coordinateSpace==e,void 0,"TypeLockupController.getAlignments","TypeLockupController.swift",591),n.push(new u.AlignmentLine(a.type,a.location,u.AlignmentDetector.ALIGNMENT_FORMA,a.line.transform(o),a.text,i))}return n}return[]},alignmentsInLocalCoords:function(t){void 0===t&&(t=!1);var e,n=[];if(e=this.lockupForma){var o,i,r,a=u.AlignmentEdges.None,l=!1,h=!1,c=!1,g=!1,p=!1,d=!1,f=!1;if(r=this.lockupStyle){if(r.backing!=N.LockupBacking.None){o=e.childrenBoundsInCoordSpace(z.Matrix2D.Identity);var m=j.ShapeLibrary.shapeDictionary[r.backingShapeID];null!=m?(a=m.alignmentEdges,l=m.centered):(l=!0,r.backing==N.LockupBacking.BannerHorizontal?a=u.AlignmentEdges.TopAndBottom:r.backing==N.LockupBacking.BannerVertical?a=u.AlignmentEdges.LeftAndRight:r.backing==N.LockupBacking.Knockout?(a=u.AlignmentEdges.None,o=null,l=!1):a=u.AlignmentEdges.All)}null!=o&&(0!=(s.toInt(a)&s.toInt(u.AlignmentEdges.CenterX))&&(n.push(new u.AlignmentLine(u.AlignmentType.CenterX,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,o.verticalLine(.5),!0,e)),d=!0),0!=(s.toInt(a)&s.toInt(u.AlignmentEdges.Left))&&(n.push(new u.AlignmentLine(u.AlignmentType.Left,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,o.verticalLine(0),!1,e)),h=!0),0!=(s.toInt(a)&s.toInt(u.AlignmentEdges.Right))&&(n.push(new u.AlignmentLine(u.AlignmentType.Right,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,o.verticalLine(1),!1,e)),c=!0),0!=(s.toInt(a)&s.toInt(u.AlignmentEdges.CenterY))&&(n.push(new u.AlignmentLine(u.AlignmentType.CenterY,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,o.horizontalLine(.5),!0,e)),f=!0),0!=(s.toInt(a)&s.toInt(u.AlignmentEdges.Top))&&(n.push(new u.AlignmentLine(u.AlignmentType.Top,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,o.horizontalLine(0),!1,e)),p=!0),0!=(s.toInt(a)&s.toInt(u.AlignmentEdges.Bottom))&&(n.push(new u.AlignmentLine(u.AlignmentType.Bottom,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,o.horizontalLine(1),!1,e)),g=!0)),null==(i=this.textBoundsInCoordSpace(z.Matrix2D.Identity))||null!=o&&l&&a==u.AlignmentEdges.All||((null==o||!l||!(h||d||c))&&(this.numLines()<=1||s.opt(this.lockupStyle,(function(t){return t.alignment==N.LockupAlignment.UNSET}))?(n.push(new u.AlignmentLine(u.AlignmentType.CenterX,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(.5),!0,e)),n.push(new u.AlignmentLine(u.AlignmentType.Left,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(0),!0,e)),n.push(new u.AlignmentLine(u.AlignmentType.Right,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(1),!0,e))):s.opt(this.lockupStyle,(function(t){return t.alignment==N.LockupAlignment.Center}))?n.push(new u.AlignmentLine(u.AlignmentType.CenterX,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(.5),!0,e)):s.opt(this.lockupStyle,(function(t){return t.alignment==N.LockupAlignment.Left}))?n.push(new u.AlignmentLine(u.AlignmentType.Left,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(0),!0,e)):s.opt(this.lockupStyle,(function(t){return t.alignment==N.LockupAlignment.Right}))&&n.push(new u.AlignmentLine(u.AlignmentType.Right,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(1),!0,e))),(null==o||!l||!(p||f||g))&&(s.opt(this.lockupStyle,(function(t){return t.verticalAlignment==N.VerticalLockupAlignment.UNSET}))?(n.push(new u.AlignmentLine(u.AlignmentType.CenterY,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(.5),!0,e)),n.push(new u.AlignmentLine(u.AlignmentType.Top,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(0),!0,e)),n.push(new u.AlignmentLine(u.AlignmentType.Bottom,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(1),!0,e))):s.opt(this.lockupStyle,(function(t){return t.verticalAlignment==N.VerticalLockupAlignment.VerticalCenter}))?n.push(new u.AlignmentLine(u.AlignmentType.CenterY,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(.5),!0,e)):s.opt(this.lockupStyle,(function(t){return t.verticalAlignment==N.VerticalLockupAlignment.Top}))?n.push(new u.AlignmentLine(u.AlignmentType.Top,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(0),!0,e)):s.opt(this.lockupStyle,(function(t){return t.verticalAlignment==N.VerticalLockupAlignment.Bottom}))&&n.push(new u.AlignmentLine(u.AlignmentType.Bottom,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(1),!0,e))))}}return n},processFormaDoubleClick:function(t){this.owner.selection.replaceSelection(t.forma),this.owner.selection.isSelected(t.forma)&&(s.opt(D.Host.logging,(function(t){return t.logToAnalytics(h.AnalyticsConstants.kAnalyticsDataTextDoubleTapEnterTextEditor,{})})),this.owner.controllerSettingsState.settings=this.settings)},processBeginFormaResize:function(t){I.GroupController.prototype.processBeginFormaResize.call(this,t),this.startSize_=this.size,this.passedARThreshold_=!1,s.opt(s.opt(s.opt(this.forma,(function(t){return t.root})),(function(t){return t.animation})),(function(t){return t.invalidate()})),this.updateBannerRatio()},processFormaResize:function(t){var e=null;(a=t.pin)&&(e=this.forma.placement.transformPoint(this.forma.bounds.eval(a)));var n=t.newSize;if(null!=this.startSize_){var o=this.startSize_.similarity(t.newSize);o<.03?(o<.005&&(this.passedARThreshold_=!1),this.passedARThreshold_||(n=this.startSize_.myAspectRatioClosestCorner(n))):this.passedARThreshold_=!0}this.updateBanner(n);var i=new M.FormaTransformChangedEvent(this.forma);this.forma.beginUpdate(i);var r,a,l=this.forma.placement.extractedScale;if(this.forma.placement=l.matrix,this.size=n,(r=e)&&(a=t.pin)){var s=this.forma.placement.transformPoint(this.forma.bounds.eval(a));this.forma.move(z.Matrix2D.translation(r.subtract(s)))}this.forma.endUpdate(i),this.updateParentGroup()},processEndFormaResize:function(t){I.GroupController.prototype.processEndFormaResize.call(this,t),this.snapSizeToBounds(),this.startSize_=null,this.invalidateStyleScores()},processEndFormaDrag:function(t){I.GroupController.prototype.processEndFormaDrag.call(this,t)},invalidateStyleScores:function(){this.styleController_.hasScoresForAttributes=!1},addListenersToNode:function(){var t=this;if(0==this.changeSubscriptions_.length&&null!=this.contentNode){var e=function(e){return s.opt(t,(function(t){return t.updateGroup()}))};this.changeSubscriptions_.push(this.contentNode.subscribeWithCallbackToTextModel(e,rt.TextModelDidApplyMessage.TYPE)),this.changeSubscriptions_.push(this.contentNode.subscribeWithCallbackToTextModel(e,rt.TextModelDidInsertMessage.TYPE)),this.changeSubscriptions_.push(this.contentNode.subscribeWithCallbackToTextModel(e,rt.TextModelDidRemoveMessage.TYPE))}},removeListenersFromNode:function(){for(;this.changeSubscriptions_.length>0;)this.changeSubscriptions_.pop().unsubscribe()},bannerRatio:{get:function(){return this.bannerRatio_},set:function(t){this.bannerRatio_=t}},styleController:{get:function(){return this.styleController_}},updateBannerRatio:function(){var t;(t=this.lockupStyle)&&(t.backing!=N.LockupBacking.Banner&&t.backing!=N.LockupBacking.BannerHorizontal&&t.backing!=N.LockupBacking.BannerVertical||(t.backing==N.LockupBacking.BannerHorizontal&&this.size.width<this.size.height?this.bannerRatio=this.size.height/this.size.width+.1:t.backing==N.LockupBacking.BannerVertical&&this.size.height<this.size.width?this.bannerRatio=this.size.width/this.size.height+.1:this.bannerRatio=r.DEFAULT_BANNER_RATIO))},updateBanner:function(t){var e;(e=this.lockupStyle)&&(e.backing!=N.LockupBacking.Banner&&e.backing!=N.LockupBacking.BannerHorizontal&&e.backing!=N.LockupBacking.BannerVertical||(e.backing==N.LockupBacking.BannerVertical&&t.width/t.height>this.bannerRatio?(e.backing=N.LockupBacking.BannerHorizontal,this.bannerRatio=r.DEFAULT_BANNER_RATIO):e.backing==N.LockupBacking.BannerHorizontal&&t.height/t.width>this.bannerRatio&&(e.backing=N.LockupBacking.BannerVertical,this.bannerRatio=r.DEFAULT_BANNER_RATIO)))},shift:function(t,e){return new ht.TextRange(t.start+e,t.end+e)},onStyleApplication:function(){this.loadFontsForStyle(),this.updateGroup()},layoutStrategyForConfiguration:function(t){if(null!=this.layoutStrategy_&&this.layoutStrategy_.supportsConfiguration(t))return this.layoutStrategy_;var e=t.style.layout;return e==N.LockupLayout.FitJustified?new L.EvenRowWidthsLayoutStrategy:e==N.LockupLayout.Standard?new S.EvenRowHeightsLayoutStrategy(t.style.alignment):N.LockupStyle.isLetterGrid(e)?new E.LetterGridLayoutStrategy:N.LockupStyle.isPath(e)?new W.PathLayoutStrategy:(p.CoreAssert.isTrue(!1,"Unknown Layout "+e,"TypeLockupController.layoutStrategyForConfiguration","TypeLockupController.swift",1026),new S.EvenRowHeightsLayoutStrategy(N.LockupAlignment.Left))},decorationStrategyForConfiguration:function(t){if(null!=this.decorationStrategy_&&this.decorationStrategy_.supportsConfiguration(t))return this.decorationStrategy_;var e=null,n=t.style.backing;return N.LockupStyle.isLetterGrid(t.style.layout)?e=new P.LetterDecorationStrategy:n==N.LockupBacking.None?e=new Y.NoDecorationStrategy:n==N.LockupBacking.Rows?e=new V.RowsDecorationStrategy:n==N.LockupBacking.Knockout?e=new V.KnockoutDecorationStrategy:n==N.LockupBacking.Banner||n==N.LockupBacking.BannerVertical||n==N.LockupBacking.BannerHorizontal?e=new c.BannerDecorationStrategy:n==N.LockupBacking.SVGBackground?null!=t.style.backingArtworkID?e=new J.SVGBackgroundDecorationStrategy(t.style.backingArtworkID):(D.Host.logging.warning("Error in svg background. nil backingArtworkID. defaulting to no backing"),e=new Y.NoDecorationStrategy):(p.CoreAssert.isTrue(!1,"Unimplemented value for lockup layout.","TypeLockupController.decorationStrategyForConfiguration","TypeLockupController.swift",1059),e=new Y.NoDecorationStrategy),e},styleFontsLoaded:function(){var t;return!(t=s.opt(s.as(s.opt(this.lockupForma,(function(t){return t.style})),N.LockupStyle),(function(t){return t.font})))||t.fontData.availability==x.FontAvailability.LOADED},updatePoolForItems:function(t,e){for(var n,o=0,i={},r=s.iter(t);!r.done;r.next()){var a=r.value;if(a.type==O.LockupItemType.Text){var l=a.text.toUpperCase(),h=(n=i[l])||null!=n?n:0;i[l]=h+1}else o+=1}for(var u=s.iter(e.configureTextFormae(s.clone(i)));!u.done;u.next()){var c=u.value;s.opt(c.parent,(function(t){return t.removeChild(c)}))}for(var g=s.iter(e.configureShapeFormae(o));!g.done;g.next())c=g.value,s.opt(c.parent,(function(t){return t.removeChild(c)}))},conformFormaeForItems:function(t,e,n,o){var i;if(void 0===n&&(n=!1),void 0===o&&(o=!1),null!=this.lockupForma)for(var r={},a=0,l=s.iter(t);!l.done;l.next()){var h,u,c,g=l.value;switch(g.type){case 0:var p,d,f=g.text.toUpperCase(),m=(i=r[f])||null!=i?i:0,y=e.nthTextFormaForString(m,f);this.conformTextFormaToItem(y,s.clone(g),!1),h=y,r[f]=m+1,u=o?0:1,(p=h.parent)&&(d=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(u)})),b.GroupForma))&&p!==d&&p.removeChild(h);break;case 1:case 2:y=e.nthShapeForma(a),this.conformShapeFormaToItem(y,s.clone(g),!1),h=y,a+=1,u=0}if(h.isFullCanvas=g.isFullCanvas,0==u&&(c=h.parent)){var k=n?e.shapeFormaCount()-a:a-1;c.childCount<=k||k<0?(c.removeChild(h),c.appendChild(h,!1)):s.eq(v._equality_Forma_Forma,c.childAt(k),h)||(c.removeChild(h),c.insertChildAt(h,k,!1))}if(null==h.parent){var S=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(u)})),b.GroupForma);null!=S&&(n?S.insertChildAt(h,0,!1):S.appendChild(h,!1))}}},lockupStyle:{get:function(){return s.as(s.opt(this.lockupForma,(function(t){return t.style})),N.LockupStyle)}},renderedLayoutResults:{get:function(){return this.renderedLayoutResults_}},calculateScalarToFit:function(t,e){var n=t.width,o=t.height,i=n/o,r=e.width,a=e.height,l=r/a,s=(i>=l?o:n/l)/a;return isNaN(s)?1:s},scalarToFitLayoutResultsIntolockupForma:function(){var t=s.clone(this.renderedLayoutResults_);if(null==t)return 1;var e=t.size,n=this.calculateScalarToFit(this.size,e);return isNaN(n)?1:n},wrappingGroup:{get:function(){var t,e=this;return null!=this.wrappingGroup_?this.wrappingGroup_:null!=this.wrappingGroupID_&&(t=s.as(s.opt(this.lockupForma,(function(t){return t.page.formaByID(e.wrappingGroupID_)})),b.GroupForma))?t:s.opt(this.lockupForma,(function(t){return 1==t.childCount}))?s.as(s.opt(this.lockupForma,(function(t){return t.childAt(0)})),b.GroupForma):null}},onFirstUpdate:function(){var t,e=this,n=!1;null!=(t=this.wrappingGroupID_)&&0==s.isEmpty(t)&&(n=!0);var o=null!=this.wrappingGroup_;if(0==n?(r=s.as(this.lockupForma.isModel?s.opt(this.lockupForma,(function(t){return t.page.createModelForma(b.GroupForma.KIND)})):s.opt(this.lockupForma,(function(t){return t.page.createForma(b.GroupForma.KIND)})),b.GroupForma))&&(s.opt(this.lockupForma,(function(t){return t.removeAllChildren()})),this.wrappingGroup_=r,this.wrappingGroupID_=r.formaID,s.opt(this.lockupForma,(function(t){return t.appendChild(r)}))):0==o&&(this.wrappingGroup_=s.as(s.opt(this.lockupForma,(function(t){return t.page.formaByID(e.wrappingGroupID_)})),b.GroupForma)),0==this.wrappingGroup_.childCount)for(var i=s.iter(s.range(0,2,!1));!i.done;i.next()){var r;(r=s.as(this.lockupForma.isModel?this.lockupForma.page.createModelForma(b.GroupForma.KIND):this.lockupForma.page.createForma(b.GroupForma.KIND),b.GroupForma))&&s.opt(this.wrappingGroup_,(function(t){return t.appendChild(r)}))}this.updateFormaPools()},updateFormaPools:function(){if(this.decorationFormaePool_.clear(),this.layoutFormaePool_.clear(),this.renderedLayoutResults_=null,this.renderedDecorationResults_=null,this.renderedConfiguration_=null,null!=this.wrappingGroup_&&this.wrappingGroup_.childCount>=2){var t,e,n,o,i=!1;if((e=this.lockupStyle)&&(i=e.backing!=N.LockupBacking.None&&e.textLook==N.LockupTextLook.FillAndOutline2||N.LockupStyle.isShadowLook(e.textLook),t=e.colors.fieldPrimary),n=s.as(this.wrappingGroup_.childAt(0),b.GroupForma))for(var r=s.iter(n.childrenAsArray);!r.done;r.next()){var a=r.value;this.decorationFormaePool_.addForma(a)}if(o=s.as(this.wrappingGroup_.childAt(1),b.GroupForma))for(var l=s.iter(o.childrenAsArray);!l.done;l.next())a=l.value,i&&!s.eq(K._equality_SolidColor_SolidColor,s.opt(s.as(a.style,ct.TextStyle),(function(t){return t.colors.fieldPrimary})),t)?this.decorationFormaePool_.addForma(a):this.layoutFormaePool_.addForma(a)}},recalculateTracking:function(t){var e=this.lockupForma,n=this.lockupStyle,o=this.text,i=new B.LockupConfiguration(o,n,t,e.placement,s.opt(e.parent,(function(t){return t.bounds}))),r=new gt.TheoSize(this.size.width,this.size.height);null==this.layoutStrategy_&&(this.layoutStrategy_=this.layoutStrategyForConfiguration(i));var a=this.layoutStrategy_.calculateTracking(i,r),l=t;0!=a&&a<1e-4&&(l=new gt.TheoSize(-a,l.height),a=0),this.beginBlockedUpdate(),s.opt(s.as(s.opt(this.lockupForma,(function(t){return t.style})),N.LockupStyle),(function(t){return t.tracking=a})),this.styleController.onTrackingChanged(),this.size=l,this.endBlockedUpdate(),this.internalUpdateGroup(!1)},recalculateLeading:function(t){var e=this.lockupForma,n=this.lockupStyle,o=this.text,i=new B.LockupConfiguration(o,n,t,e.placement,s.opt(e.parent,(function(t){return t.bounds}))),r=new gt.TheoSize(this.size.width,this.size.height);null==this.layoutStrategy_&&(this.layoutStrategy_=this.layoutStrategyForConfiguration(i));var a=this.layoutStrategy_.calculateLeading(i,r),l=t;a<0&&(l=new gt.TheoSize(l.width,-a),a=0),this.beginBlockedUpdate(),s.opt(this.lockupStyle,(function(t){return t.spacing=a})),this.styleController.onSpacingChanged(),this.size=l,this.endBlockedUpdate(),this.internalUpdateGroup(!1)},setLetterSpacingAndBounds:function(t,e){var n;if(void 0===e&&(e=st.TheoPoint.ZERO),null==this.renderedLayoutResults_&&this.updateGroup(),n=this.renderedLayoutResults_){var o=this.layoutStrategy_.adjustWidthForTracking(this.text,s.clone(n),this.lockupStyle.tracking,t);if(0==o)return;var i,r=!1,a=0;null!=(i=o)&&(r=!0,a=i);var l=this.forma.placement.transformValues,h=this.forma.bounds,u=new gt.TheoSize(h.width*l.xscale,h.height*l.xscale),c=new gt.TheoSize(u.width+a,u.height);if(c.width<=0)return;if(r){this.beginBlockedUpdate(),this.lockupStyle.tracking=t,this.endBlockedUpdate();var g=new A.FormaResizeEvent(this.forma,c,e);this.onEvent(g),this.snapSizeToBounds()}else this.lockupStyle.tracking=t}},setLineSpacingAndBounds:function(t,e){var n;if(void 0===e&&(e=st.TheoPoint.ZERO),null==this.renderedLayoutResults_&&this.updateGroup(),!(this.numLines()-1<1)&&(n=this.renderedLayoutResults_)){var o=this.layoutStrategy_.adjustHeightForLeading(this.forma.bounds,s.clone(n),this.lockupStyle.spacing,t),i=this.forma.placement.transformValues,r=this.forma.bounds,a=new gt.TheoSize(r.width*i.xscale,r.height*i.xscale),l=new gt.TheoSize(a.width,a.height+o);this.beginBlockedUpdate(),this.lockupStyle.spacing=t,this.endBlockedUpdate();var h=new A.FormaResizeEvent(this.forma,l,e);this.onEvent(h),this.snapSizeToBounds()}},addLineBreakConstraints:function(){this.allowFewerLineBreaks_=!1;var t=s.replace(s.replace(this.text,"\n"," "),"  "," "),e=s.replace(t," ","");this.lockLineBreaks_=t.split(" ").length==e.length,!this.lockLineBreaks_&&this.text.split("\n").length>1&&(this.allowFewerLineBreaks_=!0)},removeLineBreakConstraints:function(){this.lockLineBreaks_=!1,this.allowFewerLineBreaks_=!1},updateGroup:function(){this.internalUpdateGroup(!0)},updateGroupWithFontSize:function(t){this.internalUpdateGroup(!0,t)},internalUpdateGroup:function(t,e){var n;if(void 0===e&&(e=null),!(n=s.opt(s.opt(this.owner,(function(t){return t.document})),(function(t){return t.inUndoRedo})))&&null==n||!n)if(null!=this.lockupForma){if(!this.blockUpdate&&null!=this.lockupStyle){0==this.hasFirstUpdateRun&&(this.onFirstUpdate(),this.hasFirstUpdateRun=!0);var o=this.lockupForma,i=this.lockupStyle;if(!(null!=this.size&&null!=i.font&&this.styleFontsLoaded()&&i.colors.count>0&&this.text.length>0))return this.renderedConfiguration_=null,this.renderedColorLibrary_=null,this.renderedDecorationResults_=null,this.renderedLayoutResults_=null,this.clearLockupFormaPool(this.layoutFormaePool_),void this.clearLockupFormaPool(this.decorationFormaePool_);var a,l,h=this.text,u=!this.owner.selection.inCharStyleMode,c=this.forceLetterFormaMode,g=new B.LockupConfiguration(h,i,this.size,o.placement,s.opt(o.parent,(function(t){return t.bounds})),u,c,e);if(g.characterStyleRanges=s.clone(this.charStyleRanges),g.highlightMethod=this.highlightMethod,g.rowWordLengths=null,this.lockLineBreaks_||this.allowFewerLineBreaks_){for(var d=s.clone(this.lockupForma.filterByKind(ot.TextForma.KIND)),m=0,y=s.iter(d);!y.done;y.next()){var k=y.value;m=Math.max(m,k.rowIndex)}g.rowWordLengths=s.repeat(0,m+1);for(var S=s.iter(d);!S.done;S.next())k=S.value,g.rowWordLengths[k.rowIndex]+=1;g.allowFewerLineBreaks=this.allowFewerLineBreaks_}(a=i.colors.fieldPrimary)&&(this.currentPrimaryColor=a),(l=i.colors.fieldSecondary)&&(this.currentSecondaryColor=l),this.decorationStrategy_=this.decorationStrategyForConfiguration(g),this.layoutStrategy_=this.layoutStrategyForConfiguration(g);var L=null==this.renderedConfiguration_||Math.abs(this.size.height-this.thresholdGroupHeight)>1||Math.abs(this.size.width-this.thresholdGroupWidth)>1||this.renderedConfiguration_.text!=g.text||g.style.needsLayout(this.renderedConfiguration_.style)||this.renderedConfiguration_.characterStyleRanges!=g.characterStyleRanges||this.renderedConfiguration_.highlightMethod!=g.highlightMethod||0==this.layoutFormaePool_.textFormaCount()||this.renderedConfiguration_.forceLetterForma!=g.forceLetterForma;if(!L)for(var v=s.iter(g.style.characterStyles);!v.done;v.next()){var T=v.key,F=v.value;if(!(w=this.renderedConfiguration_.style.characterStyles[T])){L=!0;break}if(w.colorLibrary=this.renderedColorLibrary_,p.CoreAssert.isTrue(F.colorLibrary==i.colorLibrary,"char style library doesnt match lockup style","TypeLockupController.internalUpdateGroup","TypeLockupController.swift",1745),F.needsLayout(w)||F.textOpacity!=w.textOpacity||F.backingOpacity!=w.backingOpacity){L=!0;break}}var C=L||!g.style.sameColors(this.renderedConfiguration_.style),x=null==this.renderedConfiguration_||g.style.needsLayout(this.renderedConfiguration_.style),A=null==this.renderedConfiguration_||L||!this.renderedConfiguration_.containerSize.equal(g.containerSize)||!this.renderedConfiguration_.placement.equal(g.placement)||this.renderedConfiguration_.style.backingArtworkID!=g.style.backingArtworkID||this.renderedConfiguration_.style.backing!=g.style.backing||this.renderedConfiguration_.style.textLook!=g.style.textLook||this.renderedConfiguration_.style.shadowAngle!=g.style.shadowAngle||C&&N.LockupStyle.isShadowLook(g.style.textLook);if(!A)for(var R=s.iter(g.style.characterStyles);!R.done;R.next()){var w;if(T=R.key,F=R.value,A=C&&F.textLook==N.LockupTextLook.KnockoutAndShadow,(w=this.renderedConfiguration_.style.characterStyles[T])&&(F.backingArtworkID!=w.backingArtworkID||F.shadowAngle!=w.shadowAngle)){A=!0;break}}if(this.isRightToLeft=it.TypeLockupUtils.isTextRightToLeft(h),L){var M=s.clone(this.layoutStrategy_.layout(g));this.isRightToLeft&&M.flipForRightToLeft(),this.updatePoolForItems(s.clone(M.items),this.layoutFormaePool_),this.renderedLayoutResults_=s.clone(M)}var _=g.style.backing==N.LockupBacking.None,I=!1;if(A){var b=this.decorationStrategy_.decorate(g,s.clone(this.renderedLayoutResults_));if((F=g.style.characterStyles[r.HIGHLIGHT_STYLE])&&!N.LockupStyle.isPath(g.style.layout)){if(N.LockupStyle.isShadowLook(F.textLook)){var D=(new Q.ShadowDecorationStrategy).decorate(g,s.clone(this.renderedLayoutResults_));s.append(b.items,D.items),_=!0,I=F.textLook==N.LockupTextLook.KnockoutAndShadow}if(g.style.backing!=N.LockupBacking.None&&F.textLook==N.LockupTextLook.FillAndOutline2){var H=(new Y.NoDecorationStrategy).decorate(g,s.clone(this.renderedLayoutResults_));s.append(b.items,H.items),_=!0}if((F.backing==N.LockupBacking.Rows||F.backing==N.LockupBacking.SVGBackground)&&g.style.backing!=N.LockupBacking.Rows&&!N.LockupStyle.isLetterGrid(g.style.layout)){var P=(new V.RowsDecorationStrategy).decorate(g,s.clone(this.renderedLayoutResults_));if(_&&b.items.length>1)for(var E=s.iter(P.items);!E.done;E.next()){var O=E.value;b.items.splice(0,0,s.clone(O))}else s.append(b.items,P.items)}}if(g.style.backing!=N.LockupBacking.None&&g.style.textLook==N.LockupTextLook.FillAndOutline2){var G=(new Y.NoDecorationStrategy).decorate(g,s.clone(this.renderedLayoutResults_));s.append(b.items,G.items),_=!0}else if(N.LockupStyle.isShadowLook(g.style.textLook)){var U=(new Q.ShadowDecorationStrategy).decorate(g,s.clone(this.renderedLayoutResults_));s.append(b.items,U.items),_=!0,I=g.style.textLook==N.LockupTextLook.KnockoutAndShadow}this.updatePoolForItems(s.clone(b.items),this.decorationFormaePool_),this.renderedDecorationResults_=b}(C||L)&&this.conformFormaeForItems(s.clone(this.renderedLayoutResults_.items),this.layoutFormaePool_),(C||A)&&this.conformFormaeForItems(s.clone(this.renderedDecorationResults_.items),this.decorationFormaePool_,_,I);var W=this.renderedLayoutResults_.size.width,X=this.renderedLayoutResults_.size.height;this.thresholdGroupHeight=this.size.height,this.thresholdGroupWidth=this.size.width,this.setLayerOpacities(i);var K=this.findInternalOffset(i,this.size,new gt.TheoSize(W,X));this.updateChildGroupBounds(),t&&s.opt(this.wrappingGroup,(function(t){return t.placement=z.Matrix2D.Identity.translate(K)})),this.localCoordinateAlignmentLines_=s.clone(this.alignmentsInLocalCoords(!0)),(L||A)&&s.opt(s.opt(this.lockupForma,(function(t){return t.animation})),(function(t){return t.invalidate()})),g.style=i.clone(),this.renderedColorLibrary_=f.ColorLibrary.init_fcb1(i.colorLibrary),this.renderedConfiguration_=g,this.renderedConfiguration_.style.colorLibrary=this.renderedColorLibrary_,L&&this.highlightMethod>=r.FIRST_AUTO_METHOD&&this.highlightMethod<=r.MAX_AUTO_METHOD&&(this.autoApplyCharStyle(!0,!1,!0),x&&this.updateGroup())}}else p.CoreAssert.warning("TypeLockupController.updateGroup() after detachment")},setLayerOpacities:function(t){var e=t.currentTextOpacity,n=t.currentBackingOpacity,o=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(1)})),b.GroupForma);s.opt(o,(function(t){return t.style.opacity=e})),o=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(0)})),b.GroupForma),s.opt(o,(function(t){return t.style.opacity=n}))},updateChildGroupBounds:function(){var t,e;if(t=this.wrappingGroup_){var n=new M.FormaGeometryChangedEvent(t);t.beginUpdate(n),t.endUpdate(n)}(e=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(1)})),b.GroupForma))&&(n=new M.FormaGeometryChangedEvent(e),e.beginUpdate(n),e.endUpdate(n)),(e=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(0)})),b.GroupForma))&&(n=new M.FormaGeometryChangedEvent(e),e.beginUpdate(n),e.endUpdate(n))},findInternalOffset:function(t,e,n){var o=0,i=0,r=(e.width-n.width)/2,a=(e.height-n.height)/2,l=t.alignment,s=t.verticalAlignment;return l==N.LockupAlignment.UNSET||l==N.LockupAlignment.Center?o=r:l==N.LockupAlignment.Right&&(o=e.width-n.width),s==N.VerticalLockupAlignment.UNSET||s==N.VerticalLockupAlignment.VerticalCenter?i=a:s==N.VerticalLockupAlignment.Bottom&&(i=e.height-n.height),new st.TheoPoint(o,i)},conformTextFormaToItem:function(t,e,n){var o,i,r=this;if(e.type==O.LockupItemType.Text){var a=null;n&&((a=new M.FormaAnimationTransactionEvent(t)).duration=0,t.beginUpdate(a));var l,h,u=e.font,c=e.hasPrimaryColor?this.currentPrimaryColor:this.currentSecondaryColor,g=this.currentSecondaryColor,d=this.lockupStyle.textLook;t.style.opacity=1,null!=e.characterStyle&&(S=s.opt(this.lockupStyle,(function(t){return t.characterStyles[e.characterStyle]})))&&(S.textLook!=N.LockupTextLook.UNSET&&(d=S.textLook),p.CoreAssert.isTrue(S.colorLibrary==this.lockupStyle.colorLibrary,"char style library doesnt match lockup style","TypeLockupController.conformTextFormaToItem","TypeLockupController.swift",2062),(l=e.hasPrimaryColor?S.colors.fieldPrimary:S.colors.fieldSecondary)&&(c=l),(h=S.colors.fieldSecondary)&&(g=h),S.opacityRule!=N.OpacityRule.UNSET&&(t.style.opacity=S.textOpacity),S.textLook==N.LockupTextLook.Fill&&N.LockupStyle.isKnockoutLook(this.lockupStyle.textLook)&&S.textOpacity<1&&S.textOpacity!=N.LockupStyle.OPACITY_UNSET&&(d=N.LockupTextLook.KnockoutAndFill));var f=(o=s.opt(this.renderedLayoutResults_,(function(t){return t.avgTextPointSize})))||null!=o?o:e.pointSize,m=0,y=this.lockupStyle.strokeWeight+.04;if(d==N.LockupTextLook.OutlineOnly)m=.5*f*y;else if(d==N.LockupTextLook.KnockoutAndOutline)m=.5*f*y,g=c;else if(d==N.LockupTextLook.FillAndOutline)m=.5*f*y;else if(d==N.LockupTextLook.ShadowAndOutline)m=.08*f*(y+.25);else if(d==N.LockupTextLook.KnockoutAndShadow){var S;e.hasPrimaryColor||(m=.08*e.pointSize*(1.7*this.lockupStyle.shadowOffset+.25),t.style.opacity=.75,c=this.currentPrimaryColor,g=this.currentPrimaryColor,null!=e.characterStyle&&(S=s.opt(this.lockupStyle,(function(t){return t.characterStyles[e.characterStyle]})))&&(c=S.colors.fieldPrimary||this.currentPrimaryColor,g=S.colors.fieldPrimary||this.currentPrimaryColor))}else d==N.LockupTextLook.FillAndOutline2?e.hasPrimaryColor||(m=.5*f*y):d==N.LockupTextLook.KnockoutAndFill&&s.opt(this.lockupStyle,(function(t){return t.colors.colorID(k.ColorRole.FieldPrimary)==s.opt(r.lockupStyle,(function(t){return t.colors.colorID(k.ColorRole.FieldSecondary)}))}))&&(m=((i=s.opt(this.lockupStyle,(function(t){return t.backingOpacity})))||null!=i?i:1)>.8?6:1);t.setTextProperties(e.text,u,e.pointSize,c,g,m,d,e.rangeInLockup,e.rowIndex,this.lockupStyle.tracking),t.placement=e.placement,n&&t.endUpdate(a)}else p.CoreAssert.fail("Expected text item","TypeLockupController.conformTextFormaToItem","TypeLockupController.swift",2038)},conformShapeFormaToItem:function(t,e,n){var o=null;n&&((o=new M.FormaAnimationTransactionEvent(t)).duration=0,t.beginUpdate(o)),t.style.opacity=1;var i,r,a=e.hasPrimaryColor?this.currentPrimaryColor:this.currentSecondaryColor;switch(null!=e.characterStyle&&(i=s.opt(this.lockupStyle,(function(t){return t.characterStyles[e.characterStyle]})))&&(p.CoreAssert.isTrue(i.colorLibrary==this.lockupStyle.colorLibrary,"char style library doesnt match lockup style","TypeLockupController.conformShapeFormaToItem","TypeLockupController.swift",2165),(r=e.hasPrimaryColor?i.colors.fieldPrimary:i.colors.fieldSecondary)&&(a=r),i.opacityRule!=N.OpacityRule.UNSET&&(t.style.opacity=i.backingOpacity)),e.type){case 0:p.CoreAssert.fail("Text item cannot be associated with a shape forma","TypeLockupController.conformShapeFormaToItem","TypeLockupController.swift",2178);break;case 1:t.contentID=null,t.preScale=null,t.size=e.size,t.sliceBox=null,t.shapeLibraryID=null,t.canonicalArtwork=tt.TheoArtworkShape.fromPath(e.path),t.style.colors.fieldPrimary=a,t.placement=e.placement;break;case 2:if(t.shapeLibraryID!=e.artworkID&&j.ShapeLibrary.applyToShapeForma(t,e.artworkID),null==t.sliceBox){var l=t.canonicalArtwork.bounds,h=l.width,u=l.height,c=e.size,g=c.width<=c.height?c.width/h:c.height/u;h*=g,u*=g,t.size=new gt.TheoSize(h,u)}else t.size=e.size;t.preScale=e.preScale,t.placement=e.placement,t.style.colors.fieldPrimary=a}n&&t.endUpdate(o)},decodeMetadata:function(){var t,e;this.beginBlockedUpdate(),(t=s.as(this.controllerMetadata.get(r.PROPERTY_LOCKUPSTYLE_DEPRECATED),N.LockupStyle))&&(t.backing==N.LockupBacking.Banner&&(t.backing=this.size.width>this.size.height?N.LockupBacking.BannerHorizontal:N.LockupBacking.BannerVertical),s.opt(this.lockupForma,(function(e){return e.applyStyle(t)}))),(e=s.as(this.controllerMetadata.get(r.PROPERTY_SIZE_DEPRECATED),gt.TheoSize))&&(this.size=e),this.endBlockedUpdate()},postDecode:function(){var t,e,n;this.validDecode_=null!=this.contentNode,this.removeListenersFromNode(),this.addListenersToNode(),this.beginBlockedUpdate(),this.styleController_.legacyColorConversion(),this.endBlockedUpdate();var o,i=(t=s.opt(s.opt(this.lockupForma,(function(t){return t.page.document})),(function(t){return t.versionDecoded.vers})))||null!=t?t:0,r=!1;if(p.CoreAssert.isTrue(this.lockupForma.controller===this,void 0,"TypeLockupController.postDecode","TypeLockupController.swift",2284),o=s.as(this.lockupForma.style,N.LockupStyle)){var a,l;if(p.CoreAssert.isTrue(this.lockupForma.style===this.lockupStyle,void 0,"TypeLockupController.postDecode","TypeLockupController.swift",2288),o.backing==N.LockupBacking.SVGBackground&&(null==o.backingArtworkID&&(p.CoreAssert.fail("postDecode - style.backingArtworkID is nil. "+((e=s.opt(s.opt(this.lockupForma,(function(t){return t.page.document})),(function(t){return t.versionDecoded.description})))||null!=e?e:"nil"),"TypeLockupController.postDecode","TypeLockupController.swift",2293),o.backingArtworkID="square_001"),null!=(a=o.backingArtworkID)&&(l=this.contentDocument.nodeWithTag(j.TAG_SHAPE_ID,a))&&l.removeFromParent()),i<nt.TheoDocumentVersion.Knockouts&&o.backing==N.LockupBacking.None&&1!=o.textOpacity){var h=o.textOpacity,u=o.backingOpacity;o.textOpacity=h,o.backingOpacity=u}if(N.LockupStyle.isKnockoutLook(o.textLook)){var c=o.backing;o.backing=N.LockupBacking.None,o.backing=c}var g=(n=s.opt(s.opt(this.forma,(function(t){return t.page.document})),(function(t){return t.missingFontList.length})))||null!=n?n:0;if(g>this.missingFontCount_?(r=!0,this.missingFontCount_=g):i<nt.TheoDocumentVersion.LetterSpacing&&s.opt(o.font,(function(t){return"Pacifico-Regular"==t.fontData.postScriptName||s.opt(o.font,(function(t){return"Montserrat-Regular"==t.fontData.postScriptName}))}))&&(r=!0),i<nt.TheoDocumentVersion.NewTextAnimations&&(this.text.includes("–")||this.text.includes("—"))&&0==o.spacing&&(o.spacing=.5,r=!0),i<nt.TheoDocumentVersion.TextEffects&&null!=this.contentNode){var d=rt.ContentTextModel.init_d41d();d.match(this.contentNode.textModel),this.contentNode.textModel=d}}var f,m=!1;null!=(f=this.wrappingGroupID_)&&0==s.isEmpty(f)&&(m=!0),r?this.styleChanged():m||this.updateGroup()},clone:function(t){var e=new F.FormaControllerFactory(this.owner).createController(this.kind,t);return e.beginBlockedUpdate(),e.controllerMetadata=t.controllerMetadata,e.size=this.size,e.highlightMethod=this.highlightMethod,e.charStyleRanges=s.clone(this.charStyleRanges),e.contentID=this.contentID,e.validDecode_=this.validDecode_,e.removeListenersFromNode(),e.endBlockedUpdate(),e},match:function(t){var e;(e=s.as(t,r))?(this.size=e.size,this.highlightMethod=e.highlightMethod,0==s.count(s.opt(this.lockupStyle,(function(t){return t.characterStyles})))&&0==!this.charStyleRanges.length?this.charStyleRanges=[]:it.TypeLockupUtils.rangesAreEqual(s.clone(this.charStyleRanges),s.clone(e.charStyleRanges))||this.text==e.text&&(this.charStyleRanges=s.clone(e.charStyleRanges)),this.updateGroup()):I.GroupController.prototype.match.call(this,t)},formaWillChangeState:function(t,e){var n=this;if(null!=e[b.GroupForma.PROPERTY_BOUNDS]||null!=e[v.Forma.PROPERTY_STYLE]||null!=e[v.Forma.PROPERTY_PLACEMENT]){t.visitAll(v.FormaTraversal.PreOrder,(function(t){(t instanceof q.ShapeForma||t instanceof ot.TextForma)&&(n.formaUpdateEvents_.push(new M.FormaGeometryChangedEvent(t)),null!=e[v.Forma.PROPERTY_STYLE]&&n.formaUpdateEvents_.push(new M.FormaStyleChangedEvent(t)))}));for(var o=s.iter(this.formaUpdateEvents_);!o.done;o.next()){var i=o.value;i.forma.beginUpdate(i)}}},formaDidChangeState:function(t,e){if(null!=e[b.GroupForma.PROPERTY_BOUNDS]||null!=e[v.Forma.PROPERTY_STYLE]||null!=e[v.Forma.PROPERTY_PLACEMENT]){for(var n=s.iter(this.formaUpdateEvents_);!n.done;n.next()){var o=n.value;o.forma.endUpdate(o)}this.formaUpdateEvents_.splice(0)}},formaWillCommitState:function(t){I.GroupController.prototype.formaWillCommitState.call(this,t),this.shrinkPools=!0},shrinkPools:{get:function(){return this.layoutFormaePool_.shrinkPools_},set:function(t){this.layoutFormaePool_.shrinkPools_=t,this.decorationFormaePool_.shrinkPools_=t,t&&(null!=this.renderedLayoutResults_&&this.updatePoolForItems(s.clone(this.renderedLayoutResults_.items),this.layoutFormaePool_),null!=this.renderedDecorationResults_&&this.updatePoolForItems(s.clone(this.renderedDecorationResults_.items),this.decorationFormaePool_))}},textBacked:{get:function(){var t;return!!(t=this.lockupStyle)&&t.textBacked}},maxLineLengthDifference:{get:function(){var t=this.numLines(),e=s.repeat(1/0,t),n=s.repeat(-1/0,t);this.lockupForma.visit(v.FormaTraversal.PreOrder,(function(t,o,i){var r,a;return(r=s.as(t,ot.TextForma))&&0!=r.rangeInLockup.length&&(a=r.finalFrame)&&(e[r.rowIndex]=Math.min(e[r.rowIndex],a.minY),n[r.rowIndex]=Math.max(n[r.rowIndex],a.maxY)),!1}));for(var o=[],i=s.iter(s.range(0,t,!1));!i.done;i.next()){var r=i.value;isFinite(e[r])&&isFinite(n[r])&&o.push(n[r]-e[r])}return o.length>0?s.max(o)-s.min(o):0}},contrastCheck:function(t){void 0===t&&(t=!0),this.styleController_.backgroundContrastCheck(t)},getBackgroundEdge:function(){var t,e;return(t=s.as(this.visualParent.controller,T.FrameController))&&(e=s.opt(this.forma,(function(t){return t.finalFrame})))?t.getAverageEdge(e):null},getBackgroundLightnessSpread:function(t){for(var e=100,n=0,o=s.iter(t);!o.done;o.next()){var i=o.value;e=Math.min(e,i.lightness),n=Math.max(n,i.lightness)}return U.MathUtils.absDouble(n-e)},snapSizeToBounds:function(){var t=new M.FormaTransformChangedEvent(this.lockupForma);if(null!=this.lockupForma.frame&&null!=this.renderedLayoutResults_){var e=this.renderedLayoutResults_.size;this.lockupForma.beginUpdate(t),this.lockupForma.placement=this.wrappingGroup_.placement.concat(this.lockupForma.placement),this.thresholdGroupHeight=e.height,this.thresholdGroupWidth=e.width,this.size=e,this.lockupForma.endUpdate(t)}},isTypeLockup:{get:function(){return!0}},avgLineHeight:{get:function(){var t;return null!=(t=this.averageLineHeight)?t:-1}},averageLineHeight:{get:function(){var t;if(t=this.renderedLayoutResults_){var e=this.lockupForma.placement.transformValues.yscale;if(isFinite(t.avgTextItemHeight))return t.avgTextItemHeight*e}return null}},currentHeightScale:{get:function(){return this.getAverageFontSize()}},getSizeHeightScales:function(){return null==this.sizeHeightScales_&&this.calculateSizeHeightScales(),this.sizeHeightScales_},calculateSizeHeightScales:function(){var t=[];this.forma.placement=z.Matrix2D.Identity;for(var e=[this.size.aspectRatio,.1,.2,.3,.4,.5,.6,.8,1,1.4,2,3,5,12],n=s.iter(e);!n.done;n.next()){for(var o=n.value,i=s.opt(this.renderedLayoutResults_,(function(t){return t.size}))||new gt.TheoSize(100*o,100),r=!1,a=s.iter(t);!a.done;a.next()){var l=a.value;Math.abs(l.size.aspectRatio-i.aspectRatio)<.01&&(r=!0)}r||t.push({size:i,scale:this.avgLineHeight})}this.sizeHeightScales_=s.clone(t)},numLines:function(){var t,e=0;if(null!=(t=s.opt(this.renderedLayoutResults_,(function(t){return t.numberOfLines}))))e=t;else{var n=-1;this.lockupForma.visit(v.FormaTraversal.PreOrder,(function(t,o,i){var r;return(r=s.as(t,ot.TextForma))&&0!=r.rangeInLockup.length&&(n=Math.max(e,r.rowIndex)),!1})),n>-1&&(e=n+1)}return e},textFrame:{get:function(){return this.textBoundsInCoordSpace(this.lockupForma.placement)}},textFinalFrame:{get:function(){var t,e=null;return(t=this.lockupForma)&&t.visitAll(v.FormaTraversal.PreOrder,(function(t){t.kind==ot.TextForma.KIND&&(e=ut.TheoRect.unionOf(e,t.finalFrame))})),e}},getKnockoutOutlines:function(t){var e,n,o,i,r=lt.TheoPathBuilder.init_d41d(),a=!0;if(null!=(i=t.shapeLibraryID)){var l=j.ShapeLibrary.shapeDictionary[i];if(!l.filled)return null;a=l.clockwise}var h,u=t.boundsInCoordSpace(t.placement);return(h=this.lockupForma)&&h.visit(v.FormaTraversal.PreOrder,(function(t,i,l){var h;if(h=s.as(t,ot.TextForma)){var c=h.boundsInCoordSpace(h.placement).evalXY(.5,.5);if(!u.containsPoint(c))return!1;var g=s.opt(s.as(h.textModel.attributeAtIndex($.FontDescriptorAttribute.NAME,0).attr,$.FontDescriptorAttribute),(function(t){return t.value})),p=s.opt(s.as(h.textModel.attributeAtIndex($.FontSizeAttribute.NAME,0).attr,$.FontSizeAttribute),(function(t){return t.value})),d=(e=N.LockupTextLook.toCaseValue((n=s.opt(s.as(s.opt(h.textModel.attributeAtIndex($.TextLookAttribute.NAME,0),(function(t){return t.attr})),$.TextLookAttribute),(function(t){return t.value})))||null!=n?n:0))||null!=e?e:N.LockupTextLook.Fill,f=N.LockupStyle.isKnockoutLook(d);if(d==N.LockupTextLook.KnockoutAndShadow&&(f=0==s.opt(s.as(h.textModel.attributeAtIndex($.FontStrokeWidthAttribute.NAME,0).attr,$.FontStrokeWidthAttribute),(function(t){return t.value}))),f){var m=(o=s.opt(s.as(h.textModel.attributeAtIndex($.TrackingAttribute.NAME,0).attr,$.TrackingAttribute),(function(t){return t.value})))||null!=o?o:0,y=D.Host.textModelUtils.textOutlines(h.textModel.text,g,p,m);null!=y&&(a==D.Host.textModelUtils.fontHasClockwiseOutlines(g)&&(y=D.Host.textModelUtils.rewindPath(y)||y),r.addPath(y,h.placement))}}return!1})),null==r.path.bounds?null:r.path},textBoundsInCoordSpace:function(t){var e,n=null;if(e=this.lockupForma){var o=[];e.visit(v.FormaTraversal.PreOrder,(function(e,i,r){var a;return 0==i?o=[t]:(o=o.slice(0,1+i)).push(e.placement.concat(s.last(o))),(a=s.as(e,ot.TextForma))&&(n=ut.TheoRect.unionOf(n,a.boundsInCoordSpace(s.last(o)))),!1}))}return n},textBoundsInCoordSpace2:function(t){var e,n=null;return(e=this.lockupForma)&&e.visitPlaced(t,(function(t,e,o,i){var r;return(r=s.as(t,ot.TextForma))&&(n=ut.TheoRect.unionOf(n,r.boundsInCoordSpace(e))),!1})),n},shapeCount:function(){return s.as(this.lockupForma.root,X.RootForma).filterByControllerKind(_.GridController.KIND).length},wordCount:function(){return this.text.length>0?s.clone(this.text.split(" ")).length:0},updateScoring:function(){this.styleController_.updateScoring()},shuffleColorAssignment:function(){var t;if(t=this.lockupForma){var e=new M.FormaStyleChangedEvent(t);t.beginUpdate(e),this.styleController_.shuffleColorAssignment(),t.endUpdate(e)}},applyTextStyleSuggestion:function(t,e,n){var o,i;if(void 0===e&&(e=null),void 0===n&&(n=!0),!((o=t)&&(i=e)&&i.lockupStyleEvaluator.styleEvaluatedWithReadability(o))){var a=this.getNewStyleAttributes(!0,e,n),l=s.as(this.forma.style,N.LockupStyle);return this.forma.applyStyle(a),null!=a.font&&a.font.isSparkFont()?g.BrandingFacade.brandDocumentForElement(this.forma.page.document,a.font.sparkElementID,g.AUTHORING_CONTEXT_TYPE_FONT):s.opt(l,(function(t){return null!=t.font}))&&l.font.isSparkFont()&&g.BrandingFacade.unBrandDocumentIfNoBrandedElements(this.forma.page.document),a}return this.forma.applyStyle(o),this.charStyleRanges.length>0&&0==s.count(o.characterStyles)?(this.getCharacterStyle(r.HIGHLIGHT_STYLE),this.updateGroup()):this.styleController.pickVisibleColorsForCharStyle()&&this.updateGroup(),null},getNewStyleAttributes:function(t,e,n){for(var o=s.iter(s.range(0,5,!1));!o.done;o.next()){var i;if(i=this.styleController_.getNewStyleAttributes(t,e,n))return i}return p.CoreAssert.info("unable to find a suitable style using the evaluator, return a potential bad style"),this.styleController_.getNewStyleAttributes(t,e,!1)},generateAndApplyInitialStyleAttributes:function(){this.styleController_.generateAndApplyInitialStyleAttributes()},clearLockupFormaPool:function(t){for(var e=s.iter(t.configureTextFormae({}));!e.done;e.next()){var n=e.value;s.opt(n.parent,(function(t){return t.removeChild(n)}))}for(var o=s.iter(t.configureShapeFormae(0));!o.done;o.next())n=o.value,s.opt(n.parent,(function(t){return t.removeChild(n)}))},preferredXAlignment:{get:function(){return this.lockupStyle.alignment==N.LockupAlignment.Left?u.AlignmentType.Left:this.lockupStyle.alignment==N.LockupAlignment.Right?u.AlignmentType.Right:u.AlignmentType.CenterX}},setAlignmentType:function(t){this.numLines()>1&&(t==u.AlignmentType.Left&&s.opt(this.lockupStyle,(function(t){return t.alignment!=N.LockupAlignment.UNSET}))&&s.opt(this.lockupStyle,(function(t){return t.alignment!=N.LockupAlignment.Left}))&&(this.lockupStyle.alignment=N.LockupAlignment.Left),t==u.AlignmentType.Right&&s.opt(this.lockupStyle,(function(t){return t.alignment!=N.LockupAlignment.UNSET}))&&s.opt(this.lockupStyle,(function(t){return t.alignment!=N.LockupAlignment.Right}))&&(this.lockupStyle.alignment=N.LockupAlignment.Right),t==u.AlignmentType.CenterX&&s.opt(this.lockupStyle,(function(t){return t.alignment!=N.LockupAlignment.UNSET}))&&s.opt(this.lockupStyle,(function(t){return t.alignment!=N.LockupAlignment.Center}))&&(this.lockupStyle.alignment=N.LockupAlignment.Center))},canClaimForma:function(t){return!1},getPinBounds:function(t){var e,n=s.opt(this.lockupForma,(function(t){return t.bounds}));return(e=this.lockupStyle)&&(n=t==at.PinBoundsType.Bounds||e.backing==N.LockupBacking.Banner||e.backing==N.LockupBacking.BannerHorizontal||e.backing==N.LockupBacking.BannerVertical?this.textBoundsInCoordSpace(z.Matrix2D.Identity):this.lockupForma.childrenBoundsInCoordSpace(z.Matrix2D.Identity)),n},centerAlignmentIfSingleLine:function(){var t=this,e=s.opt(s.opt(this.wrappingGroup_,(function(t){return t.bounds})),(function(e){return e.equalWithAccuracy(t.forma.bounds,.01)}));1!=this.numLines()||null==e||!e||this.lockupStyle.alignment!=N.LockupAlignment.Left&&this.lockupStyle.alignment!=N.LockupAlignment.Right||(this.lockupStyle.alignment=N.LockupAlignment.Center)},preventOutofBoundsOrOverlap:function(t){var e,n;(e=this.textFinalFrame)&&(n=this.lockupForma)&&!t.contains(e)&&(e.minX<t.minX&&n.move(z.Matrix2D.translationXY(-1*(e.minX-t.minX)+10,0)),e.maxX>t.maxX&&n.move(z.Matrix2D.translationXY(t.maxX-e.maxX-10,0)),e.minY<t.minY&&n.move(z.Matrix2D.translationXY(0,-1*(e.minY-t.minY)+10)),e.maxY>t.maxY&&n.move(z.Matrix2D.translationXY(0,t.maxY-e.maxY-10)))},addForma:function(t,e,n){var o,i,a,l=this;if((o=s.as(t.root,X.RootForma))&&(i=s.as(e,b.GroupForma))&&(a=s.as(e.controller,r))){n.suggestPlacement||e.controller.fit(o.frame.insetRel(.25,.25,.25,.25)),e.applyStyle(N.LockupStyle.createDefault());var h=!1,u=s.clone(o.filterWithCallback((function(t){return t instanceof H.ImageForma&&t.parent instanceof R.FrameForma}))),c=null;u.length>0&&(c=s.as(u[0],H.ImageForma)),o.visitAll(v.FormaTraversal.PreOrder,(function(t){var n;if((n=s.as(t.controller,r))&&s.opt(n.lockupStyle,(function(t){return t.backing!=N.LockupBacking.Knockout}))){var o=s.opt(n.lockupStyle,(function(t){return t.clone()}));e.applyStyle(o),h=!0}}));var g=s.clone(o.filterByControllerKind(_.GridController.KIND));if(1==g.length?g[0].appendChild(e):(o.appendChild(e),e.applyStyle(N.LockupStyle.createDefault()),h=!1),n.suggestPlacement){var p,d=m.CorePromise.resolve(null);return(p=s.opt(s.opt(c,(function(t){return t.contentNode})),(function(t){return t.image})))&&(p.loaded()||(e.moveCenterToPoint(new st.TheoPoint(-o.frame.center.x,o.frame.center.y)),d=new m.CorePromise((function(t,e){return p.whenLoaded((function(){return t(null)}))})))),d.then((function(t){return l.placeStyleLockup(i,o,a,h)}))}return m.CorePromise.resolve(null)}return m.CorePromise.reject("TypeLockupController.addFormaToRoot: no lockup forma")},getBackingContrastRole:function(){var t;if(t=this.lockupStyle){var e=t.textLook==N.LockupTextLook.KnockoutOnly||t.textLook==N.LockupTextLook.OutlineOnly,n=t.strokeWeight>.15;return e||n||t.textBacked?k.ColorRole.FieldSecondary:k.ColorRole.FieldPrimary}return k.ColorRole.FieldPrimary},getSuggestableColors:function(){return this.styleController_.getSuggestableColors()},applyColors:function(t,e){this.styleController_.applyColors(s.clone(t),e)},primaryColorVisible:function(){return this.styleController.targetedTextLook!=N.LockupTextLook.KnockoutOnly&&this.styleController.targetedTextLook!=N.LockupTextLook.OutlineOnly},secondaryColorVisible:function(){return this.styleController.targetedLockupStyle.backing!=N.LockupBacking.None||N.LockupStyle.isOutlineLook(this.styleController.targetedTextLook)||this.styleController.targetedTextLook==N.LockupTextLook.Shadow},applyOpacity:function(t){this.styleController_.setOpacity(t)},currentOpacity:{get:function(){return this.styleController.getOpacityValue()}},getHighlightMethodName:function(t){return t==l.HighlightMethod.Manual?"k_HighlightMethod_None":t==l.HighlightMethod.Numbers?"k_HighlightMethod_Numbers":t==l.HighlightMethod.Nouns?"k_HighlightMethod_Nouns":t==l.HighlightMethod.Verbs?"k_HighlightMethod_Verbs":t==l.HighlightMethod.Names?"k_HighlightMethod_Names":t==l.HighlightMethod.Adjectives?"k_HighlightMethod_Adjectives":t==l.HighlightMethod.SmallWords?"k_HighlightMethod_SmallWords":t==l.HighlightMethod.EvenRows||t==l.HighlightMethod.OddRows||t==l.HighlightMethod.Bracket||t==l.HighlightMethod.InsideBracket?"k_HighlightMethod_Lines":t==l.HighlightMethod.EvenWords||t==l.HighlightMethod.OddWords?this.text.includes(" ")?"k_HighlightMethod_Words":"k_HighlightMethod_Letters":t==l.HighlightMethod.First?"k_HighlightMethod_First":t==l.HighlightMethod.Last?"k_HighlightMethod_Last":s.toString(this.highlightMethod)},placeStyleLockup:function(t,e,n,o){var i;if(i=new w.FormaPlacementSuggester(t,e).fastPlacement()){var r=new M.FormaTransformChangedEvent(t);r.duration=0,t.beginUpdate(r),i.apply(),n.text.length>0&&this.snapSizeToBounds(),n.updateScoring(),o?n.styleController.doesLockupContrastWithBackground()||n.styleController.pickVisibleColorsForLockup():n.generateAndApplyInitialStyleAttributes(),t.endUpdate(r)}return m.CorePromise.resolve(null)},incrementHighlightMethod:function(){this.highlightMethod==l.HighlightMethod.Manual?this.highlightMethod=l.HighlightMethod.Numbers:this.highlightMethod==l.HighlightMethod.Numbers?this.highlightMethod=l.HighlightMethod.Nouns:this.highlightMethod==l.HighlightMethod.Nouns?this.highlightMethod=l.HighlightMethod.Verbs:this.highlightMethod==l.HighlightMethod.Verbs?this.highlightMethod=l.HighlightMethod.Names:this.highlightMethod==l.HighlightMethod.Names?this.highlightMethod=l.HighlightMethod.Adjectives:this.highlightMethod==l.HighlightMethod.Adjectives?this.highlightMethod=l.HighlightMethod.SmallWords:this.highlightMethod==l.HighlightMethod.SmallWords?this.highlightMethod=l.HighlightMethod.EvenRows:this.highlightMethod==l.HighlightMethod.EvenRows||this.highlightMethod==l.HighlightMethod.OddRows?this.highlightMethod=l.HighlightMethod.EvenWords:this.highlightMethod==l.HighlightMethod.EvenWords||this.highlightMethod==l.HighlightMethod.OddWords?this.highlightMethod=l.HighlightMethod.InsideBracket:this.highlightMethod==l.HighlightMethod.First?this.highlightMethod=l.HighlightMethod.Numbers:this.highlightMethod==l.HighlightMethod.Last?this.highlightMethod=l.HighlightMethod.Numbers:this.highlightMethod!=l.HighlightMethod.Bracket&&this.highlightMethod!=l.HighlightMethod.InsideBracket||(this.highlightMethod=l.HighlightMethod.Numbers)},getNextRanges:function(t,e){var n=this,o=[],i=it.TypeLockupUtils.getWordRanges(t,this.highlightMethod);if(0==i.length||t.length<2)return o;var a=s.chars(t),h=1==i.length&&0==i[0].start&&i[0].end==s.chars(t).length;if(e&&t.includes(" ")&&this.highlightMethod==l.HighlightMethod.Manual)return o.push(i[0]),o;if(this.highlightMethod>=r.FIRST_NLP_METHOD&&this.highlightMethod<=r.MAX_NLP_METHOD){var u=t;u==u.toUpperCase()&&(u=u.toLowerCase()),u=s.replace(u,"\n"," ");var c=s.clone(D.Host.textModelUtils.getWordClassRanges(u,this.highlightMethod-r.FIRST_NLP_METHOD));if(h)for(var g=s.iter(c);!g.done;g.next()){var p=g.value;o.push(p)}else this.lockupForma.visit(v.FormaTraversal.PreOrder,(function(t,e,n){var i;if(i=s.as(t,ot.TextForma))for(var r=i.rangeInLockup,a=s.iter(c);!a.done;a.next()){var l=a.value;l.start>=r.start&&l.end<=r.end&&o.push(r)}return!1}));e&&this.highlightMethod==l.HighlightMethod.Numbers&&0==!o.length&&0!=o[0].start&&o.splice(0)}else if(this.highlightMethod==l.HighlightMethod.EvenWords||this.highlightMethod==l.HighlightMethod.OddWords){for(var d=s.iter(s.toSequence(i));!d.done;d.next()){var f=d.value,m=f.offset,y=f.element;(this.highlightMethod==l.HighlightMethod.EvenWords&&m%2==0||this.highlightMethod==l.HighlightMethod.OddWords&&m%2!=0)&&o.push(y)}if((this.highlightMethod==l.HighlightMethod.EvenWords||this.highlightMethod==l.HighlightMethod.OddWords)&&h){o.splice(0);for(var k=s.iter(s.range(0,s.chars(t).length,!1));!k.done;k.next()){var S=k.value;(this.highlightMethod==l.HighlightMethod.EvenWords&&S%2==0||this.highlightMethod==l.HighlightMethod.OddWords&&S%2!=0)&&o.push(new ht.TextRange(S,S+1))}}}else if(this.highlightMethod!=l.HighlightMethod.Bracket&&this.highlightMethod!=l.HighlightMethod.InsideBracket||!(i.length<3)||!it.TypeLockupUtils.isCurlyQuote(a[0])&&"("!=a[0]||!it.TypeLockupUtils.isCurlyQuote(a[a.length-1])&&")"!=a[a.length-1]){var L=0;this.lockupForma.visit(v.FormaTraversal.PreOrder,(function(t,e,i){var r;if(r=s.as(t,ot.TextForma)){var a=r.rangeInLockup;(n.highlightMethod==l.HighlightMethod.EvenRows&&r.rowIndex%2==0||n.highlightMethod==l.HighlightMethod.OddRows&&r.rowIndex%2!=0)&&o.push(a),L=Math.max(L,r.rowIndex)}return!1})),this.highlightMethod!=l.HighlightMethod.EvenRows&&this.highlightMethod!=l.HighlightMethod.OddRows||0!=L||o.splice(0),(this.highlightMethod==l.HighlightMethod.First||this.highlightMethod==l.HighlightMethod.Last)&&0!=L||(this.highlightMethod==l.HighlightMethod.Bracket||this.highlightMethod==l.HighlightMethod.InsideBracket)&&L>1?(o.splice(0),this.lockupForma.visit(v.FormaTraversal.PreOrder,(function(t,e,i){var r;if(r=s.as(t,ot.TextForma)){var a=r.rangeInLockup;(n.highlightMethod!=l.HighlightMethod.First&&n.highlightMethod!=l.HighlightMethod.Bracket||0!=r.rowIndex)&&(n.highlightMethod!=l.HighlightMethod.Last&&n.highlightMethod!=l.HighlightMethod.Bracket||r.rowIndex!=L)?n.highlightMethod==l.HighlightMethod.InsideBracket&&0!=r.rowIndex&&r.rowIndex!=L&&o.push(a):o.push(a)}return!1}))):this.highlightMethod==l.HighlightMethod.First||this.highlightMethod==l.HighlightMethod.Last||this.highlightMethod==l.HighlightMethod.Bracket?(this.highlightMethod!=l.HighlightMethod.First&&this.highlightMethod!=l.HighlightMethod.Bracket||o.push(i[0]),this.highlightMethod!=l.HighlightMethod.Last&&this.highlightMethod!=l.HighlightMethod.Bracket||o.push(i[i.length-1])):this.highlightMethod==l.HighlightMethod.InsideBracket&&i.length>1&&o.push(new ht.TextRange(i[0].end,i[i.length-1].start))}else o.splice(0),this.highlightMethod==l.HighlightMethod.Bracket?(o.push(new ht.TextRange(0,1)),o.push(new ht.TextRange(s.chars(t).length-1,s.chars(t).length))):this.highlightMethod==l.HighlightMethod.InsideBracket&&o.push(new ht.TextRange(1,s.chars(t).length-1));return s.sortInPlace(o,(function(t,e){return t.start<e.start})),o=s.clone(it.TypeLockupUtils.cleanupAndMerge(s.clone(o)))},getAllTextRanges:function(){var t=[];return this.lockupForma.visit(v.FormaTraversal.PreOrder,(function(e,n,o){var i;if(i=s.as(e,ot.TextForma)){var r=i.rangeInLockup;t.push(r)}return!1})),t},rangesEqual:function(t,e){if(t.length==e.length){for(var n=s.iter(s.range(0,t.length,!1));!n.done;n.next()){var o=n.value;if(t[o].start!=e[o].start||t[o].end!=e[o].end)return!1}return!0}return!1},updateMethodToMatchCharStyleRange:function(t){var e=s.clone(this.charStyleRanges);if(0==!e.length&&this.highlightMethod==l.HighlightMethod.Manual){p.CoreAssert.isTrue(!s.isEmpty(t),void 0,"TypeLockupController.updateMethodToMatchCharStyleRange","TypeLockupController.swift",3777),this.incrementHighlightMethod();for(var n=s.clone(this.getNextRanges(t,!1)),o=0;!this.rangesEqual(s.clone(n),s.clone(e));)if(this.incrementHighlightMethod(),n=s.clone(this.getNextRanges(t,!1)),(o+=1)>r.NUM_HIGHLIGHTMETHODS){this.highlightMethod=l.HighlightMethod.Manual;break}}},autoApplyCharStyle:function(t,e,n){var o;if(void 0===n&&(n=!1),!n){if(0==this.charStyleRanges.length&&t&&!e)return;if(0==!this.charStyleRanges.length&&!t&&!e)return}var i=s.clone(this.charStyleRanges);e&&this.incrementHighlightMethod(),0==i.length&&this.highlightMethod==l.HighlightMethod.Manual&&N.LockupStyle.isLetterGrid((o=s.opt(this.lockupStyle,(function(t){return t.layout})))||null!=o?o:N.LockupLayout.Standard)&&(this.highlightMethod=l.HighlightMethod.OddWords);var a=s.clone(this.getNextRanges(this.text,0==i.length));if(0!=!a.length||e||!this.rangesEqual(s.clone(a),s.clone(i))){var h=new M.FormaAnimationTransactionEvent(this.forma);if(h.duration=0,this.forma.beginUpdate(h),this.lockupForma.style.notifyBefore(),this.charStyleRanges=[],!n)for(var u=0;0==a.length||e&&this.rangesEqual(s.clone(a),s.clone(i))||0==a[0].start&&a[0].end==this.text.length;)if(this.incrementHighlightMethod(),a=s.clone(this.getNextRanges(this.text,!1)),(u+=1)>r.NUM_HIGHLIGHTMETHODS){a.splice(0),this.highlightMethod=l.HighlightMethod.Manual;break}this.charStyleRanges=s.clone(a),this.lockupForma.style.notifyAfter(),this.forma.endUpdate(h)}},applyCharStyle:function(t,e,n,o){var i=new ht.TextRange(0,0);if(t.lockupForma!=this.lockupForma)return this.selectCharStyleForma(),i;i=t.rangeInLockup;var r=new M.FormaAnimationTransactionEvent(this.forma);r.duration=0,this.forma.beginUpdate(r),this.lockupForma.style.notifyBefore();var a=this.applyCharStyleDirectly(i,o,n);return this.selectCharStyleForma(),this.lockupForma.style.notifyAfter(),this.forma.endUpdate(r),a},applyCharStyleDirectly:function(t,e,n){var o=t;this.highlightMethod=l.HighlightMethod.Manual;var i=!1,a=o;n==l.CharStyleApplyMode.Apply&&0!=e.length&&(o=it.TypeLockupUtils.getNewCharSelectionRange(e,o,s.clone(this.initialCharStyleRanges_)));for(var h=-1,u=s.iter(s.toSequence(this.charStyleRanges));!u.done;u.next()){var c=u.value,g=c.offset,p=c.element;o.start>=p.start&&o.start<p.end&&(h=g)}var d=s.clone(this.charStyleRanges);if(h>-1){var f=d[h];n==l.CharStyleApplyMode.SwipeApply?d[h]=new ht.TextRange(Math.min(o.start,f.start),Math.max(o.end,f.end)):n!=l.CharStyleApplyMode.Apply?f.length!=o.length?(o.end>=f.end?d.splice(h,1):d[h]=new ht.TextRange(o.end,f.end),f.start<o.start&&d.splice(h,0,new ht.TextRange(f.start,o.start))):d.splice(h,1):n!=l.CharStyleApplyMode.Remove&&(i=!0,d[h]=o),this.charStyleRanges=s.clone(d)}else n!=l.CharStyleApplyMode.Remove&&(i=!0,d.push(o),s.sortInPlace(d,(function(t,e){return t.start<e.start})),this.charStyleRanges=s.clone(d),0==s.count(this.lockupStyle.characterStyles)&&this.getCharacterStyle(r.HIGHLIGHT_STYLE));this.charStyleRanges=s.clone(it.TypeLockupUtils.cleanupAndMerge(s.clone(this.charStyleRanges)));var m=new ht.TextRange(0,0);if(i)for(var y=s.iter(this.charStyleRanges);!y.done;y.next())p=y.value,a.start>=p.start&&a.end<=p.end&&(m=p);return m},getCharacterStyle:function(t){var e=this.lockupStyle.characterStyles[t];if(null==e){var n=N.LockupStyle.createDefault();n.colorLibrary=this.lockupStyle.colorLibrary,n.setEmptyStyle(),N.LockupStyle.isKnockoutLook(this.lockupStyle.textLook)?n.textLook=N.LockupTextLook.Fill:this.lockupStyle.backing==N.LockupBacking.Rows&&this.lockupStyle.padding<.4&&this.lockupStyle.spacing>0&&(n.backing=N.LockupBacking.Rows,n.colors.setColorId(k.ColorRole.FieldPrimary,this.lockupStyle.colors.colorID(k.ColorRole.FieldSecondary)),n.colors.setColorId(k.ColorRole.FieldSecondary,this.lockupStyle.colors.colorID(k.ColorRole.FieldPrimary))),this.lockupStyle.setCharacterStyle(t,n),this.styleController.pickVisibleColorsForCharStyle(),e=n}return e},getCharacterStyleRanges:function(){return this.charStyleRanges},clearCharStyle:function(){this.highlightMethod=l.HighlightMethod.Manual,0!=this.charStyleRanges.length&&(this.lockupForma.style.notifyBefore(),this.charStyleRanges=[],this.lockupForma.style.notifyAfter())},selectCharStyleForma:function(){var t=this;this.owner.selection.clearSelectionNoUpdate(),this.owner.selection.selectForma(this.lockupForma,!1),this.lockupForma.visit(v.FormaTraversal.PreOrder,(function(e,n,o){var i;if(i=s.as(e,ot.TextForma))for(var r=i.rangeInLockup,a=s.iter(t.charStyleRanges);!a.done;a.next()){var l=a.value;if(r.start>=l.start&&r.start<l.end){if(N.LockupStyle.isShadowLook(t.styleController.targetedLockupStyle.textLook)){var h=s.opt(s.as(i.textModel.attributeAtIndex($.FontColorAttribute.NAME,0).attr,$.FontColorAttribute),(function(t){return t.value}));if(s.opt(h,(function(e){return e.isEqual(t.styleController.targetedLockupStyle.colors.fieldSecondary)})))continue}t.owner.selection.selectForma(i,!1)}}return!1})),this.owner.selection.publish(new Z.SelectionStateChangedMessage(this.owner.selection))},beginTouches:function(){this.initialCharStyleRanges_=s.clone(this.charStyleRanges)},clearInitialCharStyleRanges:function(){this.initialCharStyleRanges_=[]},updateTouches:function(t,e,n,o){void 0===o&&(o=null);var i=s.opt(this.lockupForma,(function(e){return e.page.formaAtPoint(t,void 0,[ot.TextForma.KIND])}));null!=i&&i instanceof ot.TextForma&&i.lockupForma!=this.lockupForma&&(i=null);var a,h=n?100:-100;if(null==i||!(i instanceof ot.TextForma)){var u=new st.TheoPoint(t.x+h,t.y);i=s.opt(this.lockupForma,(function(t){return t.page.formaAtPoint(u,void 0,[ot.TextForma.KIND])}))}if(a=s.as(i,ot.TextForma)){if(null!=o&&0!=s.count(this.lockupStyle.characterStyles)&&s.opt(this.lockupStyle.characterStyles[r.HIGHLIGHT_STYLE],(function(t){return null!=t.font}))){var c,g=s.opt(this.lockupForma,(function(t){return t.page.formaAtPoint(o,void 0,[ot.TextForma.KIND])}));if(null==g||!(g instanceof ot.TextForma)){var p=new st.TheoPoint(o.x+h,o.y);g=s.opt(this.lockupForma,(function(t){return t.page.formaAtPoint(p,void 0,[ot.TextForma.KIND])}))}if((c=s.as(g,ot.TextForma))&&c.rowIndex==a.rowIndex)for(var d=s.opt(s.opt(this.lockupForma,(function(t){return t.totalPlacement.inverse})),(function(e){return e.transformPoint(t)}))||t,f=s.opt(s.opt(this.lockupForma,(function(t){return t.totalPlacement.inverse})),(function(t){return t.transformPoint(o)}))||o,m=d.x>=f.x,y=d.x<=f.x,k=s.iter(this.charStyleRanges);!k.done;k.next()){var S=k.value;if(n){if(y&&a.rangeInLockup.start>=S.start&&a.rangeInLockup.start<S.end){if(a.rangeInLockup.end<S.end)return;break}if(m&&a.rangeInLockup.end==S.start)return}else{if(m&&a.rangeInLockup.start>=S.start&&a.rangeInLockup.start<S.end){if(a.rangeInLockup.end<S.end)return;break}if(y&&a.rangeInLockup.start==S.end)return}}}this.applyCharStyle(a,r.HIGHLIGHT_STYLE,l.CharStyleApplyMode.Apply,e.rangeInLockup)}},enterCharStyleModeWithTextForma:function(t,e){if(this.owner.allowSelectionChanges){var n=0==this.charStyleRanges.length;if(0==t.rangeInLockup.length){this.lockupForma.style.notifyBefore(),this.getCharacterStyle(r.HIGHLIGHT_STYLE),this.lockupForma.style.notifyAfter();var o=s.opt(this.lockupForma,(function(t){return t.page.formaAtPoint(e,void 0,[ot.TextForma.KIND])}));null!=o&&o instanceof ot.TextForma&&(s.opt(s.opt(t.page.document,(function(t){return t.controller})),(function(t){return t.selection.inCharStyleMode=!0})),this.styleController.pickVisibleColorsForCharStyle(),this.selectCharStyleForma(),this.applyCharStyle(o,r.HIGHLIGHT_STYLE,l.CharStyleApplyMode.SwipeApply,new ht.TextRange(0,0)))}else s.opt(s.opt(t.page.document,(function(t){return t.controller})),(function(t){return t.selection.inCharStyleMode=!0})),0==this.charStyleRanges.length&&this.styleController.pickVisibleColorsForCharStyle(),this.selectCharStyleForma(),this.applyCharStyle(t,r.HIGHLIGHT_STYLE,l.CharStyleApplyMode.SwipeApply,new ht.TextRange(0,0));n&&1==this.charStyleRanges.length&&0==this.charStyleRanges[0].start&&this.charStyleRanges[0].end==this.text.length&&(this.charStyleRanges=[],this.autoApplyCharStyle(!1,!1,!1),this.selectCharStyleForma())}},textChanged:function(t,e){for(var n=0,o=!1,i=s.clone(this.charStyleRanges),r=s.iter(s.toSequence(this.charStyleRanges));!r.done;r.next()){var a=r.value,l=a.offset,h=a.element;t.start>=h.start&&t.start<h.end?(n=e-t.length,o=!0,h.end+n<h.start?i[l]=new ht.TextRange(h.start,h.start):i[l]=new ht.TextRange(h.start,h.end+n)):t.start<h.start&&t.end>h.start?(t.end<h.end?i[l]=new ht.TextRange(t.start+e,h.end-t.end+t.start+e):i[l]=new ht.TextRange(h.start,h.start),o||(n=e-t.length,o=!0)):0!=n&&(i[l]=new ht.TextRange(h.start+n,h.end+n)),!o&&t.end<=h.start&&(n=e-t.length,o=!0,i[l]=new ht.TextRange(h.start+n,h.end+n))}this.charStyleRanges=s.clone(i),o&&(this.charStyleRanges=s.clone(it.TypeLockupUtils.cleanupAndMerge(s.clone(this.charStyleRanges))))},applyPredefinedCharStyle:function(t){var e=this.highlightMethod==t;if(this.highlightMethod=t,t==l.HighlightMethod.SmallWords){this.styleController.applyBacking(N.LockupBacking.None,null),e||this.lockupStyle.setCharacterStyles({});var n=this.getCharacterStyle(r.HIGHLIGHT_STYLE);n.spacing=.5,n.colors.setColorId(k.ColorRole.FieldPrimary,this.lockupStyle.colors.colorID(k.ColorRole.FieldPrimary)),n.colors.setColorId(k.ColorRole.FieldSecondary,this.lockupStyle.colors.colorID(k.ColorRole.FieldSecondary)),e?n.layout==N.LockupLayout.Standard&&n.alignment==N.LockupAlignment.Center&&0==n.lineBreakAtCharacterStyleSizeChange?(n.alignment=N.LockupAlignment.Right,n.lineBreakAtCharacterStyleSizeChange=!1):n.layout==N.LockupLayout.Standard&&n.alignment==N.LockupAlignment.Right?(n.alignment=N.LockupAlignment.Center,n.lineBreakAtCharacterStyleSizeChange=!0):n.layout==N.LockupLayout.UNSET&&0==n.lineBreakAtCharacterStyleSizeChange?(n.alignment=N.LockupAlignment.Center,n.layout=N.LockupLayout.Standard,n.lineBreakAtCharacterStyleSizeChange=!1):(n.alignment=N.LockupAlignment.UNSET,n.layout=N.LockupLayout.UNSET,n.lineBreakAtCharacterStyleSizeChange=!1):n.lineBreakAtCharacterStyleSizeChange=!1,this.autoApplyCharStyle(!0,!1,!0)}else this.highlightMethod==l.HighlightMethod.Manual?this.clearCharStyle():t==l.HighlightMethod.Nouns?(this.styleController.applyBacking(N.LockupBacking.Rows,null),this.lockupStyle.setCharacterStyles({}),this.getCharacterStyle(r.HIGHLIGHT_STYLE),this.autoApplyCharStyle(!0,!1,!0)):(e&&(this.highlightMethod==l.HighlightMethod.EvenRows?this.highlightMethod=l.HighlightMethod.OddRows:this.highlightMethod==l.HighlightMethod.OddRows?this.highlightMethod=l.HighlightMethod.Bracket:this.highlightMethod==l.HighlightMethod.Bracket?this.highlightMethod=l.HighlightMethod.InsideBracket:this.highlightMethod==l.HighlightMethod.InsideBracket&&(this.highlightMethod=l.HighlightMethod.EvenRows)),this.lockupStyle.setCharacterStyles({}),this.getCharacterStyle(r.HIGHLIGHT_STYLE));this.forma.controller.styleChanged()},snapToClosestExistingSize:function(t){var e=this;if(!s.opt(this.lockupStyle,(function(t){return t.layout==N.LockupLayout.FitJustified&&1!=e.numLines()}))){var n=s.clone(it.TypeLockupUtils.sizesInDocument(this.forma.page.document)),o=this.getCurrentFontSize();if(0!=o){for(var i=t,r=s.iter(n);!r.done;r.next()){var a=r.value;(o!=a||t==o)&&Math.abs(o-a)<Math.abs(o-i)&&(i=a)}var l=i/o;if(!(0==i||l>1.2||l<(t==i?.2:.8))){var h=new gt.TheoSize(this.forma.bounds.width*l,this.forma.bounds.height*l),u=new A.FormaResizeEvent(this.forma,h,st.TheoPoint.ZERO);this.onEvent(u)}}}},getCurrentFontSize:function(){var t,e=0;return(t=this.lockupForma)&&(t.visit(v.FormaTraversal.PreOrder,(function(t,n,o){var i;return!!(i=s.as(t,ot.TextForma))&&(e=s.opt(s.as(i.textModel.attributeAtIndex($.FontSizeAttribute.NAME,0).attr,$.FontSizeAttribute),(function(t){return t.value})),!0)})),e*=this.lockupForma.placement.extractedScale.scale.x),e},getAverageFontSize:function(){var t,e=this;if(t=this.lockupForma){var n=[];if(t.visit(v.FormaTraversal.PreOrder,(function(t,o,i){var r;if(r=s.as(t,ot.TextForma)){var a=s.opt(s.as(r.textModel.attributeAtIndex($.FontSizeAttribute.NAME,0).attr,$.FontSizeAttribute),(function(t){return t.value}));if(n.push(a*e.lockupForma.placement.extractedScale.scale.x),s.opt(e.lockupStyle,(function(t){return t.layout!=N.LockupLayout.FitJustified})))return!0}return!1})),n.length>0)return n.reduce((function(t,e){return t+e}),0)/s.toDouble(n.length)}return 0},getFontSizeSnapValues:function(){var t=[];if(this.styleController.targetedLockupStyle!==this.lockupStyle)return t.push(100),t;var e=s.clone(it.TypeLockupUtils.sizesInDocument(this.forma.page.document,this.forma));s.sortInPlace(e);var n=this.getCurrentFontSize(),o=0;if(0!=n)for(var i=s.iter(e);!i.done;i.next()){var r=i.value;Math.round(r)==o&&r!=n||(o=Math.round(r),t.push(r))}return t},matchNextSize:function(t,e){for(var n=this.getCurrentFontSize(),o=n,i=!1,r=s.iter(t);!r.done;r.next()){var a=r.value,l=a/n;if(Math.round(o)<Math.round(a)&&(l<.99||l>1.01)){o=a,i=!0;break}}t.length>0&&(0==i||o>this.getSizeSliderMaxValue())&&(o=t[0]);var h=o/n;if(h<.99||h>1.01){var u=this.forma.placement.transformValues,c=this.forma.bounds,g=new gt.TheoSize(c.width*u.xscale,c.height*u.xscale),p=new gt.TheoSize(g.width*h,g.height*h),d=new A.FormaResizeEvent(this.forma,p,e);this.onEvent(d)}return o},setSizeSliderValue:function(t,e,n){var o=t;if(this.styleController.targetedLockupStyle!==this.lockupStyle){o=t/100;for(var i=s.iter(e);!i.done;i.next())t>=(a=i.value)-5&&t<=a+5&&(o=a/100);this.styleController.targetedLockupStyle.spacing=1==o?-1:o,this.styleChanged(),this.selectCharStyleForma(),o*=100}else{for(var r=s.iter(e);!r.done;r.next()){var a;t>=(a=r.value)-5&&t<=a+5&&(o=a)}var l=o/this.getCurrentFontSize(),h=this.forma.placement.transformValues,u=this.forma.bounds,c=new gt.TheoSize(u.width*h.xscale,u.height*h.xscale),g=(t=new gt.TheoSize(c.width*l,c.height*l),this.forma.boundsInCoordSpace(this.forma.placement));if(Math.round(1e3*t.width)!=Math.round(1e3*g.width)||Math.round(1e3*t.height)!=Math.round(1e3*g.height)){var p=new A.FormaResizeEvent(this.forma,t,n);this.onEvent(p)}}return o},getSizeSliderValue:function(){return this.styleController.targetedLockupStyle!==this.lockupStyle?-1==this.styleController.targetedLockupStyle.spacing?100:100*this.styleController.targetedLockupStyle.spacing:this.getCurrentFontSize()},getSizeSliderMinValue:function(){if(this.styleController.targetedLockupStyle!==this.lockupStyle)return 20;var t=20,e=this.getCurrentFontSize();return e<20&&(t=e),t},getSizeSliderMaxValue:function(){if(this.styleController.targetedLockupStyle!==this.lockupStyle)return 400;var t=500,e=this.getCurrentFontSize();e>500&&(t=e+200);var n=t/e,o=1.2*this.forma.root.bounds.width/this.forma.bounds.width;return n>o?o*e:t}}}),r)},Cj3Q:function(t,e,n){var o,i,r=e,a=n("oAGj"),l=n("iCxV"),s=n("JgVS"),h=n("cEEQ"),u=n("c+uM"),c=n("tGKA"),g=n("JKVa"),p=n("8t9B"),d=n("hgLm"),f=n("oKlP"),m=n("sIWg"),y=n("1NAc");r.P=function(t,e){return new f.TheoPoint(t,e)},r.clockwiseRectanglePath=function(t,e,n){var o=d.TheoPathBuilder.init_d41d(),i=e.transformPoint(t.eval(r.P(0,0)));o.moveTo(i.x,i.y);var l=new m.TheoRect(i.x,i.y,i.x,i.y);if(n)for(var s=a.iter([r.P(0,1),r.P(1,1),r.P(1,0)]);!s.done;s.next()){var h=s.value;i=e.transformPoint(t.eval(h)),o.lineTo(i.x,i.y),l=l.expandToFit(i)}else for(var u=a.iter([r.P(1,0),r.P(1,1),r.P(0,1)]);!u.done;u.next()){h=u.value;i=e.transformPoint(t.eval(h)),o.lineTo(i.x,i.y),l=l.expandToFit(i)}return o.closePath(),{path:o.path,bounds:l}},r.RowsDecorationStrategy=(o=function(){this.paddingScalar=.6,s.BaseDecorationStrategy.call(this)},a.defineClass({name:"RowsDecorationStrategy",ctor:o,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{easeOutQuad:function(t,e,n,o){var i=t/o;return-n*i*(i-2)+e},easeOut:function(t,e,n){return this.easeOutQuad(n,t,e-t,1)},supportsConfiguration:function(t){return t.style.backing==u.LockupBacking.Rows},decorateNoKnockout:function(t,e){var n=t.style,o=[],i={},f={},k=0,S=this.paddingScalar,L=n.padding;0==n.spacing&&e.numberOfLines>1&&(S*=.5,0==n.padding&&(L=.1));var v,T,F=!1;(v=t.style.characterStyles[p.TypeLockupController.HIGHLIGHT_STYLE])&&(F=v.backing==u.LockupBacking.Rows&&n.backing==u.LockupBacking.Rows),n.backing!=u.LockupBacking.Rows&&(S=this.paddingScalar/2,(T=t.style.characterStyles[p.TypeLockupController.HIGHLIGHT_STYLE])&&T.padding>-1&&(L=T.padding));var C=e.avgLinePointSize*e.typographicBoundingRatios.heightRatio,x=C*L*S;L>=0&&(x=Math.max(.05*C,x));for(var A=e.typographicBoundingRatios.backingVerticalOffsetRatio*C,R=this.easeOut(0,A,L),w=x+e.typographicBoundingRatios.sideInsetRatio*e.avgLinePointSize,M=t.style.font.fontData,_=e.numberOfLines,I={},b=-1,D=a.iter(a.toSequence(e.items));!D.done;D.next()){var H=D.value,B=H.offset,P=H.element;if(P.type==h.LockupItemType.Text){var E=P.rowIndex,O=n.backing==u.LockupBacking.Rows,N=null;null!=P.characterStyle&&(K=t.style.characterStyles[P.characterStyle])&&(K.backing==u.LockupBacking.None&&n.backing!=u.LockupBacking.Rows?O=!1:(O=!0,K.backing==u.LockupBacking.UNSET||K.backing==u.LockupBacking.None||u.LockupStyle.isShadowLook(K.textLook)&&K.textLook!=u.LockupTextLook.KnockoutAndShadow||(N=P.characterStyle,n.backing==u.LockupBacking.Rows&&K.backing==u.LockupBacking.Rows&&(k=w))));var G=0;if(B>0&&(G=P.placement.tx-(e.items[B-1].placement.tx+e.items[B-1].size.width)),O&&I[E]==N||(null!=i[E]&&(i[_]=i[E],f[_]=f[E],I[_]=I[E],0!=k&&k>G/2&&(i[_]=new m.TheoRect(i[_].minX,i[_].minY,i[_].maxX-k+G/2,i[_].maxY)),_+=1,a.removeKey(i,E),a.removeKey(I,E),b=E),O)){I[E]=N;var z=P.pointSize*e.typographicBoundingRatios.heightRatio,U=F&&null==i[E]?w:0;0!=k&&b==E&&k>G/2&&(U=G/2);var Y=F?w:0,W=m.TheoRect.fromXYWH(P.placement.tx-U,P.placement.ty,P.size.width+(U+Y),z);null==(q=i[E])?(q=W,f[E]=P.typographicBoundingRatios):q=q.unionWith(W),i[E]=q}}}if(0==a.count(i))return new s.DecorationResults(a.clone(o));for(var V=s.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,M.italicAngle),X=a.iter(i,!0);!X.done;X.next()){var K,Q=X.key,q=X.value,j=f[Q],Z=q.size.height/e.typographicBoundingRatios.heightRatio,J=(e.typographicBoundingRatios.textVerticalOffsetRatio-M.capRatio)*Z,$=e.typographicBoundingRatios.textVerticalOffsetRatio,tt=e.typographicBoundingRatios.heightRatio,et=j.textVerticalOffsetRatio,nt=($-(tt/2-j.heightRatio/2)-et)*Z,ot=F?0:w,it=q.size.width+2*ot+V,rt=(z=q.size.height+2*x,q.minX-ot),at=q.minY+nt-J-x+R,lt=new y.TheoSize(it,z),st=c.Matrix2D.translationXY(rt,at),ht=!1;if(null!=I[Q]&&(K=t.style.characterStyles[I[Q]])&&K.backing==u.LockupBacking.SVGBackground){if(null==K.backingArtworkID)return a.opt(l.Host.logging,(function(t){return t.warning("artworkID or artworkInfo is nil ")})),new s.DecorationResults([]);var ut=new g.SVGBackgroundDecorationStrategy(K.backingArtworkID),ct=a.clone(h.LayoutResults.init_8322(a.clone(e.items),q.size,e.placement,e.typographicBoundingRatios,e.avgRowAspect)),gt=ut.calcSVGConfiguration(t.style,a.clone(ct),K.padding),pt=gt.frame,dt=gt.preScale;o.push(a.clone(h.LockupItem.init_9cc6(!1,pt.size,c.Matrix2D.translationXY(pt.minX+q.minX,pt.minY+q.minY+nt-J),K.backingArtworkID,dt,Q+e.numberOfLines,I[Q]))),ht=!0}if(!ht||n.backing==u.LockupBacking.Rows){var ft=d.TheoPathBuilder.init_d41d(),mt=r.clockwiseRectanglePath(m.TheoRect.fromSize(lt),c.Matrix2D.Identity,!0).path;ft.addPath(mt,c.Matrix2D.Identity),o.push(a.clone(h.LockupItem.init_708e(!1,lt,st,ft.path,Q,void 0,ht&&n.backing==u.LockupBacking.Rows?null:I[Q])))}}return o=a.sort(o,(function(t,e){return t.characterStyle!=e.characterStyle?null==t.characterStyle:t.rowIndex<e.rowIndex})),new s.DecorationResults(a.clone(o))},decorate:function(t,e){var n,o=t.style,i=!1;if((n=t.style.characterStyles[p.TypeLockupController.HIGHLIGHT_STYLE])&&(i=n.backing!=u.LockupBacking.Rows&&u.LockupStyle.isKnockoutLook(n.textLook)),!l.Host.textModelUtils.useOutlinesForKnockouts()||o.backing!=u.LockupBacking.Rows||!u.LockupStyle.isKnockoutLook(o.textLook)&&!i)return this.decorateNoKnockout(t,a.clone(e));var r=[],g={},f=[],k={},S=d.TheoPathBuilder.init_d41d(),L=d.TheoPathBuilder.init_d41d(),v=this.paddingScalar,T=o.padding;0==o.spacing&&e.numberOfLines>1&&(v*=.5,0==o.padding&&(T=.1));var F=e.avgLinePointSize*e.typographicBoundingRatios.heightRatio,C=F*T*v;T>=0&&(C=Math.max(.05*F,C));for(var x=t.style.font.fontData,A=s.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,x.italicAngle),R=e.typographicBoundingRatios.backingVerticalOffsetRatio*F,w=this.easeOut(0,R,T),M=C+e.typographicBoundingRatios.sideInsetRatio*e.avgLinePointSize,_=e.typographicBoundingRatios.textVerticalOffsetRatio,I=e.typographicBoundingRatios.heightRatio,b=c.Matrix2D.translationXY(-M,-C),D=!1,H=e.numberOfLines,B=a.iter(a.range(0,e.items.length,!1));!B.done;B.next()){var P=B.value,E=a.clone(e.items[P]);if(E.type==h.LockupItemType.Text){var O=E.rowIndex,N=o.backing==u.LockupBacking.Rows;if(null!=E.characterStyle&&null!=t.style.characterStyles[E.characterStyle]&&(N=!0),N){var G=E.pointSize*e.typographicBoundingRatios.heightRatio,z=m.TheoRect.fromXYWH(E.placement.tx,E.placement.ty,E.size.width,G),U=g[O];null==U?(U=z,k[O]=E.typographicBoundingRatios):U=U.unionWith(z),g[O]=U;var Y=k[O],W=U.size.height/e.typographicBoundingRatios.heightRatio,V=(e.typographicBoundingRatios.textVerticalOffsetRatio-E.font.capRatio)*W,X=Y.textVerticalOffsetRatio,K=(_-(I/2-Y.heightRatio/2)-X)*W;if(D||(b=c.Matrix2D.translationXY(-M,U.minY+K-V-C+w),D=!0),P==e.items.length-1||O!=e.items[P+1].rowIndex){var Q=!0,q=U.size.width+2*M+A,j=U.size.height+2*C,Z=U.minX,J=U.minY+K-V+w,$=a.last(f),tt=m.TheoRect.fromXYWH(Z,J,q,j);f.push(tt),null!=$&&$.maxY<tt.minY?(L.lineTo($.maxX,$.maxY),L.lineTo($.minX,$.maxY),L.closePath(),L.moveTo(tt.minX,tt.minY),Q=!1):null==$?L.moveTo(tt.minX,tt.minY):$.maxX>tt.maxX?L.lineTo($.maxX,$.maxY):L.lineTo($.maxX,tt.minY),Q&&null!=$&&$.maxX>tt.maxX?L.lineTo(tt.maxX,$.maxY):L.lineTo(tt.maxX,tt.minY)}}else null!=g[O]&&(g[H]=g[O],k[H]=k[O],H+=1,a.removeKey(g,O))}}if(0==f.length)return new s.DecorationResults(a.clone(r));L.lineTo(f[f.length-1].maxX,f[f.length-1].maxY);for(var et=a.iter(a.stride(f.length-1,0,-1));!et.done;et.next()){var nt=et.value;f[nt-1].maxY>=f[nt].minY?(L.lineTo(f[nt].minX,f[nt].maxY),f[nt].minX<f[nt-1].minX?(L.lineTo(f[nt].minX,f[nt].minY),L.lineTo(f[nt-1].minX,f[nt].minY)):(L.lineTo(f[nt].minX,f[nt-1].maxY),L.lineTo(f[nt-1].minX,f[nt-1].maxY))):nt==f.length-1&&L.lineTo(f[nt].minX,f[nt].maxY)}1==f.length&&L.lineTo(f[0].minX,f[0].maxY),L.closePath();var ot=c.Matrix2D.translationXY(0,-f[0].minY),it=l.Host.textModelUtils.rewindPath(L.simplestForm)||L.simplestForm;S.addPath(it,ot);var rt=S.path,at=new y.TheoSize(a.opt(rt.bounds,(function(t){return t.width})),a.opt(rt.bounds,(function(t){return t.height})));return r.push(a.clone(h.LockupItem.init_708e(!1,at,b,rt,null))),new s.DecorationResults(a.clone(r))}}}),o),r.KnockoutDecorationStrategy=(i=function(){s.BaseDecorationStrategy.call(this)},a.defineClass({name:"KnockoutDecorationStrategy",ctor:i,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.backing==u.LockupBacking.Knockout},decorate:function(t,e){var n,o,i=(n=a.opt(t.parentBounds,(function(t){return t.width})))||null!=n?n:5e3;null!=t.parentBounds&&a.opt(t.parentBounds,(function(t){return t.height}))>i&&(i=(o=a.opt(t.parentBounds,(function(t){return t.height})))||null!=o?o:5e3);var l=d.TheoPathBuilder.init_d41d(),u=e.placement,g=c.Matrix2D.translationXY(-i,-i),p=[],f=new y.TheoSize(e.size.width+2*i,e.size.height+2*i),k=m.TheoRect.fromSize(f),S=r.clockwiseRectanglePath(k,c.Matrix2D.Identity,!0).path;return l.addPath(S,u),p.push(a.clone(h.LockupItem.init_708e(!1,k.size,g,l.path,null,!0))),new s.DecorationResults(a.clone(p))}}}),i)},JKVa:function(t,e,n){var o,i=e,r=n("oAGj"),a=n("SpAV"),l=n("iCxV"),s=n("JgVS"),h=n("cEEQ"),u=n("c+uM"),c=n("tGKA"),g=n("ezSu"),p=n("35Q0"),d=n("oKlP"),f=n("sIWg");i.SVGBackgroundDecorationStrategy=(o=function(t){if(this.artworkID_=null,this.artworkInfo_=null,this.spacingScalar=.75,this.paddingScalar=.6,this.artworkID_=t,null!=t){var e=l.Host.resourceUtils.urlForResource("shape",t);null!=e?(this.artworkInfo_=l.Host.pathUtils.artworkFromURL(e,!1),a.CoreAssert.isTrue(null!=this.artworkInfo_,"Unable to load artwork!","SVGBackgroundDecorationStrategy.init","SVGBackgroundDecorationStrategy.swift",47)):r.opt(l.Host.logging,(function(t){return t.warning("Invalid artwork ID provided!")}))}},r.defineClass({name:"SVGBackgroundDecorationStrategy",ctor:o,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{easeOutQuad:function(t,e,n,o){var i=t/o;return-n*i*(i-2)+e},easeOut:function(t,e,n){return this.easeOutQuad(n,t,e-t,1)},supportsConfiguration:function(t){return t.style.backing==u.LockupBacking.SVGBackground&&this.artworkID_==t.style.backingArtworkID&&!u.LockupStyle.isLetterGrid(t.style.layout)},decorate:function(t,e){if(null==this.artworkID_||null==this.artworkInfo_)return r.opt(l.Host.logging,(function(t){return t.warning("artworkID or artworkInfo is nil ")})),new s.DecorationResults([]);var n=[],o=this.calcSVGConfiguration(t.style,r.clone(e)),i=o.frame,a=o.preScale;return n.push(r.clone(h.LockupItem.init_9cc6(!1,i.size,c.Matrix2D.translationXY(i.minX,i.minY),this.artworkID_,a))),new s.DecorationResults(r.clone(n))},calcSVGConfiguration:function(t,e,n){void 0===n&&(n=-1);var o=f.TheoRect.fromSize(e.size),i=e.typographicBoundingRatios.backingVerticalOffsetRatio*e.avgLinePointSize,r=t.font.fontData,a=s.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,r.italicAngle),l=((e.size.width+e.size.height)/4+e.avgLinePointSize)/2,h=t.padding*this.paddingScalar*l,u=t.padding;n>-1?(u=n/2,h=n*this.paddingScalar*l/2):e.numberOfLines>1&&(u+=t.spacing,h+=t.spacing*this.spacingScalar*e.avgLinePointSize),(t.padding>=0||n>-1)&&(h=Math.max(.05*l,h));var c,g=this.easeOut(0,i,Math.min(1,u)),m=o.minX-h,y=o.maxX+h+a,k=o.minY-h+g,S=o.maxY+h+g;if(o=new f.TheoRect(m,k,y,S),(c=p.ShapeLibrary.getShapeDataForArtworkId(this.artworkID_))&&c.category==p.ShapeCategory.Circle){var L=new d.TheoPoint(o.minX,o.minY),v=o.center,T=v.distanceTo(L),F=Math.sqrt(2*Math.pow(T,2))/2;m=v.x-F,y=v.x+F,k=v.y-F,S=v.y+F,o=new f.TheoRect(m,k,y,S)}return this.calcSVGFrame(o)},calcSVGFrame:function(t){var e,n,o=null!=this.artworkInfo_.sliceBox,i=null!=this.artworkInfo_.contentRegion,r=this.artworkInfo_.artwork.bounds,a=i?this.artworkInfo_.contentRegion:r,l=1,s=null;if(i)if(o){a=this.artworkInfo_.contentRegion;var h=t.width/a.width,u=t.height/a.height;s=Math.min(h,u);var p=g.NineSlicingFilter.calculateOuterBoundsForMapping(r,this.artworkInfo_.sliceBox,s,a,t);n=p.bounds,s=(e=p.prescribedPrescale)||null!=e?e:s}else h=t.width/a.width,u=t.height/a.height,l=Math.max(h,u),n=r.transform(c.Matrix2D.scalingXY(l,l));else o?n=t:(h=t.width/r.width,u=t.height/r.height,l=Math.max(h,u),n=r.transform(c.Matrix2D.scalingXY(l,l)));if(!o){var d=a.transform(c.Matrix2D.scalingXY(l,l));n=n.transform(c.Matrix2D.translation(t.center.subtract(d.center)))}return{frame:n,preScale:s}}}}),o)},X1F6:function(t,e,n){var o,i,r=e,a=n("oAGj"),l=n("SpAV"),s=n("QgZx"),h=n("iCxV"),u=n("cEEQ"),c=n("c+uM"),g=n("tGKA"),p=n("8t9B"),d=n("3UhB"),f=n("oKlP"),m=n("oKI3"),y=n("uUew"),k=n("sIWg"),S=n("1NAc");r.PathLayoutStrategy=(o=function(){this.trackingScalar=1.5,this.precision=.003,this.ascentCoeff=.594,this.concavityCoeff=1,this.requiredCoverageClosed=.99,this.requiredCoverageOpen=.99,this.coverageThresholdMustCenter=.98,this.sampleFontSize=32,this.minFontSize=8,this.maxFontSize=600,this.maxIterations=100,u.BaseLockupLayoutStrategy.call(this)},a.defineClass({name:"PathLayoutStrategy",ctor:o,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return c.LockupStyle.isPath(t.style.layout)},fitText:function(t){return t.style.alignment!=c.LockupAlignment.Right},layout:function(t){var e=t.containerSize,n=t.style,o=n.tracking*this.trackingScalar,i=t.text,r=n.font.fontData;r.allCapsAllowed&&(i=i.toUpperCase());var l=u.getTypographicBoundingRatiosOfString(i,r,!1),s=m.TextPathLibrary.getPathForLockupStyle(n),h=this.transformPath(s,e),c=h[0];s=h[1];var p=this.precision*c.hypotenuse,d=this.getCorrectedPathLen(s,l.heightFromBaselineRatio*this.sampleFontSize,p),L=s.isClosed()?this.requiredCoverageClosed:this.requiredCoverageOpen,v=a.clone(this.measureLetters(i,a.clone(t.characterStyleRanges),this.sampleFontSize,n,r,o,l.hasUppercase,s.isClosed())),T=this.estimateFontSizeToFit(s,i,r,l,o,p);T=Math.min(Math.max(this.minFontSize,T),this.maxFontSize);for(var F=0,C=this.minFontSize,x=this.maxFontSize,A=0,R=null;F<this.maxIterations&&C<x;){var w=s.clone();if(w=(R=this.placeLetters(w,a.clone(v),l,T,p)).path,R.placements.length<v.length)x=T;else{if((A=1-this.getCorrectedPathLen(w,l.heightFromBaselineRatio*this.sampleFontSize,p)/d)>=L)break;C=T}T=(C+x)/2,F+=1}A<this.coverageThresholdMustCenter&&(R=this.placeLettersAndCenter(s,a.clone(v),l,T,p));var M=this.fitText(t),_=R.bounds,I=_.size,b=1;M&&((I.width>e.width||I.height>e.height)&&(b=(I=this.getFitSize(_,e)).width/_.width),s=(s=s.offset(f._minus_TheoPoint_TheoPoint(f.TheoPoint.ZERO,_.origin))).multiply(new S.TheoSize(b,b)));for(var D=s.getBounds(),H=l.heightFromBaselineRatio*T,B=[],P=a.iter(a.toSequence(R.placements));!P.done;P.next()){var E=P.value,O=E.offset,N=E.element,G=v[O],z=M?_:D,U=(N.tx-z.minX)*b,Y=(N.ty-z.minY)*b,W=new g.Matrix2D(N.a,N.b,N.c,N.d,U,Y),V=T*G.fontSizeAdjustRatio*b,X=a.clone(u.LockupItem.init_e7b2(!0,G.characterStyle,new S.TheoSize(G.unitWidth*V,H),W,G.character,G.font,V,V,l,0,new y.TextRange(O,O+1)));B.push(a.clone(X))}var K=M?k.TheoRect.fromSize(I).unionWith(D).size:D.size;return u.LayoutResults.init_8322(a.clone(B),K,g.Matrix2D.Identity,l,K.aspectRatio)},placeOneLetter:function(t,e,n,o,i){var r=t,s=o*this.ascentCoeff,h=this.concavityCoeff*s,u=t.findTValueByCorrectedPrefixLength(s,h,n,i);if(u>=a.toDouble(t.numSegments))return{placement:null,t:0,path:t};var c=t.findTValueByCorrectedPrefixLength(s,h,e/2,i);l.CoreAssert.isTrue(c<a.toDouble(t.numSegments),void 0,"PathLayoutStrategy.placeOneLetter","PathLayoutStrategy.swift",218);var p=t.pointAt(c),d=t.tangentUnitVectorAt(c),f=Math.atan2(d.y,d.x);return{placement:g.Matrix2D.translationXY(-e/2,-o).rotate(Math.cos(f),Math.sin(f)).translate(p),t:u,path:r=r.truncate(u).suffix}},placeLetters:function(t,e,n,o,i){for(var r=n.heightFromBaselineRatio*o,l=0,s=k.TheoRect.Zero,h=[],u=t,c=a.iter(e);!c.done;c.next()){var g=c.value,p=o*g.fontSizeAdjustRatio,d=g.unitWidth*p,f=g.unitTrackedWidth*p,m=g.unitYAdjust*p,y=this.placeOneLetter(u,d,f,r-m,i);u=y.path;var S=y.placement;if(null==S)break;h.push(S);var L=new k.TheoRect(0,0,f,r).transform(S);s=s.unionWith(L),l+=f}return{placements:h,bounds:s,composedWidth:l,path:u}},placeLettersAndCenter:function(t,e,n,o,i){var r=t,l=this.placeLetters(r,a.clone(e),n,o,i);if(r=l.path,l.placements.length<e.length)return l;for(var s=0,h=i,u=0;(Math.abs(s-h)>.01*(s+h)||l.placements.length<e.length)&&u<this.maxIterations;)s>h||l.placements.length<e.length?s-=(s-h)/2:s+=(h-s)/2,r=r.truncate(r.findTValueByCorrectedPrefixLength(0,0,s,i)).suffix,r=(l=this.placeLetters(r,a.clone(e),n,o,i)).path,h=l.placements.length<e.length?0:r.getLength(i),u+=1;return l},calculateLeading:function(t,e){return t.style.spacing},adjustHeightForLeading:function(t,e,n,o){return 0},calculateTracking:function(t,e){return t.style.tracking},adjustWidthForTracking:function(t,e,n,o){return null},getFitSize:function(t,e,n){void 0===n&&(n=1);var o,i,r=t.width,a=t.height,l=0==a?1/0:r/a,s=e.width,h=e.height,u=s/h,c=n>1?n:1/n;return l<u?(i=h,o=h*(u=Math.min(u,l*c))):(o=s,i=s/(u=Math.max(u,l/c))),new S.TheoSize(o,i)},transformPath:function(t,e){var n=t.getBounds(),o=this.getFitSize(n,e,t.flex),i=0==n.width?1:o.width/n.width,r=0==n.height?1:o.height/n.height;return[o,t.multiply(new S.TheoSize(i,r))]},getCorrectedPathLen:function(t,e,n){var o=e*this.ascentCoeff,i=this.concavityCoeff*o;return t.getCorrectedLength(o,i,n)},estimateFontSizeToFit:function(t,e,n,o,i,r){var l=e.length,s=a.clone(h.Host.textModelUtils.getGlyphPositions(e,n,32,!1)),u=a.toDouble(t.isClosed()?l:l-1)*i*32,c=a.last(s)+u,g=t.getLength(r);return 32*g/(c-(this.getCorrectedPathLen(t,32*o.heightFromBaselineRatio,r)-g))},getCharacterStyle:function(t,e,n){for(var o=a.iter(t);!o.done;o.next()){var i=o.value;if(e>=i.start&&e<i.end)return p.TypeLockupController.HIGHLIGHT_STYLE}return""},measureLetters:function(t,e,n,o,i,l,u,c){var g,f=t.length,m=a.opt(a.opt(o.characterStyles[p.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||i,y=d.TypeLockupUtils.getCharFontAdjust(o,u,!1),k=d.TypeLockupUtils.getCharFontYAdjust(o,n,n*y),S=[],L=[],v=[],T=l<=.25;T&&(L=a.clone(h.Host.textModelUtils.getGlyphPositions(t,i,n,!1)),v=a.clone(a.eq(s._equality_FontDescriptor_FontDescriptor,m,i)?L:h.Host.textModelUtils.getGlyphPositions(t,m,n,!1)));for(var F,C,x=!1,A=a.iter(a.toSequence(a.chars(t)));!A.done;A.next()){var R=A.value,w=R.offset,M=R.element,_=a.toString(M),I=(g=C)||null!=g?g:this.getCharacterStyle(a.clone(e),w,w+1);w<f-1&&(C=this.getCharacterStyle(a.clone(e),w+1,w+2));var b=I==p.TypeLockupController.HIGHLIGHT_STYLE,D=b?m:i,H=b?y:1,B=b?k/(n*H):0,P=0;if(T&&I==C){var E=a.clone(b?v:L);P=(E[w+1]-E[w])/n}else P=h.Host.textModelUtils.measureInkBounds(_,D,n).width/n;var O=r.LetterInfo.init_3ebc(_,D,H,I,P,B,w!=f-1||c?l:0);(x=d.TypeLockupUtils.isWhiteSpace(_))&&(F=O),S.push(O)}return c&&!x&&null!=F&&S.push(F),S}}}),o),r.LetterInfo=(i=function(){},a.defineClass({name:"LetterInfo",ctor:i,props:{init_3ebc:function(t,e,n,o,i,r,a){this.character=t,this.font=e,this.fontSizeAdjustRatio=n,this.characterStyle=o,this.unitWidth=i,this.unitYAdjust=r,this.unitTrackedWidth=i+a},init_implicit:function(t,e,n,o,i,r,a){this.character=t,this.font=e,this.fontSizeAdjustRatio=n,this.characterStyle=o,this.unitWidth=i,this.unitYAdjust=r,this.unitTrackedWidth=a}}}),i)}}]);
//# sourceMappingURL=vendors_npm_spark_6dd528bf-19fff9c7.js.map