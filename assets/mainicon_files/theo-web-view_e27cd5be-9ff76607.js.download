(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[82,67,75],{"4pbt":function(e,t,o){var n,a;n=[o("xeH2"),o("UFvF"),o("YLtl"),o("Uwho"),o("gBAB"),o("2ofD"),o("Na8G"),o("tY4j"),o("zTjw"),o("DIoP"),o("MGCh"),o("vOKO"),o("+Ltv"),o("ZLL8"),o("uRNc"),o("Dcjk"),o("3xdQ"),o("3xm6"),o("Avqh"),o("KFmL"),o("+VG/"),o("WPh2"),o("sggK"),o("2Fsf"),o("0VUy"),o("5eso"),o("TW0n"),o("C8IR"),o("W1Jy"),o("M1RA"),o("NgGw"),o("tpS0"),o("0gXD"),o("z4rR"),o("7LIx"),o("/Elb"),o("r30K"),o("KQv+"),o("FIWz"),o("UXma"),o("mYMA"),o("vdJz"),o("e8qH"),o("wRAw"),o("GN+k"),o("W3p6"),o("mTyn"),o("uZvm"),o("ZXGz"),o("jo99"),o("HPKp"),o("7JlS"),o("FpXA"),o("UzQk"),o("k99a"),o("YJFe"),o("Ctaw"),o("Exk9"),o("+gTl"),o("a8ov"),o("TdwW"),o("O0ct"),o("JjOv"),o("mwMu"),o("qnb0"),o("8VGm"),o("b2xK"),o("pVEn"),o("pEL3"),o("/nf9"),o("hSNs"),o("Pbp+"),o("GSfz"),o("fuLW"),o("d/MO"),o("yQjA"),o("dO52"),o("kdSY"),o("Ww1C"),o("3Jkv"),o("rjtT"),o("TY/+")],void 0===(a=function(e,t,n,a,r,i,s,l,d,c,p,u,m,g,b,h,f,w,v,k,T,I,P,C,B,S,x,y,D,A,L,E,M,F,W,N,R,z,U,O,j,G,H,_,K,$,V,X,Y,Q,q,J,Z,ee,te,oe,ne,ae,re,ie,se,le,de,ce,pe,ue,me,ge,be,he,fe,we,ve,ke,Te,Ie,Pe,Ce,Be,Se,xe,ye){const De=ie.default,Ae=ue.default,Le={STALE_SESSION:"Stale Session"};we.init();Ce();var Ee,Me,Fe=p.channel("controller"),We={},Ne=!0,Re=!1,ze=!1,Ue={errorDialogs:{}},Oe=[],je=-1,Ge=t.defer(),He=t.defer();He.resolve();var _e,Ke,$e,Ve,Xe,Ye,Qe,qe,Je,Ze,et,tt=!1,ot=!0,nt=!1,at=!1,rt=null,it={DOCUMENT:1,TEMPLATE:2},st=new te,lt=new oe(st),dt="app.kDefaultDocName",ct="app.kDefaultTemplateName",pt=["showFacebookUploadButton","showImageModalPanelOnload","showShareButton","showDownloadButton"],ut={default:{isDefault:!0,showShareButton:!0,showDownloadButton:!0},"facebook-cover-image-design":{showFacebookUpdateCoverButton:!0,showNoProfilePic:!1,showImageModalPanelOnload:!0},"facebook-holiday-ad-design":{showFacebookUploadButton:!0,showImageModalPanelOnload:!0},"twitter-design":{showTwitterUpload:!0}},mt=!1,gt=!1,bt="",ht="",ft="";if(We.enabled=!1,window.newrelic&&window.newrelic.setCustomAttribute){const e=window.adobeIMS.getUserProfile().userId;window.newrelic.setCustomAttribute("adobeId",e)}function wt(){m.inPremiumTemplateOnboardingFlow=!0,Lt()}function vt(e){Ue.collabStatusButton.$el.toggleClass("shared-document",!!e)}function kt(e){i.currentDoc===e.composite&&(vt(e.collab.collaborators.length+e.collab.invitations.length>0),Ue.brandIndicator&&Ue.brandIndicator.update({collaborationStatus:i.currentDoc.getCollaboration()||"NONE"}))}function Tt(e){aa(e.authContext).then(()=>{Ue.brandIndicator.events.publish("brand-switch-complete")}).done()}function It(){if(Qe&&Qe.newTemplateId){var e="design-edit-template/post/"+Qe.contextId+"/"+Qe.newTemplateId;marvel.navigate(e,{trigger:!1,replace:!0})}}function Pt(e){var t="design/post/"+e;marvel.navigate(t,{trigger:!1,replace:!0})}var Ct=!1;function Bt(){Ue.addContentPopUp.$el.addClass("slide-right-fade-out"),Ue.addContentButton.$el.removeClass("rotate"),Ct=!1,Ue.postEditorView.$el.off("click",Bt),setTimeout((function(){Ue.addContentPopUp.hide(),Ue.addContentPopUp.$el.removeClass("slide-right-fade-out")}),300)}function St(e){Ct?Bt():(c.publish("editor:addPressed"),Ue.addContentPopUp.$el.addClass("slide-left-fade-in"),Ue.addContentPopUp.show(),Ue.addContentButton.$el.addClass("rotate"),Ue.addContentButton.$el.removeClass("large"),Ct=!0,t.resolve().then((function(){Ue.postEditorView.$el.on("click",Bt)})),setTimeout((function(){Ue.addContentPopUp.$el.removeClass("slide-left-fade-in")}),300))}async function xt(){ze=!0;var e=Ke===it.TEMPLATE?"template-mode main-toolbar toolbar":"main-toolbar toolbar";if(Ue.postEditorView=new D({id:"PostEditorContent",layout:"rows",parent:Ue.windowPanel,panels:[{id:"PostTopBar",class:e,size:"66px"},{id:"PostApp",size:"auto"}]}),Ue.topColorStrip=new v({parent:"PostTopBar",id:"colorStrip",tag:"DIV"}),Ke!==it.TEMPLATE?(Ue.postAppSection=new D({layout:"columns",panels:[{id:"PostCanvasSection",size:"auto"},{id:"PostControlSection",size:"280px"},{id:"PostNavStrip",size:"80px"}],parent:"PostApp"}),Ue.postControlStrip=new D({layout:"rows",panels:[{id:"PostBrandIndicatorContainer",size:"50px"},{id:"PostSidebar",size:"auto"}],parent:"PostControlSection"}),Ue.brandIndicator=new F({collaborationStatus:i.currentDoc.getCollaboration(),height:50,id:"PostBrandIndicator",isEntitled:st.featureEnabled("entitle-brand-kit"),parent:"PostBrandIndicatorContainer",navigateToCreateBrandMethod:ma,width:280})):Ue.postAppSection=new D({layout:"columns",parent:"PostApp",panels:[{id:"PostCanvasSection",size:"auto"},{id:"PostSidebar",size:"280px"},{id:"PostNavStrip",size:"80px"}]}),Ue.postContentSection=new D({layout:"rows",parent:"PostCanvasSection",panels:[{id:"PostContentSection",size:"auto"},{id:"PostActionsStrip",size:"0px"}]}),Ue.canvasInteractionLayer=new B({id:"canvasInteractionLayer",parent:"PostCanvasSection",onPointerDown:function(e){var t=yt(e.x,e.y);Me.handlePointerChanged({updateType:"pointerDown",x:t.x,y:t.y,pointerType:e.pointerType,pointerId:e.pointerId,tapCount:e.tapCount,modifierKeys:e.modifierKeys})},onPointerUp:function(e){var t=yt(e.x,e.y);Me.handlePointerChanged({updateType:"pointerUp",x:t.x,y:t.y,pointerType:e.pointerType,pointerId:e.pointerId,tapCount:e.tapCount,modifierKeys:e.modifierKeys})},onPointerMove:function(e){var t=yt(e.x,e.y);Me.handlePointerChanged({updateType:"pointerMove",x:t.x,y:t.y,pointerType:e.pointerType,pointerId:e.pointerId,tapCount:e.tapCount,modifierKeys:e.modifierKeys})}}),Ue.imageWrapper=new y({id:"PosterImageWrapper",parent:Ue.canvasInteractionLayer,aspect:1,margin:40,marginLeft:70,marginRight:70,minTop:100}),st.featureEnabled("post-enable-zendesk-widget")&&(ke.loadZendeskWidget(),Ue.feebackButton=new T({parent:Ue.canvasInteractionLayer,class:"feedback-button",width:40,height:40,onClick:function(){window.zE.activate({hideOnClose:!0})}})),Ke===it.TEMPLATE&&Ue.imageWrapper.$el.on("click",(function(){Ue.docNameInput.blur()})),Ue.poster=await ye.default({featureFlag:"post-pgm-poster",featureEnabled:st.featureEnabled,parent:Ue.imageWrapper,watermarkEnabled:Ne}).catch(Fe.error),ee.Host.setPosterView(Ue.poster),Ue.postTopBarLeft=new C({parent:"PostTopBar",id:"PostTopBarLeft",class:"application-options",height:"auto",width:Ke===it.TEMPLATE?"auto":495}),Ue.postTopBarMid=new C({parent:"PostTopBar",id:"PostTopBarMid",class:"document-options",template:"",height:"auto",width:"auto"}),Ue.postTopBarRight=new C({parent:"PostTopBar",id:"PostTopBarRight",class:"editor-options",height:"auto",left:"auto",width:360}),Ke===it.TEMPLATE?(Ue.saveTemplateButton=new k({parent:"PostTopBarLeft",class:"pill pill-primary-on-light",hidden:!1,label:"i18n.common.kSave",onClick:Et}),Ue.cancelTemplateButton=new k({parent:"PostTopBarLeft",class:"pill pill-secondary-on-light",hidden:!1,label:"i18n.common.kCancel",onClick:Mt})):(Ue.hamburgerMenu=new k({parent:"PostTopBarLeft",class:"hamburgerButton mrvl-hamburger-menu",attributes:{"data-auto":"mrvl-hamburger-menu"},label:" ",tag:"div",onClick:function(){window.marvel&&window.marvel.events.trigger("mrvl-show-global-nav")}}),Ue.homeButton=new k({parent:"PostTopBarLeft",class:"homeButton",id:"PostHomeButton",label:" ",tag:"div",onClick:ua}),Ue.postLogo=new C({parent:"PostTopBarLeft",id:"PostLogo",template:"i18n.app.kPost",class:"name"}),Ue.navCrumbs=new C({parent:"PostTopBarLeft",id:"PostTopBarNavCrumbs"}),Ue.backToProjects=new k({class:"post-top-bar-crumb",parent:Ue.navCrumbs,label:"i18n.app.kProjects",onClick:ga}),Ue.carrotOne=new v({class:"post-top-bar-carrot",parent:Ue.navCrumbs})),Ue.docNameInput=new ge({parent:Ke===it.TEMPLATE?"PostTopBarLeft":Ue.navCrumbs,onFocusOut:function(){var e=Ue.docNameInput.getText();if(e.trim().length<1){e="";var t=Ke===it.TEMPLATE?ct:dt,o=w.translate(t);Ue.docNameInput.setText(o),Ue.docNameInput.$el.addClass("placeholder"),Ue.docNameInput.$el.removeClass("named")}else{(Ke===it.TEMPLATE?ae.getTemplateName(Ye):i.currentDoc.getProjectName())!==e?c.publish("renameDocument",{}):c.publish("renameDocumentCancelled",{}),Ue.docNameInput.$el.removeClass("placeholder"),Ue.docNameInput.$el.addClass("named")}!function(e){Ke===it.TEMPLATE?ae.setTemplateName(Ye,e):i.currentDoc.setProjectName(e);Fn()}(e),Ue.editNameButton.$el.css("visibility","visible")},onFocus:function(){c.publish("renameDocumentClicked",{}),Me.deselect(),Ue.editNameButton.$el.css("visibility","hidden"),Ue.docNameInput.$el.hasClass("placeholder")&&(Ue.docNameInput.setText(""),Ue.docNameInput.$el.removeClass("placeholder"),Ue.docNameInput.$el.addClass("named"))},attributes:{"data-i18n":"[aria-label]app.kPostNameInputLabel"}}),Ue.editNameButton=new T({parent:Ke===it.TEMPLATE?"PostTopBarLeft":Ue.navCrumbs,class:"edit-name-button",width:16,height:16,onClick:function(){Ue.docNameInput.focus(),Ue.editNameButton.$el.css("visibility","hidden")}}),Ue.savingIndicator=new v({id:"PostSavingIndicator",parent:"PostTopBarLeft",template:"i18n.app.kSaving",hidden:!0}),Ue.undo=new k({parent:"PostTopBarMid",id:"PostUndoButton",tag:"div",hoverLabel:"i18n.app.kUndo",hoverLabelPosition:"below",label:"i18n.app.kUndo",onClick:Dt}),Ue.redo=new k({parent:"PostTopBarMid",id:"PostRedoButton",tag:"div",hoverLabel:"i18n.app.kRedo",hoverLabelPosition:"below",label:"i18n.app.kRedo",onClick:At}),st.featureEnabled("post-enable-debug-menu")&&(Ue.debugMenu=new k({parent:"PostTopBarMid",id:"PostDebugMenuButton",tag:"div",label:"Debug",onClick:function(){Ue.debugView.show()}}),Ue.debugView=new N({id:"PostDebugView",parent:"PostCanvasSection"})),Ke!==it.TEMPLATE){Ue.collabStatusButton=new T({parent:"PostTopBarRight",class:"collabStatusButton",width:50,height:63,onClick:function(){jt("projectHeader")}}),vt(i.currentDoc.attributes.collaboration&&"NONE"!==i.currentDoc.attributes.collaboration);const e={parent:"PostTopBarRight",class:"button downloadButton",id:"downloadButton",label:"app.kDownload",submitButtonLabel:"app.kStartDownload",optionsList:[{label:"app.downloadOptions.pngImg.kButtonLabel",filetype:"img_png",checked:"true",tooltipMessage:"app.downloadOptions.pngImg.kTooltip"},{label:"app.downloadOptions.jpgImg.kButtonLabel",filetype:"img_jpg",tooltipMessage:"app.downloadOptions.jpgImg.kTooltip"},{label:"app.downloadOptions.printPdf.kButtonLabel",filetype:"pdf",betaflag:"true",tooltipMessage:"app.downloadOptions.printPdf.kTooltip"}],onIMGDownload:Ht,onPDFDownload:_t,onOptionsShown:Kt};Ue.downloadButton=new Te(e);const t={parent:"PostTopBarRight",class:"postShareMenu",id:"postShareMenu",menutitle:"app.kShare",onClick:Gt,icon:"/images/sp-editor-share.svg",iconHover:"/images/sp-editor-share-hover.svg",menuitems:[{icon:"/marvel-core/images/share/sp-editor-publish.svg",menuItemText:"app.shareMenuItems.publish.kMenuItemText",tooltipMessage:"app.shareMenuItems.publish.kTooltip",id:"sharemenu-publish"},{icon:"/marvel-core/images/share/sp-editor-invite.svg",menuItemText:"app.shareMenuItems.invite.kMenuItemText",tooltipMessage:"app.shareMenuItems.invite.kTooltip",id:"sharemenu-invite"}]};Ue.sharePostButton=new Pe(t),Se.getAccountType().then((function(e){Se.shouldShowNewBadge().then((function(o){const n=[...t.menuitems];"teacher"===e&&n.push({icon:"/marvel-core/images/share/sp-editor-canvas-lms.svg",menuItemText:"app.shareMenuItems.lms.kAttachText",id:"sharemenu-lms-attach",menuItemTag:o?"app.shareMenuItems.lms.kMenuItemTag":""}),"student"===e&&n.push({icon:"/marvel-core/images/share/sp-editor-canvas-lms.svg",menuItemText:"app.shareMenuItems.lms.kTurninText",id:"sharemenu-lms-attach",menuItemTag:o?"app.shareMenuItems.lms.kMenuItemTag":""}),Ue.sharePostButton.update({menuitems:n,menutitle:t.menutitle,icon:t.icon,iconHover:t.iconHover}),o&&(Ue.lmsCoachmark||(Ue.lmsCoachmark=new be({parent:"postShareMenu",id:"lmsCoachmark",message:"i18n.components.coachmarks.lms.kMessage",arrowDirection:"top-right",closeButtonType:"icon",height:52,width:330,top:66,hidden:!0,left:"calc(100% - 330px)",priority:10,anchorElement:Ue.sharePostButton})),setTimeout(()=>{Ue.lmsCoachmark.show()},0))}))}))}Ue.facebookUploadButton=new k({parent:"PostTopBarMid",class:"button uploadButton facebookUploadButton",id:"FacebookUploadButton",hidden:!0,tag:"div",label:"i18n.app.kShareFacebook",onClick:$t}),Ue.facebookUpdateCover=new k({parent:"PostTopBarMid",class:"button uploadButton facebookUploadButton",id:"facebookUpdateCoverButton",hidden:!0,tag:"div",label:"i18n.app.kUpdateFacebookCover",onClick:$t}),Ue.twitterUpload=new k({parent:"PostTopBarMid",class:"button uploadButton twitterUploadButton",id:"TwitterUploadButton",hidden:!0,tag:"div",label:"i18n.app.kUploadTwitter",onClick:Vt}),Ue.addContentRegion=new C({parent:"PostNavStrip",id:"PostAddContentRegion",height:80,width:80}),Ue.addContentButton=new T({parent:"PostAddContentRegion",id:"PostAddContentButton",height:"auto",width:"auto",label:"i18n.components.buttons.kAdd",iconTemplate:"<i class='circle-button'></i>",onClick:St}),Ue.addContentPopUp=new A({id:"PostAddContentPopUp",parent:"PostAddContentRegion",focusScrim:!1,hidden:!0,iconCount:4,carrot:!0,preventDefaultAnimation:!0}),Ue.addContentTextButton=new T({parent:"PostAddContentPopUp",class:"pop-up-icon-left",id:"PostAddContentPopUpText",label:"i18n.components.buttons.kText",width:60,height:60,onClick:fo}),Ue.addContentImageButton=new T({parent:"PostAddContentPopUp",class:"pop-up-icon-mid",id:"PostAddContentPopUpImage",width:60,height:60,label:"i18n.components.buttons.kPhoto",onClick:go}),Ue.colorPicker=new W({id:"colorPicker",parent:Ue.postEditorView,top:180,left:10,width:250,height:350,hideBrandkit:!st.featureEnabled("entitle-brand-kit")}),Ue.sidebarGlobal=new L({parent:"PostSidebar",hidden:!1}),Ue.sidebarTheme=new H({parent:Ue.sidebarGlobal,hidden:!1,visibilityGroup:"main-sidebar",showMerchPopup:!st.featureEnabled("entitle-brand-kit")}),Ue.sidebarPalette=new _({parent:Ue.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar",enableColorPicker:st.featureEnabled("post-color-picker"),colorPicker:Ue.colorPicker}),Ue.sidebarResize=new G({parent:Ue.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar"}),st.featureEnabled("post-templates-search-enabled")&&Ke!==it.TEMPLATE&&(Ue.sidebarTemplates=new X({waitForSaveMethod:Ca,saveDocument:Fn,deletingCurrentDoc:Un,imageWrapper:Ue.imageWrapper,parent:Ue.sidebarGlobal,poster:Ue.poster,hidden:!0,visibilityGroup:"main-sidebar",showResizeOption:st.featureEnabled("post-templates-show-resize"),getDocSize:Hn})),Ue.sidebarLayout=new j({parent:Ue.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar"}),Ue.sidebarGlobal.registerSidebarTabWithId(Ue.sidebarTheme,"theme"),Ue.sidebarGlobal.registerSidebarTabWithId(Ue.sidebarPalette,"palette"),Ue.sidebarGlobal.registerSidebarTabWithId(Ue.sidebarLayout,"layout"),Ue.sidebarGlobal.registerSidebarTabWithId(Ue.sidebarResize,"resize"),Ue.sidebarTemplates&&Ue.sidebarGlobal.registerSidebarTabWithId(Ue.sidebarTemplates,"templates"),Ue.sidebarText=new O({parent:"PostSidebar",hidden:!0,hasNewFonts:st.featureEnabled("post-new-fonts"),enableColorPicker:st.featureEnabled("post-color-picker"),entitleBrandKit:st.featureEnabled("entitle-brand-kit"),wheelImprovementsEnabled:st.featureEnabled("post-wheel-improvements"),colorPicker:Ue.colorPicker}),Ue.sidebarBackground=new U({parent:"PostSidebar",hidden:!0,enablePixiRenderer:st.featureEnabled("post-pgm-poster"),enableColorPicker:st.featureEnabled("post-color-picker"),colorPicker:Ue.colorPicker,disableImageFrames:wn()}),Ue.sidebarLogo=new K({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),Ue.sidebarIcon=new $({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",colorPicker:Ue.colorPicker}),Ue.sidebarMultiselect=new V({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",alignmentTypes:Me.getAlignmentTypes(),distributeTypes:Me.getDistributeTypes()}),Ue.addTextSidebar=new Q({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",onAddText:Yt}),Ue.sidebarCrop=new q({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),Ue.navStripTabsWrapper=new v({parent:"PostNavStrip",id:"PostNavStripTabsWrapper"}),Ue.globalTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostGlobalTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"global-tabs",defaultActive:!0,rememberLastTab:!0,onShown:jo}),st.featureEnabled("post-templates-search-enabled")&&Ke!==it.TEMPLATE&&(Ue.tabButtonTemplates=new I({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kTemplates",id:"sectionTabTemplates",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:tn}),Ue.globalTabsWrapper.registerTab(Ue.tabButtonTemplates)),Ke!==it.TEMPLATE&&(Ue.tabButtonTheme=new I({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kDesign",id:"sectionTabTheme",group:"global-sidebar-tabs",defaultSelected:!0,onSelect:on}),Ue.globalTabsWrapper.registerTab(Ue.tabButtonTheme)),Ue.tabButtonPalette=new I({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kColors",id:"sectionTabPalette",group:"global-sidebar-tabs",onSelect:nn}),Ue.globalTabsWrapper.registerTab(Ue.tabButtonPalette),Ue.tabButtonLayout=new I({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kLayout",id:"sectionTabLayout",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:Jo}),Ue.globalTabsWrapper.registerTab(Ue.tabButtonLayout),Ue.tabButtonResize=new I({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kResize",id:"sectionTabResize",group:"global-sidebar-tabs",defaultSelected:!1,isPremium:st.featureEnabled("post-resize-is-paid-feature")&&Ke!==it.TEMPLATE,isEntitled:lt.isEntitledToFeature("postResizeButton"),onTrySelect:Zo,onSelect:en}),Ue.globalTabsWrapper.registerTab(Ue.tabButtonResize),Ue.textTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostTextTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"text-tabs",defaultActive:!1,onHidden:function(){Ue.sidebarText.hide(),Me&&Me.exitCharStyleMode()},onShown:$o}),Ue.tabButtonTextType=new I({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kType",id:"sectionTabText",group:"text-tabs",onSelect:function(){an({tabId:"type"})}}),Ue.textTabsWrapper.registerTab(Ue.tabButtonTextType),Ue.tabButtonTextColor=new I({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kColor",id:"sectionTabTextColor",group:"text-tabs",onSelect:function(){an({tabId:"color"})}}),Ue.textTabsWrapper.registerTab(Ue.tabButtonTextColor),Ue.tabButtonTextShape=new I({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kShape",id:"sectionTabTextShape",group:"text-tabs",onSelect:function(){an({tabId:"shape"})}}),Ue.textTabsWrapper.registerTab(Ue.tabButtonTextShape),Ue.tabButtonTextEffects=new I({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kEffects",id:"sectionTabTextEffects",group:"text-tabs",onSelect:function(){an({tabId:"effects"})}}),Ue.textTabsWrapper.registerTab(Ue.tabButtonTextEffects),Ue.tabButtonTextStyle=new I({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kStyle",id:"sectionTabTextStyle",group:"text-tabs",onSelect:function(){an({tabId:"style"})}}),Ue.textTabsWrapper.registerTab(Ue.tabButtonTextStyle),Ue.addTextTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostAddTextTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"add-text-tabs",defaultActive:!1,onHidden:Go,onShown:Ho}),Ue.tabButtonAddText=new I({parent:"PostAddTextTabsWrapper",label:"i18n.components.buttons.kText",id:"sectionTabAddText",group:"local-sidebar-tabs"}),Ue.addTextTabsWrapper.registerTab(Ue.tabButtonAddText),Ue.cropTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostCropTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"crop-tabs",defaultActive:!1,onHidden:_o}),Ue.tabButtonCrop=new I({parent:"PostCropTabsWrapper",label:"i18n.components.buttons.kImage",id:"sectionTabCrop",group:"local-sidebar-tabs"}),Ue.cropTabsWrapper.registerTab(Ue.tabButtonCrop),Ue.backgroundTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostBackgroundTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"background-tabs",defaultActive:!1,onHidden:Ue.sidebarBackground.hide,onShown:Ko}),Ue.tabButtonBackgroundImage=new I({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kImage",id:"sectionTabBackground",group:"local-sidebar-tabs",onSelect:function(){rn({tabId:"image"});var e=Me.getSelectedForma();e&&!e.isImage()&&ho({disallowClose:!0,setHome:!0})}}),Ue.backgroundTabsWrapper.registerTab(Ue.tabButtonBackgroundImage),Ue.tabButtonBackgroundLooks=new I({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kFilters",id:"sectionTabBackgroundLooks",group:"local-sidebar-tabs",onSelect:function(){rn({tabId:"looks"});var e=Me.getSelectedForma();e&&!e.isImage()&&ho({disallowClose:!0,setHome:!0})}}),Ue.backgroundTabsWrapper.registerTab(Ue.tabButtonBackgroundLooks),Ue.tabButtonBackgroundColor=new I({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kColorFill",id:"sectionTabBackgroundColor",group:"local-sidebar-tabs",onSelect:function(){rn({tabId:"color"})}}),Ue.backgroundTabsWrapper.registerTab(Ue.tabButtonBackgroundColor),Ue.logoTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostLogoTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"logo-tabs",defaultActive:!1,onHidden:Ue.sidebarLogo.hide,onShown:Vo}),Ue.tabButtonLogo=new I({parent:"PostLogoTabsWrapper",label:"i18n.components.buttons.kLogo",id:"sectionTabLogo",group:"local-sidebar-tabs",onSelect:sn}),Ue.logoTabsWrapper.registerTab(Ue.tabButtonLogo),Ue.iconTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostIconTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"icon-tabs",defaultActive:!1,onHidden:Ue.sidebarIcon.hide,onShown:Xo}),st.featureEnabled("post-language-switcher")&&(Ue.LanguageSwitcher=new fe({parent:"PostNavStrip",id:"PostLanguageSwitcher"}));let t="i18n.components.buttons.kIcon";we.run("IconShapeExperiment",{shape_for_icon_label:function(e){t="i18n.components.buttons.kShape"},control:function(e){}}).then((function(e){Ue.tabButtonIcon=new I({parent:"PostIconTabsWrapper",label:t,id:"sectionTabIcon",group:"local-sidebar-tabs",onSelect:function(){ln({tabId:"icon"})}}),Ue.iconTabsWrapper.registerTab(Ue.tabButtonIcon),Ue.tabButtonIconColor=new I({parent:"PostIconTabsWrapper",label:"i18n.components.buttons.kColor",id:"sectionTabIconColor",group:"local-sidebar-tabs",onSelect:function(){ln({tabId:"color"})}}),Ue.iconTabsWrapper.registerTab(Ue.tabButtonIconColor),Ue.addContentIconButton=new T({parent:"PostAddContentPopUp",class:"pop-up-icon-mid",id:"PostAddContentPopUpIcon",width:60,height:60,label:t,onClick:mo}),Ue.addContentLogoButton=new T({parent:"PostAddContentPopUp",class:"pop-up-icon-right",id:"PostAddContentPopUpLogo",width:60,height:60,label:"i18n.components.buttons.kLogo",onClick:vo}),_n()})).done(),Ue.multiselectTabsWrapper=new P({parent:"PostNavStripTabsWrapper",id:"PostMultiselectTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"multiselect-tabs",defaultActive:!1,onHidden:Ue.sidebarMultiselect.hide,onShown:Yo}),Ue.tabButtonMultiselectAlign=new I({parent:"PostMultiselectTabsWrapper",label:"i18n.components.buttons.kAlgin",id:"sectionTabAlign",group:"multiselect-tabs",onSelect:function(){var e,t;t=(e=(e={tabId:"align"})||{}).tabId||"align",Ue.sidebarMultiselect.showSidebarWithId(e.tabId),qo({component:Ue.sidebarMultiselect}),"align"===t&&c.publish("multiselectSidebarDisplayed:align")}}),Ue.multiselectTabsWrapper.registerTab(Ue.tabButtonMultiselectAlign),Ue.changeImageModalPanel=new D({layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostImagePicker",size:"auto"}]}),Ue.changeImageModalPanel.remove=function(){Ue.changeImageModalPanel.$el.hide()};var o=!1;Ue.changeImageModalPanel.insert=function(){o?Ue.changeImageModalPanel.$el.show():(Ue.changeImageModalPanel.parent.$el.append(Ue.changeImageModalPanel.$el),o=!0)},Ue.imagePicker=new Y({parent:"PostImagePicker",waitForSaveMethod:Ca,onClose:function(){Ue.changeImageModalPanel.hide(),!Me.getSelectedForma()&&ft.length?(Me.selectFormaById({formaId:ft}),ft=""):(Me.deselect(),Gn())}}),Ue.changeIconModalPanel=new D({layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostIconPicker",size:"auto"}]}),Ue.changeIconModalPanel.remove=function(){Ue.changeIconModalPanel.$el.hide()};var n=!1;Ue.changeIconModalPanel.insert=function(){n?Ue.changeIconModalPanel.$el.show():(Ue.changeIconModalPanel.parent.$el.append(Ue.changeIconModalPanel.$el),n=!0)},Ue.iconPicker=new Y({parent:"PostIconPicker",waitForSaveMethod:Ca,sources:[],assetType:"vector",image_filter:[".svg","image/svg+xml"],label:"Choose icon",onClose:function(){Ue.changeIconModalPanel.hide(),!Me.getSelectedForma()&&ft.length?(Me.selectFormaById({formaId:ft}),ft=""):(Me.deselect(),Gn())}}),Ue.textCapture=new z({parent:Ue.windowPanel,hidden:!0,coreWrapper:Me}),Ue.posterAdornments=new Z({poster:Ue.poster,background:Ue.postContentSection,pageElement:Ee}),Ue.watermarkButton=new x({id:"PostWatermarkButton",parent:Ue.imageWrapper,onClick:Rt,hidden:!!Ne}),Ne&&function(){Ue.watermarkButton.$el.on("mouseover",(function(){Ne&&Ze&&Ue.watermarkTooltip.show()})),Ue.watermarkButton.$el.on("mouseleave",(function(){Ne&&Ze&&Ue.watermarkTooltip.hide()})),Ue.watermarkCoachmark=new be({parent:Ue.imageWrapper,id:"watermarkCoachmark",message:"i18n.components.coachmarks.watermark.kMessage",title:"i18n.components.coachmarks.watermark.kTitle",hidden:!0,arrowDirection:"down",offsetY:-210,priority:0,anchorElement:Ue.watermarkButton,userSettingFlag:ve.keys.POST_WATERMARK_COACHMARK_DISMISSED,onHide:function(){Ze=!0}}),Ne&&!Ze&&Ue.watermarkCoachmark.show();Ue.watermarkTooltip=new he({parent:Ue.imageWrapper,id:"watermarkTooltip",message:"i18n.components.coachmarks.watermark.kTooltip",arrowDirection:"down",width:"auto",height:34,hidden:!0})}(),Ue.noProfilePic=new x({id:"PostNoProfilePic",parent:Ue.imageWrapper,hidden:!0})}function yt(e,t){var o=Ue.poster.getViewScale(),n=Ue.poster.$el.offset();return{x:(e-n.left)/o,y:(t-n.top)/o}}function Dt(){if(Me.canUndo()){var e=Me.getUndoDescription();c.publish("undoApplied",{actionDescription:e}),Me.undo()}}function At(){if(Me.canRedo()){var e=Me.getRedoDescription();c.publish("redoApplied",{actionDescription:e}),Me.redo()}}function Lt(){Ue.premiumTemplateTextTooltip=new be({parent:"PostApp",id:"textTooltip",message:"i18n.components.coachmarks.premiumText.kMessage",arrowDirection:"left",showCloseButton:!1,anchorElement:Ue.imageWrapper,height:"auto",width:130,offsetY:250,offsetX:5,priority:1,hidden:!0}),Ue.premiumTemplateTextTooltip.show()}function Et(){Ue.posterAdornments.hideSelectionBox(),Ca().done((function(){marvel.navigate("/branding/"+Qe.contextId,{trigger:!0})}))}function Mt(){Ue.posterAdornments.hideSelectionBox();var e=t.defer();Ue.poster.disable(),Ue.posterAdornments.hideSelectionBox(),Me.undoToInitialState(),ae.setTemplateName(Ye,Ve.templateName);var o=Me.getDocumentSize(),a=o.width/o.height;Ue.imageWrapper.update({aspect:a}),n.delay((function(){Ue.poster.update({core:Me}),Ue.poster.enable(),e.resolve()}),250),e.promise.done((function(){zn(),Ca("Please wait...").done((function(){marvel.navigate("/branding/"+Qe.contextId,{trigger:!0})}))}))}function Ft(e){Ue.sidebarTheme.setDesigns({aspectRatio:Me.getPageAspectRatio(),wordCount:Me.getLockupWordCount(),iconCount:Me.getIconCount(),imageCount:Me.getPotentialBackgroundImageCount(),isInitialLoad:e||!1,manifest:Me.getManifestData(),docId:Me.getDocumentCCID()})}function Wt(e){var t=Me.getColorPalette();Ue.sidebarPalette.setCurrentPalette(t,e)}function Nt(e){var t=(e=e||Me).getExportData().pixelDimensions;return{width:t.width,height:t.height,imageQuality:1}}function Rt(){Ue.watermarkCoachmark&&Ue.watermarkCoachmark.hide(),Ze=!0,b.setSetting(ve.keys.POST_WATERMARK_COACHMARK_DISMISSED,!0),c.publish("editor:watermarkPressed"),Re?s.showMerchPopover({$element:Ue.watermarkButton.$el,position:"top",touchpointName:"postWatermarkUpgradeOnly",notify:function(e){"no-selection"===e&&c.publish("editor:watermarkRemoveCancelled",{payToRemove:!0})}}):s.showMerchPopover({$element:Ue.watermarkButton.$el,position:"top",touchpointName:"postWatermark",notify:function(e){"secondary"===e?(Me.setWatermarkEnabledForDoc(!1),Ne=!1,Ue.poster.setWatermark(!1),Ue.watermarkButton.hide(),zn(),c.publish("editor:watermarkRemoved")):"no-selection"===e&&c.publish("editor:watermarkRemoveCancelled",{payToRemove:!1})}})}function zt(e){var o,n=Me.getFullCanvasColor(),a=!!n;return!a&&e&&(o=Me.setBackgroundTransparency(0),Ne&&Ue.poster.setWatermark(!1)),(o||t.resolve()).then(()=>new Promise(e=>setTimeout(()=>e(),0))).then(()=>We.getDownloadImageBlobPromise(i.currentDoc,"image/png")).then(e=>{var o=window.URL.createObjectURL(e);if(a){var r=document.createElement("canvas"),i=Nt();return r.width=i.width,r.height=i.height,function(e,o,n){var a=t.defer(),r=new Image;return r.onload=function(){var t=e.getContext("2d");t.drawImage(r,0,0);for(var o,i=e.width,s=e.height,l=t.getImageData(0,0,i,s),d=255*n.red,c=255*n.green,p=255*n.blue,u=0===d?0:d-1,m=0===c?0:c-1,g=0===p?0:p-1,b=0;b<s;b++)for(var h=0;h<i;h++)o=4*(b*i+h),l.data[o+0]>=u&&l.data[o+0]<=d+1&&l.data[o+1]>=m&&l.data[o+1]<=c+1&&l.data[o+2]>=g&&l.data[o+2]<=p+1&&255===l.data[o+3]&&(l.data[o+0]=0,l.data[o+1]=0,l.data[o+2]=0,l.data[o+3]=0);t.putImageData(l,0,0),yn(e).then((function(e){a.resolve(e)}))},r.src=o,a.promise}(r,o,n)}return t.resolve(e)}).then(t=>(e&&(Me.setBackgroundTransparency(1).done(),Ue.poster.setWatermark(Ne)),t))}function Ut(){for(var e=Me.getDocumentMetadataEvents(),t=0;t<e.length;t++){var o=e[t];c.publish("shareMetadata",{"document:metadata":o[0],"document:metadata2":o[1],"document:metadata3":o[2],"document:metadata4":o[3]})}var n=Me.getDocFontSourceUsage();c.publish("exportFontUsage",{contextualData1:"fontSource:[".concat(n.join(", "),"]")});var a=Me.getAllStringForFormaUsedWheelSuggestions();a.length>0&&c.publish("lockupStyleCaptured",{contextualData1:"styleString:".concat(a),contextualData2:"location:ShareExport"}),We.reportNounProjectIds()}function Ot(){Ut(),window.marvel.events.trigger("send-theo-editor-download-button-export-analytics",Ia())}function jt(e){window.marvel.events.trigger("spark-invite-collaborators-to-current-doc",{composite:i.currentDoc,source:e,page:"post:editor"})}function Gt(e){Ue.lmsCoachmark&&!Ue.lmsCoachmark.isHidden()&&Ue.lmsCoachmark.hide(),Ca().done((function(){return"sharemenu-publish"===e?(c.publish("shareButtonPressed"),Ut(),void window.marvel.events.trigger("share-workflow-current-doc")):"sharemenu-invite"===e?jt("project"):"sharemenu-lms-turnin"===e||"sharemenu-lms-attach"===e?(Se.showModal({type:"adobe-theo",id:i.currentDoc.id},{syncInProgress:!1}),null):""===e?(Ue.downloadButton.el.hideDownloadList(),null):(console.warn("handleShareMenuClick called with unrecognized menuItemId",e),null)}))}function Ht(o){const n=o.originalEvent.detail.mediaType.split("_")[1];Ca().done((function(){var o,a,r,i;c.publish("downloadButtonPressed"),"string"==typeof n&&c.publish("downloadImgButtonPressed:"+n),Ot(),"jpg"!==n&&Me.shouldSuggestTransparentBackground()?(a="png"===n,r=t.defer(),i=new E({headerText:"i18n.dialogs.transparentBackground.kHeaderText",contentText:"",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.transparentBackground.kPNGButtonLabel",onClick:function(){c.publish("transparentBackgroundButtonPressed"),i.hide(),r.resolve(!0)}},{class:"pill pill-primary-on-light",label:a?"i18n.dialogs.transparentBackground.kPNGSolidButtonLabel":"i18n.dialogs.transparentBackground.kJPEGButtonlabel",onClick:function(){c.publish("solidBackgroundButtonPressed"),i.hide(),r.resolve(!1)}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:function(){c.publish("backgroundCancelButtonPressed"),i.hide(),r.resolve(null)}}]}),o=r.promise):o=t(!1),o.done((function(t){"boolean"==typeof t&&(t||n&&"jpg"!==n?zt(t).catch((function(e){Fe.error("generatePngImageBlob error",e)})).done((function(t){c.publish("Sharing Action",{contextData:["projectId"],eventAction:"BeginDownload",slide:"publish"}),function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"png";var n=e("<a></a>");e(document.body).append(n);var a=Ue.docNameInput.getText()+"."+o;if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(t,a);else{var r=window.URL.createObjectURL(t);n.attr("href",r),n.attr("download",a),n[0].click(),window.URL.revokeObjectURL(r)}}(t,"png"),c.publish("Sharing Action",{contextData:["projectId"],eventAction:"Download"})})):window.marvel.events.trigger("download-current-doc"))}))}))}function _t(){Ca().done((function(){c.publish("downloadPDFButtonPressed"),Ie(i,a),Ot()}))}function Kt(){Ue.sharePostButton.el.hideMenuDropdown()}function $t(){Ca().done((function(){window.marvel.events.trigger("upload-to-facebook-current-doc")}))}function Vt(){Ca().done((function(){window.marvel.events.trigger("upload-to-twitter-current-doc")}))}function Xt(){var e=Me.getTextForSelectedLockup();if(e){var o=Me.getSelectedForma();Ue.textCapture.prompt(e).then((function(n){if(n&&n!==e){var a=n.length.toString(),r=o.source;if(ee.FormaSourceUtils.isDesignIngredient(r)){var i=ee.BadgeFacade.getDesignIngredientIDAndType(r);c.publish("designIngredient:textEdited",{contextualData1:"id:"+i.id,contextualData2:"type:"+i.type,contextualData7:"lengthOfText:"+a})}else{var s=o.style,l=s.font.fontData.postScriptName,d=function(e){switch(e.backing){case ee.LockupBacking.None:return"none";case ee.LockupBacking.Rows:return"row";case ee.LockupBacking.BannerHorizontal:return"bannerHorizontal";case ee.LockupBacking.BannerVertical:return"bannerVertical";case ee.LockupBacking.Knockout:return"knockout";case ee.LockupBacking.LegacyShadow:return"none";default:if(e.backingArtworkID)return e.backingArtworkID}return"none"}(s);c.publish("customTextEdited",{contextualData7:"lengthOfText:"+a,contextualData10:"fontName:"+l,contextualData12:"shapeName:"+d})}return Me.setTextForSelectedLockup(n)}return t.resolve()})).done(Ue.posterAdornments.showSelectionBox)}}function Yt(){var e=!1;Bt(),Me.downloadNewLockupRandomFontsAsync(),Ue.textCapture.prompt("").then((function(o){if(o){var n=o.length.toString();return c.publish("customTextAdded",{contextualData7:"lengthOfText:"+n}),e=!0,Me.addNewLockup(o,{select:!0})}return t.resolve()})).done((function(){e&&(Ue.tabButtonTextType.select(),Ue.posterAdornments.showSelectionBox())}))}function Qt(){var e,t=Me.getAllSelectedFormas();t&&(e=t,Me.canDuplicateFormae(e)?Me.duplicateFormae(e).done():uo())}function qt(t){c.publish("editImage:cropPressed"),e("#PostApp").addClass("crop-scrim"),e("#PostTopBar").addClass("crop-scrim").append('<div class="full-scrim"></div>'),e("#PostTopBar").find(".full-scrim").on("click",(function(e){eo()})),Me.enterCropMode().then((function(){Ue.tabButtonCrop.select(),Ue.sidebarCrop.show(),Ue.sidebarCrop.moveToSection(t)}))}function Jt(e){Me.applyAspectRatioCropToImage(e).done()}function Zt(e){Me.applyShapeMaskToImage(e).done()}function eo(){to(),Me.exitCropMode().then((function(){Ue.tabButtonBackgroundImage.select(),Ue.sidebarBackground.show()}))}function to(){e("#PostApp").removeClass("crop-scrim"),e("#PostTopBar").removeClass("crop-scrim"),e("#PostTopBar").find(".full-scrim").remove()}function oo(){c.publish("editImage:layerSelected",{contextualData1:"imageLayer:floating"}),Me.setImageAsForeground().done()}function no(){c.publish("editImage:layerSelected",{contextualData1:"imageLayer:background"}),Me.setImageAsBackground().done()}function ao(){var e=Me.getAllSelectedFormas();if(e)if(Me.showDeleteImageOption(e))var t=new E({headerText:"i18n.dialogs.delete.kHeaderText",contentText:"i18n.dialogs.delete.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.delete.kDeleteContentButtonLabel",onClick:function(){Me.replaceImagesWithColors(null,[]).done(),t.hide()}},{class:"pill pill-primary-on-light",label:"i18n.dialogs.delete.kDeletePhotoSectionLabel",onClick:function(){ro(e),t.hide()}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:function(){t.hide()}}]});else ro(e)}function ro(e){e=e||Me.getAllSelectedFormas(),Me.deleteFormae(e).done()}function io(t,o){var n=e("#swapCellThumbnail");if(n.length)n.css({top:o.y+5+"px",left:o.x-50+"px"});else{var a=e('<div id="swapCellThumbnail"></div>').css({position:"absolute",top:o.y+5+"px",left:o.x-50+"px",opacity:.5,"box-shadow":"0px 0px 4px 0px"});if(e("body").append(a),t.isBackgroundImage()){var r=Me.getImagePreviewData(t),i=e('<img src="'+r.url+'">').css({"max-height":"100px","max-width":"100px"});a.append(i)}else{var s=t.style.colors.fieldPrimary;if(s){var l=se.rgb2hex(se.solidColor2Rgba(s)),d=t.frame.width>t.frame.height;a.css({background:"#"+l,height:d?t.frame.height/t.frame.width*100+"px":"100px",width:d?"100px":t.frame.width/t.frame.height*100+"px"})}}}}function so(){e("#swapCellThumbnail").remove()}function lo(t){e("#swapScrim").remove();var o=t.finalFrame,n=Ue.poster.getViewScale(),a=Ue.poster.$el.offset(),r=a.top+o.minY*n,i=a.left+o.minX*n,s=(o.maxY-o.minY)*n,l=(o.maxX-o.minX)*n,d=e('<div id="swapScrim"></div>').css({background:"rgba(0,0,0,.25)",outline:"solid white 4px",top:r,left:i,height:s,width:l,position:"absolute"});e("body").append(d)}function co(){e("body").find("#swapScrim").remove()}function po(){Ue.sidebarCrop.recordFormaResize()}function uo(){var e=new E({headerText:"i18n.dialogs.tooManyImages.kHeaderText",contentText:"i18n.dialogs.tooManyImages.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){e.hide()}}]});e.show()}function mo(e){e=e||{},Ue.posterAdornments.hideSelectionBox(),ft=Me.getSelectedFormaId()||"",Me.deselect({silent:!0}),Ue.tabButtonIcon.select(),Ue.tabButtonIconColor.hide({silent:!0,preventSelection:!0}),e.setHome=!0,at||(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=function(){let e=["badge","fun","spark","circle","singer","arrow","heart","star","flower","rectangle","love","party","triangle","square","oval","phone","food","sun"];st.featureEnabled("use-translation-service-for-icon-search")&&(e=["iconSearch.kBadge","iconSearch.kFun","iconSearch.kSpark","iconSearch.kCircle","iconSearch.kSinger","iconSearch.kArrow","iconSearch.kHeart","iconSearch.kStar","iconSearch.kFlower","iconSearch.kRectangle","iconSearch.kLove","iconSearch.kParty","iconSearch.kTriangle","iconSearch.kSquare","iconSearch.kOval","iconSearch.kPhone","iconSearch.kFood","iconSearch.kSun"]);var t=Math.floor(Math.random()*(e.length+1));return w.translate(e[t])}(),at=!0),e.label="Add icon",wo(e),Bt(),c.publish("editor:addIconPressed")}function go(e){c.publish("editor:addImagePressed"),e=e||{},Me.canAddMoreImages(1)?(nt=!1,Ue.posterAdornments.hideSelectionBox(),ft=Me.getSelectedFormaId()||"",Me.deselect({silent:!0}),Ue.tabButtonBackgroundImage.select(),Ue.tabButtonBackgroundColor.hide({silent:!0,preventSelection:!0}),Ue.tabButtonBackgroundLooks.hide({silent:!0,preventSelection:!0}),e.setHome=!0,e.label="Add photo",e.disallowClose=Me.backgroundImageFormas().length<1,ho(e),Ue.changeIconModalPanel.hide(),Bt()):uo()}function bo(e){e=e||{},nt=!0;var t=Me.getSelectedForma();t&&(Me.isIcon(t)?(Ue.tabButtonIcon.select(),e.label="Replace icon","dooplo"===t.contentNode.mediaMetadata.searchSource&&(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=t.contentNode.mediaMetadata.searchTerm),wo(e)):(e.label="Replace photo",t.isImage()&&t.childCount>0&&t.childAt(0).contentNode.mediaMetadata&&"dooplo"===t.childAt(0).contentNode.mediaMetadata.searchSource&&(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=t.childAt(0).contentNode.mediaMetadata.searchTerm),ho(e)))}function ho(e){if("boolean"!=typeof(e=e||{}).disallowClose){var t=Me.getSelectedForma();t&&(t.isImage()||t.isGridCell())?e.disallowClose=!1:e.disallowClose=Me.imageFormas().length<1}Ue.imagePicker.show(e),Ue.changeImageModalPanel.show(e),Ue.imagePicker.removeSelection(),e.label&&Ue.imagePicker.setTitle(e.label),e.setHome&&Ue.imagePicker.home(),Ue.imagePicker.setCloseButtonVisibility(!e.disallowClose)}function fo(){c.publish("editor:addTextPressed",{sparkFormat:"post"}),Me.triggerTextSidebarDisplayed(),Ue.tabButtonAddText.select(),Ue.addTextSidebar.show(),c.publish("addTextSidebarDisplayed"),Bt()}function wo(e){e=e||{},Ue.iconPicker.show(e),Ue.changeIconModalPanel.show(e),Ue.iconPicker.removeSelection(),e.label&&Ue.iconPicker.setTitle(e.label),e.setHome&&Ue.iconPicker.home(),Ue.iconPicker.setCloseButtonVisibility(!e.disallowClose)}function vo(){c.publish("editor:addLogoPressed"),st.featureEnabled("entitle-brand-kit")?(Bt(),Ue.tabButtonLogo.select(),Ue.changeImageModalPanel.hide(),Ue.changeIconModalPanel.hide()):s.showMerchPopover({$element:Ue.addContentButton.$el,position:"bottom-left",width:320,positionOffset:-4,touchpointName:"postLogoButton"})}function ko(){c.publish("uploadNewLogoSelected"),Ue.posterAdornments.hideSelectionBox(),Bt()}var To=n.throttle((function(e,t){e.originalLayout?(Me.deselect(),0!==t&&Me.shuffleCustomGridStyle(t).done(),c.publish("layoutSelected",{layoutID:"original"})):(Me.applyGridStyle(e,t).done(),c.publish("layoutSelected",{layoutID:e.gridStyle.name}))}),40);function Io(e){if("Original"===e.id){var t=Me.getOriginalImageSize();if(!t)return;e=ee.DesignSizeLibrary.getOriginalSize(t.width,t.height)}Ue.poster.disable();var o=!1;return Ue.watermarkCoachmark&&!Ze&&(Ue.watermarkCoachmark.hide(),o=!0),Ue.posterAdornments.hideSelectionBox(),Me.setPageSizeFromDesignSize(e).then((function(){Ue.imageWrapper.update({aspect:e.aspectRatio||1}),o&&(o=$n()),Ue.sidebarBackground.updateFilters({tileAspect:e.aspectRatio||1}),n.delay((function(){Ue.poster.enable()}),50),o&&!Ze&&Ue.watermarkCoachmark.show(),c.publish("canvasSizeSelected",{aspectRatio:e.aspectRatio||1,targetId:e.id})}))}var Po=n.throttle((function(e){"Custom"==e.id?function(){var e=Me.getPageExportData(),t=e.pixelDimensions,o=Me.getDocumentSizeId(),n=e.format,a=e.ppi;"Custom"===o&&(n=Me.getPageCustomSizeFormat(),a=Me.getPageCustomSizePPI());var r=new M({currentExportSize:t,currentFormat:n,currentPPI:a});r.events.subscribe("submit",(function(e){e.exportData.format===n&&t.width===e.exportData.pixelWidth&&t.height===e.exportData.pixelHeight||(Io(ee.DesignSizeLibrary.getCustomSize(e.exportData.width,e.exportData.height,e.exportData.format,e.exportData.ppi)),c.publish("customSizeSet",{dimensions:e.exportData.width+"x"+e.exportData.height+" "+e.exportData.format}))})),r.events.subscribe("cancel",(function(){Ue.sidebarResize.selectDocumentSizeWithId(Me.getDocumentSizeId(),{silent:!0}),c.publish("customSizeCancelled")}))}():Io(e)}),40);function Co(t,o,n){n.silent||!e(n.target).closest("[class*='tile-shuffle-button']").length&&0!==o||(0===o?Me.setColorPalette(t,{shuffle:!0}).done():Me.shuffleColorPalette().done())}function Bo(e){e=e||{};var t,o=Me.getDocumentSizeId();o===bt&&"Custom"!==o||(bt=o,Ue.imageWrapper.update({aspect:Me.getPageAspectRatio()}),Ue.sidebarResize.selectDocumentSizeWithId(Me.getDocumentSizeId(),{silent:!0})),Ue.tabButtonPalette&&Ue.tabButtonPalette.isSelected()&&Wt(),Ue.tabButtonTheme&&(t=Me.getThemeId())!==ht&&(Ue.sidebarTheme.selectThemeWithid(t,{silent:!0}),ht=t),e.formaAdded&&Lo(),mt=!0}var So=n.throttle((function(e,t){e.manifestPromise().then((function(e){return Me.applyDesignTheme(e,t)})).done((function(){c.publish("designVariationSelected",{contextualData1:"variationTemplateDocumentId:"+e.assetId,contextualData2:"numShuffles:"+t})}))}),40),xo=n.throttle((function(e){e.manifestPromise().done((function(t){Me.addBadge(t,e.assetId)}))}),40);function yo(e){e.data.forma.isTypeLockup()&&Ue.tabButtonTheme&&Ue.tabButtonTheme.isSelected()&&Ue.sidebarTheme.setDesigns({aspectRatio:Me.getPageAspectRatio(),wordCount:Me.getLockupWordCount(),iconCount:Me.getIconCount(),imageCount:Me.getPotentialBackgroundImageCount(),manifest:Me.getManifestData(),docId:Me.getDocumentCCID()}),e.selected&&!Ue.sidebarBackground.isHidden()&&Ue.sidebarBackground.updateFilters({whilePanelVisibleOnly:!0,image:Me.getImagePreviewData(Me.getSelectedForma())})}function Do(e){e.duplicatedImage&&Me.updateConstrainedImages(),Lo()}function Ao(e){Eo(),Ue.posterAdornments.dismissPopUp(),e.deletedImage&&Me.updateConstrainedImages()}function Lo(){Eo()}function Eo(){Ue.tabButtonTheme&&Ue.tabButtonTheme.isSelected()&&Ft()}function Mo(e){var t;Me.isMultiSelect()?(t=Me.getSettableFeatures(),Ue.sidebarMultiselect.update({attributes:t}),Ue.multiselectTabsWrapper.isActive()||Ue.tabButtonMultiselectAlign.select()):function(e){Ue.downloadButton&&Ue.downloadButton.el.hideDownloadList();Ue.sharePostButton&&Ue.sharePostButton.el.hideMenuDropdown();Array.isArray(e.forma)&&(e.forma=e.forma[0]);if(Ue.changeImageModalPanel.hide(),Ue.changeIconModalPanel.hide(),e.forma){if("Root"===e.forma.kind)Ue.tabButtonBackgroundImage.hide(),Ue.tabButtonBackgroundLooks.hide(),Ue.tabButtonBackgroundColor.isHidden()&&Ue.tabButtonBackgroundColor.show(),Ue.tabButtonBackgroundColor.isSelected()||Ue.tabButtonBackgroundColor.select();else if(e.forma.isTypeLockup())Ue.textTabsWrapper.isActive()||Ue.tabButtonTextType.select();else if(e.forma.isLogo())Ue.logoTabsWrapper.isActive()||Ue.tabButtonLogo.select();else if(Me.isIcon(e.forma))Ue.iconTabsWrapper.isActive()||Ue.tabButtonIcon.select(),Ue.tabButtonIconColor.show({silent:!0,preventSelection:!0});else if(e.forma.isImage()){Ue.tabButtonBackgroundImage.isHidden()&&Ue.tabButtonBackgroundImage.show({silent:!0,preventSelection:!0});var t=e.forma.isVideo();t&&Ue.tabButtonBackgroundLooks.hide(),Ue.tabButtonBackgroundLooks.isHidden()&&!t&&(Ue.tabButtonBackgroundColor.hide(),Ue.tabButtonBackgroundLooks.show({silent:!0,preventSelection:!0}),Ue.tabButtonBackgroundColor.show({silent:!0,preventSelection:!0}));var o=e.forma.controller,n=o.kind===ee.FrameController.KIND&&o.isBackgroundImageWithAlpha();if(Me.inCropMode())return;Ue.backgroundTabsWrapper.isActive()&&(n||Ue.tabButtonBackgroundImage.isSelected()||Ue.tabButtonBackgroundLooks.isSelected())||Ue.tabButtonBackgroundImage.select(),e.forma.controller.moveable&&Ue.tabButtonBackgroundColor.hide()}else e.forma.isGridCell()&&(Ue.tabButtonBackgroundLooks.hide(),Ue.tabButtonBackgroundColor.isHidden()&&Ue.tabButtonBackgroundColor.show({silent:!0,preventSelection:!1}),Ue.tabButtonBackgroundColor.isSelected()||Ue.tabButtonBackgroundColor.select());(e.forma.isBackgroundImage()||e.forma.isGridCell())&&(Ue.tabButtonBackgroundColor.isHidden()&&Ue.tabButtonBackgroundColor.show({silent:!0,preventSelection:!0}),e.forma.controller.moveable?Ue.tabButtonBackgroundImage.hide():Ue.tabButtonBackgroundImage.isHidden()&&Ue.tabButtonBackgroundImage.show({silent:!0,preventSelection:!0}))}else Gn()}(e)}function Fo(){if(!Me.isMultiSelect()){var e=Me.getSelectedForma();e&&(e.isTypeLockup()?Xt():(e.isImage()&&!e.isLogo()||Me.isIcon(e))&&bo())}}function Wo(e){let{backgroundColor:t}=e;Ue.errorDialogs.imageCorruptedModal||(Ue.errorDialogs.imageCorruptedModal=new E({headerText:'\n            <span class="error-modal-header">\n              <span>i18n.dialogs.corruptedDocument.kHeaderText</span>\n              <i class="error-modal-header__icon"></i>\n            </span>\n          ',contentText:'<div class="error-modal-content">\n                <span>i18n.dialogs.corruptedDocument.kContentText</span>\n                <span class="error-modal-content_placeholder-indicator" style="background-color: #'.concat(t,';"></span>\n              </div>'),dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.corruptedDocument.kButtonLabel",onClick:function(){Ue.errorDialogs.imageCorruptedModal.hide()}}]})),Ue.errorDialogs.imageCorruptedModal.show()}function No(){if(Ue.sidebarLayout){var e=Ue.sidebarResize.getSelected(),t=Me.getDocumentSize(),o=Me.getImageSizeIfFullBleed(),n=o&&o.width&&o.height&&Math.atan(o.height/o.width)*(4/Math.PI),a=t&&t.width&&t.height&&Math.atan(t.height/t.width)*(4/Math.PI),r=Math.abs(n-a)<=.01;e&&e.item&&"original"===e.item.data.aspect&&!r&&Ue.sidebarResize.deselectSelected()}}function Ro(){var e=w.toLocaleKey(Me.getUndoDescription());e?(Ue.undo.update({hoverLabel:"i18n.app.kActionLabel",context:{"action-type":"i18n.app.kUndo","action-name":"i18n.actions."+e}}),Ue.undo.enable()):(Ue.undo.update({hoverLabel:"i18n.app.kUndo"}),Ue.undo.disable());var t=w.toLocaleKey(Me.getRedoDescription());t?(Ue.redo.update({hoverLabel:"i18n.app.kActionLabel",context:{"action-type":"i18n.app.kRedo","action-name":"i18n.actions."+t}}),Ue.redo.enable()):(Ue.redo.update({hoverLabel:"i18n.app.kRedo"}),Ue.redo.disable())}function zo(){Oo(),Me.updateConstrainedImages(),Me.validateDoc("undo")}function Uo(){Oo(),Me.updateConstrainedImages(),Me.validateDoc("redo")}function Oo(){Ue.sidebarBackground&&!Ue.sidebarBackground.isHidden()&&Ue.sidebarBackground.selectCurrentColor({silent:!0}),Ue.sidebarIcon&&!Ue.sidebarIcon.isHidden()&&Ue.sidebarIcon.selectCurrentColor({silent:!0}),Ue.sidebarText&&!Ue.sidebarText.isHidden()&&Ue.sidebarText.selectCurrentColor({silent:!0}),Ue.sidebarPalette&&!Ue.sidebarPalette.isHidden()&&Ue.sidebarPalette.selectCurrentPalette({silent:!0})}function jo(){Me.deselect()}function Go(){Ue.addTextSidebar.hide()}function Ho(){Qo()}function _o(){Ue.undo.show(),Ue.redo.show(),Ue.sidebarCrop.hide()}function Ko(){Qo()}function $o(){Me.ensureLockupSelected(),Qo()}function Vo(){Jn(ne.currentBrandElements()),Qo()}function Xo(){Qo()}function Yo(){Qo()}function Qo(){Ue.tabButtonPalette.isSelected()&&Ue.sidebarPalette.unbindColorPicker(),Ue.sidebarTemplates&&!Ue.sidebarTemplates.isHidden()&&Ue.sidebarTemplates.switchedToLocalTabSet()}function qo(e){e=e||{},Ue.sidebarLayout.isHidden()&&Me.disableAutomaticLayoutMode(),e.component&&(rt=e.component,Ue.brandIndicator&&(rt===Ue.sidebarTemplates?(Ue.brandIndicator.hide(),Ue.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"0px"},{id:"PostSidebar",size:"auto"}]})):(Ue.brandIndicator.show(),Ue.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"50px"},{id:"PostSidebar",size:"auto"}]}))))}function Jo(){qo({component:Ue.sidebarLayout}),"layout"!==Ue.sidebarGlobal.activeSidebarId()&&(Ue.sidebarGlobal.showSidebarWithId("layout"),c.publish("editor:layoutPressed"))}function Zo(){return c.publish("editor:resizePressed"),we.run("PostResize").catch(e=>{Fe.error("Ran into error with PostResize experiment",e)}).done(),!st.featureEnabled("post-resize-is-paid-feature")||lt.tryPremiumFeature({$element:Ue.tabButtonResize.$el,position:"left",touchpointName:"postResizeButton"})}function en(){qo({component:Ue.sidebarResize}),"resize"!==Ue.sidebarGlobal.activeSidebarId()&&(Ue.sidebarGlobal.showSidebarWithId("resize"),c.publish("layoutResizeDisplayed"))}function tn(){qo({component:Ue.sidebarTemplates}),"templates"!==Ue.sidebarGlobal.activeSidebarId()&&Ue.sidebarGlobal.showSidebarWithId("templates")}function on(){qo({component:Ue.sidebarTheme}),"theme"!==Ue.sidebarGlobal.activeSidebarId()&&(Ue.sidebarGlobal.showSidebarWithId("theme"),Ue.sidebarTheme.setDefaultSelection(),Ft(),c.publish("editor:designFilterPressed"))}function nn(){qo({component:Ue.sidebarPalette}),"palette"!==Ue.sidebarGlobal.activeSidebarId()&&(Ue.sidebarGlobal.showSidebarWithId("palette"),Wt({updateSelection:!0}),c.publish("editor:colorPressed"),Me.triggerEnteredPalette())}function an(e){var t=(e=e||{}).tabId||"type";switch(Ue.sidebarText.showSidebarWithId(t),qo({component:Ue.sidebarText}),Ue.posterAdornments.handleTextTabSelected(),c.publish("textSidebarDisplayed"),c.publish("text"+t.toLowerCase()+"SidebarDisplayed"),t){case"type":c.publish("textSidebarDisplayed:type");break;case"color":c.publish("textSidebarDisplayed:color");break;case"shape":c.publish("textSidebarDisplayed:shape");break;case"style":c.publish("textSidebarDisplayed:style");break;case"effects":c.publish("textSidebarDisplayed:effects")}}function rn(e){var t=(e=e||{}).tabId||"color";Ue.sidebarBackground.isHiding()&&null==e.reselectWhenHiding?n.delay((function(){e.reselectWhenHiding=!0,rn(e)}),200):(Ue.sidebarBackground.showSidebarWithId(e.tabId),qo({component:Ue.sidebarBackground}),c.publish("photoSidebarDisplayed"),"image"===t?c.publish("backgroundSidebarDisplayed:image"):"color"===t?c.publish("backgroundSidebarDisplayed:color"):"looks"===t&&c.publish("backgroundSidebarDisplayed:looks"))}function sn(){qo({component:Ue.sidebarLogo}),Ue.sidebarLogo.show(),c.publish("logoSidebarDisplayed")}function ln(e){var t=(e=e||{}).tabId||"icon";Ue.sidebarIcon.showSidebarWithId(e.tabId),qo({component:Ue.sidebarIcon}),"icon"===t?c.publish("iconSidebarDisplayed:icon"):"color"===t&&c.publish("iconSidebarDisplayed:color")}var dn=[],cn=!1;function pn(){return e.each(dn,(function(e,t){t&&t.abort()})),"If you leave now, the latest changes to your Post design will not be saved."}function un(){e(window).on("beforeunload",pn)}function mn(){e(window).off("beforeunload",pn)}function gn(e,t,o){dn.push(t)}function bn(t,o,n){var a=e.inArray(o,dn);dn.splice(a,1)}function hn(e){vn(e,Bn,!0)}function fn(e){var t,o=En(e.info);nt&&(t=Me.getSelectedForma()),Me.createFormaFromSVG(e.files[0],o,t),c.publish("addedIconToProject:icon")}function wn(){return!st.featureEnabled("post-pgm-poster")||!st.featureEnabled("post-enable-image-frames")}function vn(t,o){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(nt||Me.canAddMoreImages(1)){o=o||xn;var a=Me.getSelectedForma();if((nt||null!=a&&a.isShape())&&(t.replacementForma=a,Ue.posterAdornments.showImageMenu(),t.replacementForma&&("Root"==t.replacementForma.kind?t.replacementForma=null:t.replacementFrame=t.replacementForma.finalFrame)),n&&(t.floatingImageStrategy=ee.FloatingImageStrategy.IfHasAlphaOrIsLogo),n||null!=t.replacementForma)In(t,o);else{c.publish("editor:addImagePressed",{contextualData1:"numImages:1",contextualData2:"actionType:success"});var r=Me.backgroundImageFormas().length>0?"kChoosePhotoAddToCollageButtonLabel":"kChoosePhotoPinToBackgroundButtonLabel";if(wn())return t.floatingImageStrategy=ee.FloatingImageStrategy.IfHasAlphaOrIsLogo,void In(t,o);var i=new E({id:"PostImageLayerPicker",headerText:"i18n.dialogs.choosePhotoLayer.kHeaderText",contentText:'<div class="image-layer-picker-visualization">\n           <span class="background-layer-visualization"></span>\n           <span class="foreground-layer-visualization"></span>\n           </div>',dismissable:!1,addButtonParent:!0,onShow:function(){e(".background-layer-visualization").click((function(){Tn(t,o,i)})),e(".foreground-layer-visualization").click((function(){kn(t,o,i)}))},onHide:function(){e(".background-layer-visualization").off("click",Tn),e(".foreground-layer-visualization").off("click",kn)},buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.choosePhotoLayer.kChoosePhotoMoveFreelyButtonLabel",onClick:function(){kn(t,o,i)}},{class:"pill pill-primary-on-light",label:"i18n.dialogs.choosePhotoLayer."+r,onClick:function(){Tn(t,o,i)}}]})}}else uo()}function kn(e,t,o){c.publish("editor:imageLayerPressed",{contextualData1:"imageLayer:floating"}),e.floatingImageStrategy=ee.FloatingImageStrategy.Always,In(e,t),o.hide()}function Tn(e,t,o){c.publish("editor:imageLayerPressed",{contextualData1:"imageLayer:background"}),e.floatingImageStrategy=ee.FloatingImageStrategy.Never,In(e,t),o.hide()}function In(e,o){var n=t.defer();o(e,n),n.promise.done()}var Pn=1600;function Cn(e){c.publish("brandKitLogoApplied"),Ue.poster&&Ue.poster.events.publish("image-loading-begin"),c.publish("editor:logoAdded"),Me.addLogo(e).then((function(){Ue.poster&&Ue.poster.events.publish("image-loading-end")}))}function Bn(e,o){Ue.poster&&Ue.poster.events.publish("image-loading-begin");var n,a,r=e.files[0];return(n=r,a=URL.createObjectURL(n),u.load(a).then((function(e){return Dn(e)}))).then(e=>{var n=t.defer();if(e.width<180||e.height<180)var a=new E({headerText:"i18n.panels.addNewLogo.kSizeWarningHeader",contentText:"i18n.panels.addNewLogo.kSizeWarningContent",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.components.buttons.kContinue",onClick:function(){a.hide(),n.resolve(e)}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:function(){Ue.poster&&Ue.poster.events.publish("image-loading-end"),a.hide(),n.reject(),o.resolve()}}]});else n.resolve(e);return n.promise}).then(o=>{var n=o.getContext("2d");return e.hasAlpha=An(n,o.width,o.height),e.hasAlpha?(Ln(o),yn(o)):t.resolve(r)}).then(o=>{if(e.processedImgData=o,!st.featureEnabled("entitle-brand-kit")||"brandkit"===e.source)return t.resolve(o);var n=ne.currentBrandElements(),a=!n||!n.logos||n.logos.length<1;return ne.addLogoToCurrentBrand(o,a)}).then(t=>(e.isLogo=!0,t&&(na(!0),e.sparkElementId=t.getValue("id"),e.sparkRoles=t.getValue("ac#roles")),xn(e,o))).catch(e=>t.resolve())}function Sn(e){var t={files:[{source:"adobestock",mimeType:e.newItemInfo.mimeType,original:{link:e.newItemInfo.href,height:e.newItemInfo.height,width:e.newItemInfo.width},preview:{link:e.newItemInfo.href,height:e.newItemInfo.height,width:e.newItemInfo.width},thumbnail:{link:e.newItemInfo.thumb.url,height:e.newItemInfo.thumb.height,width:e.newItemInfo.thumb.width},licenseInfo:e.newItemInfo.info}],info:e.newItemInfo.info};nt=!0,vn(t,xn)}function xn(o,a,r,i,s){a=a||t.defer(),r=r||t.defer(),i=i||!1,s=s||!1,Me.validateDoc("addImageBegin"),cn||(cn=!0,e(document).on("ajaxSend",gn),e(document).on("ajaxComplete",bn));var d=Date.now();He.promise.isFulfilled()&&(He=t.defer()),un();var p=o.processedImgData||o.files[0],m=p.type||p.mimeType||"image/jpeg";"dooplo"===p.source&&p.preview.link.indexOf(".png")>-1&&"image/png"!==m&&(m="image/png");var g,b,h,f,w,v,k,T=En(o.info),I=p instanceof Blob,P="Adobe Stock"===T.sourceName,C="google drive"===p.source,B=null,S=o.isLogo;return Ue.poster&&Ue.poster.events.publish("image-loading-begin"),t().then((function(){if(I||P||C)return t.resolve();var e=p.thumbnail||p.small||p.preview,o="/api/post/v1/proxy?url="+encodeURIComponent(e.link);return["dropbox","cc","lightroom"].indexOf(p.source)>-1&&(o=e.link),u.load(o)})).then((function(e){if(I||P||C)return t.resolve();var n=Dn(e),a=n.getContext("2d");if(B=An(a,n.width,n.height)){if(nt)return t.resolve();Ln(n)}return g=n.toDataURL(),Me.addOrReplaceImage({id:null,imageId:null,metadata:T,isLowResImage:!0,isNewPostImage:i,url:g,width:n.width,height:n.height,mimeType:m,replacementForma:o.replacementForma,replacementFrame:o.replacementFrame,sparkRoles:o.sparkRoles,sparkElementId:o.sparkElementId,hasAlpha:B,forceReplacement:nt,floatingImageStrategy:o.floatingImageStrategy})})).then((function(e){return e&&e.formaId&&(v=e.formaId),e&&e.contentNodeId&&(k=e.contentNodeId),I||P||C||nt&&B||!Ue.poster?t.resolve(e):(r.resolve(),n.delay((function(){Ue.poster&&Ue.poster.events.publish("image-loading-end")}),350),t.resolve(e))})).then((function(e){if(e=e||{},Ue.savingIndicator&&Ue.savingIndicator.show(),p instanceof Blob)return Me.saveImageComponent(p,m);var t=function(e,t){if(e instanceof Blob)return e;var o=e.source,n=e.original.link,a=e.original.width,r=e.original.height;if("dooplo"==e.source&&e.original.width&&e.original.height&&e.original.width*e.original.height>Pn*Pn){var i=t._links.rendition.filter((function(e){return!!(e.href&&e.width&&e.height)&&e.width*e.height<Pn*Pn}));i.sort((function(e,t){return e.width<t.width?-1:e.width>t.width?1:0}));var s=i.pop();s&&(o="dooplocdn",n=s.href,a=s.width,r=s.height)}return o||Fe.error("getBestRenditionForImageSaving source is falsy, imgData is ",e),{source:o,assetId:n,width:a,height:r}}(p,o.info);return f=t.width,w=t.height,l(Me.saveImageComponent,{maxAttempts:3})({source:t.source,assetId:t.assetId},m,null,e.contentNodeId,e.contentNodeId)})).then((function(e){return p instanceof Blob?u.loadImageFromBlob(p).then((function(t){return f=t.width,w=t.height,e})).catch((function(){return t.reject()})):t.resolve(e)})).then((function(e){return b=e,h=De.decodeUrl(b.encodedUrl),u.load(h)})).then((function(e){var o;return null===B&&(o=Dn(e),B=An(o.getContext("2d"),o.width,o.height)),f=e.width,w=e.height,B&&!S?(o||(o=Dn(e)),Ln(o),f=o.width,w=o.height,yn(o)):t.resolve(e)})).then((function(e){return!B||S?t.resolve(e):(Ue.savingIndicator&&Ue.savingIndicator.show(),Me.saveImageComponent(e,m))})).then((function(e){return!B||S?t.resolve(e):(b=e,h=De.decodeUrl(b.encodedUrl),u.load(h))})).then((function(e){if(S){var t={url:b.encodedUrl,pixelWidth:e.width,pixelHeight:e.height,mimeType:m,acRoles:o.sparkRoles,id:o.sparkElementId,componentId:b.component.id};return c.publish("editor:logoAdded"),Me.addLogo(t)}var n={id:b.component.id,imageId:null,metadata:T,isLowResImage:!1,isNewPostImage:i,url:b.encodedUrl,width:f||e.width,height:w||e.height,mimeType:m,replacementForma:o.replacementForma,replacementFrame:o.replacementFrame,lowResImageUrl:g,hasAlpha:B,forceReplacement:nt,contentNodeId:k,floatingImageStrategy:o.floatingImageStrategy};return g?Me.replaceImageWithHighRes(n):Me.addOrReplaceImage(n)})).then((function(e){return e&&e.formaId&&(v=e.formaId),r.resolve()})).then((function(){Me.updateConstrainedImages();var e=Date.now()-d;return c.publish("post:addImageEnd",{contextualData1:"timeElapsedMs:"+e,contextualData2:"imageSource:"+p.source}),He.promise})).then((function(){cn=!1,e(document).off("ajaxSend",gn),e(document).off("ajaxComplete",bn),dn=[],Me.validateDoc("addImageSuccess"),a&&a.resolve(),(I||nt&&B)&&n.delay((function(){Ue.poster&&Ue.poster.events.publish("image-loading-end")}),350)})).catch((function(e){if(!o.replacementForma&&!o.replacementFrame&&(Fe.error("failed to add image",e),v)){var t=Me.getFormaById(v);t&&Me.deleteFormae([t]).done()}if((o.replacementForma||o.replacementFrame)&&Fe.error("failed to replace image",e),v&&(o.replacementForma||o.replacementFrame)){var n=Me.getFormaById(v);n&&Me.replaceImagesWithColors([n],[]).done()}var i="";if(i=o.replacementForma||o.replacementFrame?"i18n.dialogs.addOrReplaceImageFailed.kContentTextReplace":"i18n.dialogs.addOrReplaceImageFailed.kContentText",!s)var l=new E({headerText:"i18n.dialogs.addOrReplaceImageFailed.kHeaderText",contentText:i,dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.addOrReplaceImageFailed.kOK",onClick:function(){l.hide()}}]});Ue.poster&&Ue.poster.events.publish("image-loading-end"),Me.updateConstrainedImages(),Me.validateDoc("addImageFail"),a.reject(),r.reject()})).done(),r.promise}function yn(e,o){var n=t.defer();return e.toBlob?e.toBlob((function(e){n.resolve(e)}),o):n.resolve(e.msToBlob()),n.promise}function Dn(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t}function An(e,t,o){for(var n=e.getImageData(0,0,t,o).data,a=3,r=n.length;a<r;a+=4)if(0===n[a])return!0;return!1}function Ln(e){for(var t,o=e.width,n=e.height,a=o,r=n,i=0,s=0,l=e.getContext("2d"),d=l.getImageData(0,0,o,n),c=0;c<n;c++)for(var p=0;p<o;p++)t=4*(c*o+p),d.data[t+3]>0&&(p<a?a=p:p>i&&(i=p),c<r?r=c:c>s&&(s=c));var u=i-a+1,m=s-r+1,g=l.getImageData(a,r,u,m);return e.width=u,e.height=m,l.putImageData(g,0,0),e}function En(e,t){var o={};if(e){var n="unknown",a="unknown";e.source&&e.source.name&&("Adobe Stock"===e.source.name?n="adobestock":"Unsplash"!==e.source.name&&"pixabay"!==e.source.name&&"The Noun Project"!==e.source.name||(n="dooplo"),a="The Noun Project"===e.source.name?e.id:e.image_id?e.image_id.toString():e.id?e.id:"unknown"),o={source:n,search:e.searchText,rootProperties:{license:{asset_id:a,owner:e.owner?e.owner.name:"unknown",photo_name:e.title,source_name:e.source?e.source.name:"unknown",source_url:e.context?e.context.href:"unknown",tags:e.tags instanceof Array?e.tags.join(","):"",type:e.license?e.license.short_name:"unknown"}}}}var r=ee.MediaMetadata.fromProperties(o);return t&&(r.designIntent=ee.MediaMetadata.DESIGNINTENT_LOGO),r}function Mn(e){e&&e.id&&0===e.id.indexOf("bk_")&&c.publish("usedBrandKitPalette"),c.publish("paletteSelected")}const Fn=function(){let e,o,n,a=!1,r=!1;return function(){var s,l;if(!tt)return He.promise.isPending()||(He=t.defer()),Me.validateDoc("saveBegin"),s=i.currentDoc.getDataFromRoot("cp#isExported"),"boolean"==typeof(l=Me.getIsExported())&&l!==s&&Me.setIsExported(s),Me.postDocumentHasHighResImageSaveableState().then(s=>{if(Ue.savingIndicator&&Ue.savingIndicator.show(),a)return o||(o=t.defer()),r=!0,o.promise;a=!0,n=Date.now(),c.publish("saveDocumentBegin"),i.currentDoc&&window.marvel.logger.beginTrackingFlow("saveProjectFromEditor",{sparkFormat:"post",projectId:i.currentDoc.id}),e||(e=t.defer());const l=Me.imageFormas();for(let e=0;e<l.length;e++){const t=l[e];null==t.contentNode?Fe.error("saving image with no contentNode"):null==t.contentNode.url&&Fe.error("saving image with no url")}un();let d,p,u;u="edit-template"===Qe.operation||"new-template-from-template"===Qe.operation?t():Ue.poster.getRendition({longestSide:1200,imageQuality:.94}),u.then(e=>(d=e,Ue.poster.getRendition({longestSide:500,imageQuality:.94}))).then(e=>(p=e,Ke===it.TEMPLATE&&ne.currentBrandKit()&&Ye?ae.setUsedBrandElementsData(ne.currentBrandKit(),Ye,Me,!1):t.resolve(null))).then(()=>Me.saveWithRenditions(d,p,s)).then(()=>{if(Ue.docNameInput){const e=Ue.docNameInput.getText();i.currentDoc.setProjectName(e)}e.resolve();const t=Date.now()-n;d?c.publish("saveDocumentEnd",{saveTimeElapsedMs:t,docId:i.currentDoc.id,previewImageSize:d.size}):c.publish("saveDocumentEnd",{saveTimeElapsedMs:t,docId:i.currentDoc.id}),a=!1,i.currentDoc&&window.marvel.logger.endTrackingFlow("saveProjectFromEditor"),Me.validateDoc("saveSuccess"),r&&Me.canSave()?(r=!1,e=o,Fn()):(Ue.savingIndicator&&Ue.savingIndicator.hide(),e=null,mn(),He.resolve()),o=null},o=>{a=!1,e.reject(o),Ue.savingIndicator&&Ue.savingIndicator.hide(),Fe.error("Failed to save Post project",o),Me.validateDoc("saveFail"),e=null,mn(),He.reject(o),function(e){function o(){window.location.pathname.includes("/design/post/")||window.location.reload()}if("UPDATE_CONFLICT"===e.code)var n=new E({headerText:"i18n.dialogs.saveFailedMergeConflict.kHeaderText",contentText:"i18n.dialogs.saveFailedMergeConflict.kContentText",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailedMergeConflict.kRefresh",onClick:function(){n.hide(),(He=t.defer()).resolve(),window.location.reload()}}]});else var a=new E({headerText:"i18n.dialogs.saveFailed.kHeaderText",contentText:"i18n.dialogs.saveFailed.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailed.kRefresh",onClick:function(){a.hide(),(He=t.defer()).resolve(),window.location.reload()}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.saveFailed.kTryAgain",onClick:function(){a.hide(),Fn(),Ca().done(o)}}]})}(o)})}).done(),e;ot=!0}}();var Wn=n.debounce(Fn,4e3);function Nn(){tt=!0}function Rn(){tt=!1,ot&&(zn(),ot=!1)}function zn(){He.promise.isFulfilled()&&(un(),He=t.defer()),Wn()}function Un(){return Wn&&Wn.cancel(),Fn(),st.featureEnabled("spark-home-enabled")?(gt=!0,fa()):He.promise}function On(e,t,o){Oe.push(e.events.subscribe(t,o))}function jn(e,t){var o=Ue.poster.$el.offset(),n=Ue.poster.getViewScale(),a=Ue.poster.getWidth(),r=Ue.poster.getHeight(),i=e.pageX-o.left,s=e.pageY-o.top;i>0&&i<a&&s>0&&s<r?Ue.poster.getColorAtPoint({x:Math.round(i/n),y:Math.round(s/n)}).then((function(o){var n=se.rgb2hex(o);"click"===e.type?t.handleEyeDropperClicked(n):t.handleEyeDropperMoved(n,e)})):"click"===e.type?t.handleEyeDropperClicked(!1):t.handleEyeDropperMoved(!1,e)}function Gn(e){(e=e||{}).silent="boolean"==typeof e.silent&&e.silent,Ue.posterAdornments&&Ue.posterAdornments.dismissPopUp(),Ue.globalTabsWrapper&&!Ue.globalTabsWrapper.isActive()&&(Ue.textTabsWrapper.hide(),Ue.backgroundTabsWrapper.hide(),Ue.logoTabsWrapper.hide(),Ue.globalTabsWrapper.show()),Ue.tabButtonLayout&&Ue.tabButtonLayout.isSelected()&&Ue.sidebarLayout.returnFromSelectionState(),Ue.tabButtonPalette&&Ue.tabButtonPalette.isSelected()&&Ue.sidebarPalette.rebindColorPicker(),Ue.sidebarTemplates&&!Ue.sidebarTemplates.isHidden()&&(Ue.sidebarTemplates.returnedToGlobalSidebarState(),Ue.brandIndicator&&(Ue.brandIndicator.hide(),Ue.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"0px"},{id:"PostSidebar",size:"auto"}]})))}function Hn(){const e=Me.getRootForma().page;return{sizeID:e.sizeID,pageSize:e.pageSize,exportData:e.exportData}}function _n(){let e=!0;i.currentDoc.belongsToUser()||ne.currentBrandKit()&&!1!==ne.currentBrandElements().showBrandInUI&&ne.currentBrandKit().getLogosSync().length||(e=!1),e?Ue.addContentLogoButton.enable():Ue.addContentLogoButton.disable()}async function Kn(e){(c.publish("showEditor"),ze&&Ke===$e||await xt().catch(Fe.error),Ue.addContentLogoButton&&_n(),On(Me,"save-requested",zn),On(Me,"design-updated",Bo),On(Me,"forma-updated",yo),On(Me,"formae-duplicated",Do),On(Me,"formae-deleted",Ao),On(Me,"forma-added",Lo),On(Me,"forma-selected",Mo),On(Me,"filter-applied",Ue.sidebarBackground.updateFilters),On(Me,"undo-redo-state-changed",Ro),On(Me,"undo-finished",zo),On(Me,"redo-finished",Uo),On(Me,"forma-drag-start",Nn),On(Me,"forma-drag-end",Rn),On(Me,"layer-double-tapped",Fo),On(Me,"show-image-forma-corrupted-modal",Wo),On(Me,"current-brand-changed",ra),On(Me,"exit-crop-mode",to),On(Ue.posterAdornments,"buttonpress-style",Ue.tabButtonTextType.select),On(Ue.posterAdornments,"buttonpress-edit",Xt),On(Ue.posterAdornments,"buttonpress-duplicate",Qt),On(Ue.posterAdornments,"buttonpress-delete",ao),On(Ue.posterAdornments,"buttonpress-addText",Yt),On(Ue.posterAdornments,"buttonpress-change-photo",bo),On(Ue.posterAdornments,"buttonpress-logo",vo),On(Ue.posterAdornments,"create-swap-thumbnail",io),On(Ue.posterAdornments,"remove-swap-thumbnail",so),On(Ue.posterAdornments,"handle-drag",po),On(Ue.posterAdornments,"swap-formae",(function(e){Me.swapFormas(e.forma1,e.forma2).done()})),On(Ue.posterAdornments,"create-swap-forma-overlay",lo),On(Ue.posterAdornments,"remove-swap-forma-overlay",co),On(Ue.posterAdornments,"stock-image-licensed",Sn),On(Ue.posterAdornments,"post-interaction-layer-clicked",(function(){Ue.docNameInput.$el.is(":focus")&&Ue.docNameInput.blur(),Ue.downloadButton&&Ue.downloadButton.el.hideDownloadList(),Ue.sharePostButton&&Ue.sharePostButton.el.hideMenuDropdown(),Ct&&Bt()})),On(Ue.sidebarText,"buttonpress-edit",Xt),On(Ue.sidebarText,"buttonpress-delete",ao),On(Ue.sidebarText,"buttonpress-addText",Yt),On(Ue.sidebarText,"get-new-brandkit-colors",ea),On(Ue.sidebarText,"eyedropper-changed",(function(e){jn(e,Ue.sidebarText)})),On(Ue.sidebarText,"buttonpress-close",Gn),On(Ue.sidebarText,"size-slide-start",Ue.posterAdornments.hideSelectionBox),On(Ue.sidebarText,"size-slide-end",Ue.posterAdornments.showSelectionBox),On(Ue.poster,"rendered-image-layer-url-changed",No),On(Ue.poster,"watermark-footprint-changed",(function(e){Ue.watermarkButton.update({height:e.height+"%",width:e.width+"%"}),Vn(),Xn()})),On(Ue.sidebarTheme,"item-selected",So),On(Ue.sidebarTheme,"brand-button-pressed",Qn),On(Ue.sidebarBackground,"buttonpress-change-photo",bo),On(Ue.sidebarBackground,"buttonpress-add-photo",go),On(Ue.sidebarBackground,"filter-selected",(function(e,t,o){Me.setImageFilterForSelection(e,t,o).done()})),On(Ue.sidebarBackground,"bg-color-selected",(function(e){Me.setColorForSelection(e).done()})),On(Ue.sidebarBackground,"image-forma-replace-with-color",Me.updateConstrainedImages),On(Ue.sidebarBackground,"eyedropper-changed",(function(e){jn(e,Ue.sidebarBackground)})),On(Ue.sidebarBackground,"buttonpress-close",Gn),On(Ue.sidebarBackground,"buttonpress-set-foreground",oo),On(Ue.sidebarBackground,"buttonpress-set-background",no),On(Ue.sidebarBackground,"buttonpress-crop",qt),On(Ue.sidebarLayout,"grid-item-selected",To),On(Ue.sidebarResize,"size-item-selected",Po),On(Ue.sidebarPalette,"item-selected",Co),On(Ue.sidebarPalette,"item-selected",Mn),On(Ue.sidebarPalette,"eyedropper-changed",(function(e){jn(e,Ue.sidebarPalette)})),On(Ue.sidebarPalette,"update-palette-color",(function(e,t){Me.updateColorInTheme(e,t).done()})),On(Ue.sidebarLogo,"item-selected",Cn),On(Ue.sidebarLogo,"buttonpress-uploadNewLogo",ko),On(Ue.sidebarLogo,"logo-uploaded",hn),On(Ue.sidebarLogo,"buttonpress-closeLogoPanel",Gn),On(Ue.sidebarIcon,"buttonpress-replace-icon",bo),On(Ue.sidebarIcon,"icon-color-selected",(function(e,t){Me.setColorForSelection(e,t).done()})),On(Ue.sidebarIcon,"hide-icon-picker",(function(){Ue.changeIconModalPanel.hide()})),On(Ue.sidebarIcon,"eyedropper-changed",(function(e){jn(e,Ue.sidebarIcon)})),On(Ue.iconPicker,"item-selected",fn),On(Ue.iconPicker,"hide",(function(){Ue.changeIconModalPanel.hide()})),On(Ue.addTextSidebar,"badge-selected",xo),On(Ue.addTextSidebar,"buttonpress-addTextPanel",Gn),On(Ue.sidebarCrop,"crop-shape-selected",Zt),On(Ue.sidebarCrop,"crop-aspect-ratio-selected",Jt),On(Ue.sidebarCrop,"close-crop-picker",eo),On(Ue.imagePicker,"item-selected",vn),On(Ue.imagePicker,"hide",(function(){Ue.changeImageModalPanel.hide()})),On(Ue.sidebarBackground,"hide-image-picker",(function(){Ue.changeImageModalPanel.hide()})),On(Ue.colorPicker,"brand-color-added",ea),On(Ue.colorPicker,"colorChangeModal",(function(e){"begin"===e.type?Me.beginBranch():"confirm"!==e.type&&"cancel"!==e.type||Me.endBranch("confirm"===e.type)})),Ue.brandIndicator&&On(Ue.brandIndicator,"switch-brand",Tt),st.featureEnabled("entitle-brand-kit")&&!st.featureEnabled("hide-premium-font-onboarding")&&(Ue.tabButtonTextType.$el.addClass("premium-highlight-badge"),Ue.sidebarText.events.subscribe("font-picker-opened",(function(){Ue.tabButtonTextType.$el.removeClass("premium-highlight-badge")}))),Ue.imagePicker&&Ue.imagePicker.home(),Ke===it.TEMPLATE?Ue.topColorStrip.$el.css({background:"#ffffff"}):Ue.topColorStrip.$el.css({background:"#10c459"}),Ue.collabStatusButton)&&vt(i.currentDoc.getCollaboration()&&"NONE"!==i.currentDoc.getCollaboration());!function(){const e=Me.getRootForma(),t=e.filterWithCallback(e=>e.isSticker()),o=e.filterWithCallback(e=>!!e.animation),n=e.filterWithCallback(e=>e.isVideo());if(t.length>0||o.length>0||n.length>0){const e=new E({headerText:"i18n.dialogs.minisFeatureNotice.kHeaderText",contentText:"i18n.dialogs.minisFeatureNotice.kContentText",buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.minisFeatureNotice.kButtonLabel",onClick:function(){e.hide()}}]});e.show()}}(),Ue.poster&&(Ne?(Ue.poster.setWatermark(!0),c.publish("editor:watermarkShown",{payToRemove:Re})):Ue.poster.setWatermark(!1)),Ne?Ue.watermarkButton.isHidden()&&Ue.watermarkButton.show():Ue.watermarkButton.hide(),Ke!==it.TEMPLATE&&(e.showShareButton?Ue.sharePostButton.show():Ue.sharePostButton.hide(),e.showDownloadButton?Ue.downloadButton.show():Ue.downloadButton.hide()),e.showFacebookUpdateCoverButton?Ue.facebookUpdateCover.show():Ue.facebookUpdateCover.hide(),e.showFacebookUploadButton?Ue.facebookUploadButton.show():Ue.facebookUploadButton.hide(),e.showTwitterUpload?Ue.twitterUpload.show():Ue.twitterUpload.hide(),Ue.sidebarTheme.setCoreWrapper(Me),Ue.sidebarText.setCoreWrapper(Me),Ue.sidebarBackground.setCoreWrapper(Me),Ue.sidebarLogo.setCoreWrapper(Me),Ue.sidebarIcon.setCoreWrapper(Me),Ue.sidebarMultiselect.setCoreWrapper(Me),Ue.sidebarLayout.setCoreWrapper(Me),Ue.sidebarLayout.deselectSelected(),Ue.sidebarCrop.setCoreWrapper(Me),Ue.sidebarResize.setCoreWrapper(Me),Ue.sidebarResize.deselectSelected(),Ue.debugView&&Ue.debugView.setCoreWrapper(Me),Ue.postEditorView.show(),Ue.windowPanel.resize(),Ue.sidebarTemplates&&(Qe.projectContext||(Qe.projectContext=i.getProjectContexts()),Ue.sidebarTemplates.setupSessionData(Qe,i.currentDoc,et,Je,st.featureEnabled("is-paid-user")),Ue.sidebarTemplates.setCoreWrapper(Me));var t=Date.now(),o=Ue.poster.events.subscribe("rendered",(function(){var e=Date.now()-t;c.publish("post:posterInitialRenderEnd",{contextualData1:"timeElapsedMs:"+e,contextualData2:"editorOperation:"+Qe.operation,contextualData3:"numImages:"+Me.imageFormas().length}),Ue.sidebarTemplates&&Ue.sidebarTemplates.events.publish("poster-initial-render-end"),o.remove()}));Ue.poster.update({core:Me}),Me.setViewScale(Ue.poster.getViewScale()),Ue.posterAdornments.setPageElement(Ee),Ue.posterAdornments.setCoreWrapper(Me),Ue.posterAdornments.enable(),Ue.imageWrapper.update({aspect:Ue.poster.getAspect()}),Ue.brandIndicator&&Ue.brandIndicator.update({collaborationStatus:i.currentDoc.getCollaboration()||"NONE",isEntitled:st.featureEnabled("entitle-brand-kit"),navigateToCreateBrandMethod:ma}),Ue.sidebarBackground.update();var n,a,r=Ue.poster.getWatermarkFootprint();Ue.watermarkButton.update({height:r.height+"%",width:r.width+"%"}),Vn(),Xn(),Ke===it.TEMPLATE?(Ue.tabButtonResize.select(),n=ae.getTemplateName(Ye),a=w.translate(ct)):(e.startingMenu?"colors"===e.startingMenu?Ue.tabButtonPalette.select():"layout"===e.startingMenu?Ue.tabButtonLayout.select():"resize"===e.startingMenu?Ue.tabButtonResize.select():"templates"===e.startingMenu?(Ue.tabButtonTemplates.select(),delete e.startingMenu):Ue.tabButtonTheme.select():e.showImageModalPanelOnload?(Ue.tabButtonBackgroundImage.select(),Ue.changeImageModalPanel.show()):"remix"===Qe.operation||"new-from-template"===Qe.operation?Ue.tabButtonLayout.select():Ue.tabButtonTheme.select(),n=i.currentDoc.getProjectName(),a=w.translate(dt)),Ue.docNameInput&&((n=n||a)===a?(Ue.docNameInput.$el.addClass("placeholder"),Ue.docNameInput.$el.removeClass("named")):(Ue.docNameInput.$el.removeClass("placeholder"),Ue.docNameInput.$el.addClass("named")),Ue.docNameInput.setText(n)),window.addEventListener("resize",(function(e){Bt(),Ue.posterAdornments.handleWindowResize(),Xn()})),Ro()}function $n(){if(Ne&&Ue.imageWrapper&&Ue.watermarkButton){var e=Ue.poster.getWatermarkFootprint();return Ue.imageWrapper.getWidth()>=e.width&&Ue.imageWrapper.getHeight()>=e.height}return!1}function Vn(){var e=$n();Ne&&(e?(Ue.poster.setWatermark(!0),Ue.watermarkButton.show()):(Ue.poster.setWatermark(!1),Ue.watermarkButton.hide()))}function Xn(){if(Ne){var e=Ue.poster.getWatermarkFootprint(),t=Ue.imageWrapper.getHeight(),o=Ue.imageWrapper.getWidth(),n=o-o*(e.width/100)/2,a=t*(1-e.height/100);Ue.watermarkCoachmark&&Ne&&!Ze&&Ue.watermarkCoachmark.reposition(),!Ze&&Ue.watermarkCoachmark&&Ue.watermarkButton.isHidden()&&!Ue.watermarkCoachmark.isHidden()&&Ue.watermarkCoachmark.hide(),Ue.watermarkTooltip&&(Ue.watermarkTooltip.update({left:n-41,top:a-48}),Ue.watermarkButton.isHidden()&&!Ue.watermarkTooltip.isHidden()&&Ue.watermarkTooltip.hide())}}function Yn(e){const o=ne.currentBrandElements();if(!o||!o.activated)return t.resolve(null);e||o.coreBrandPromise&&o.coreBrandPromise.isFulfilled()||qn(o),Ue.poster&&Ue.poster.events.publish("image-loading-begin");const n=e?re.getLiteCoreBrand(o):o.coreBrandPromise,a=o.belongsToUser?ne.checkForRestrictedFonts():t.resolve([]);let r;return n.then(e=>(r=e,a)).then((function(e){if(e.length){const o=t.defer();return window.marvel.events.trigger("missing-brand-fonts-ux",{doc:i.currentDoc,missingFonts:e,defer:o}),o.promise.then(e=>e?t.resolve():t.reject({brandFontsVerificationFailed:!0}))}return t.resolve()})).then(()=>r?Me.brandDocument(r):t.resolve()).then(()=>{Ue.poster&&Ue.poster.events.publish("image-loading-end")}).catch(e=>{if(e&&e.brandFontsVerificationFailed)return t.resolve();{const o=e&&e.message?": ".concat(e.message):"";return Fe.error("brandDocument error ".concat(o),e),t.resolve()}})}function Qn(e){const t=ne.currentBrandElements();"INCOMING"!==i.currentDoc.getCollaboration()||t&&(!t||!1!==t.showBrandInUI)?t&&t.activated?(Yn().done(),c.publish("brandifyApplied")):window.marvel.events.trigger("spark-post-show-brandify-onboarding",{element:e.$element}):xe.showAlert(w.translate("dialogs.brandifySharedProjectAlert.kHeaderText"),w.translate("dialogs.brandifySharedProjectAlert.kContentText"),{okText:w.translate("dialogs.brandifySharedProjectAlert.kButtonLabel")})}function qn(e){e&&e.coreBrandPromise?e.coreBrandPromise.done(()=>(ee.Host.setAuthoringContext(e.coreBrand),e.coreBrand)):ee.Host.setAuthoringContext(null)}function Jn(e){Ue.sidebarLogo&&(e&&e.primaryLogoPromise?Ue.sidebarLogo.updateListOfBrandKitLogos(e):Ue.sidebarLogo.updateListOfBrandKitLogos([]))}function Zn(e){var t=e&&e.activated?e:null;Ue.sidebarPalette&&Ue.sidebarPalette.setListOfBrandKitPalettes(t),Ue.sidebarText&&Ue.sidebarText.setBrandKitColors(Me.getBrandKitColorsPalettesForSelectedLockup(t)),Ue.sidebarBackground&&Ue.sidebarBackground.setBrandKitColors(t),Ue.sidebarIcon&&Ue.sidebarIcon.setBrandKitColors(t),Ue.colorPicker&&Ue.colorPicker.update({authoringContext:ne.currentBrandKit()})}function ea(){!function(e){const o=ne.currentBrandElements();!st.featureEnabled("entitle-brand-kit")||o&&!1===o.showBrandInUI?t():ne.refreshBrandColors().then((function(t){qn(t),e&&Zn(t)}))}(!0)}function ta(e){e=e||ne.currentBrandElements();const t=ne.currentBrandKit();let o=e;e&&!1===e.showBrandInUI&&(o=null),Jn(o),Zn(o),Ue.sidebarText&&Ue.sidebarText.setBrandkit(e&&!1!==e.showBrandInUI?t:null),Ue.sidebarTheme&&Ue.sidebarTheme.setBrandKitThemes(o),Ue.brandIndicator&&Ue.brandIndicator.setBrand(e,t)}function oa(e,t){qn(e),t&&ta(e)}function na(e,o){return ne.refreshCachedCurrentBrandElements().then(va(o,t=>{oa(t,e)})).catch(e=>{if(e&&e.message===Le.STALE_SESSION)return t.reject(e);Fe.error("refreshCurrentBrandElements: ".concat(e))})}function aa(e){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ne.switchCurrentAuthoringContext(e).then(e=>(oa(e,!0),e.coreBrandPromise)).then(e=>o?Me.changeBranding(e):t()).timeout(3e5).catch(e=>{const o=e?e.message:"";return xe.showAlert(w.translate("dialogs.switchBrandFailureAlert.kHeaderText"),w.translate("dialogs.switchBrandFailureAlert.kContentText"),{okText:w.translate("dialogs.switchBrandFailureAlert.kButtonLabel")}),Fe.error("switchBrand error: ".concat(o),e),t.reject()})}function ra(e){aa(e,!1)}var ia=!1;function sa(e){if(!m.disableCustomKeyboardShortcuts){var t=!1,o=window.navigator.platform.indexOf("Mac")>-1,n=e.ctrlKey,a=o&&e.metaKey,r=e.shiftKey,i=e.which;if(n||a)switch(i){case 83:n+r&&(ia=!0),t=!0;break;case 84:r&&ia&&(console.info("saving a copy as template"),We.saveAsCopyToTemplate().then((function(){Fe.info("save complete")}),(function(e){Fe.error("save failed",e)}))),t=!0;break;case 90:r?At():Dt(),t=!0;break;case 89:At(),t=!0}t&&e.preventDefault()}}function la(t){e(t.target).is("#PosterImageWrapper")||1===e(t.target).closest("#PosterImageWrapper").length||1===e(t.target).closest("#selectionPopUp").length||Ue.globalTabsWrapper.isActive()||Gn()}function da(e,t){var o=Nt(e),n={width:o.width,height:o.height,imageQuality:o.imageQuality};return n.outputFormat=t||"image/jpeg",n}let ca;function pa(e){if(e=e||{},!ca){ca=t.defer();const n=Date.now();o.e(47).then(function(a){const r=o("+7aA"),i=Date.now();Fe.info("headless load time = "+(i-n)),("string"==typeof e.authoringContextId?ne.getBrandKitById(e.authoringContextId):t.resolve()).then(e=>r.initialize(e)).done(()=>{const e=Date.now();Fe.info("headless init time = ".concat(e-i)),ca.resolve(r)})}.bind(null,o)).catch(o.oe)}return ca.promise}function ua(e){ba(e,"home")}function ma(e){ba(e,"create_brand")}function ga(e){ba(e,"organizer")}function ba(e,t){var o="/";if("organizer"===t?o+="projects":"create_brand"===t&&(o+="branding/create"),e="boolean"==typeof e&&e,Wn&&Wn.cancel(),gt=!0,e)He.resolve();else{if(ha())return void wa({returnPath:o});Fn()}Ca().done((function(){window.marvel.navigate(o,{trigger:!0})}))}function ha(){return st.featureEnabled("spark-home-enabled")&&"new"===Qe.operation&&"blank"===Qe.workflow&&!mt}function fa(){const e=t.defer();return He.promise.finally((function(){i.waitForQuiet().then((function(){e.resolve()}))})),e.promise}function wa(e){e=e||{};const o=t.defer(),n=new E({headerText:"i18n.dialogs.saveNonDirtyNewBlank.kHeaderText",contentText:"i18n.dialogs.saveNonDirtyNewBlank.kContentText",dismissable:!0,onDismissed:function(){o.resolve({dismissed:!0})},buttons:[{class:"pill pill-primary-on-dark",label:"i18n.dialogs.saveNonDirtyNewBlank.kDontSave",onClick:function(){n.hide(),o.resolve(!1)}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.saveNonDirtyNewBlank.kSaveProject",onClick:function(){n.hide(),o.resolve(!0)}}]});o.promise.then((function(o){if(!o.dismissed)if(Fn(),o)fa().done((function(){e.returnPath?window.marvel.navigate(e.returnPath,{trigger:!0}):e.defer&&e.defer.resolve()}));else{const o=new E({headerText:"i18n.dialogs.saveNonDirtyNewBlank.kDeleteProgress",contentText:'<div class="postspinner postspinner-small"></div>',dismissable:!1});o.show();const n=function(){o.hide()};window.marvel.events.once("design-view-unloading",n),fa().done((function(){const o=t.defer();window.marvel.events.trigger("delete-current-doc",{doc:i.currentDoc,defer:o}),o.promise.then((function(){e.returnPath?window.marvel.navigate(e.returnPath,{trigger:!0}):e.defer&&e.defer.resolve()}))}))}}))}function va(e,o){var n=this;return function(){if("number"==typeof e&&e!==je)return t.reject(new Error(Le.STALE_SESSION));var a=[].slice.apply(arguments);try{var r=o.apply(n,a);return r}catch(e){return t.reject(e)}}}function ka(e){e&&e.message===Le.STALE_SESSION?Fe.error("Abandoning stale session. May be benign."):(window.marvel.events.trigger("hide-interstitial"),!e||e.userCanceledNPW||e.doNotLog||e.isWebGLUnavailable?(e&&e.isWebGLUnavailable&&Fe.warn("Failed to enable Post editor due to WebGL unavailability"),ba(!0)):(e.url=window.location.href,Fe.error("error enabling Post editor",e),Ue.windowPanel.show(),Ue.errorDialogs.enableEditorErrorModal=Be(e,()=>{ba(!0)})))}function Ta(e){var t;return t=(e=e||{}).tags?e.tags.includes("remixpaid")?"paid":"free":e.templateType||"none",{tagNames:e.tags?"["+e.tags.join(", ")+"]":"[]",templateType:t,templateId:e.id?e.id:"none"}}function Ia(e){e=e||Je;var t=function(){if(Me){var e,t={},o=Me.getDocumentOriginalSizeId().toLowerCase(),n=Me.getDocumentSizeId().toLowerCase();e=o===ee.FormaPage.DEFAULT_ORIGINAL_SIZE_ID.toLowerCase()?"unknown":o!==n,t.originalSize=o,t.exportSize=n,t.hasResized=e;var a=Me.getAllDesignIngredientIDsAndTypes();a.length&&(t.designIngredientId=a[0].id);var r=Me.getColorPaletteId();r&&(t.color=r);var i=Me.getAppliedLayoutId();i&&(t.layout=i),t.includesPaidAdobeFonts=We.includesPaidAdobeFonts();var s=Me.getContentCountsString();s.length>1?t.contentCountsString=s.substring(0,s.length-1)+", designIngredient:"+a.length+"]":t.contentCountsString="";var l=Me.getAppliedVariationTemplateId();return l?(t.designFilter=l,t.hasVariationTemplate=!0):t.hasVariationTemplate=!1,t}return{originalSize:"unknown",exportSize:"unknown",hasResized:"unknown",designIngredientId:"unknown",color:"unknown",layout:"unknown",includesPaidAdobeFonts:"unknown",textCount:"unknown",imageCount:"unknown",iconCount:"unknown",logoCount:"unknown",designIngredientCount:"unknown",designFilter:"unknown",hasVariationTemplate:"unknown"}}();return n.extend({},e,t)}function Pa(e,o,n){return n?t({tags:null,templateType:"brand",id:e}):e?function(e,t){if(e&&t)return new de({cpServiceDomain:t}).getAssetMetadataWithRetry(e)}(e,o):t({})}function Ca(e){var t="string"==typeof e?e:"i18n.app.kSavingPost";return He.promise.isPending()&&(_e&&t===Xe||(_e=new E({headerText:t,contentText:'<div class="postspinner postspinner-large"></div>',dismissable:!1}),Xe=t),_e.show()),He.promise.finally((function(){_e&&_e.hide()})).done(),He.promise}return We.enable=function(o,a){var r=++je;if(o){Ue.errorDialogs.fontMissingNoticeModal&&Ue.errorDialogs.fontMissingNoticeModal.hide(),Ee=o,Ue.windowPanel?Ue.windowPanel.update({parentDomElement:Ee,hidden:!0}):Ue.windowPanel=new S({id:"PostWindowPanel",parentDomElement:Ee,hidden:!0});var l=Date.now(),d=!ze,p=0;Je={};var u,m,h="new"===(Qe=a).operation;$e=Ke,Ke=it.DOCUMENT,"edit-template"===Qe.operation&&(Ke=it.TEMPLATE);var v={};We.enabled=!0,le.resetLoadingTimes();var k,T,I=(k=b.getSetting(ve.keys.POST_WATERMARK_UNLOCKED).catch(e=>{const o=e?e.message:"";return Fe.warn("Error fetching user settings for watermark status. Error: ".concat(o),e),t.resolve(!1)}),T=st.loadFeatures(),Promise.all([k,T]).then((function(e){var t=e[0],o=st.featureEnabled("show-remove-branding-flow"),n=st.featureEnabled("remove-branding-enabled");return!t&&o&&n?(b.setSetting(ve.keys.POST_WATERMARK_UNLOCKED,!0),!0):t}))),P=t.allSettled([He.promise,st.loadFeatures()]);g.doSerial([P,function(){return w.initLocalization(w.sparkSelectedLocale)}]).then(va(r,(function(){window.marvel.events.on("saved-composite-doc",It),st.featureEnabled("entitle-brand-kit")&&window.marvel.events.on("onboarding-premium-templates-remove",wt),window.marvel.events.on("document-collaboration-changed",kt),ee.Host.setFeatureController(st)}))).then(va(r,(function(){if(st.featureEnabled("entitle-brand-kit")||"remix"!==Qe.operation)return t.resolve();var e=t.defer();return(qe=Pa(Qe.cpAssetId,Qe.cpServiceDomain||"cc-api-cp.adobe.io",!1)).then(va(r,t=>{const{tags:o,id:n,alias:a}=t;o&&o.includes("remixpaid")?(window.marvel.events.trigger("hide-interstitial"),Ue.windowPanel.show(),s.showMerchMessagingModal({workflow:"remixPremiumTemplate",destinationUrl:Qe.routeFragment,asset:{id:n,alias:a,tags:o,isPremiumTemplate:!0,remixable:!0,remixpaid:!0,app:"post"},analyticsPage:"editor:post",analyticsFullTagNames:"[".concat(o.join(", "),"]")}),window.marvel.events.on("upgrade-view-closed",()=>{window.marvel.events.off("upgrade-view-closed"),e.reject({message:"user not entitled to remix premium template",doNotLog:!0})})):e.resolve()})).catch((function(t){e.reject(t)})),e.promise}))).then(va(r,(function(){var e=t.defer(),o=document.createElement("canvas").getContext("webgl");if(!1===(null!==o&&o instanceof WebGLRenderingContext)){var n=function(){var e="Unknown",t="Unknown",o=document.createElement("canvas");if(o){var n=o.getContext("webgl")||o.getContext("experimental-webgl");if(n){var a=n.getExtension("WEBGL_debug_renderer_info");a&&(e=n.getParameter(a.UNMASKED_VENDOR_WEBGL),t=n.getParameter(a.UNMASKED_RENDERER_WEBGL))}}return{vendor:e,renderer:t,platform:navigator.platform,userAgent:navigator.userAgent}}();c.publish("webGLUnavailable",n),Ue.errorDialogs.webglWarningModal=new E({headerText:"i18n.dialogs.webGLDisabled.kHeaderText",contentText:"i18n.dialogs.webGLDisabled.kContentText<br/><br/>Vendor: "+n.vendor+"<br/>Renderer: "+n.renderer+"<br/>Platform: "+n.platform+"<br/>UserAgent: "+n.userAgent,dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){Ue.errorDialogs.webglWarningModal.hide(),e.reject({isWebGLUnavailable:!0})}}]}),window.marvel.events.trigger("hide-interstitial"),Ue.windowPanel.show(),Ue.errorDialogs.webglWarningModal.show()}else c.publish("webGLAvailable"),e.resolve();return e.promise}))).then(va(r,(function(){if(!h)return t.resolve();Ue.newPostWorkflow||(Ue.newPostWorkflow=new R({parent:Ue.windowPanel})),c.publish("newProjectWorkflowLoaded"),st.featureEnabled("post-max-static-npw")&&(a.isMaxStaticNpw=!0);var e=st.featureEnabled("post-redesinged-npw");a.useRedesignedNewProjectWorkflow=e;var o=Date.now(),n=Ue.newPostWorkflow.prompt(a);return Ue.windowPanel.show(),n.then((function(e){et=u=e,p=Date.now()-o,window.marvel.events.trigger("show-interstitial",{typeName:"post"})}))}))).then(va(r,(function(){return function(e,t){return(t=t||{}).belongsToUser="boolean"!=typeof t.belongsToUser||t.belongsToUser,st.featureEnabled("entitle-brand-kit")?ne.loadBrandKit(e,t):ne.loadBrandKit(null,t)}(Qe.contextId||i.currentDoc.getDCXRoot().getValue("authctx#ctxid"),{skipReload:!0,belongsToUser:"INCOMING"!==i.currentDoc.getCollaboration(),isEntitledUser:st.featureEnabled("entitle-brand-kit")})}))).then(va(r,(function(){return e=ne.currentBrandKit(),le.load({loadForEditor:!0,authoringContext:e});var e}))).then(va(r,()=>na(!1,r))).then(va(r,(function(){const e=ne.currentBrandKit(),t=ne.currentBrandElements();if(h){t&&t.activated&&((m="true"===Qe.branded)?c.publish("paidProjectStartBranded"):c.publish("paidProjectStartUnbranded"))}else{if("edit-template"===Qe.operation||"new-from-template"===Qe.operation||"new-template-from-template"===Qe.operation)return Ye=e.getThemeById(Qe.templateId),v.persistSource=ce.fromTemplate(e,Ye),"new-template-from-template"===Qe.operation?(c.publish("createdTemplateFromTemplate"),ae.createEmptyPostTemplate(e).then(va(r,(function(t){return v.persistSave=pe.toTemplateLocal(e,Ye,pe.CommitChanges.AUTO),Qe.newTemplateId=t.id,v})))):("edit-template"===Qe.operation?(c.publish("editedTemplate"),v.persistSave=pe.toTemplateLocal(e,Ye,pe.CommitChanges.AUTO)):(c.publish("projectCreated",{projectId:i.currentDoc.id}),c.publish("createdBrandedProject",{projectId:i.currentDoc.id,templateName:Ye._data["theme#data"].name,themeletId:Qe.templateId}),c.publish("createdProjectFromTemplate"),Pt(i.currentDoc.id),v.persistSave=pe.toDocument(i.currentDoc)),v);"remix"===Qe.operation?(De.setCPServiceDomain(Qe.cpServiceDomain),Pt(i.currentDoc.id),new de({cpServiceDomain:Qe.cpServiceDomain}).trackRepeatableActivity(Qe.cpAssetId,"remix_count"),v={persistSource:new Ae({assetId:Qe.cpAssetId,cpServiceDomain:Qe.cpServiceDomain}),persistSave:pe.toDocument(i.currentDoc)}):(De.setCPServiceDomain(""),v={persistSource:ce.fromDocument(i.currentDoc),persistSave:pe.toDocument(i.currentDoc)})}return v}))).then(va(r,(function(e){return(Me=new f(e)).whenInitialized().then(va(r,(function(){le.logLoadingTimes();var e=Me.missingFontListInDoc();e.length>0&&function(e){var t=e.join(", ");Ue.errorDialogs.fontMissingNoticeModal||(Ue.errorDialogs.fontMissingNoticeModal=new E({headerText:"i18n.dialogs.fontMissingNotice.kHeaderText",contentText:w.translate("dialogs.fontMissingNotice.kContentText",{missingFontNames:t}),buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.fontMissingNotice.kEditButtonLabel",onClick:function(){Ue.errorDialogs.fontMissingNoticeModal.hide(),c.publish("missingFontsWhenOpenReplaceButtonPressed")}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.fontMissingNotice.kCancelButtonLabel",onClick:function(){Ue.errorDialogs.fontMissingNoticeModal.hide(),ba(!0),c.publish("missingFontsWhenOpenCancelButtonPressed")}}]})),Ue.errorDialogs.fontMissingNoticeModal.show()}(e),ee.Host.setCoreWrapper(Me),Me.validateDoc("open"),Ge.resolve(Me)})))}))).then(va(r,(function(){if("remix"===Qe.operation){var e;if(Qe.aspectId||Qe.customSize)if(Qe.customSize){var o=Qe.customSize.split(":");4===o.length&&(e=ee.DesignSizeLibrary.getCustomSize(o[0],o[1],o[2],o[3]))}else e=ee.DesignSizeLibrary.getById(Qe.aspectId);return(e?Me.setPageSizeFromDesignSize(e):t.resolve()).then(va(r,(function(){return Me.recordOriginalSize()})))}if(!h)return t.resolve();var n=Me.beginTransaction("initialization");return Me.setPageSizeFromDesignSize(u.shapeData).then(va(r,(function(){return Me.recordOriginalSize()}))).then(va(r,(function(){if(!a.useRedesignedNewProjectWorkflow&&m||!u.image)return t.resolve();if(u.image&&(mt=!0),Array.isArray(u.image)){var e,o=[];return u.image.forEach((function(n){var a=t.defer();a.promise.catch((function(){e||(Ue.errorDialogs.addImageErrorOverlay=new E({headerText:"i18n.dialogs.addImageError.kHeaderText",contentText:"i18n.dialogs.addImageError.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"Ok",onClick:function(){errorOverlay.hide()}}]}),e=!0)})),o.push(xn(n,a,null,!0,!0))})),t.allSettled(o)}return xn(u.image,null,null,!0,null).catch((function(){return t.resolve()}))}))).then(va(r,(function(){return Me.initializeNewPost(u)}))).then(va(r,(function(){return m?Yn(!0):t.resolve()}))).then(va(r,(function(){Me.endTransactionAndMergeWithPrevious(n),c.publish("projectCreated",{projectId:i.currentDoc.id,aspectRatio:u.shapeData.aspectRatio,targetId:u.shapeData.id,id:u.id,textLength:u.text.length,workflow:a.workflow}),m&&c.publish("createdBrandedProject",{projectId:i.currentDoc.id})})))}))).then(va(r,(function(){var e="remix"===Qe.operation,o="new-from-template"===Qe.operation,n=Qe.cpServiceDomain||"cc-api-cp.adobe.io",a=Me.getRemixParentsCpIds(),s=Qe.cpAssetId||(a?a[a.length-1]:null),l=o?Qe.templateId:Me.getAuthoringContextThemeId();return o&&Me.setAuthoringContextThemeId(Qe.templateId),qe||(qe=Pa(s,n,!!l)),qe.then(va(r,(function(t){e&&(i.currentDoc.name="",Me.setRemixParentCpId(t.id)),Je=Ta(t)}))).catch((function(o){return o&&o.message===Le.STALE_SESSION?t.reject(o):e?t.reject(o):(Fe.warn("Failed to get parent CP metadata for a non-remix flow",o),Je=Ta(null),t.resolve())}))}))).then(va(r,(function(){if("remix"!==Qe.operation&&"new-from-template"!==Qe.operation)return t.resolve();var e=t.defer();return 0===Me.getRootForma().childCount?(Ue.errorDialogs.notRemixableOverlay=new E({headerText:"i18n.dialogs.remixFailed.kHeaderText",contentText:"i18n.dialogs.remixFailed.kContentText",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){Ue.errorDialogs.notRemixableOverlay.hide(),e.reject(),ba(!0)}}]}),window.marvel.events.trigger("hide-interstitial"),Ue.windowPanel.show(),Ue.errorDialogs.notRemixableOverlay.show()):(zn(),e.resolve()),e.promise}))).then(va(r,(function(){return I}))).then(va(r,(function(e){Re=st.hasExperimentFeature("post-watermark-pay-to-remove","postWatermarkExperimentV2",{eventName:"payToRemoveWatermarkVariantAssignment",eventData:{},pageName:"editor:post"},{eventName:"removeOnceVariantAssignment",eventData:{},pageName:"editor:post"});var o=st.featureEnabled("entitle-brand-kit"),n=st.featureEnabled("post-create-template-contentteam");return Ne=!n&&(!e&&!o&&(!!Re||("remix"===Qe.operation||Me.getWatermarkEnabledForDoc()))),Me.setWatermarkEnabledForDoc(Ne),b.getSetting(ve.keys.POST_WATERMARK_COACHMARK_DISMISSED).then(va(r,(function(e){Ze=e}))).catch(e=>{const o=e?e.message:"";if(o===Le.STALE_SESSION)return t.reject(e);Fe.warn("Error fetching user settings for watermark coachmark. Error: ".concat(o),e),Ze=!1})}))).then(va(r,(function(){Me.resetUserActions(),Me.monitorTransactions(),Kn(function(e){e=e||{};var t=ut.default;if(e.workflow&&ut.hasOwnProperty(e.workflow)&&(t=n.clone(ut[e.workflow])),e.startingMenu&&(t.startingMenu=e.startingMenu),!t.isDefault&&e.buttons){var o=e.buttons;o.indexOf("facebook_upload")>=0&&(t.showFacebookUploadButton=!0),o.indexOf("share")>=0&&(t.showShareButton=!0),o.indexOf("download")>=0&&(t.showDownloadButton=!0)}return n.each(pt,(function(o){var a;n.isUndefined(e[o])||(a="true"==e[o]||"false"!=e[o]&&e[o],t[o]=a)})),t}(a)).then(va(r,()=>{Ke===it.TEMPLATE&&(Ve={templateName:ae.getTemplateName(Ye)}),Ue.windowPanel.show(),window.marvel.events.trigger("hide-interstitial"),ta(ne.currentBrandElements())})).catch(Fe.error)}))).then(va(r,(function(){var t=["new","new-from-theme","new-from-template","remix"].indexOf(Qe.operation)>=0,o=ne.currentBrandElements()||{id:""};c.publish("project:editorDisplayed",{isBranded:!n.isEmpty(i.currentDoc.getDCXRoot().getValue("authctx#ctxid")),contextualData23:o.isDefault?"":o.id,isNewProject:t,sparkFormat:"post",contextData:["projectId"],includesUploadedFonts:We.includesUploadedFonts(),contextualData5:"tagNames:"+Je.tagNames,contextualData6:"templateType:"+Je.templateType,contextualData24:"collabStatus:"+i.currentDoc.getCollaborationForAnalytics(),templateId:Je.templateId}),window.marvel.events.trigger("editor-displayed",{appName:"post"});var a=Date.now()-l;p&&(a-=p),c.publish("post:editorStartupEnd",{contextualData1:"timeElapsedMs:"+a,contextualData2:"editorOperation:"+Qe.operation,contextualData3:"isFreshLoad:"+d,contextualData4:"hasActivatedBrand:"+(!!o&&o.activated),contextualData5:"timeSpentInNpw:"+p}),e(document).on("keydown",sa),e("#PostCanvasSection").on("click",la)}))).then(va(r,()=>{"new"!==Qe.operation&&(Me.replaceCorruptImageFrames()&&(Fe.error("Replacing corrupt images in document during open"),Ue.errorDialogs.replacedLowResImagesModal||(Ue.errorDialogs.replacedLowResImagesModal=new E({headerText:'\n                  <span class="error-modal-header">\n                    <span>i18n.dialogs.corruptImageReplacement.kHeaderText</span>\n                    <i class="error-modal-header__icon"></i>\n                  </span>\n                ',contentText:'<div class="error-modal-content">\n                      <span>i18n.dialogs.corruptImageReplacement.kContentText</span>\n                      <span class="error-modal-content_placeholder-indicator" style="background-color: #FF0000;"></span>\n                    </div>',dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.corruptImageReplacement.kButtonLabel",onClick:()=>Ue.errorDialogs.replacedLowResImagesModal.hide()}]})),Ue.errorDialogs.replacedLowResImagesModal.show()))})).catch(ka).done()}},We.getMetadataForExportAnalytics=function(e,o){return Pa(e,"cc-api-cp.adobe.io",o).then((function(e){return Ia(Ta(e))})).catch((function(e){return Fe.error("getMetadataForExportAnalytics: error while fetching metadata from CP",e),t(!1)}))},We.disable=function(){We.enabled=!1,ne.resetBrandCaches(),Ye=null,Ve=null,mt=!1,et=null,Object.keys(Ue.errorDialogs).forEach(e=>Ue.errorDialogs[e].hide()),Gn({silent:!0}),Ue.windowPanel&&Ue.windowPanel.hide(),Ge=t.defer(),qe=null,He.promise.done((function(){Ue.poster&&Ue.poster.update({core:void 0}),Ue.posterAdornments&&Ue.posterAdornments.disable(),Ue.postEditorView&&Ue.postEditorView.hide(),Ue.newPostWorkflow&&Ue.newPostWorkflow.hide(),window.marvel.events.off("saved-composite-doc",It),window.marvel.events.off("onboarding-premium-templates-remove",Lt),window.marvel.events.off("upgrade-view-closed"),window.marvel.events.off("document-collaboration-changed",kt),function(){for(var e=0;e<Oe.length;e++)Oe[e].remove();Oe=[]}(),e(document).off("keydown",sa),e("#PostCanvasSection").off("click",la)}))},We.handleUnload=function(){if(!Me||!Me.getDocument())return t();var e=Me.getAllStringForFormaUsedWheelSuggestions();if(e.length>0&&c.publish("lockupStyleCaptured",{contextualData1:"styleString:".concat(e),contextualData2:"location:EditorClose"}),!gt&&ha()){var o=t.defer();return wa({defer:o}),o.promise}return gt=!1,Ca()},We.getCurrentDocumentSynthesizedName=function(){return Me.getCurrentDocumentSynthesizedName()},We.getCurrentDocumentDescription=function(){return Me.getCurrentDocumentDescription()},We.getRemixAncestorsIntoMachineTags=function(e){return Me.getRemixAncestorsIntoMachineTags(e)},We.getDocumentSize=function(){return Me.getDocumentSize()},We.getCoreWrapperPromise=function(){return Ge.promise},We.saveAsCopyToTemplate=function(){var e,t;return Ue.poster.getRendition({width:500,imageQuality:.75}).then((function(e){return t=e,r.getController()})).then((function(e){return e.getGlobalActiveContext()})).then((function(t){if(!(e=t))throw new Error("No current BrandKit.");return ae.createEmptyPostTemplate(e)})).then((function(o){var n=pe.toTemplateExternal(e,o,pe.CommitChanges.AUTO);return Me.saveCopyWithRenditions(n,null,t)}))},We.getDownloadImageBlobPromise=function(e,t){if(We.enabled){We.reportNounProjectIds();var o=da(Me,t);return Ue.poster.getRendition(o)}var n;return pa({authoringContextId:e.getDCXRoot().getValue("authctx#ctxid")}).then(t=>{var o=ce.fromDocument(e),a=new me;return(n=new f({persistSource:o,persistSave:a})).whenInitialized().then(()=>t)}).then(e=>{We.reportNounProjectIds(n);var o=da(n,t);return e.getRenditionBlobPromise(n,o)})},We.reportNounProjectIds=function(t){var o;if(Me)o=Me.getUnreportedNounProjectIds();else{if(!t)return void Fe.error("can not report Icons, due to core wrapper not being initialized");o=t.getUnreportedNounProjectIds()}var n="https://"+window.marvel.settings.dooplo+"/api/v1/report/usage?api_key=MarvelCP1",r=window.adobeIMS.getAccessToken();o.length&&e.ajax({headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",url:n,data:JSON.stringify({ids:o}),beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+r),e.setRequestHeader("X-Api-Key",a.key)},success:function(e,a,r){"success"!==a?Fe.error("error reporting Noun Project icon Ids","Requested "+n+". Got back "+r.statusCode+": "+r.body):(Me?Me.setNounProjectIdsReported(o):t&&t.setNounProjectIdsReported(o),zn())},error:function(e){Fe.error("error reporting Noun Project icon Ids","Requested "+n+". Got back "+e.responseText)}})},We.getCompositeImageFiles=function(e){var o;return pa().then((function(){var t=ce.fromDocument(e),n=new me;return(o=new f({persistSource:t,persistSave:n})).whenInitialized()})).then((function(){var e=o.imageFormas(),n=[];e.forEach((function(e){n.push(u.load(De.decodeUrl(e.contentNode.url)))}));var a=[];return t.all(n).then((function(){for(var e=[],o=[],n=0;n<arguments[0].length;n++){var r=arguments[0][n];if(r instanceof HTMLImageElement){o.push(r.src);var i=r.src.substring(r.src.lastIndexOf("=")+1),s=Dn(r);e.push(yn(s,i))}}return t.all(e).then((function(){for(var e=0;e<arguments[0].length;e++){var t=arguments[0][e],n=new RegExp(/asset_id=([^&]*)/),r=n.exec(o[e])[1],i=o[e].substring(o[e].lastIndexOf("/")+1);a.push({name:r+"."+i,assetId:r,blob:t})}return a})).catch((function(e){Fe.error("getCompositeImageFiles fail-1",e)}))})).catch((function(e){Fe.error("getCompositeImageFiles fail-2",e)}))}))},We.includesUploadedFonts=function(){return!!Me&&Me.includesUploadedFonts()},We.includesPaidAdobeFonts=function(){return Me?Me.getDocFontSourceUsage().indexOf(ee.describeFontSource(ee.FontSource.TYPEKIT_PREMIUM))>-1:(Fe.warn("includesPaidAdobeFonts: Unable to get font usage info from doc - coreWrapper unavailable"),"unknown")},We.getRemixParentsCpIds=function(){return Me?Me.getRemixParentsCpIds():(Fe.warn("getRemixParentsCpIds: Unable to get remix parent ids from doc - coreWrapper unavailable"),null)},We.getConstrainedImages=function(){return Me?Me.getConstrainedImages():(Fe.warn("getConstrainedImages: Unable to get constrained images info from doc - coreWrapper unavailable"),null)},We.getFontsUsed=function(){var e=t.defer();return Ge.promise.done((function(){Me?e.resolve(Me.getFontsUsed()):e.reject("coreWrapper is undefined")})),e.promise},We.setCPProjectId=function(e){Me&&Me.setCPProjectID(e)},We.setCPAlias=function(e){Me&&Me.setCommunityPlatformAlias(e)},We.setCPAssetId=function(e){Me&&Me.setCommunityPlatformAssetID(e)},We.setPublishedContentEtag=function(e){Me&&Me.setPublishedEtag(e)},We}.apply(t,n))||(e.exports=a)}}]);
//# sourceMappingURL=theo-web-view_e27cd5be-9ff76607.js.map